module.exports=[54826,(a,b,c)=>{},15299,(a,b,c)=>{a.r(54826);var d=a.r(72131),e=d&&"object"==typeof d&&"default"in d?d:{default:d},f="u">typeof process&&process.env&&!0,g=function(a){return"[object String]"===Object.prototype.toString.call(a)},h=function(){function a(a){var b=void 0===a?{}:a,c=b.name,d=void 0===c?"stylesheet":c,e=b.optimizeForSpeed,h=void 0===e?f:e;i(g(d),"`name` must be a string"),this._name=d,this._deletedRulePlaceholder="#"+d+"-deleted-rule____{}",i("boolean"==typeof h,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=h,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0,this._nonce=null}var b,c=a.prototype;return c.setOptimizeForSpeed=function(a){i("boolean"==typeof a,"`setOptimizeForSpeed` accepts a boolean"),i(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=a,this.inject()},c.isOptimizeForSpeed=function(){return this._optimizeForSpeed},c.inject=function(){var a=this;i(!this._injected,"sheet already injected"),this._injected=!0,this._serverSheet={cssRules:[],insertRule:function(b,c){return"number"==typeof c?a._serverSheet.cssRules[c]={cssText:b}:a._serverSheet.cssRules.push({cssText:b}),c},deleteRule:function(b){a._serverSheet.cssRules[b]=null}}},c.getSheetForTag=function(a){if(a.sheet)return a.sheet;for(var b=0;b<document.styleSheets.length;b++)if(document.styleSheets[b].ownerNode===a)return document.styleSheets[b]},c.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},c.insertRule=function(a,b){return i(g(a),"`insertRule` accepts only strings"),"number"!=typeof b&&(b=this._serverSheet.cssRules.length),this._serverSheet.insertRule(a,b),this._rulesCount++},c.replaceRule=function(a,b){this._optimizeForSpeed;var c=this._serverSheet;if(b.trim()||(b=this._deletedRulePlaceholder),!c.cssRules[a])return a;c.deleteRule(a);try{c.insertRule(b,a)}catch(d){f||console.warn("StyleSheet: illegal rule: \n\n"+b+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),c.insertRule(this._deletedRulePlaceholder,a)}return a},c.deleteRule=function(a){this._serverSheet.deleteRule(a)},c.flush=function(){this._injected=!1,this._rulesCount=0,this._serverSheet.cssRules=[]},c.cssRules=function(){return this._serverSheet.cssRules},c.makeStyleTag=function(a,b,c){b&&i(g(b),"makeStyleTag accepts only strings as second parameter");var d=document.createElement("style");this._nonce&&d.setAttribute("nonce",this._nonce),d.type="text/css",d.setAttribute("data-"+a,""),b&&d.appendChild(document.createTextNode(b));var e=document.head||document.getElementsByTagName("head")[0];return c?e.insertBefore(d,c):e.appendChild(d),d},b=[{key:"length",get:function(){return this._rulesCount}}],function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}(a.prototype,b),a}();function i(a,b){if(!a)throw Error("StyleSheet: "+b+".")}var j=function(a){for(var b=5381,c=a.length;c;)b=33*b^a.charCodeAt(--c);return b>>>0},k={};function l(a,b){if(!b)return"jsx-"+a;var c=String(b),d=a+c;return k[d]||(k[d]="jsx-"+j(a+"-"+c)),k[d]}function m(a,b){var c=a+(b=b.replace(/\/style/gi,"\\/style"));return k[c]||(k[c]=b.replace(/__jsx-style-dynamic-selector/g,a)),k[c]}var n=function(){function a(a){var b=void 0===a?{}:a,c=b.styleSheet,d=void 0===c?null:c,e=b.optimizeForSpeed,f=void 0!==e&&e;this._sheet=d||new h({name:"styled-jsx",optimizeForSpeed:f}),this._sheet.inject(),d&&"boolean"==typeof f&&(this._sheet.setOptimizeForSpeed(f),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var b=a.prototype;return b.add=function(a){var b=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(a.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed());var c=this.getIdAndRules(a),d=c.styleId,e=c.rules;if(d in this._instancesCounts){this._instancesCounts[d]+=1;return}var f=e.map(function(a){return b._sheet.insertRule(a)}).filter(function(a){return -1!==a});this._indices[d]=f,this._instancesCounts[d]=1},b.remove=function(a){var b=this,c=this.getIdAndRules(a).styleId;if(function(a,b){if(!a)throw Error("StyleSheetRegistry: "+b+".")}(c in this._instancesCounts,"styleId: `"+c+"` not found"),this._instancesCounts[c]-=1,this._instancesCounts[c]<1){var d=this._fromServer&&this._fromServer[c];d?(d.parentNode.removeChild(d),delete this._fromServer[c]):(this._indices[c].forEach(function(a){return b._sheet.deleteRule(a)}),delete this._indices[c]),delete this._instancesCounts[c]}},b.update=function(a,b){this.add(b),this.remove(a)},b.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},b.cssRules=function(){var a=this,b=this._fromServer?Object.keys(this._fromServer).map(function(b){return[b,a._fromServer[b]]}):[],c=this._sheet.cssRules();return b.concat(Object.keys(this._indices).map(function(b){return[b,a._indices[b].map(function(a){return c[a].cssText}).join(a._optimizeForSpeed?"":"\n")]}).filter(function(a){return!!a[1]}))},b.styles=function(a){var b,c;return b=this.cssRules(),void 0===(c=a)&&(c={}),b.map(function(a){var b=a[0],d=a[1];return e.default.createElement("style",{id:"__"+b,key:"__"+b,nonce:c.nonce?c.nonce:void 0,dangerouslySetInnerHTML:{__html:d}})})},b.getIdAndRules=function(a){var b=a.children,c=a.dynamic,d=a.id;if(c){var e=l(d,c);return{styleId:e,rules:Array.isArray(b)?b.map(function(a){return m(e,a)}):[m(e,b)]}}return{styleId:l(d),rules:Array.isArray(b)?b:[b]}},b.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(a,b){return a[b.id.slice(2)]=b,a},{})},a}(),o=d.createContext(null);function p(){return new n}function q(){return d.useContext(o)}function r(a){var b=q();return b&&b.add(a),null}o.displayName="StyleSheetContext",e.default.useInsertionEffect||e.default.useLayoutEffect,r.dynamic=function(a){return a.map(function(a){return l(a[0],a[1])}).join(" ")},c.StyleRegistry=function(a){var b=a.registry,c=a.children,f=d.useContext(o),g=d.useState(function(){return f||b||p()})[0];return e.default.createElement(o.Provider,{value:g},c)},c.createStyleRegistry=p,c.style=r,c.useStyleRegistry=q},31626,(a,b,c)=>{b.exports=a.r(15299).style},33354,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},92434,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"warnOnce",{enumerable:!0,get:function(){return d}});let d=a=>{}},68063,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={getDeploymentId:function(){return f},getDeploymentIdQueryOrEmptyString:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});function f(){return!1}function g(){return""}},4987,(a,b,c)=>{"use strict";function d({widthInt:a,heightInt:b,blurWidth:c,blurHeight:d,blurDataURL:e,objectFit:f}){let g=c?40*c:a,h=d?40*d:b,i=g&&h?`viewBox='0 0 ${g} ${h}'`:"";return`%3Csvg xmlns='http://www.w3.org/2000/svg' ${i}%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='${i?"none":"contain"===f?"xMidYMid":"cover"===f?"xMidYMid slice":"none"}' style='filter: url(%23b);' href='${e}'/%3E%3C/svg%3E`}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"getImageBlurSvg",{enumerable:!0,get:function(){return d}})},345,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={VALID_LOADERS:function(){return f},imageConfigDefault:function(){return g}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=["default","imgix","cloudinary","akamai","custom"],g={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:14400,formats:["image/webp"],maximumRedirects:3,dangerouslyAllowLocalIP:!1,dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:[75],unoptimized:!1}},94915,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"getImgProps",{enumerable:!0,get:function(){return j}}),a.r(92434);let d=a.r(68063),e=a.r(4987),f=a.r(345),g=["-moz-initial","fill","none","scale-down",void 0];function h(a){return void 0!==a.default}function i(a){return void 0===a?a:"number"==typeof a?Number.isFinite(a)?a:NaN:"string"==typeof a&&/^[0-9]+$/.test(a)?parseInt(a,10):NaN}function j({src:a,sizes:b,unoptimized:c=!1,priority:j=!1,preload:k=!1,loading:l,className:m,quality:n,width:o,height:p,fill:q=!1,style:r,overrideSrc:s,onLoad:t,onLoadingComplete:u,placeholder:v="empty",blurDataURL:w,fetchPriority:x,decoding:y="async",layout:z,objectFit:A,objectPosition:B,lazyBoundary:C,lazyRoot:D,...E},F){var G;let H,I,J,{imgConf:K,showAltText:L,blurComplete:M,defaultLoader:N}=F,O=K||f.imageConfigDefault;if("allSizes"in O)H=O;else{let a=[...O.deviceSizes,...O.imageSizes].sort((a,b)=>a-b),b=O.deviceSizes.sort((a,b)=>a-b),c=O.qualities?.sort((a,b)=>a-b);H={...O,allSizes:a,deviceSizes:b,qualities:c}}if(void 0===N)throw Object.defineProperty(Error("images.loaderFile detected but the file is missing default export.\nRead more: https://nextjs.org/docs/messages/invalid-images-config"),"__NEXT_ERROR_CODE",{value:"E163",enumerable:!1,configurable:!0});let P=E.loader||N;delete E.loader,delete E.srcSet;let Q="__next_img_default"in P;if(Q){if("custom"===H.loader)throw Object.defineProperty(Error(`Image with src "${a}" is missing "loader" prop.
Read more: https://nextjs.org/docs/messages/next-image-missing-loader`),"__NEXT_ERROR_CODE",{value:"E252",enumerable:!1,configurable:!0})}else{let a=P;P=b=>{let{config:c,...d}=b;return a(d)}}if(z){"fill"===z&&(q=!0);let a={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[z];a&&(r={...r,...a});let c={responsive:"100vw",fill:"100vw"}[z];c&&!b&&(b=c)}let R="",S=i(o),T=i(p);if((G=a)&&"object"==typeof G&&(h(G)||void 0!==G.src)){let b=h(a)?a.default:a;if(!b.src)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received ${JSON.stringify(b)}`),"__NEXT_ERROR_CODE",{value:"E460",enumerable:!1,configurable:!0});if(!b.height||!b.width)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received ${JSON.stringify(b)}`),"__NEXT_ERROR_CODE",{value:"E48",enumerable:!1,configurable:!0});if(I=b.blurWidth,J=b.blurHeight,w=w||b.blurDataURL,R=b.src,!q)if(S||T){if(S&&!T){let a=S/b.width;T=Math.round(b.height*a)}else if(!S&&T){let a=T/b.height;S=Math.round(b.width*a)}}else S=b.width,T=b.height}let U=!j&&!k&&("lazy"===l||void 0===l);(!(a="string"==typeof a?a:R)||a.startsWith("data:")||a.startsWith("blob:"))&&(c=!0,U=!1),H.unoptimized&&(c=!0),Q&&!H.dangerouslyAllowSVG&&a.split("?",1)[0].endsWith(".svg")&&(c=!0);let V=i(n),W=Object.assign(q?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:A,objectPosition:B}:{},L?{}:{color:"transparent"},r),X=M||"empty"===v?null:"blur"===v?`url("data:image/svg+xml;charset=utf-8,${(0,e.getImageBlurSvg)({widthInt:S,heightInt:T,blurWidth:I,blurHeight:J,blurDataURL:w||"",objectFit:W.objectFit})}")`:`url("${v}")`,Y=g.includes(W.objectFit)?"fill"===W.objectFit?"100% 100%":"cover":W.objectFit,Z=X?{backgroundSize:Y,backgroundPosition:W.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:X}:{},$=function({config:a,src:b,unoptimized:c,width:e,quality:f,sizes:g,loader:h}){if(c){let a=(0,d.getDeploymentId)();if(b.startsWith("/")&&!b.startsWith("//")&&a){let c=b.includes("?")?"&":"?";b=`${b}${c}dpl=${a}`}return{src:b,srcSet:void 0,sizes:void 0}}let{widths:i,kind:j}=function({deviceSizes:a,allSizes:b},c,d){if(d){let c=/(^|\s)(1?\d?\d)vw/g,e=[];for(let a;a=c.exec(d);)e.push(parseInt(a[2]));if(e.length){let c=.01*Math.min(...e);return{widths:b.filter(b=>b>=a[0]*c),kind:"w"}}return{widths:b,kind:"w"}}return"number"!=typeof c?{widths:a,kind:"w"}:{widths:[...new Set([c,2*c].map(a=>b.find(b=>b>=a)||b[b.length-1]))],kind:"x"}}(a,e,g),k=i.length-1;return{sizes:g||"w"!==j?g:"100vw",srcSet:i.map((c,d)=>`${h({config:a,src:b,quality:f,width:c})} ${"w"===j?c:d+1}${j}`).join(", "),src:h({config:a,src:b,quality:f,width:i[k]})}}({config:H,src:a,unoptimized:c,width:S,quality:V,sizes:b,loader:P}),_=U?"lazy":l;return{props:{...E,loading:_,fetchPriority:x,width:S,height:T,decoding:y,className:m,style:{...W,...Z},sizes:$.sizes,srcSet:$.srcSet,src:s||$.src},meta:{unoptimized:c,preload:k||j,placeholder:v,fill:q}}}},94613,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return f}});let d=a.r(72131),e=()=>{};function f(a){let{headManager:b,reduceComponentsToState:c}=a;function f(){if(b&&b.mountedInstances){let a=d.Children.toArray(Array.from(b.mountedInstances).filter(Boolean));b.updateHead(c(a))}}return b?.mountedInstances?.add(a.children),f(),e(()=>(b?.mountedInstances?.add(a.children),()=>{b?.mountedInstances?.delete(a.children)})),e(()=>(b&&(b._pendingUpdate=f),()=>{b&&(b._pendingUpdate=f)})),null}},92966,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HeadManagerContext},58018,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return p},defaultHead:function(){return l}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(33354),g=a.r(46058),h=a.r(87924),i=g._(a.r(72131)),j=f._(a.r(94613)),k=a.r(92966);function l(){return[(0,h.jsx)("meta",{charSet:"utf-8"},"charset"),(0,h.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")]}function m(a,b){return"string"==typeof b||"number"==typeof b?a:b.type===i.default.Fragment?a.concat(i.default.Children.toArray(b.props.children).reduce((a,b)=>"string"==typeof b||"number"==typeof b?a:a.concat(b),[])):a.concat(b)}a.r(92434);let n=["name","httpEquiv","charSet","itemProp"];function o(a){let b,c,d,e;return a.reduce(m,[]).reverse().concat(l().reverse()).filter((b=new Set,c=new Set,d=new Set,e={},a=>{let f=!0,g=!1;if(a.key&&"number"!=typeof a.key&&a.key.indexOf("$")>0){g=!0;let c=a.key.slice(a.key.indexOf("$")+1);b.has(c)?f=!1:b.add(c)}switch(a.type){case"title":case"base":c.has(a.type)?f=!1:c.add(a.type);break;case"meta":for(let b=0,c=n.length;b<c;b++){let c=n[b];if(a.props.hasOwnProperty(c))if("charSet"===c)d.has(c)?f=!1:d.add(c);else{let b=a.props[c],d=e[c]||new Set;("name"!==c||!g)&&d.has(b)?f=!1:(d.add(b),e[c]=d)}}}return f})).reverse().map((a,b)=>{let c=a.key||b;return i.default.cloneElement(a,{key:c})})}let p=function({children:a}){let b=(0,i.useContext)(k.HeadManagerContext);return(0,h.jsx)(j.default,{reduceComponentsToState:o,headManager:b,children:a})};("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},4486,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ImageConfigContext},53773,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.RouterContext},35444,(a,b,c)=>{"use strict";function d(a,b){let c=a||75;return b?.qualities?.length?b.qualities.reduce((a,b)=>Math.abs(b-c)<Math.abs(a-c)?b:a,0):c}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"findClosestQuality",{enumerable:!0,get:function(){return d}})},2305,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return g}});let d=a.r(35444),e=a.r(68063);function f({config:a,src:b,width:c,quality:f}){if(b.startsWith("/")&&b.includes("?")&&a.localPatterns?.length===1&&"**"===a.localPatterns[0].pathname&&""===a.localPatterns[0].search)throw Object.defineProperty(Error(`Image with src "${b}" is using a query string which is not configured in images.localPatterns.
Read more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`),"__NEXT_ERROR_CODE",{value:"E871",enumerable:!1,configurable:!0});let g=(0,d.findClosestQuality)(f,a),h=(0,e.getDeploymentId)();return`${a.path}?url=${encodeURIComponent(b)}&w=${c}&q=${g}${b.startsWith("/")&&h?`&dpl=${h}`:""}`}f.__next_img_default=!0;let g=f},8591,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"useMergedRef",{enumerable:!0,get:function(){return e}});let d=a.r(72131);function e(a,b){let c=(0,d.useRef)(null),e=(0,d.useRef)(null);return(0,d.useCallback)(d=>{if(null===d){let a=c.current;a&&(c.current=null,a());let b=e.current;b&&(e.current=null,b())}else a&&(c.current=f(a,d)),b&&(e.current=f(b,d))},[a,b])}function f(a,b){if("function"!=typeof a)return a.current=b,()=>{a.current=null};{let c=a(b);return"function"==typeof c?c:()=>a(null)}}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},67161,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"Image",{enumerable:!0,get:function(){return u}});let d=a.r(33354),e=a.r(46058),f=a.r(87924),g=e._(a.r(72131)),h=d._(a.r(35112)),i=d._(a.r(58018)),j=a.r(94915),k=a.r(345),l=a.r(4486);a.r(92434);let m=a.r(53773),n=d._(a.r(2305)),o=a.r(8591),p={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1};function q(a,b,c,d,e,f,g){let h=a?.src;a&&a["data-loaded-src"]!==h&&(a["data-loaded-src"]=h,("decode"in a?a.decode():Promise.resolve()).catch(()=>{}).then(()=>{if(a.parentElement&&a.isConnected){if("empty"!==b&&e(!0),c?.current){let b=new Event("load");Object.defineProperty(b,"target",{writable:!1,value:a});let d=!1,e=!1;c.current({...b,nativeEvent:b,currentTarget:a,target:a,isDefaultPrevented:()=>d,isPropagationStopped:()=>e,persist:()=>{},preventDefault:()=>{d=!0,b.preventDefault()},stopPropagation:()=>{e=!0,b.stopPropagation()}})}d?.current&&d.current(a)}}))}function r(a){return g.use?{fetchPriority:a}:{fetchpriority:a}}globalThis.__NEXT_IMAGE_IMPORTED=!0;let s=(0,g.forwardRef)(({src:a,srcSet:b,sizes:c,height:d,width:e,decoding:h,className:i,style:j,fetchPriority:k,placeholder:l,loading:m,unoptimized:n,fill:p,onLoadRef:s,onLoadingCompleteRef:t,setBlurComplete:u,setShowAltText:v,sizesInput:w,onLoad:x,onError:y,...z},A)=>{let B=(0,g.useCallback)(a=>{a&&(y&&(a.src=a.src),a.complete&&q(a,l,s,t,u,n,w))},[a,l,s,t,u,y,n,w]),C=(0,o.useMergedRef)(A,B);return(0,f.jsx)("img",{...z,...r(k),loading:m,width:e,height:d,decoding:h,"data-nimg":p?"fill":"1",className:i,style:j,sizes:c,srcSet:b,src:a,ref:C,onLoad:a=>{q(a.currentTarget,l,s,t,u,n,w)},onError:a=>{v(!0),"empty"!==l&&u(!0),y&&y(a)}})});function t({isAppRouter:a,imgAttributes:b}){let c={as:"image",imageSrcSet:b.srcSet,imageSizes:b.sizes,crossOrigin:b.crossOrigin,referrerPolicy:b.referrerPolicy,...r(b.fetchPriority)};return a&&h.default.preload?(h.default.preload(b.src,c),null):(0,f.jsx)(i.default,{children:(0,f.jsx)("link",{rel:"preload",href:b.srcSet?void 0:b.src,...c},"__nimg-"+b.src+b.srcSet+b.sizes)})}let u=(0,g.forwardRef)((a,b)=>{let c=(0,g.useContext)(m.RouterContext),d=(0,g.useContext)(l.ImageConfigContext),e=(0,g.useMemo)(()=>{let a=p||d||k.imageConfigDefault,b=[...a.deviceSizes,...a.imageSizes].sort((a,b)=>a-b),c=a.deviceSizes.sort((a,b)=>a-b),e=a.qualities?.sort((a,b)=>a-b);return{...a,allSizes:b,deviceSizes:c,qualities:e,localPatterns:d?.localPatterns}},[d]),{onLoad:h,onLoadingComplete:i}=a,o=(0,g.useRef)(h);(0,g.useEffect)(()=>{o.current=h},[h]);let q=(0,g.useRef)(i);(0,g.useEffect)(()=>{q.current=i},[i]);let[r,u]=(0,g.useState)(!1),[v,w]=(0,g.useState)(!1),{props:x,meta:y}=(0,j.getImgProps)(a,{defaultLoader:n.default,imgConf:e,blurComplete:r,showAltText:v});return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(s,{...x,unoptimized:y.unoptimized,placeholder:y.placeholder,fill:y.fill,onLoadRef:o,onLoadingCompleteRef:q,setBlurComplete:u,setShowAltText:w,sizesInput:a.sizes,ref:b}),y.preload?(0,f.jsx)(t,{isAppRouter:!c,imgAttributes:x}):null]})});("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},33095,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return k},getImageProps:function(){return j}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(33354),g=a.r(94915),h=a.r(67161),i=f._(a.r(2305));function j(a){let{props:b}=(0,g.getImgProps)(a,{defaultLoader:i.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[a,c]of Object.entries(b))void 0===c&&delete b[a];return{props:b}}let k=h.Image},71987,(a,b,c)=>{b.exports=a.r(33095)},72124,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.default=class extends Error{constructor(a){super(a.message),this.name="PostgrestError",this.details=a.details,this.hint=a.hint,this.code=a.code}}},56592,(a,b,c)=>{"use strict";var d=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0});let e=d(a.r(23952)),f=d(a.r(72124));c.default=class{constructor(a){this.shouldThrowOnError=!1,this.method=a.method,this.url=a.url,this.headers=a.headers,this.schema=a.schema,this.body=a.body,this.shouldThrowOnError=a.shouldThrowOnError,this.signal=a.signal,this.isMaybeSingle=a.isMaybeSingle,a.fetch?this.fetch=a.fetch:"u"<typeof fetch?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(a,b){return this.headers=Object.assign({},this.headers),this.headers[a]=b,this}then(a,b){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let c=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async a=>{var b,c,d;let e=null,g=null,h=null,i=a.status,j=a.statusText;if(a.ok){if("HEAD"!==this.method){let b=await a.text();""===b||(g="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?b:JSON.parse(b))}let d=null==(b=this.headers.Prefer)?void 0:b.match(/count=(exact|planned|estimated)/),f=null==(c=a.headers.get("content-range"))?void 0:c.split("/");d&&f&&f.length>1&&(h=parseInt(f[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(g)&&(g.length>1?(e={code:"PGRST116",details:`Results contain ${g.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},g=null,h=null,i=406,j="Not Acceptable"):g=1===g.length?g[0]:null)}else{let b=await a.text();try{e=JSON.parse(b),Array.isArray(e)&&404===a.status&&(g=[],e=null,i=200,j="OK")}catch(c){404===a.status&&""===b?(i=204,j="No Content"):e={message:b}}if(e&&this.isMaybeSingle&&(null==(d=null==e?void 0:e.details)?void 0:d.includes("0 rows"))&&(e=null,i=200,j="OK"),e&&this.shouldThrowOnError)throw new f.default(e)}return{error:e,data:g,count:h,status:i,statusText:j}});return this.shouldThrowOnError||(c=c.catch(a=>{var b,c,d;return{error:{message:`${null!=(b=null==a?void 0:a.name)?b:"FetchError"}: ${null==a?void 0:a.message}`,details:`${null!=(c=null==a?void 0:a.stack)?c:""}`,hint:"",code:`${null!=(d=null==a?void 0:a.code)?d:""}`},data:null,count:null,status:0,statusText:""}})),c.then(a,b)}}},98564,(a,b,c)=>{"use strict";var d=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0});let e=d(a.r(56592));class f extends e.default{select(a){let b=!1,c=(null!=a?a:"*").split("").map(a=>/\s/.test(a)&&!b?"":('"'===a&&(b=!b),a)).join("");return this.url.searchParams.set("select",c),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(a,{ascending:b=!0,nullsFirst:c,foreignTable:d,referencedTable:e=d}={}){let f=e?`${e}.order`:"order",g=this.url.searchParams.get(f);return this.url.searchParams.set(f,`${g?`${g},`:""}${a}.${b?"asc":"desc"}${void 0===c?"":c?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:b,referencedTable:c=b}={}){let d=void 0===c?"limit":`${c}.limit`;return this.url.searchParams.set(d,`${a}`),this}range(a,b,{foreignTable:c,referencedTable:d=c}={}){let e=void 0===d?"offset":`${d}.offset`,f=void 0===d?"limit":`${d}.limit`;return this.url.searchParams.set(e,`${a}`),this.url.searchParams.set(f,`${b-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:a=!1,verbose:b=!1,settings:c=!1,buffers:d=!1,wal:e=!1,format:f="text"}={}){var g;let h=[a?"analyze":null,b?"verbose":null,c?"settings":null,d?"buffers":null,e?"wal":null].filter(Boolean).join("|"),i=null!=(g=this.headers.Accept)?g:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${f}; for="${i}"; options=${h};`,this}rollback(){var a;return(null!=(a=this.headers.Prefer)?a:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}c.default=f},19001,(a,b,c)=>{"use strict";var d=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0});let e=d(a.r(98564));class f extends e.default{eq(a,b){return this.url.searchParams.append(a,`eq.${b}`),this}neq(a,b){return this.url.searchParams.append(a,`neq.${b}`),this}gt(a,b){return this.url.searchParams.append(a,`gt.${b}`),this}gte(a,b){return this.url.searchParams.append(a,`gte.${b}`),this}lt(a,b){return this.url.searchParams.append(a,`lt.${b}`),this}lte(a,b){return this.url.searchParams.append(a,`lte.${b}`),this}like(a,b){return this.url.searchParams.append(a,`like.${b}`),this}likeAllOf(a,b){return this.url.searchParams.append(a,`like(all).{${b.join(",")}}`),this}likeAnyOf(a,b){return this.url.searchParams.append(a,`like(any).{${b.join(",")}}`),this}ilike(a,b){return this.url.searchParams.append(a,`ilike.${b}`),this}ilikeAllOf(a,b){return this.url.searchParams.append(a,`ilike(all).{${b.join(",")}}`),this}ilikeAnyOf(a,b){return this.url.searchParams.append(a,`ilike(any).{${b.join(",")}}`),this}is(a,b){return this.url.searchParams.append(a,`is.${b}`),this}in(a,b){let c=Array.from(new Set(b)).map(a=>"string"==typeof a&&RegExp("[,()]").test(a)?`"${a}"`:`${a}`).join(",");return this.url.searchParams.append(a,`in.(${c})`),this}contains(a,b){return"string"==typeof b?this.url.searchParams.append(a,`cs.${b}`):Array.isArray(b)?this.url.searchParams.append(a,`cs.{${b.join(",")}}`):this.url.searchParams.append(a,`cs.${JSON.stringify(b)}`),this}containedBy(a,b){return"string"==typeof b?this.url.searchParams.append(a,`cd.${b}`):Array.isArray(b)?this.url.searchParams.append(a,`cd.{${b.join(",")}}`):this.url.searchParams.append(a,`cd.${JSON.stringify(b)}`),this}rangeGt(a,b){return this.url.searchParams.append(a,`sr.${b}`),this}rangeGte(a,b){return this.url.searchParams.append(a,`nxl.${b}`),this}rangeLt(a,b){return this.url.searchParams.append(a,`sl.${b}`),this}rangeLte(a,b){return this.url.searchParams.append(a,`nxr.${b}`),this}rangeAdjacent(a,b){return this.url.searchParams.append(a,`adj.${b}`),this}overlaps(a,b){return"string"==typeof b?this.url.searchParams.append(a,`ov.${b}`):this.url.searchParams.append(a,`ov.{${b.join(",")}}`),this}textSearch(a,b,{config:c,type:d}={}){let e="";"plain"===d?e="pl":"phrase"===d?e="ph":"websearch"===d&&(e="w");let f=void 0===c?"":`(${c})`;return this.url.searchParams.append(a,`${e}fts${f}.${b}`),this}match(a){return Object.entries(a).forEach(([a,b])=>{this.url.searchParams.append(a,`eq.${b}`)}),this}not(a,b,c){return this.url.searchParams.append(a,`not.${b}.${c}`),this}or(a,{foreignTable:b,referencedTable:c=b}={}){let d=c?`${c}.or`:"or";return this.url.searchParams.append(d,`(${a})`),this}filter(a,b,c){return this.url.searchParams.append(a,`${b}.${c}`),this}}c.default=f},3619,(a,b,c)=>{"use strict";var d=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0});let e=d(a.r(19001));c.default=class{constructor(a,{headers:b={},schema:c,fetch:d}){this.url=a,this.headers=b,this.schema=c,this.fetch=d}select(a,{head:b=!1,count:c}={}){let d=!1,f=(null!=a?a:"*").split("").map(a=>/\s/.test(a)&&!d?"":('"'===a&&(d=!d),a)).join("");return this.url.searchParams.set("select",f),c&&(this.headers.Prefer=`count=${c}`),new e.default({method:b?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(a,{count:b,defaultToNull:c=!0}={}){let d=[];if(this.headers.Prefer&&d.push(this.headers.Prefer),b&&d.push(`count=${b}`),c||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(a)){let b=a.reduce((a,b)=>a.concat(Object.keys(b)),[]);if(b.length>0){let a=[...new Set(b)].map(a=>`"${a}"`);this.url.searchParams.set("columns",a.join(","))}}return new e.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}upsert(a,{onConflict:b,ignoreDuplicates:c=!1,count:d,defaultToNull:f=!0}={}){let g=[`resolution=${c?"ignore":"merge"}-duplicates`];if(void 0!==b&&this.url.searchParams.set("on_conflict",b),this.headers.Prefer&&g.push(this.headers.Prefer),d&&g.push(`count=${d}`),f||g.push("missing=default"),this.headers.Prefer=g.join(","),Array.isArray(a)){let b=a.reduce((a,b)=>a.concat(Object.keys(b)),[]);if(b.length>0){let a=[...new Set(b)].map(a=>`"${a}"`);this.url.searchParams.set("columns",a.join(","))}}return new e.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}update(a,{count:b}={}){let c=[];return this.headers.Prefer&&c.push(this.headers.Prefer),b&&c.push(`count=${b}`),this.headers.Prefer=c.join(","),new e.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:this.fetch,allowEmpty:!1})}delete({count:a}={}){let b=[];return a&&b.push(`count=${a}`),this.headers.Prefer&&b.unshift(this.headers.Prefer),this.headers.Prefer=b.join(","),new e.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}},84589,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.version=void 0,c.version="0.0.0-automated"},37418,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),c.DEFAULT_HEADERS=void 0;let d=a.r(84589);c.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${d.version}`}},27749,(a,b,c)=>{"use strict";var d=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0});let e=d(a.r(3619)),f=d(a.r(19001)),g=a.r(37418);class h{constructor(a,{headers:b={},schema:c,fetch:d}={}){this.url=a,this.headers=Object.assign(Object.assign({},g.DEFAULT_HEADERS),b),this.schemaName=c,this.fetch=d}from(a){let b=new URL(`${this.url}/${a}`);return new e.default(b,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new h(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,b={},{head:c=!1,get:d=!1,count:e}={}){let g,h,i=new URL(`${this.url}/rpc/${a}`);c||d?(g=c?"HEAD":"GET",Object.entries(b).filter(([a,b])=>void 0!==b).map(([a,b])=>[a,Array.isArray(b)?`{${b.join(",")}}`:`${b}`]).forEach(([a,b])=>{i.searchParams.append(a,b)})):(g="POST",h=b);let j=Object.assign({},this.headers);return e&&(j.Prefer=`count=${e}`),new f.default({method:g,url:i,headers:j,schema:this.schemaName,body:h,fetch:this.fetch,allowEmpty:!1})}}c.default=h},79614,(a,b,c)=>{"use strict";var d=a.e&&a.e.__importDefault||function(a){return a&&a.__esModule?a:{default:a}};Object.defineProperty(c,"__esModule",{value:!0}),c.PostgrestError=c.PostgrestBuilder=c.PostgrestTransformBuilder=c.PostgrestFilterBuilder=c.PostgrestQueryBuilder=c.PostgrestClient=void 0;let e=d(a.r(27749));c.PostgrestClient=e.default;let f=d(a.r(3619));c.PostgrestQueryBuilder=f.default;let g=d(a.r(19001));c.PostgrestFilterBuilder=g.default;let h=d(a.r(98564));c.PostgrestTransformBuilder=h.default;let i=d(a.r(56592));c.PostgrestBuilder=i.default;let j=d(a.r(72124));c.PostgrestError=j.default,c.default={PostgrestClient:e.default,PostgrestQueryBuilder:f.default,PostgrestFilterBuilder:g.default,PostgrestTransformBuilder:h.default,PostgrestBuilder:i.default,PostgrestError:j.default}},23605,a=>{"use strict";let b,c,d,e,f,g,h;var i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=a.i(87924),K=a.i(72131),L=a.i(70106);let M=(0,L.default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),N=()=>(0,J.jsxs)("div",{className:"loader-container",children:[(0,J.jsx)("div",{className:"peeking-photo-icon",children:(0,J.jsx)(M,{strokeWidth:1.5})}),(0,J.jsxs)("div",{className:"shield-container",children:[Array.from({length:150}).map((a,b)=>(0,J.jsx)("div",{className:"particle",style:{animationDelay:`${b%10*.1+.02*Math.floor(b/10)}s`}},b)),(0,J.jsxs)("div",{className:"shield-structure",children:[(0,J.jsx)("div",{className:"structure-line line-1"}),(0,J.jsx)("div",{className:"structure-line line-2"}),(0,J.jsx)("div",{className:"structure-line line-3"}),(0,J.jsx)("div",{className:"structure-line line-4"})]})]}),(0,J.jsx)("div",{className:"loading-text",children:"LÃ„DT..."})]});var O=a.i(31626);let P=(0,L.default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var Q=a.i(43108),R=a.i(77156);let S=(0,L.default)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var T=a.i(96221),U=a.i(71987),V=a.i(68114);let W={key:"/key.svg",lock:"/lock.svg",shield:"/shield.svg",upload:"/upload.svg",smartphone:"/smartphone.svg",cloud:"/cloud.svg",clock:"/clock.svg",search:"/search.svg",image:"/image.svg",folder:"/Openfolder.svg",refresh:"/RefreshCw.svg",chevronRight:"/ChevronRight.svg"};function X({name:a,className:b,size:c=24}){return(0,J.jsx)("div",{className:(0,V.cn)("relative inline-block shrink-0",b),style:{width:c,height:c},children:(0,J.jsx)(U.default,{src:W[a],alt:a,fill:!0,className:"object-contain",unoptimized:!0})})}var Y=a.i(29139),Z=a.i(47241);function $({children:a,className:b="",onClick:c,variant:d="default"}){let e=(0,K.useMemo)(()=>Array.from({length:12},()=>(Math.random()-.5)*6),[]),f={default:{fill:"#FFFFFF",stroke:"#2563EB",strokeWidth:3},elevated:{fill:"#FFFFFF",stroke:"#2563EB",strokeWidth:4},outline:{fill:"transparent",stroke:"#3B82F6",strokeWidth:2}}[d];return(0,J.jsxs)("div",{onClick:c,className:`
        relative
        ${c?"cursor-pointer hover:scale-[1.01] active:scale-[0.99]":""}
        transition-transform duration-150
        ${b}
      `,children:[(0,J.jsxs)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",preserveAspectRatio:"none",children:[(0,J.jsx)("defs",{children:(0,J.jsxs)("filter",{id:"card-rough",x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,J.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.04",numOctaves:"2",result:"noise"}),(0,J.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1"})]})}),(0,J.jsx)("path",{d:`
            M ${5+e[0]}% ${3+e[1]}%
            Q 25% ${-.5+e[2]}%, 50% ${2+e[3]}%
            Q 75% -0.5%, ${95+e[4]}% 3%
            Q 100.5% 25%, 97% 50%
            Q 100.5% 75%, ${95+e[5]}% 97%
            Q 75% 100.5%, 50% ${97+e[6]}%
            Q 25% 100.5%, ${5+e[7]}% 97%
            Q -0.5% 75%, 3% 50%
            Q -0.5% 25%, ${5+e[8]}% 3%
            Z
          `,fill:f.fill,stroke:f.stroke,strokeWidth:f.strokeWidth,strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#card-rough)"}}),(0,J.jsx)("path",{d:`
            M ${6+e[9]}% ${4+e[10]}%
            Q 25% 0.5%, 50% 3%
            Q 75% 0.5%, ${94+e[11]}% 4%
            Q 99.5% 25%, 96% 50%
            Q 99.5% 75%, 94% 96%
            Q 75% 99.5%, 50% 96%
            Q 25% 99.5%, 6% 96%
            Q 0.5% 75%, 4% 50%
            Q 0.5% 25%, 6% 4%
            Z
          `,fill:"none",stroke:f.stroke,strokeWidth:"1",strokeLinecap:"round",opacity:"0.4"}),"elevated"===d&&(0,J.jsx)("path",{d:`
              M 7% 6%
              Q 25% 2%, 50% 5%
              Q 75% 2%, 93% 6%
              Q 98% 25%, 95% 50%
              Q 98% 75%, 93% 95%
              Q 75% 98%, 50% 95%
              Q 25% 98%, 7% 95%
              Q 2% 75%, 5% 50%
              Q 2% 25%, 7% 6%
              Z
            `,fill:"none",stroke:"#1E40AF",strokeWidth:"2",opacity:"0.2",transform:"translate(3, 3)"})]}),(0,J.jsx)("div",{className:"relative z-10 p-6",children:a})]})}function _({checked:a,onChange:b,label:c,disabled:d=!1}){let e=(0,K.useMemo)(()=>Array.from({length:8},()=>(Math.random()-.5)*3),[]),f=`
    M ${16+e[0]} ${2+e[1]}
    Q 30 0, ${44+e[2]} 2
    Q 58 6, ${58+e[3]} 16
    Q 58 26, 44 ${30+e[4]}
    Q 30 32, ${16+e[5]} 30
    Q 2 26, ${2+e[6]} 16
    Q 2 6, ${16+e[7]} 2
    Z
  `,g=a=>{let b="";for(let c=0;c<=16;c++){let d=c/16*Math.PI*2,e=.96*Math.sin(3*c),f=a+(12+e)*Math.cos(d),g=16+(12+e)*Math.sin(d);b+=(0===c?"M ":"L ")+`${f} ${g} `}return b+"Z"},h=a?44:16;return(0,J.jsxs)("label",{className:`
        inline-flex items-center gap-3
        ${d?"opacity-50 cursor-not-allowed":"cursor-pointer"}
      `,children:[(0,J.jsx)("button",{type:"button",onClick:()=>!d&&b(!a),disabled:d,className:"relative focus:outline-none focus:ring-2 focus:ring-blue-300 rounded-full",style:{width:60,height:32},children:(0,J.jsxs)("svg",{width:60,height:32,viewBox:"0 0 60 32",children:[(0,J.jsx)("defs",{children:(0,J.jsxs)("filter",{id:"toggle-rough",x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,J.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.05",numOctaves:"2",result:"noise"}),(0,J.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1"})]})}),(0,J.jsx)("path",{d:f,fill:a?"#2563EB":"#E5E7EB",stroke:a?"#1D4ED8":"#9CA3AF",strokeWidth:"2.5",strokeLinecap:"round",style:{filter:"url(#toggle-rough)"}}),(0,J.jsx)("path",{d:f,fill:"none",stroke:a?"#1E40AF":"#6B7280",strokeWidth:"1",opacity:"0.3",transform:"translate(1, 1)"}),(0,J.jsxs)("g",{style:{transition:"transform 0.2s ease-out"},children:[(0,J.jsx)("path",{d:g(h),fill:"#1E40AF",opacity:"0.15",transform:"translate(2, 2)"}),(0,J.jsx)("path",{d:g(h),fill:"#FFFFFF",stroke:"#2563EB",strokeWidth:"2.5",strokeLinecap:"round"}),(0,J.jsx)("path",{d:g(h),fill:"none",stroke:"#3B82F6",strokeWidth:"1",opacity:"0.4",transform:"scale(0.85)",style:{transformOrigin:`${h}px 16px`}})]})]})}),c&&(0,J.jsx)("span",{className:"font-['Google Sans',_sans-serif] text-xl text-[#1E40AF]",children:c})]})}function aa({icon:a,size:b=48,color:c="#2563EB",className:d=""}){let e=(0,K.useMemo)(()=>Array.from({length:20},()=>(Math.random()-.5)*2),[]),f=b>40?3:2;return(0,J.jsxs)("svg",{width:b,height:b,viewBox:`0 0 ${b} ${b}`,className:d,children:[(0,J.jsx)("defs",{children:(0,J.jsxs)("filter",{id:`icon-rough-${a}`,x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,J.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.03",numOctaves:"2",result:"noise"}),(0,J.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"0.5"})]})}),(0,J.jsx)("g",{style:{filter:`url(#icon-rough-${a})`},children:(()=>{switch(a){case"shield":return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("path",{d:`
                M ${b/2+e[0]} ${4+e[1]}
                Q ${b-6+e[2]} 6, ${b-6} ${b/3}
                Q ${b-6} ${.6*b}, ${b/2} ${b-4+e[3]}
                Q 6 ${.6*b}, ${6+e[4]} ${b/3}
                Q 6 6, ${b/2+e[5]} 4
                Z
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round",strokeLinejoin:"round"}),(0,J.jsx)("path",{d:`
                M ${.3*b+e[6]} ${.5*b}
                L ${.45*b} ${.65*b+e[7]}
                L ${.7*b+e[8]} ${.35*b}
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round",strokeLinejoin:"round"})]});case"photo":return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("path",{d:`
                M ${6+e[0]} ${8+e[1]}
                L ${b-6+e[2]} 8
                L ${b-6} ${b-8+e[3]}
                L ${6+e[4]} ${b-8}
                Z
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round",strokeLinejoin:"round"}),(0,J.jsx)("path",{d:`
                M ${10+e[5]} ${b-14}
                L ${.35*b} ${.45*b+e[6]}
                L ${.5*b} ${.55*b}
                L ${.65*b+e[7]} ${.4*b}
                L ${b-10} ${b-14+e[8]}
              `,fill:"none",stroke:c,strokeWidth:f-.5,strokeLinecap:"round",strokeLinejoin:"round"}),(0,J.jsx)("circle",{cx:.7*b,cy:.3*b,r:.08*b,fill:"none",stroke:c,strokeWidth:f-.5})]});case"clock":return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("path",{d:(()=>{let a="",c=b/2,d=b/2,f=b/2-6;for(let b=0;b<=24;b++){let g=b/24*Math.PI*2-Math.PI/2,h=.04*f*(e[b%10]||0),i=c+(f+h)*Math.cos(g),j=d+(f+h)*Math.sin(g);a+=(0===b?"M ":"L ")+`${i} ${j} `}return a+"Z"})(),fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round"}),(0,J.jsx)("path",{d:`
                M ${b/2+e[0]} ${b/2}
                L ${b/2-.15*b+e[1]} ${b/2-.15*b}
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round"}),(0,J.jsx)("path",{d:`
                M ${b/2} ${b/2+e[2]}
                L ${b/2+.2*b} ${b/2-.25*b+e[3]}
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round"}),(0,J.jsx)("circle",{cx:b/2,cy:b/2,r:3,fill:c})]});case"key":return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("path",{d:(()=>{let a="",c=.3*b,d=.35*b,f=.2*b;for(let b=0;b<=16;b++){let g=b/16*Math.PI*2,h=.06*f*(e[b%10]||0),i=c+(f+h)*Math.cos(g),j=d+(f+h)*Math.sin(g);a+=(0===b?"M ":"L ")+`${i} ${j} `}return a+"Z"})(),fill:"none",stroke:c,strokeWidth:f}),(0,J.jsx)("circle",{cx:.3*b,cy:.35*b,r:.08*b,fill:"none",stroke:c,strokeWidth:f-.5}),(0,J.jsx)("path",{d:`
                M ${.45*b+e[0]} ${.45*b}
                L ${b-8+e[1]} ${b-10}
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round"}),(0,J.jsx)("path",{d:`
                M ${.65*b+e[2]} ${.6*b}
                L ${.72*b} ${.68*b+e[3]}
                M ${.75*b} ${.7*b+e[4]}
                L ${.82*b+e[5]} ${.78*b}
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round"})]});case"cloud":return(0,J.jsx)("path",{d:`
              M ${.25*b+e[0]} ${.65*b}
              Q ${.1*b} ${.65*b}, ${.1*b+e[1]} ${.5*b}
              Q ${.1*b} ${.35*b}, ${.25*b} ${.35*b+e[2]}
              Q ${.3*b} ${.2*b}, ${.45*b+e[3]} ${.2*b}
              Q ${.55*b} ${.15*b+e[4]}, ${.65*b} ${.25*b}
              Q ${.8*b} ${.2*b}, ${.85*b+e[5]} ${.35*b}
              Q ${.95*b} ${.4*b+e[6]}, ${.9*b} ${.55*b}
              Q ${.95*b} ${.65*b}, ${.8*b+e[7]} ${.65*b}
              Z
            `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round",strokeLinejoin:"round"});case"folder":return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("path",{d:`
                M ${8+e[0]} ${.35*b}
                L 8 ${.25*b+e[1]}
                L ${.35*b+e[2]} ${.25*b}
                L ${.4*b} ${.35*b+e[3]}
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round",strokeLinejoin:"round"}),(0,J.jsx)("path",{d:`
                M ${8+e[4]} ${.35*b}
                L ${b-8+e[5]} ${.35*b}
                L ${b-8} ${b-10+e[6]}
                L ${8+e[7]} ${b-10}
                Z
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round",strokeLinejoin:"round"})]});case"check":return(0,J.jsx)("path",{d:`
              M ${.2*b+e[0]} ${.5*b}
              L ${.4*b+e[1]} ${.7*b+e[2]}
              L ${.8*b+e[3]} ${.3*b}
            `,fill:"none",stroke:c,strokeWidth:f+1,strokeLinecap:"round",strokeLinejoin:"round"});case"warning":return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)("path",{d:`
                M ${b/2+e[0]} 8
                L ${b-8+e[1]} ${b-10}
                L ${8+e[2]} ${b-10}
                Z
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round",strokeLinejoin:"round"}),(0,J.jsx)("path",{d:`
                M ${b/2+e[3]} ${.35*b}
                L ${b/2} ${.55*b+e[4]}
              `,fill:"none",stroke:c,strokeWidth:f,strokeLinecap:"round"}),(0,J.jsx)("circle",{cx:b/2,cy:.7*b,r:2.5,fill:c})]});default:return null}})()})]})}function ab({value:a,onChange:b,placeholder:c="",type:d="text",label:e,icon:f,disabled:g=!1,className:h=""}){return(0,K.useMemo)(()=>Array.from({length:8},()=>(Math.random()-.5)*4),[]),(0,J.jsxs)("div",{className:`relative ${h}`,children:[e&&(0,J.jsx)("label",{className:"block font-['Google Sans',_sans-serif] text-xl text-[#1E40AF] mb-2",children:e}),(0,J.jsxs)("div",{className:"relative",children:[(0,J.jsxs)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",preserveAspectRatio:"none",children:[(0,J.jsx)("defs",{children:(0,J.jsxs)("filter",{id:"input-rough",x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,J.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.04",numOctaves:"2",result:"noise"}),(0,J.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1",xChannelSelector:"R",yChannelSelector:"G"})]})}),(0,J.jsx)("path",{d:"M0,0 L${width},0 L${width},${height} L0,${height} Z",className:"stroke-[#2563EB] stroke-[3] fill-none",filter:"url(#input-rough)"})]}),(0,J.jsx)("input",{type:d,value:a,onChange:a=>b(a.target.value),placeholder:c,disabled:g,className:`
             relative z-10
             w-full
             ${f?"pl-12":"px-5"} py-4
             bg-transparent
             font-['Google Sans',_sans-serif] text-xl text-[#1E40AF]
             placeholder:text-[#9CA3AF]
             focus:outline-none
             ${g?"opacity-50 cursor-not-allowed":""}
           `}),f&&(0,J.jsx)("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 text-[#2563EB]/40",children:f})]})]})}function ac({value:a,onChange:b,placeholder:c="",label:d,rows:e=4,disabled:f=!1,className:g=""}){return(0,K.useMemo)(()=>Array.from({length:8},()=>(Math.random()-.5)*4),[]),(0,J.jsxs)("div",{className:`relative ${g}`,children:[d&&(0,J.jsx)("label",{className:"block font-['Google Sans',_sans-serif] text-xl text-[#1E40AF] mb-2",children:d}),(0,J.jsxs)("div",{className:"relative",children:[(0,J.jsxs)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",preserveAspectRatio:"none",children:[(0,J.jsx)("defs",{children:(0,J.jsxs)("filter",{id:"textarea-rough",x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,J.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.03",numOctaves:"2",result:"noise"}),(0,J.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1",xChannelSelector:"R",yChannelSelector:"G"})]})}),(0,J.jsx)("path",{d:"M0,0 L${width},0 L${width},${height} L0,${height} Z",className:"stroke-[#2563EB] stroke-[3] fill-none",filter:"url(#textarea-rough)"})]}),(0,J.jsx)("textarea",{value:a,onChange:a=>b(a.target.value),placeholder:c,rows:e,disabled:f,className:`
             relative z-10
             w-full
             px-5 py-4
             bg-transparent
             font-['Google Sans',_sans-serif] text-xl text-[#1E40AF]
             placeholder:text-[#9CA3AF]
             focus:outline-none
             resize-none
             ${f?"opacity-50 cursor-not-allowed":""}
           `})]})]})}function ad({onSuccess:a}){let[b,c]=(0,K.useState)("welcome"),[d,e]=(0,K.useState)(""),[f,g]=(0,K.useState)(""),[h,i]=(0,K.useState)(!1),[j,k]=(0,K.useState)(!1),[l,m]=(0,K.useState)(null),n=async()=>{if(!d||!f)return void m("Bitte E-Mail und Passwort eingeben");k(!0),m(null);try{let b=await Y.signIn.email({email:d,password:f});if(b.error)return void m(b.error.message||"Anmeldung fehlgeschlagen");b.data?.user&&a({id:b.data.user.id,email:b.data.user.email,vaultKeyHash:b.data.user.vault_key_hash||null})}catch(a){console.error("Login error:",a),m("Ein Fehler ist aufgetreten. Bitte versuche es erneut.")}finally{k(!1)}};return"welcome"===b?(0,J.jsxs)("div",{className:"min-h-screen flex flex-col px-6 pt-16 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,J.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[(0,J.jsxs)("div",{className:"relative w-28 h-28 mb-8",children:[(0,J.jsx)("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",children:(0,J.jsx)("path",{d:"M 10 10 Q 30 5, 50 10 Q 70 5, 90 10 Q 95 30, 90 50 Q 95 70, 90 90 Q 70 95, 50 90 Q 30 95, 10 90 Q 5 70, 10 50 Q 5 30, 10 10 Z",fill:"white",stroke:"#2563EB",strokeWidth:"3"})}),(0,J.jsx)("div",{className:"relative z-10 w-full h-full flex items-center justify-center",children:(0,J.jsx)(X,{name:"shield",size:56,className:"text-[#2563EB]"})})]}),(0,J.jsx)("h1",{className:"sketch-heading text-[42px] mb-3",children:"PhotoVault"}),(0,J.jsx)("p",{className:"sketch-body text-[#3B82F6] max-w-[280px] mb-12",children:"Sichere deine Fotos mit Zero-Knowledge Verschluesselung"}),(0,J.jsxs)("div",{className:"w-full max-w-[320px] space-y-4 mb-12",children:[(0,J.jsx)(ae,{icon:"lock",text:"Ende-zu-Ende verschluesselt"}),(0,J.jsx)(ae,{icon:"smartphone",text:"Multi-Device Sync"}),(0,J.jsx)(ae,{icon:"cloud",text:"Dezentrales IPFS Backup"})]})]}),(0,J.jsxs)("div",{className:"space-y-4",children:[(0,J.jsx)(Z.SketchButton,{onClick:()=>c("login"),className:"w-full",size:"lg",children:"Anmelden"}),(0,J.jsx)("p",{className:"text-center sketch-body text-gray-400 text-sm",children:"Registrierung ist derzeit deaktiviert"})]})]}):(0,J.jsxs)("div",{className:"jsx-d70472d407c31818 min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,J.jsx)("button",{onClick:()=>c("welcome"),className:"jsx-d70472d407c31818 self-start sketch-body text-[#2563EB] mb-8 ios-tap-target flex items-center gap-2",children:"â† Zurueck"}),(0,J.jsxs)("div",{className:"jsx-d70472d407c31818 flex-1",children:[(0,J.jsx)("h1",{className:"jsx-d70472d407c31818 sketch-heading text-[32px] mb-2",children:"Willkommen zurueck"}),(0,J.jsx)("p",{className:"jsx-d70472d407c31818 sketch-body text-[#3B82F6] mb-8",children:"Melde dich an, um auf deinen Vault zuzugreifen"}),(0,J.jsxs)("div",{className:"jsx-d70472d407c31818 space-y-6",children:[(0,J.jsx)("div",{className:"jsx-d70472d407c31818 relative",children:(0,J.jsx)(ab,{type:"email",value:d,onChange:a=>e(a),placeholder:"E-Mail",label:"E-Mail",icon:(0,J.jsx)(P,{className:"w-5 h-5"})})}),(0,J.jsxs)("div",{className:"jsx-d70472d407c31818 relative flex flex-col gap-1",children:[(0,J.jsx)(ab,{type:h?"text":"password",value:f,onChange:a=>g(a),placeholder:"Passwort",label:"Passwort",icon:(0,J.jsx)(Q.Lock,{className:"w-5 h-5"})}),(0,J.jsx)("button",{type:"button",onClick:()=>i(!h),className:"jsx-d70472d407c31818 absolute right-4 top-[38px] text-[#2563EB]/40 z-20",children:h?(0,J.jsx)(S,{className:"w-5 h-5"}):(0,J.jsx)(R.Eye,{className:"w-5 h-5"})})]}),l&&(0,J.jsxs)("div",{className:"jsx-d70472d407c31818 relative py-3 px-4",children:[(0,J.jsx)("svg",{preserveAspectRatio:"none",className:"jsx-d70472d407c31818 absolute inset-0 w-full h-full",children:(0,J.jsx)("path",{d:"M 2 5 Q 25 2, 50 5 Q 75 2, 98 5 Q 99 30, 98 60 Q 75 63, 50 60 Q 25 63, 2 60 Q 1 30, 2 5 Z",fill:"#FF3B3010",stroke:"#FF3B30",strokeWidth:"1",className:"jsx-d70472d407c31818"})}),(0,J.jsx)("p",{className:"jsx-d70472d407c31818 relative z-10 sketch-body text-[#FF3B30] text-center text-sm",children:l})]})]})]}),(0,J.jsx)("div",{className:"jsx-d70472d407c31818 space-y-4",children:(0,J.jsx)(Z.SketchButton,{onClick:n,disabled:j,className:"w-full",size:"lg",children:j?(0,J.jsx)(T.Loader2,{className:"w-6 h-6 animate-spin"}):"Anmelden"})}),(0,J.jsx)(O.default,{id:"d70472d407c31818",children:".sketch-input-field.jsx-d70472d407c31818{color:#1d1d1f;background-color:#0000;border:2px solid #2563eb;border-radius:12px;width:100%;height:54px;padding-left:3rem;padding-right:1rem;font-family:Google Sans,sans-serif;font-size:17px;transition:border-color .2s}.sketch-input-field.jsx-d70472d407c31818:focus{border-color:#1e40af;outline:none}.sketch-input-field.jsx-d70472d407c31818::placeholder{color:#8e8e93}"})]})}function ae({icon:a,text:b}){return(0,J.jsxs)("div",{className:"relative group",children:[(0,J.jsx)("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none",children:(0,J.jsx)("path",{d:"M 2 2 Q 25 -1, 50 2 Q 75 -1, 98 2 Q 100 25, 98 50 Q 75 53, 50 50 Q 25 53, 2 50 Q 0 25, 2 2 Z",fill:"white",stroke:"#2563EB40",strokeWidth:"1.5"})}),(0,J.jsxs)("div",{className:"relative z-10 flex items-center gap-4 p-4",children:[(0,J.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",children:(0,J.jsx)(X,{name:a,size:24,className:"text-[#2563EB]"})}),(0,J.jsx)("span",{className:"sketch-body text-base text-[#1E40AF]",children:b})]})]})}let af=(0,L.default)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var ag=a.i(55331);function ah({userEmail:a,expectedKeyHash:b,onUnlock:c,onCreateNewVault:d,onLogout:e}){let[f,g]=(0,K.useState)(""),[h,i]=(0,K.useState)(!1),[j,k]=(0,K.useState)(null),l=async()=>{if(!f.trim())return void k("Bitte gib deine Recovery-Phrase ein");i(!0),k(null);try{let a=f.trim().replace(/[\s\n]+/g,"-").replace(/-+/g,"-"),d=(0,ag.recoveryPhraseToKey)(a);if(!d||32!==d.length){k("Ungueltige Recovery-Phrase"),i(!1);return}let e=await (0,ag.getUserKeyHash)(d);if(b&&e!==b){k("Diese Recovery-Phrase gehoert nicht zu diesem Konto. Bitte ueberpruefe deine Eingabe."),i(!1);return}(0,ag.saveKeyToStorage)(d),c(d,e)}catch(a){console.error("Unlock error:",a),k("Ungueltige Recovery-Phrase. Bitte ueberpruefe deine Eingabe.")}finally{i(!1)}};return(0,J.jsxs)("div",{className:"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,J.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,J.jsxs)("div",{className:"sketch-body text-[14px] text-[#6E6E73]",children:["Angemeldet als",(0,J.jsx)("br",{}),(0,J.jsx)("span",{className:"text-[#2563EB] font-bold",children:a})]}),(0,J.jsx)("button",{onClick:e,className:"sketch-body text-[#FF3B30] text-[15px] hover:text-[#D73A49]",children:"Abmelden"})]}),(0,J.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,J.jsxs)("div",{className:"flex flex-col items-center text-center mb-8",children:[(0,J.jsx)("div",{className:"mb-6",children:(0,J.jsx)(aa,{icon:"shield",size:80})}),(0,J.jsx)("h1",{className:"sketch-heading text-[32px] mb-2 text-[#1D1D1F]",children:"Vault entsperren"}),(0,J.jsx)("p",{className:"sketch-body text-[15px] text-[#6E6E73] max-w-[300px]",children:b?"Gib deine Recovery-Phrase ein, um auf deine verschluesselten Fotos zuzugreifen":"Du hast noch keinen Vault. Erstelle einen neuen oder stelle einen bestehenden wieder her."})]}),(0,J.jsxs)("div",{className:"mb-6",children:[(0,J.jsx)(ac,{value:f,onChange:a=>{g(a),k(null)},label:"Recovery-Phrase (12 Woerter)",placeholder:"abc123XY-def456AB-...",rows:4}),(0,J.jsx)("p",{className:"sketch-body text-[12px] text-[#8E8E93] mt-2 px-1",children:"Mit Bindestrichen oder Leerzeichen getrennt"})]}),j&&(0,J.jsx)("div",{className:"relative py-3 px-4 mb-6",children:(0,J.jsx)($,{className:"bg-[#FF3B30]/5 border-[#FF3B30]",children:(0,J.jsx)("p",{className:"sketch-body text-[14px] text-[#FF3B30] text-center",children:j})})}),(0,J.jsx)("div",{className:"mb-6",children:(0,J.jsx)($,{className:"bg-[#2563EB]/5",children:(0,J.jsxs)("div",{className:"flex items-start gap-3",children:[(0,J.jsx)(af,{className:"w-5 h-5 text-[#2563EB] mt-0.5 flex-shrink-0"}),(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"sketch-subheading text-[15px] mb-1",children:"Warum brauche ich die Phrase?"}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Deine Fotos sind lokal verschluesselt. Nur mit der Recovery-Phrase kannst du sie entschluesseln. Wir speichern sie niemals."})]})]})})})]}),(0,J.jsxs)("div",{className:"space-y-4",children:[(0,J.jsx)(Z.SketchButton,{onClick:l,disabled:h||!f.trim(),className:"w-full",size:"lg",children:h?(0,J.jsx)(T.Loader2,{className:"w-6 h-6 animate-spin"}):"Vault entsperren"}),!b&&(0,J.jsx)("button",{onClick:d,className:"w-full py-2 sketch-body text-[#2563EB] text-[17px] hover:underline",children:"Neuen Vault erstellen"})]})]})}function ai(){let[a,b]=(0,K.useState)(null),[c,d]=(0,K.useState)(!1),[e,f]=(0,K.useState)(null),[g,h]=(0,K.useState)(!1),[i,j]=(0,K.useState)(null);(0,K.useEffect)(()=>{(async()=>{let a=(0,ag.loadKeyFromStorage)();a&&(b(a),f((0,ag.keyToRecoveryPhrase)(a)),j(await (0,ag.getUserKeyHash)(a))),d(!0)})()},[]);let k=(0,K.useCallback)(()=>new Promise(a=>{h(!0),setTimeout(async()=>{let c=(0,ag.generateKeyPair)().secretKey;b(c),(0,ag.saveKeyToStorage)(c);let d=(0,ag.keyToRecoveryPhrase)(c);f(d),j(await (0,ag.getUserKeyHash)(c)),h(!1),a(d)},1500)}),[]);return{secretKey:a,isInitialized:c,hasKey:!!a,recoveryPhrase:e,userKeyHash:i,isGeneratingKey:g,generateNewKey:k,restoreFromPhrase:(0,K.useCallback)(a=>{try{let c=(0,ag.recoveryPhraseToKey)(a);return b(c),(0,ag.saveKeyToStorage)(c),f(a),!0}catch{return!1}},[]),clearKey:(0,K.useCallback)(()=>{b(null),f(null),(0,ag.clearKeyFromStorage)()},[])}}function aj({userId:a,onComplete:b,onBack:c}){let[d,e]=(0,K.useState)("intro"),[f,g]=(0,K.useState)(!1),[h,i]=(0,K.useState)(!1),{isGeneratingKey:j,generateNewKey:k,recoveryPhrase:l,userKeyHash:m}=ai(),n=async()=>{e("generating");try{await k(),e("phrase")}catch(a){console.error("Failed to generate key:",a),e("intro")}},o=async()=>{l&&(await navigator.clipboard.writeText(l),i(!0),setTimeout(()=>i(!1),2e3))},p=l?.split("-").slice(0,12)||[];return"generating"===d||j?(0,J.jsx)(N,{}):"intro"===d?(0,J.jsxs)("div",{className:"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,J.jsx)("button",{onClick:c,className:"self-start sketch-body text-[#2563EB] text-[17px] mb-8 hover:text-[#1E40AF]",children:"â† Zurueck"}),(0,J.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[(0,J.jsx)("div",{className:"mb-6",children:(0,J.jsx)(aa,{icon:"key",size:80})}),(0,J.jsx)("h1",{className:"sketch-heading text-[32px] mb-3 text-[#1D1D1F]",children:"Erstelle deinen Vault"}),(0,J.jsx)("p",{className:"sketch-body text-[17px] text-[#3B82F6] max-w-[300px] mb-8",children:"Dein persoenlicher Verschluesselungsschluessel schuetzt alle deine Fotos"}),(0,J.jsxs)("div",{className:"w-full max-w-[320px] space-y-4 mb-8",children:[(0,J.jsx)($,{className:"p-4",children:(0,J.jsxs)("div",{className:"flex items-start gap-4",children:[(0,J.jsx)(aa,{icon:"shield",size:32,color:"#30D158"}),(0,J.jsxs)("div",{className:"text-left",children:[(0,J.jsx)("p",{className:"sketch-subheading text-[16px]",children:"Zero-Knowledge"}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Nur du kannst deine Fotos entschluesseln"})]})]})}),(0,J.jsx)($,{className:"p-4",children:(0,J.jsxs)("div",{className:"flex items-start gap-4",children:[(0,J.jsx)(aa,{icon:"clock",size:32,color:"#2563EB"}),(0,J.jsxs)("div",{className:"text-left",children:[(0,J.jsx)("p",{className:"sketch-subheading text-[16px]",children:"Recovery-Phrase"}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"12 Woerter zum Wiederherstellen"})]})]})}),(0,J.jsx)($,{className:"p-4",children:(0,J.jsxs)("div",{className:"flex items-start gap-4",children:[(0,J.jsx)(aa,{icon:"photo",size:32,color:"#FF9500"}),(0,J.jsxs)("div",{className:"text-left",children:[(0,J.jsx)("p",{className:"sketch-subheading text-[16px]",children:"Multi-Device"}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Synchronisiere all deine Geraete"})]})]})})]})]}),(0,J.jsx)(Z.SketchButton,{onClick:n,className:"w-full",size:"lg",children:"Vault erstellen"})]}):"phrase"===d?(0,J.jsxs)("div",{className:"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,J.jsxs)("div",{className:"flex-1",children:[(0,J.jsxs)("div",{className:"text-center mb-6",children:[(0,J.jsx)("h1",{className:"sketch-heading text-[32px] mb-2 text-[#1D1D1F]",children:"Deine Phrase"}),(0,J.jsx)("p",{className:"sketch-body text-[15px] text-[#6E6E73]",children:"Notiere diese Woerter sicher. Du brauchst sie zur Wiederherstellung."})]}),(0,J.jsx)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:p.map((a,b)=>(0,J.jsxs)($,{className:"p-3 text-center",children:[(0,J.jsx)("span",{className:"sketch-body text-[11px] text-[#6E6E73] block mb-0.5",children:b+1}),(0,J.jsx)("span",{className:"sketch-subheading text-[16px] break-all",children:a})]},b))}),(0,J.jsx)("button",{onClick:o,className:"w-full py-3 sketch-body text-[#2563EB] text-[16px] hover:underline mb-4",children:h?"âœ“ Kopiert!":"Phrase kopieren"}),(0,J.jsx)("div",{className:"mb-6",children:(0,J.jsx)($,{className:"bg-[#FF3B30]/5 border-[#FF3B30]",children:(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#FF3B30] text-center",children:"Teile diese Woerter niemals mit anderen. Wer sie hat, kann auf deine Fotos zugreifen."})})}),(0,J.jsx)("div",{className:"mb-8",children:(0,J.jsxs)($,{className:"p-4 flex items-center justify-between",children:[(0,J.jsx)("span",{className:"sketch-subheading text-[17px] text-[#1D1D1F]",children:"Sicher gespeichert?"}),(0,J.jsx)(_,{checked:f,onChange:g})]})})]}),(0,J.jsx)(Z.SketchButton,{onClick:()=>{m&&b(m)},disabled:!f,className:"w-full",size:"lg",children:"Weiter"})]}):null}var ak=a.i(33441);class al extends Error{constructor(a,b="FunctionsError",c){super(a),this.name=b,this.context=c}}class am extends al{constructor(a){super("Failed to send a request to the Edge Function","FunctionsFetchError",a)}}class an extends al{constructor(a){super("Relay Error invoking the Edge Function","FunctionsRelayError",a)}}class ao extends al{constructor(a){super("Edge Function returned a non-2xx status code","FunctionsHttpError",a)}}(j=x||(x={})).Any="any",j.ApNortheast1="ap-northeast-1",j.ApNortheast2="ap-northeast-2",j.ApSouth1="ap-south-1",j.ApSoutheast1="ap-southeast-1",j.ApSoutheast2="ap-southeast-2",j.CaCentral1="ca-central-1",j.EuCentral1="eu-central-1",j.EuWest1="eu-west-1",j.EuWest2="eu-west-2",j.EuWest3="eu-west-3",j.SaEast1="sa-east-1",j.UsEast1="us-east-1",j.UsWest1="us-west-1",j.UsWest2="us-west-2";class ap{constructor(b,{headers:c={},customFetch:d,region:e=x.Any}={}){this.url=b,this.headers=c,this.region=e,this.fetch=(b=>{let c;return c=b||("u"<typeof fetch?(...b)=>a.A(59789).then(({default:a})=>a(...b)):fetch),(...a)=>c(...a)})(d)}setAuth(a){this.headers.Authorization=`Bearer ${a}`}invoke(a,b={}){var c,d,e,f,g;return d=this,e=void 0,f=void 0,g=function*(){try{let d,{headers:e,method:f,body:g}=b,h={},{region:i}=b;i||(i=this.region),i&&"any"!==i&&(h["x-region"]=i),g&&(e&&!Object.prototype.hasOwnProperty.call(e,"Content-Type")||!e)&&("u">typeof Blob&&g instanceof Blob||g instanceof ArrayBuffer?(h["Content-Type"]="application/octet-stream",d=g):"string"==typeof g?(h["Content-Type"]="text/plain",d=g):"u">typeof FormData&&g instanceof FormData?d=g:(h["Content-Type"]="application/json",d=JSON.stringify(g)));let j=yield this.fetch(`${this.url}/${a}`,{method:f||"POST",headers:Object.assign(Object.assign(Object.assign({},h),this.headers),e),body:d}).catch(a=>{throw new am(a)}),k=j.headers.get("x-relay-error");if(k&&"true"===k)throw new an(j);if(!j.ok)throw new ao(j);let l=(null!=(c=j.headers.get("Content-Type"))?c:"text/plain").split(";")[0].trim();return{data:"application/json"===l?yield j.json():"application/octet-stream"===l?yield j.blob():"text/event-stream"===l?j:"multipart/form-data"===l?yield j.formData():yield j.text(),error:null}}catch(a){return{data:null,error:a}}},new(f||(f=Promise))(function(a,b){function c(a){try{i(g.next(a))}catch(a){b(a)}}function h(a){try{i(g.throw(a))}catch(a){b(a)}}function i(b){var d;b.done?a(b.value):((d=b.value)instanceof f?d:new f(function(a){a(d)})).then(c,h)}i((g=g.apply(d,e||[])).next())})}}let{PostgrestClient:aq,PostgrestQueryBuilder:ar,PostgrestFilterBuilder:as,PostgrestTransformBuilder:at,PostgrestBuilder:au,PostgrestError:av}=a.i(79614).default,aw={"X-Client-Info":"realtime-js/2.11.2"};(k=y||(y={}))[k.connecting=0]="connecting",k[k.open=1]="open",k[k.closing=2]="closing",k[k.closed=3]="closed",(l=z||(z={})).closed="closed",l.errored="errored",l.joined="joined",l.joining="joining",l.leaving="leaving",(m=A||(A={})).close="phx_close",m.error="phx_error",m.join="phx_join",m.reply="phx_reply",m.leave="phx_leave",m.access_token="access_token",(B||(B={})).websocket="websocket",(n=C||(C={})).Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed";class ax{constructor(){this.HEADER_LENGTH=1}decode(a,b){return a.constructor===ArrayBuffer?b(this._binaryDecode(a)):"string"==typeof a?b(JSON.parse(a)):b({})}_binaryDecode(a){let b=new DataView(a),c=new TextDecoder;return this._decodeBroadcast(a,b,c)}_decodeBroadcast(a,b,c){let d=b.getUint8(1),e=b.getUint8(2),f=this.HEADER_LENGTH+2,g=c.decode(a.slice(f,f+d));f+=d;let h=c.decode(a.slice(f,f+e));return f+=e,{ref:null,topic:g,event:h,payload:JSON.parse(c.decode(a.slice(f,a.byteLength)))}}}class ay{constructor(a,b){this.callback=a,this.timerCalc=b,this.timer=void 0,this.tries=0,this.callback=a,this.timerCalc=b}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(o=D||(D={})).abstime="abstime",o.bool="bool",o.date="date",o.daterange="daterange",o.float4="float4",o.float8="float8",o.int2="int2",o.int4="int4",o.int4range="int4range",o.int8="int8",o.int8range="int8range",o.json="json",o.jsonb="jsonb",o.money="money",o.numeric="numeric",o.oid="oid",o.reltime="reltime",o.text="text",o.time="time",o.timestamp="timestamp",o.timestamptz="timestamptz",o.timetz="timetz",o.tsrange="tsrange",o.tstzrange="tstzrange";let az=(a,b,c={})=>{var d;let e=null!=(d=c.skipTypes)?d:[];return Object.keys(b).reduce((c,d)=>(c[d]=aA(d,a,b,e),c),{})},aA=(a,b,c,d)=>{let e=b.find(b=>b.name===a),f=null==e?void 0:e.type,g=c[a];return f&&!d.includes(f)?aB(f,g):aC(g)},aB=(a,b)=>{if("_"===a.charAt(0))return aG(b,a.slice(1,a.length));switch(a){case D.bool:return aD(b);case D.float4:case D.float8:case D.int2:case D.int4:case D.int8:case D.numeric:case D.oid:return aE(b);case D.json:case D.jsonb:return aF(b);case D.timestamp:return aH(b);case D.abstime:case D.date:case D.daterange:case D.int4range:case D.int8range:case D.money:case D.reltime:case D.text:case D.time:case D.timestamptz:case D.timetz:case D.tsrange:case D.tstzrange:default:return aC(b)}},aC=a=>a,aD=a=>{switch(a){case"t":return!0;case"f":return!1;default:return a}},aE=a=>{if("string"==typeof a){let b=parseFloat(a);if(!Number.isNaN(b))return b}return a},aF=a=>{if("string"==typeof a)try{return JSON.parse(a)}catch(a){console.log(`JSON parse error: ${a}`)}return a},aG=(a,b)=>{if("string"!=typeof a)return a;let c=a.length-1,d=a[c];if("{"===a[0]&&"}"===d){let d,e=a.slice(1,c);try{d=JSON.parse("["+e+"]")}catch(a){d=e?e.split(","):[]}return d.map(a=>aB(b,a))}return a},aH=a=>"string"==typeof a?a.replace(" ","T"):a,aI=a=>{let b=a;return(b=(b=b.replace(/^ws/i,"http")).replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,"")).replace(/\/+$/,"")};class aJ{constructor(a,b,c={},d=1e4){this.channel=a,this.event=b,this.payload=c,this.timeout=d,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(a){this.timeout=a,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(a){this.payload=Object.assign(Object.assign({},this.payload),a)}receive(a,b){var c;return this._hasReceived(a)&&b(null==(c=this.receivedResp)?void 0:c.response),this.recHooks.push({status:a,callback:b}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let a=a=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=a,this._matchReceive(a)};this.channel._on(this.refEvent,{},a),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(a,b){this.refEvent&&this.channel._trigger(this.refEvent,{status:a,response:b})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:a,response:b}){this.recHooks.filter(b=>b.status===a).forEach(a=>a.callback(b))}_hasReceived(a){return this.receivedResp&&this.receivedResp.status===a}}(p=E||(E={})).SYNC="sync",p.JOIN="join",p.LEAVE="leave";class aK{constructor(a,b){this.channel=a,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const c=(null==b?void 0:b.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(c.state,{},a=>{let{onJoin:b,onLeave:c,onSync:d}=this.caller;this.joinRef=this.channel._joinRef(),this.state=aK.syncState(this.state,a,b,c),this.pendingDiffs.forEach(a=>{this.state=aK.syncDiff(this.state,a,b,c)}),this.pendingDiffs=[],d()}),this.channel._on(c.diff,{},a=>{let{onJoin:b,onLeave:c,onSync:d}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(a):(this.state=aK.syncDiff(this.state,a,b,c),d())}),this.onJoin((a,b,c)=>{this.channel._trigger("presence",{event:"join",key:a,currentPresences:b,newPresences:c})}),this.onLeave((a,b,c)=>{this.channel._trigger("presence",{event:"leave",key:a,currentPresences:b,leftPresences:c})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(a,b,c,d){let e=this.cloneDeep(a),f=this.transformState(b),g={},h={};return this.map(e,(a,b)=>{f[a]||(h[a]=b)}),this.map(f,(a,b)=>{let c=e[a];if(c){let d=b.map(a=>a.presence_ref),e=c.map(a=>a.presence_ref),f=b.filter(a=>0>e.indexOf(a.presence_ref)),i=c.filter(a=>0>d.indexOf(a.presence_ref));f.length>0&&(g[a]=f),i.length>0&&(h[a]=i)}else g[a]=b}),this.syncDiff(e,{joins:g,leaves:h},c,d)}static syncDiff(a,b,c,d){let{joins:e,leaves:f}={joins:this.transformState(b.joins),leaves:this.transformState(b.leaves)};return c||(c=()=>{}),d||(d=()=>{}),this.map(e,(b,d)=>{var e;let f=null!=(e=a[b])?e:[];if(a[b]=this.cloneDeep(d),f.length>0){let c=a[b].map(a=>a.presence_ref),d=f.filter(a=>0>c.indexOf(a.presence_ref));a[b].unshift(...d)}c(b,f,d)}),this.map(f,(b,c)=>{let e=a[b];if(!e)return;let f=c.map(a=>a.presence_ref);e=e.filter(a=>0>f.indexOf(a.presence_ref)),a[b]=e,d(b,e,c),0===e.length&&delete a[b]}),a}static map(a,b){return Object.getOwnPropertyNames(a).map(c=>b(c,a[c]))}static transformState(a){return Object.getOwnPropertyNames(a=this.cloneDeep(a)).reduce((b,c)=>{let d=a[c];return"metas"in d?b[c]=d.metas.map(a=>(a.presence_ref=a.phx_ref,delete a.phx_ref,delete a.phx_ref_prev,a)):b[c]=d,b},{})}static cloneDeep(a){return JSON.parse(JSON.stringify(a))}onJoin(a){this.caller.onJoin=a}onLeave(a){this.caller.onLeave=a}onSync(a){this.caller.onSync=a}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(q=F||(F={})).ALL="*",q.INSERT="INSERT",q.UPDATE="UPDATE",q.DELETE="DELETE",(r=G||(G={})).BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system",(s=H||(H={})).SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR";class aL{constructor(a,b={config:{}},c){this.topic=a,this.params=b,this.socket=c,this.bindings={},this.state=z.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=a.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},b.config),this.timeout=this.socket.timeout,this.joinPush=new aJ(this,A.join,this.params,this.timeout),this.rejoinTimer=new ay(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=z.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(a=>a.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=z.closed,this.socket._remove(this)}),this._onError(a=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,a),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=z.errored,this.rejoinTimer.scheduleTimeout())}),this._on(A.reply,{},(a,b)=>{this._trigger(this._replyEventName(b),a)}),this.presence=new aK(this),this.broadcastEndpointURL=aI(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(a,b=this.timeout){var c,d;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:e,presence:f,private:g}}=this.params;this._onError(b=>null==a?void 0:a(H.CHANNEL_ERROR,b)),this._onClose(()=>null==a?void 0:a(H.CLOSED));let h={},i={broadcast:e,presence:f,postgres_changes:null!=(d=null==(c=this.bindings.postgres_changes)?void 0:c.map(a=>a.filter))?d:[],private:g};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:i},h)),this.joinedOnce=!0,this._rejoin(b),this.joinPush.receive("ok",async({postgres_changes:b})=>{var c;if(this.socket.setAuth(),void 0===b){null==a||a(H.SUBSCRIBED);return}{let d=this.bindings.postgres_changes,e=null!=(c=null==d?void 0:d.length)?c:0,f=[];for(let c=0;c<e;c++){let e=d[c],{filter:{event:g,schema:h,table:i,filter:j}}=e,k=b&&b[c];if(k&&k.event===g&&k.schema===h&&k.table===i&&k.filter===j)f.push(Object.assign(Object.assign({},e),{id:k.id}));else{this.unsubscribe(),null==a||a(H.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=f,a&&a(H.SUBSCRIBED);return}}).receive("error",b=>{null==a||a(H.CHANNEL_ERROR,Error(JSON.stringify(Object.values(b).join(", ")||"error")))}).receive("timeout",()=>{null==a||a(H.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(a,b={}){return await this.send({type:"presence",event:"track",payload:a},b.timeout||this.timeout)}async untrack(a={}){return await this.send({type:"presence",event:"untrack"},a)}on(a,b,c){return this._on(a,b,c)}async send(a,b={}){var c,d;if(this._canPush()||"broadcast"!==a.type)return new Promise(c=>{var d,e,f;let g=this._push(a.type,a,b.timeout||this.timeout);"broadcast"!==a.type||(null==(f=null==(e=null==(d=this.params)?void 0:d.config)?void 0:e.broadcast)?void 0:f.ack)||c("ok"),g.receive("ok",()=>c("ok")),g.receive("error",()=>c("error")),g.receive("timeout",()=>c("timed out"))});{let{event:e,payload:f}=a,g={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:f,private:this.private}]})};try{let a=await this._fetchWithTimeout(this.broadcastEndpointURL,g,null!=(c=b.timeout)?c:this.timeout);return await (null==(d=a.body)?void 0:d.cancel()),a.ok?"ok":"error"}catch(a){if("AbortError"===a.name)return"timed out";return"error"}}}updateJoinPayload(a){this.joinPush.updatePayload(a)}unsubscribe(a=this.timeout){this.state=z.leaving;let b=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(A.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(c=>{let d=new aJ(this,A.leave,{},a);d.receive("ok",()=>{b(),c("ok")}).receive("timeout",()=>{b(),c("timed out")}).receive("error",()=>{c("error")}),d.send(),this._canPush()||d.trigger("ok",{})})}async _fetchWithTimeout(a,b,c){let d=new AbortController,e=setTimeout(()=>d.abort(),c),f=await this.socket.fetch(a,Object.assign(Object.assign({},b),{signal:d.signal}));return clearTimeout(e),f}_push(a,b,c=this.timeout){if(!this.joinedOnce)throw`tried to push '${a}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let d=new aJ(this,a,b,c);return this._canPush()?d.send():(d.startTimeout(),this.pushBuffer.push(d)),d}_onMessage(a,b,c){return b}_isMember(a){return this.topic===a}_joinRef(){return this.joinPush.ref}_trigger(a,b,c){var d,e;let f=a.toLocaleLowerCase(),{close:g,error:h,leave:i,join:j}=A;if(c&&[g,h,i,j].indexOf(f)>=0&&c!==this._joinRef())return;let k=this._onMessage(f,b,c);if(b&&!k)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(f)?null==(d=this.bindings.postgres_changes)||d.filter(a=>{var b,c,d;return(null==(b=a.filter)?void 0:b.event)==="*"||(null==(d=null==(c=a.filter)?void 0:c.event)?void 0:d.toLocaleLowerCase())===f}).map(a=>a.callback(k,c)):null==(e=this.bindings[f])||e.filter(a=>{var c,d,e,g,h,i;if(!["broadcast","presence","postgres_changes"].includes(f))return a.type.toLocaleLowerCase()===f;if("id"in a){let f=a.id,g=null==(c=a.filter)?void 0:c.event;return f&&(null==(d=b.ids)?void 0:d.includes(f))&&("*"===g||(null==g?void 0:g.toLocaleLowerCase())===(null==(e=b.data)?void 0:e.type.toLocaleLowerCase()))}{let c=null==(h=null==(g=null==a?void 0:a.filter)?void 0:g.event)?void 0:h.toLocaleLowerCase();return"*"===c||c===(null==(i=null==b?void 0:b.event)?void 0:i.toLocaleLowerCase())}}).map(a=>{if("object"==typeof k&&"ids"in k){let a=k.data,{schema:b,table:c,commit_timestamp:d,type:e,errors:f}=a;k=Object.assign(Object.assign({},{schema:b,table:c,commit_timestamp:d,eventType:e,new:{},old:{},errors:f}),this._getPayloadRecords(a))}a.callback(k,c)})}_isClosed(){return this.state===z.closed}_isJoined(){return this.state===z.joined}_isJoining(){return this.state===z.joining}_isLeaving(){return this.state===z.leaving}_replyEventName(a){return`chan_reply_${a}`}_on(a,b,c){let d=a.toLocaleLowerCase(),e={type:d,filter:b,callback:c};return this.bindings[d]?this.bindings[d].push(e):this.bindings[d]=[e],this}_off(a,b){let c=a.toLocaleLowerCase();return this.bindings[c]=this.bindings[c].filter(a=>{var d;return!((null==(d=a.type)?void 0:d.toLocaleLowerCase())===c&&aL.isEqual(a.filter,b))}),this}static isEqual(a,b){if(Object.keys(a).length!==Object.keys(b).length)return!1;for(let c in a)if(a[c]!==b[c])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(a){this._on(A.close,{},a)}_onError(a){this._on(A.error,{},b=>a(b))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(a=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=z.joining,this.joinPush.resend(a))}_getPayloadRecords(a){let b={new:{},old:{}};return("INSERT"===a.type||"UPDATE"===a.type)&&(b.new=az(a.columns,a.record)),("UPDATE"===a.type||"DELETE"===a.type)&&(b.old=az(a.columns,a.old_record)),b}}let aM=()=>{},aN="u">typeof WebSocket,aO=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class aP{constructor(b,c){var d;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=aw,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=aM,this.conn=null,this.sendBuffer=[],this.serializer=new ax,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=b=>{let c;return c=b||("u"<typeof fetch?(...b)=>a.A(59789).then(({default:a})=>a(...b)):fetch),(...a)=>c(...a)},this.endPoint=`${b}/${B.websocket}`,this.httpEndpoint=aI(b),(null==c?void 0:c.transport)?this.transport=c.transport:this.transport=null,(null==c?void 0:c.params)&&(this.params=c.params),(null==c?void 0:c.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),c.headers)),(null==c?void 0:c.timeout)&&(this.timeout=c.timeout),(null==c?void 0:c.logger)&&(this.logger=c.logger),(null==c?void 0:c.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=c.heartbeatIntervalMs);const e=null==(d=null==c?void 0:c.params)?void 0:d.apikey;e&&(this.accessTokenValue=e,this.apiKey=e),this.reconnectAfterMs=(null==c?void 0:c.reconnectAfterMs)?c.reconnectAfterMs:a=>[1e3,2e3,5e3,1e4][a-1]||1e4,this.encode=(null==c?void 0:c.encode)?c.encode:(a,b)=>b(JSON.stringify(a)),this.decode=(null==c?void 0:c.decode)?c.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ay(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(null==c?void 0:c.fetch),(null==c?void 0:c.worker)&&(this.worker=(null==c?void 0:c.worker)||!1,this.workerUrl=null==c?void 0:c.workerUrl),this.accessToken=(null==c?void 0:c.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(aN){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new aQ(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),a.A(12079).then(({default:a})=>{this.conn=new a(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(a,b){this.conn&&(this.conn.onclose=function(){},a?this.conn.close(a,null!=b?b:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(a){let b=await a.unsubscribe();return 0===this.channels.length&&this.disconnect(),b}async removeAllChannels(){let a=await Promise.all(this.channels.map(a=>a.unsubscribe()));return this.disconnect(),a}log(a,b,c){this.logger(a,b,c)}connectionState(){switch(this.conn&&this.conn.readyState){case y.connecting:return C.Connecting;case y.open:return C.Open;case y.closing:return C.Closing;default:return C.Closed}}isConnected(){return this.connectionState()===C.Open}channel(a,b={config:{}}){let c=new aL(`realtime:${a}`,b,this);return this.channels.push(c),c}push(a){let{topic:b,event:c,payload:d,ref:e}=a,f=()=>{this.encode(a,a=>{var b;null==(b=this.conn)||b.send(a)})};this.log("push",`${b} ${c} (${e})`,d),this.isConnected()?f():this.sendBuffer.push(f)}async setAuth(a=null){let b=a||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(b){let a=null;try{a=JSON.parse(atob(b.split(".")[1]))}catch(a){}if(a&&a.exp&&!(Math.floor(Date.now()/1e3)-a.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${a.exp}`);this.accessTokenValue=b,this.channels.forEach(a=>{b&&a.updateJoinPayload({access_token:b}),a.joinedOnce&&a._isJoined()&&a._push(A.access_token,{access_token:b})})}}async sendHeartbeat(){var a;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),null==(a=this.conn)||a.close(1e3,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(a=>a()),this.sendBuffer=[])}_makeRef(){let a=this.ref+1;return a===this.ref?this.ref=0:this.ref=a,this.ref.toString()}_leaveOpenTopic(a){let b=this.channels.find(b=>b.topic===a&&(b._isJoined()||b._isJoining()));b&&(this.log("transport",`leaving duplicate topic "${a}"`),b.unsubscribe())}_remove(a){this.channels=this.channels.filter(b=>b._joinRef()!==a._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=a=>this._onConnError(a),this.conn.onmessage=a=>this._onConnMessage(a),this.conn.onclose=a=>this._onConnClose(a))}_onConnMessage(a){this.decode(a.data,a=>{let{topic:b,event:c,payload:d,ref:e}=a;e&&e===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${d.status||""} ${b} ${c} ${e&&"("+e+")"||""}`,d),this.channels.filter(a=>a._isMember(b)).forEach(a=>a._trigger(c,d,e)),this.stateChangeCallbacks.message.forEach(b=>b(a))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let a=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(a),this.workerRef.onerror=a=>{this.log("worker","worker error",a.message),this.workerRef.terminate()},this.workerRef.onmessage=a=>{"keepAlive"===a.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach(a=>a())}_onConnClose(a){this.log("transport","close",a),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(b=>b(a))}_onConnError(a){this.log("transport",a.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(b=>b(a))}_triggerChanError(){this.channels.forEach(a=>a._trigger(A.error))}_appendParams(a,b){if(0===Object.keys(b).length)return a;let c=a.match(/\?/)?"&":"?",d=new URLSearchParams(b);return`${a}${c}${d}`}_workerObjectUrl(a){let b;if(a)b=a;else{let a=new Blob([aO],{type:"application/javascript"});b=URL.createObjectURL(a)}return b}}class aQ{constructor(a,b,c){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=y.connecting,this.send=()=>{},this.url=null,this.url=a,this.close=c.close}}class aR extends Error{constructor(a){super(a),this.__isStorageError=!0,this.name="StorageError"}}function aS(a){return"object"==typeof a&&null!==a&&"__isStorageError"in a}class aT extends aR{constructor(a,b){super(a),this.name="StorageApiError",this.status=b}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class aU extends aR{constructor(a,b){super(a),this.name="StorageUnknownError",this.originalError=b}}let aV=b=>{let c;return c=b||("u"<typeof fetch?(...b)=>a.A(59789).then(({default:a})=>a(...b)):fetch),(...a)=>c(...a)},aW=a=>{if(Array.isArray(a))return a.map(a=>aW(a));if("function"==typeof a||a!==Object(a))return a;let b={};return Object.entries(a).forEach(([a,c])=>{b[a.replace(/([-_][a-z])/gi,a=>a.toUpperCase().replace(/[-_]/g,""))]=aW(c)}),b};var aX=function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})};let aY=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a);function aZ(b,c,d,e,f,g){return aX(this,void 0,void 0,function*(){return new Promise((h,i)=>{let j;b(d,(j={method:c,headers:(null==e?void 0:e.headers)||{}},"GET"===c?j:(j.headers=Object.assign({"Content-Type":"application/json"},null==e?void 0:e.headers),g&&(j.body=JSON.stringify(g)),Object.assign(Object.assign({},j),f)))).then(a=>{if(!a.ok)throw a;return(null==e?void 0:e.noResolveJson)?a:a.json()}).then(a=>h(a)).catch(b=>aX(void 0,void 0,void 0,function*(){var c,d,f,g;let h=yield(c=void 0,d=void 0,f=void 0,g=function*(){return"u"<typeof Response?(yield a.A(59789)).Response:Response},new(f||(f=Promise))(function(a,b){function e(a){try{i(g.next(a))}catch(a){b(a)}}function h(a){try{i(g.throw(a))}catch(a){b(a)}}function i(b){var c;b.done?a(b.value):((c=b.value)instanceof f?c:new f(function(a){a(c)})).then(e,h)}i((g=g.apply(c,d||[])).next())}));b instanceof h&&!(null==e?void 0:e.noResolveJson)?b.json().then(a=>{i(new aT(aY(a),b.status||500))}).catch(a=>{i(new aU(aY(a),a))}):i(new aU(aY(b),b))}))})})}function a$(a,b,c,d){return aX(this,void 0,void 0,function*(){return aZ(a,"GET",b,c,d)})}function a_(a,b,c,d,e){return aX(this,void 0,void 0,function*(){return aZ(a,"POST",b,d,e,c)})}function a0(a,b,c,d,e){return aX(this,void 0,void 0,function*(){return aZ(a,"DELETE",b,d,e,c)})}var a1=function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})};let a2={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},a3={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class a4{constructor(a,b={},c,d){this.url=a,this.headers=b,this.bucketId=c,this.fetch=aV(d)}uploadOrUpdate(a,b,c,d){return a1(this,void 0,void 0,function*(){try{let e,f=Object.assign(Object.assign({},a3),d),g=Object.assign(Object.assign({},this.headers),"POST"===a&&{"x-upsert":String(f.upsert)}),h=f.metadata;"u">typeof Blob&&c instanceof Blob?((e=new FormData).append("cacheControl",f.cacheControl),h&&e.append("metadata",this.encodeMetadata(h)),e.append("",c)):"u">typeof FormData&&c instanceof FormData?((e=c).append("cacheControl",f.cacheControl),h&&e.append("metadata",this.encodeMetadata(h))):(e=c,g["cache-control"]=`max-age=${f.cacheControl}`,g["content-type"]=f.contentType,h&&(g["x-metadata"]=this.toBase64(this.encodeMetadata(h)))),(null==d?void 0:d.headers)&&(g=Object.assign(Object.assign({},g),d.headers));let i=this._removeEmptyFolders(b),j=this._getFinalPath(i),k=yield this.fetch(`${this.url}/object/${j}`,Object.assign({method:a,body:e,headers:g},(null==f?void 0:f.duplex)?{duplex:f.duplex}:{})),l=yield k.json();if(k.ok)return{data:{path:i,id:l.Id,fullPath:l.Key},error:null};return{data:null,error:l}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}upload(a,b,c){return a1(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",a,b,c)})}uploadToSignedUrl(a,b,c,d){return a1(this,void 0,void 0,function*(){let e=this._removeEmptyFolders(a),f=this._getFinalPath(e),g=new URL(this.url+`/object/upload/sign/${f}`);g.searchParams.set("token",b);try{let a,b=Object.assign({upsert:a3.upsert},d),f=Object.assign(Object.assign({},this.headers),{"x-upsert":String(b.upsert)});"u">typeof Blob&&c instanceof Blob?((a=new FormData).append("cacheControl",b.cacheControl),a.append("",c)):"u">typeof FormData&&c instanceof FormData?(a=c).append("cacheControl",b.cacheControl):(a=c,f["cache-control"]=`max-age=${b.cacheControl}`,f["content-type"]=b.contentType);let h=yield this.fetch(g.toString(),{method:"PUT",body:a,headers:f}),i=yield h.json();if(h.ok)return{data:{path:e,fullPath:i.Key},error:null};return{data:null,error:i}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}createSignedUploadUrl(a,b){return a1(this,void 0,void 0,function*(){try{let c=this._getFinalPath(a),d=Object.assign({},this.headers);(null==b?void 0:b.upsert)&&(d["x-upsert"]="true");let e=yield a_(this.fetch,`${this.url}/object/upload/sign/${c}`,{},{headers:d}),f=new URL(this.url+e.url),g=f.searchParams.get("token");if(!g)throw new aR("No token returned by API");return{data:{signedUrl:f.toString(),path:a,token:g},error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}update(a,b,c){return a1(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",a,b,c)})}move(a,b,c){return a1(this,void 0,void 0,function*(){try{return{data:yield a_(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:a,destinationKey:b,destinationBucket:null==c?void 0:c.destinationBucket},{headers:this.headers}),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}copy(a,b,c){return a1(this,void 0,void 0,function*(){try{return{data:{path:(yield a_(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:a,destinationKey:b,destinationBucket:null==c?void 0:c.destinationBucket},{headers:this.headers})).Key},error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}createSignedUrl(a,b,c){return a1(this,void 0,void 0,function*(){try{let d=this._getFinalPath(a),e=yield a_(this.fetch,`${this.url}/object/sign/${d}`,Object.assign({expiresIn:b},(null==c?void 0:c.transform)?{transform:c.transform}:{}),{headers:this.headers}),f=(null==c?void 0:c.download)?`&download=${!0===c.download?"":c.download}`:"";return{data:e={signedUrl:encodeURI(`${this.url}${e.signedURL}${f}`)},error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}createSignedUrls(a,b,c){return a1(this,void 0,void 0,function*(){try{let d=yield a_(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:b,paths:a},{headers:this.headers}),e=(null==c?void 0:c.download)?`&download=${!0===c.download?"":c.download}`:"";return{data:d.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${e}`):null})),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}download(a,b){return a1(this,void 0,void 0,function*(){let c=void 0!==(null==b?void 0:b.transform),d=this.transformOptsToQueryString((null==b?void 0:b.transform)||{}),e=d?`?${d}`:"";try{let b=this._getFinalPath(a),d=yield a$(this.fetch,`${this.url}/${c?"render/image/authenticated":"object"}/${b}${e}`,{headers:this.headers,noResolveJson:!0});return{data:yield d.blob(),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}info(a){return a1(this,void 0,void 0,function*(){let b=this._getFinalPath(a);try{let a=yield a$(this.fetch,`${this.url}/object/info/${b}`,{headers:this.headers});return{data:aW(a),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}exists(a){return a1(this,void 0,void 0,function*(){let b=this._getFinalPath(a);try{return yield function(a,b,c,d){return aX(this,void 0,void 0,function*(){return aZ(a,"HEAD",b,Object.assign(Object.assign({},c),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${b}`,{headers:this.headers}),{data:!0,error:null}}catch(a){if(aS(a)&&a instanceof aU){let b=a.originalError;if([400,404].includes(null==b?void 0:b.status))return{data:!1,error:a}}throw a}})}getPublicUrl(a,b){let c=this._getFinalPath(a),d=[],e=(null==b?void 0:b.download)?`download=${!0===b.download?"":b.download}`:"";""!==e&&d.push(e);let f=void 0!==(null==b?void 0:b.transform),g=this.transformOptsToQueryString((null==b?void 0:b.transform)||{});""!==g&&d.push(g);let h=d.join("&");return""!==h&&(h=`?${h}`),{data:{publicUrl:encodeURI(`${this.url}/${f?"render/image":"object"}/public/${c}${h}`)}}}remove(a){return a1(this,void 0,void 0,function*(){try{return{data:yield a0(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:a},{headers:this.headers}),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}list(a,b,c){return a1(this,void 0,void 0,function*(){try{let d=Object.assign(Object.assign(Object.assign({},a2),b),{prefix:a||""});return{data:yield a_(this.fetch,`${this.url}/object/list/${this.bucketId}`,d,{headers:this.headers},c),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}encodeMetadata(a){return JSON.stringify(a)}toBase64(a){return"u">typeof Buffer?Buffer.from(a).toString("base64"):btoa(a)}_getFinalPath(a){return`${this.bucketId}/${a}`}_removeEmptyFolders(a){return a.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(a){let b=[];return a.width&&b.push(`width=${a.width}`),a.height&&b.push(`height=${a.height}`),a.resize&&b.push(`resize=${a.resize}`),a.format&&b.push(`format=${a.format}`),a.quality&&b.push(`quality=${a.quality}`),b.join("&")}}let a5={"X-Client-Info":"storage-js/2.7.1"};var a6=function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})};class a7{constructor(a,b={},c){this.url=a,this.headers=Object.assign(Object.assign({},a5),b),this.fetch=aV(c)}listBuckets(){return a6(this,void 0,void 0,function*(){try{return{data:yield a$(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}getBucket(a){return a6(this,void 0,void 0,function*(){try{return{data:yield a$(this.fetch,`${this.url}/bucket/${a}`,{headers:this.headers}),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}createBucket(a,b={public:!1}){return a6(this,void 0,void 0,function*(){try{return{data:yield a_(this.fetch,`${this.url}/bucket`,{id:a,name:a,public:b.public,file_size_limit:b.fileSizeLimit,allowed_mime_types:b.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}updateBucket(a,b){return a6(this,void 0,void 0,function*(){try{return{data:yield function(a,b,c,d,e){return aX(this,void 0,void 0,function*(){return aZ(a,"PUT",b,d,void 0,c)})}(this.fetch,`${this.url}/bucket/${a}`,{id:a,name:a,public:b.public,file_size_limit:b.fileSizeLimit,allowed_mime_types:b.allowedMimeTypes},{headers:this.headers}),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}emptyBucket(a){return a6(this,void 0,void 0,function*(){try{return{data:yield a_(this.fetch,`${this.url}/bucket/${a}/empty`,{},{headers:this.headers}),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}deleteBucket(a){return a6(this,void 0,void 0,function*(){try{return{data:yield a0(this.fetch,`${this.url}/bucket/${a}`,{},{headers:this.headers}),error:null}}catch(a){if(aS(a))return{data:null,error:a};throw a}})}}class a8 extends a7{constructor(a,b={},c){super(a,b,c)}from(a){return new a4(this.url,this.headers,a,this.fetch)}}let a9="";a9="u">typeof Deno?"deno":"u">typeof document?"web":"u">typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let ba={headers:{"X-Client-Info":`supabase-js-${a9}/2.48.1`}},bb={schema:"public"},bc={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},bd={};var be=a.i(23952);let bf="2.67.3",bg={"X-Client-Info":`gotrue-js/${bf}`},bh="X-Supabase-Api-Version",bi={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},bj=b=>{let c;return c=b||("u"<typeof fetch?(...b)=>a.A(59789).then(({default:a})=>a(...b)):fetch),(...a)=>c(...a)},bk=async(a,b,c)=>{await a.setItem(b,JSON.stringify(c))},bl=async(a,b)=>{let c=await a.getItem(b);if(!c)return null;try{return JSON.parse(c)}catch(a){return c}},bm=async(a,b)=>{await a.removeItem(b)};class bn{constructor(){this.promise=new bn.promiseConstructor((a,b)=>{this.resolve=a,this.reject=b})}}function bo(a){let b=a.split(".");if(3!==b.length)throw Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(b[1]))throw Error("JWT is not valid: payload is not in base64url format");return JSON.parse(function(a){let b,c,d,e,f,g,h,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",j="",k=0;for(a=a.replace("-","+").replace("_","/");k<a.length;)e=i.indexOf(a.charAt(k++)),f=i.indexOf(a.charAt(k++)),g=i.indexOf(a.charAt(k++)),h=i.indexOf(a.charAt(k++)),b=e<<2|f>>4,c=(15&f)<<4|g>>2,d=(3&g)<<6|h,j+=String.fromCharCode(b),64!=g&&0!=c&&(j+=String.fromCharCode(c)),64!=h&&0!=d&&(j+=String.fromCharCode(d));return j}(b[1]))}async function bp(a){return await new Promise(b=>{setTimeout(()=>b(null),a)})}function bq(a){return("0"+a.toString(16)).substr(-2)}async function br(a){let b=new TextEncoder().encode(a);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",b))).map(a=>String.fromCharCode(a)).join("")}async function bs(a){return"u">typeof crypto&&void 0!==crypto.subtle&&"u">typeof TextEncoder?btoa(await br(a)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),a)}async function bt(a,b,c=!1){let d=function(){let a=new Uint32Array(56);if("u"<typeof crypto){let a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",b=a.length,c="";for(let d=0;d<56;d++)c+=a.charAt(Math.floor(Math.random()*b));return c}return crypto.getRandomValues(a),Array.from(a,bq).join("")}(),e=d;c&&(e+="/PASSWORD_RECOVERY"),await bk(a,`${b}-code-verifier`,e);let f=await bs(d),g=d===f?"plain":"s256";return[f,g]}bn.promiseConstructor=Promise;let bu=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;class bv extends Error{constructor(a,b,c){super(a),this.__isAuthError=!0,this.name="AuthError",this.status=b,this.code=c}}function bw(a){return"object"==typeof a&&null!==a&&"__isAuthError"in a}class bx extends bv{constructor(a,b,c){super(a,b,c),this.name="AuthApiError",this.status=b,this.code=c}}class by extends bv{constructor(a,b){super(a),this.name="AuthUnknownError",this.originalError=b}}class bz extends bv{constructor(a,b,c,d){super(a,c,d),this.name=b,this.status=c}}class bA extends bz{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class bB extends bz{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class bC extends bz{constructor(a){super(a,"AuthInvalidCredentialsError",400,void 0)}}class bD extends bz{constructor(a,b=null){super(a,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=b}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class bE extends bz{constructor(a,b){super(a,"AuthRetryableFetchError",b,void 0)}}function bF(a){return bw(a)&&"AuthRetryableFetchError"===a.name}class bG extends bz{constructor(a,b,c){super(a,"AuthWeakPasswordError",b,"weak_password"),this.reasons=c}}var bH=function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c};let bI=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),bJ=[502,503,504];async function bK(a){var b;let c,d;if(!("object"==typeof a&&null!==a&&"status"in a&&"ok"in a&&"json"in a&&"function"==typeof a.json))throw new bE(bI(a),0);if(bJ.includes(a.status))throw new bE(bI(a),a.status);try{c=await a.json()}catch(a){throw new by(bI(a),a)}let e=function(a){let b=a.headers.get(bh);if(!b||!b.match(bu))return null;try{return new Date(`${b}T00:00:00.0Z`)}catch(a){return null}}(a);if(e&&e.getTime()>=bi["2024-01-01"].timestamp&&"object"==typeof c&&c&&"string"==typeof c.code?d=c.code:"object"==typeof c&&c&&"string"==typeof c.error_code&&(d=c.error_code),d){if("weak_password"===d)throw new bG(bI(c),a.status,(null==(b=c.weak_password)?void 0:b.reasons)||[]);else if("session_not_found"===d)throw new bA}else if("object"==typeof c&&c&&"object"==typeof c.weak_password&&c.weak_password&&Array.isArray(c.weak_password.reasons)&&c.weak_password.reasons.length&&c.weak_password.reasons.reduce((a,b)=>a&&"string"==typeof b,!0))throw new bG(bI(c),a.status,c.weak_password.reasons);throw new bx(bI(c),a.status||500,d)}async function bL(a,b,c,d){var e;let f=Object.assign({},null==d?void 0:d.headers);f[bh]||(f[bh]=bi["2024-01-01"].name),(null==d?void 0:d.jwt)&&(f.Authorization=`Bearer ${d.jwt}`);let g=null!=(e=null==d?void 0:d.query)?e:{};(null==d?void 0:d.redirectTo)&&(g.redirect_to=d.redirectTo);let h=Object.keys(g).length?"?"+new URLSearchParams(g).toString():"",i=await bM(a,b,c+h,{headers:f,noResolveJson:null==d?void 0:d.noResolveJson},{},null==d?void 0:d.body);return(null==d?void 0:d.xform)?null==d?void 0:d.xform(i):{data:Object.assign({},i),error:null}}async function bM(a,b,c,d,e,f){let g,h,i=(h={method:b,headers:(null==d?void 0:d.headers)||{}},"GET"===b?h:(h.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==d?void 0:d.headers),h.body=JSON.stringify(f),Object.assign(Object.assign({},h),e)));try{g=await a(c,Object.assign({},i))}catch(a){throw console.error(a),new bE(bI(a),0)}if(g.ok||await bK(g),null==d?void 0:d.noResolveJson)return g;try{return await g.json()}catch(a){await bK(a)}}function bN(a){var b,c,d;let e=null;(d=a).access_token&&d.refresh_token&&d.expires_in&&(e=Object.assign({},a),a.expires_at||(e.expires_at=(c=a.expires_in,Math.round(Date.now()/1e3)+c)));return{data:{session:e,user:null!=(b=a.user)?b:a},error:null}}function bO(a){let b=bN(a);return!b.error&&a.weak_password&&"object"==typeof a.weak_password&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.message&&"string"==typeof a.weak_password.message&&a.weak_password.reasons.reduce((a,b)=>a&&"string"==typeof b,!0)&&(b.data.weak_password=a.weak_password),b}function bP(a){var b;return{data:{user:null!=(b=a.user)?b:a},error:null}}function bQ(a){return{data:a,error:null}}function bR(a){let{action_link:b,email_otp:c,hashed_token:d,redirect_to:e,verification_type:f}=a;return{data:{properties:{action_link:b,email_otp:c,hashed_token:d,redirect_to:e,verification_type:f},user:Object.assign({},bH(a,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function bS(a){return a}var bT=function(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols)for(var e=0,d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]]);return c};class bU{constructor({url:a="",headers:b={},fetch:c}){this.url=a,this.headers=b,this.fetch=bj(c),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(a,b="global"){try{return await bL(this.fetch,"POST",`${this.url}/logout?scope=${b}`,{headers:this.headers,jwt:a,noResolveJson:!0}),{data:null,error:null}}catch(a){if(bw(a))return{data:null,error:a};throw a}}async inviteUserByEmail(a,b={}){try{return await bL(this.fetch,"POST",`${this.url}/invite`,{body:{email:a,data:b.data},headers:this.headers,redirectTo:b.redirectTo,xform:bP})}catch(a){if(bw(a))return{data:{user:null},error:a};throw a}}async generateLink(a){try{let{options:b}=a,c=bT(a,["options"]),d=Object.assign(Object.assign({},c),b);return"newEmail"in c&&(d.new_email=null==c?void 0:c.newEmail,delete d.newEmail),await bL(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:d,headers:this.headers,xform:bR,redirectTo:null==b?void 0:b.redirectTo})}catch(a){if(bw(a))return{data:{properties:null,user:null},error:a};throw a}}async createUser(a){try{return await bL(this.fetch,"POST",`${this.url}/admin/users`,{body:a,headers:this.headers,xform:bP})}catch(a){if(bw(a))return{data:{user:null},error:a};throw a}}async listUsers(a){var b,c,d,e,f,g,h;try{let i={nextPage:null,lastPage:0,total:0},j=await bL(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(c=null==(b=null==a?void 0:a.page)?void 0:b.toString())?c:"",per_page:null!=(e=null==(d=null==a?void 0:a.perPage)?void 0:d.toString())?e:""},xform:bS});if(j.error)throw j.error;let k=await j.json(),l=null!=(f=j.headers.get("x-total-count"))?f:0,m=null!=(h=null==(g=j.headers.get("link"))?void 0:g.split(","))?h:[];return m.length>0&&(m.forEach(a=>{let b=parseInt(a.split(";")[0].split("=")[1].substring(0,1)),c=JSON.parse(a.split(";")[1].split("=")[1]);i[`${c}Page`]=b}),i.total=parseInt(l)),{data:Object.assign(Object.assign({},k),i),error:null}}catch(a){if(bw(a))return{data:{users:[]},error:a};throw a}}async getUserById(a){try{return await bL(this.fetch,"GET",`${this.url}/admin/users/${a}`,{headers:this.headers,xform:bP})}catch(a){if(bw(a))return{data:{user:null},error:a};throw a}}async updateUserById(a,b){try{return await bL(this.fetch,"PUT",`${this.url}/admin/users/${a}`,{body:b,headers:this.headers,xform:bP})}catch(a){if(bw(a))return{data:{user:null},error:a};throw a}}async deleteUser(a,b=!1){try{return await bL(this.fetch,"DELETE",`${this.url}/admin/users/${a}`,{headers:this.headers,body:{should_soft_delete:b},xform:bP})}catch(a){if(bw(a))return{data:{user:null},error:a};throw a}}async _listFactors(a){try{let{data:b,error:c}=await bL(this.fetch,"GET",`${this.url}/admin/users/${a.userId}/factors`,{headers:this.headers,xform:a=>({data:{factors:a},error:null})});return{data:b,error:c}}catch(a){if(bw(a))return{data:null,error:a};throw a}}async _deleteFactor(a){try{return{data:await bL(this.fetch,"DELETE",`${this.url}/admin/users/${a.userId}/factors/${a.id}`,{headers:this.headers}),error:null}}catch(a){if(bw(a))return{data:null,error:a};throw a}}}let bV={getItem:a=>null,setItem:(a,b)=>{},removeItem:a=>{}};function bW(a={}){return{getItem:b=>a[b]||null,setItem:(b,c)=>{a[b]=c},removeItem:b=>{delete a[b]}}}globalThis;class bX extends Error{constructor(a){super(a),this.isAcquireTimeout=!0}}if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(a){"u">typeof self&&(self.globalThis=self)}let bY={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:bg,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function bZ(a,b,c){return await c()}class b${constructor(a){this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=b$.nextInstanceID,b$.nextInstanceID+=1,this.instanceID;const b=Object.assign(Object.assign({},bY),a);this.logDebugMessages=!!b.debug,"function"==typeof b.debug&&(this.logger=b.debug),this.persistSession=b.persistSession,this.storageKey=b.storageKey,this.autoRefreshToken=b.autoRefreshToken,this.admin=new bU({url:b.url,headers:b.headers,fetch:b.fetch}),this.url=b.url,this.headers=b.headers,this.fetch=bj(b.fetch),this.lock=b.lock||bZ,this.detectSessionInUrl=b.detectSessionInUrl,this.flowType=b.flowType,this.hasCustomAuthorizationHeader=b.hasCustomAuthorizationHeader,b.lock?this.lock=b.lock:this.lock=bZ,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?b.storage?this.storage=b.storage:(this.memoryStorage={},this.storage=bW(this.memoryStorage)):(this.memoryStorage={},this.storage=bW(this.memoryStorage)),this.initialize()}_debug(...a){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${bf}) ${new Date().toISOString()}`,...a),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){try{let a=function(a){let b={},c=new URL(a);if(c.hash&&"#"===c.hash[0])try{new URLSearchParams(c.hash.substring(1)).forEach((a,c)=>{b[c]=a})}catch(a){}return c.searchParams.forEach((a,c)=>{b[c]=a}),b}(window.location.href);return this._isImplicitGrantCallback(a)||await this._isPKCECallback(a),await this._recoverAndRefresh(),{error:null}}catch(a){if(bw(a))return{error:a};return{error:new by("Unexpected error during initialization",a)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(a){var b,c,d;try{let{data:e,error:f}=await bL(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!=(c=null==(b=null==a?void 0:a.options)?void 0:b.data)?c:{},gotrue_meta_security:{captcha_token:null==(d=null==a?void 0:a.options)?void 0:d.captchaToken}},xform:bN});if(f||!e)return{data:{user:null,session:null},error:f};let g=e.session,h=e.user;return e.session&&(await this._saveSession(e.session),await this._notifyAllSubscribers("SIGNED_IN",g)),{data:{user:h,session:g},error:null}}catch(a){if(bw(a))return{data:{user:null,session:null},error:a};throw a}}async signUp(a){var b,c,d;try{let e;if("email"in a){let{email:c,password:d,options:f}=a,g=null,h=null;"pkce"===this.flowType&&([g,h]=await bt(this.storage,this.storageKey)),e=await bL(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==f?void 0:f.emailRedirectTo,body:{email:c,password:d,data:null!=(b=null==f?void 0:f.data)?b:{},gotrue_meta_security:{captcha_token:null==f?void 0:f.captchaToken},code_challenge:g,code_challenge_method:h},xform:bN})}else if("phone"in a){let{phone:b,password:f,options:g}=a;e=await bL(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:b,password:f,data:null!=(c=null==g?void 0:g.data)?c:{},channel:null!=(d=null==g?void 0:g.channel)?d:"sms",gotrue_meta_security:{captcha_token:null==g?void 0:g.captchaToken}},xform:bN})}else throw new bC("You must provide either an email or phone number and a password");let{data:f,error:g}=e;if(g||!f)return{data:{user:null,session:null},error:g};let h=f.session,i=f.user;return f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:i,session:h},error:null}}catch(a){if(bw(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithPassword(a){try{let b;if("email"in a){let{email:c,password:d,options:e}=a;b=await bL(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:c,password:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:bO})}else if("phone"in a){let{phone:c,password:d,options:e}=a;b=await bL(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:c,password:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},xform:bO})}else throw new bC("You must provide either an email or phone number and a password");let{data:c,error:d}=b;if(d)return{data:{user:null,session:null},error:d};if(!c||!c.session||!c.user)return{data:{user:null,session:null},error:new bB};return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:Object.assign({user:c.user,session:c.session},c.weak_password?{weakPassword:c.weak_password}:null),error:d}}catch(a){if(bw(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithOAuth(a){var b,c,d,e;return await this._handleProviderSignIn(a.provider,{redirectTo:null==(b=a.options)?void 0:b.redirectTo,scopes:null==(c=a.options)?void 0:c.scopes,queryParams:null==(d=a.options)?void 0:d.queryParams,skipBrowserRedirect:null==(e=a.options)?void 0:e.skipBrowserRedirect})}async exchangeCodeForSession(a){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(a))}async _exchangeCodeForSession(a){let b=await bl(this.storage,`${this.storageKey}-code-verifier`),[c,d]=(null!=b?b:"").split("/");try{let{data:b,error:e}=await bL(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:a,code_verifier:c},xform:bN});if(await bm(this.storage,`${this.storageKey}-code-verifier`),e)throw e;if(!b||!b.session||!b.user)return{data:{user:null,session:null,redirectType:null},error:new bB};return b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("SIGNED_IN",b.session)),{data:Object.assign(Object.assign({},b),{redirectType:null!=d?d:null}),error:e}}catch(a){if(bw(a))return{data:{user:null,session:null,redirectType:null},error:a};throw a}}async signInWithIdToken(a){try{let{options:b,provider:c,token:d,access_token:e,nonce:f}=a,{data:g,error:h}=await bL(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:c,id_token:d,access_token:e,nonce:f,gotrue_meta_security:{captcha_token:null==b?void 0:b.captchaToken}},xform:bN});if(h)return{data:{user:null,session:null},error:h};if(!g||!g.session||!g.user)return{data:{user:null,session:null},error:new bB};return g.session&&(await this._saveSession(g.session),await this._notifyAllSubscribers("SIGNED_IN",g.session)),{data:g,error:h}}catch(a){if(bw(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithOtp(a){var b,c,d,e,f;try{if("email"in a){let{email:d,options:e}=a,f=null,g=null;"pkce"===this.flowType&&([f,g]=await bt(this.storage,this.storageKey));let{error:h}=await bL(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:d,data:null!=(b=null==e?void 0:e.data)?b:{},create_user:null==(c=null==e?void 0:e.shouldCreateUser)||c,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken},code_challenge:f,code_challenge_method:g},redirectTo:null==e?void 0:e.emailRedirectTo});return{data:{user:null,session:null},error:h}}if("phone"in a){let{phone:b,options:c}=a,{data:g,error:h}=await bL(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:b,data:null!=(d=null==c?void 0:c.data)?d:{},create_user:null==(e=null==c?void 0:c.shouldCreateUser)||e,gotrue_meta_security:{captcha_token:null==c?void 0:c.captchaToken},channel:null!=(f=null==c?void 0:c.channel)?f:"sms"}});return{data:{user:null,session:null,messageId:null==g?void 0:g.message_id},error:h}}throw new bC("You must provide either an email or phone number.")}catch(a){if(bw(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(a){var b,c;try{let d,e;"options"in a&&(d=null==(b=a.options)?void 0:b.redirectTo,e=null==(c=a.options)?void 0:c.captchaToken);let{data:f,error:g}=await bL(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},a),{gotrue_meta_security:{captcha_token:e}}),redirectTo:d,xform:bN});if(g)throw g;if(!f)throw Error("An error occurred on token verification.");let h=f.session,i=f.user;return(null==h?void 0:h.access_token)&&(await this._saveSession(h),await this._notifyAllSubscribers("recovery"==a.type?"PASSWORD_RECOVERY":"SIGNED_IN",h)),{data:{user:i,session:h},error:null}}catch(a){if(bw(a))return{data:{user:null,session:null},error:a};throw a}}async signInWithSSO(a){var b,c,d;try{let e=null,f=null;return"pkce"===this.flowType&&([e,f]=await bt(this.storage,this.storageKey)),await bL(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in a?{provider_id:a.providerId}:null),"domain"in a?{domain:a.domain}:null),{redirect_to:null!=(c=null==(b=a.options)?void 0:b.redirectTo)?c:void 0}),(null==(d=null==a?void 0:a.options)?void 0:d.captchaToken)?{gotrue_meta_security:{captcha_token:a.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:e,code_challenge_method:f}),headers:this.headers,xform:bQ})}catch(a){if(bw(a))return{data:null,error:a};throw a}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async a=>{let{data:{session:b},error:c}=a;if(c)throw c;if(!b)throw new bA;let{error:d}=await bL(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:b.access_token});return{data:{user:null,session:null},error:d}})}catch(a){if(bw(a))return{data:{user:null,session:null},error:a};throw a}}async resend(a){try{let b=`${this.url}/resend`;if("email"in a){let{email:c,type:d,options:e}=a,{error:f}=await bL(this.fetch,"POST",b,{headers:this.headers,body:{email:c,type:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}},redirectTo:null==e?void 0:e.emailRedirectTo});return{data:{user:null,session:null},error:f}}if("phone"in a){let{phone:c,type:d,options:e}=a,{data:f,error:g}=await bL(this.fetch,"POST",b,{headers:this.headers,body:{phone:c,type:d,gotrue_meta_security:{captcha_token:null==e?void 0:e.captchaToken}}});return{data:{user:null,session:null,messageId:null==f?void 0:f.message_id},error:g}}throw new bC("You must provide either an email or phone number and a type")}catch(a){if(bw(a))return{data:{user:null,session:null},error:a};throw a}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async a=>a))}async _acquireLock(a,b){this._debug("#_acquireLock","begin",a);try{if(this.lockAcquired){let a=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),c=(async()=>(await a,await b()))();return this.pendingInLock.push((async()=>{try{await c}catch(a){}})()),c}return await this.lock(`lock:${this.storageKey}`,a,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let a=b();for(this.pendingInLock.push((async()=>{try{await a}catch(a){}})()),await a;this.pendingInLock.length;){let a=[...this.pendingInLock];await Promise.all(a),this.pendingInLock.splice(0,a.length)}return await a}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(a){this._debug("#_useSession","begin");try{let b=await this.__loadSession();return await a(b)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let a=null,b=await bl(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",b),null!==b&&(this._isValidSession(b)?a=b:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!a)return{data:{session:null},error:null};let c=!!a.expires_at&&a.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${c?"":" not"} expired`,"expires_at",a.expires_at),!c){if(this.storage.isServer){let b=this.suppressGetSessionWarning;a=new Proxy(a,{get:(a,c,d)=>(b||"user"!==c||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),b=!0,this.suppressGetSessionWarning=!0),Reflect.get(a,c,d))})}return{data:{session:a},error:null}}let{session:d,error:e}=await this._callRefreshToken(a.refresh_token);if(e)return{data:{session:null},error:e};return{data:{session:d},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(a){return a?await this._getUser(a):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(a){try{if(a)return await bL(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:a,xform:bP});return await this._useSession(async a=>{var b,c,d;let{data:e,error:f}=a;if(f)throw f;return(null==(b=e.session)?void 0:b.access_token)||this.hasCustomAuthorizationHeader?await bL(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!=(d=null==(c=e.session)?void 0:c.access_token)?d:void 0,xform:bP}):{data:{user:null},error:new bA}})}catch(a){if(bw(a))return bw(a)&&"AuthSessionMissingError"===a.name&&(await this._removeSession(),await bm(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:a};throw a}}async updateUser(a,b={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(a,b))}async _updateUser(a,b={}){try{return await this._useSession(async c=>{let{data:d,error:e}=c;if(e)throw e;if(!d.session)throw new bA;let f=d.session,g=null,h=null;"pkce"===this.flowType&&null!=a.email&&([g,h]=await bt(this.storage,this.storageKey));let{data:i,error:j}=await bL(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==b?void 0:b.emailRedirectTo,body:Object.assign(Object.assign({},a),{code_challenge:g,code_challenge_method:h}),jwt:f.access_token,xform:bP});if(j)throw j;return f.user=i.user,await this._saveSession(f),await this._notifyAllSubscribers("USER_UPDATED",f),{data:{user:f.user},error:null}})}catch(a){if(bw(a))return{data:{user:null},error:a};throw a}}_decodeJWT(a){return bo(a)}async setSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(a))}async _setSession(a){try{if(!a.access_token||!a.refresh_token)throw new bA;let b=Date.now()/1e3,c=b,d=!0,e=null,f=bo(a.access_token);if(f.exp&&(d=(c=f.exp)<=b),d){let{session:b,error:c}=await this._callRefreshToken(a.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!b)return{data:{user:null,session:null},error:null};e=b}else{let{data:d,error:f}=await this._getUser(a.access_token);if(f)throw f;e={access_token:a.access_token,refresh_token:a.refresh_token,user:d.user,token_type:"bearer",expires_in:c-b,expires_at:c},await this._saveSession(e),await this._notifyAllSubscribers("SIGNED_IN",e)}return{data:{user:e.user,session:e},error:null}}catch(a){if(bw(a))return{data:{session:null,user:null},error:a};throw a}}async refreshSession(a){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(a))}async _refreshSession(a){try{return await this._useSession(async b=>{var c;if(!a){let{data:d,error:e}=b;if(e)throw e;a=null!=(c=d.session)?c:void 0}if(!(null==a?void 0:a.refresh_token))throw new bA;let{session:d,error:e}=await this._callRefreshToken(a.refresh_token);return e?{data:{user:null,session:null},error:e}:d?{data:{user:d.user,session:d},error:null}:{data:{user:null,session:null},error:null}})}catch(a){if(bw(a))return{data:{user:null,session:null},error:a};throw a}}async _getSessionFromURL(a,b){try{throw new bD("No browser detected.")}catch(a){if(bw(a))return{data:{session:null,redirectType:null},error:a};throw a}}_isImplicitGrantCallback(a){return!!(a.access_token||a.error_description)}async _isPKCECallback(a){let b=await bl(this.storage,`${this.storageKey}-code-verifier`);return!!(a.code&&b)}async signOut(a={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(a))}async _signOut({scope:a}={scope:"global"}){return await this._useSession(async b=>{var c;let{data:d,error:e}=b;if(e)return{error:e};let f=null==(c=d.session)?void 0:c.access_token;if(f){let{error:b}=await this.admin.signOut(f,a);if(b&&!(bw(b)&&"AuthApiError"===b.name&&(404===b.status||401===b.status||403===b.status)))return{error:b}}return"others"!==a&&(await this._removeSession(),await bm(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(a){let b="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){let b=16*Math.random()|0;return("x"==a?b:3&b|8).toString(16)}),c={id:b,callback:a,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",b),this.stateChangeEmitters.delete(b)}};return this._debug("#onAuthStateChange()","registered callback with id",b),this.stateChangeEmitters.set(b,c),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(b)})})(),{data:{subscription:c}}}async _emitInitialSession(a){return await this._useSession(async b=>{var c,d;try{let{data:{session:d},error:e}=b;if(e)throw e;await (null==(c=this.stateChangeEmitters.get(a))?void 0:c.callback("INITIAL_SESSION",d)),this._debug("INITIAL_SESSION","callback id",a,"session",d)}catch(b){await (null==(d=this.stateChangeEmitters.get(a))?void 0:d.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",a,"error",b),console.error(b)}})}async resetPasswordForEmail(a,b={}){let c=null,d=null;"pkce"===this.flowType&&([c,d]=await bt(this.storage,this.storageKey,!0));try{return await bL(this.fetch,"POST",`${this.url}/recover`,{body:{email:a,code_challenge:c,code_challenge_method:d,gotrue_meta_security:{captcha_token:b.captchaToken}},headers:this.headers,redirectTo:b.redirectTo})}catch(a){if(bw(a))return{data:null,error:a};throw a}}async getUserIdentities(){var a;try{let{data:b,error:c}=await this.getUser();if(c)throw c;return{data:{identities:null!=(a=b.user.identities)?a:[]},error:null}}catch(a){if(bw(a))return{data:null,error:a};throw a}}async linkIdentity(a){try{let{data:b,error:c}=await this._useSession(async b=>{var c,d,e,f,g;let{data:h,error:i}=b;if(i)throw i;let j=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,a.provider,{redirectTo:null==(c=a.options)?void 0:c.redirectTo,scopes:null==(d=a.options)?void 0:d.scopes,queryParams:null==(e=a.options)?void 0:e.queryParams,skipBrowserRedirect:!0});return await bL(this.fetch,"GET",j,{headers:this.headers,jwt:null!=(g=null==(f=h.session)?void 0:f.access_token)?g:void 0})});if(c)throw c;return{data:{provider:a.provider,url:null==b?void 0:b.url},error:null}}catch(b){if(bw(b))return{data:{provider:a.provider,url:null},error:b};throw b}}async unlinkIdentity(a){try{return await this._useSession(async b=>{var c,d;let{data:e,error:f}=b;if(f)throw f;return await bL(this.fetch,"DELETE",`${this.url}/user/identities/${a.identity_id}`,{headers:this.headers,jwt:null!=(d=null==(c=e.session)?void 0:c.access_token)?d:void 0})})}catch(a){if(bw(a))return{data:null,error:a};throw a}}async _refreshAccessToken(a){let b=`#_refreshAccessToken(${a.substring(0,5)}...)`;this._debug(b,"begin");try{var c,d;let e=Date.now();return await (c=async c=>(c>0&&await bp(200*Math.pow(2,c-1)),this._debug(b,"refreshing attempt",c),await bL(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:a},headers:this.headers,xform:bN})),d=(a,b)=>{let c=200*Math.pow(2,a);return b&&bF(b)&&Date.now()+c-e<3e4},new Promise((a,b)=>{(async()=>{for(let e=0;e<1/0;e++)try{let b=await c(e);if(!d(e,null,b))return void a(b)}catch(a){if(!d(e,a))return void b(a)}})()}))}catch(a){if(this._debug(b,"error",a),bw(a))return{data:{session:null,user:null},error:a};throw a}finally{this._debug(b,"end")}}_isValidSession(a){return"object"==typeof a&&null!==a&&"access_token"in a&&"refresh_token"in a&&"expires_at"in a}async _handleProviderSignIn(a,b){let c=await this._getUrlForProvider(`${this.url}/authorize`,a,{redirectTo:b.redirectTo,scopes:b.scopes,queryParams:b.queryParams});return this._debug("#_handleProviderSignIn()","provider",a,"options",b,"url",c),{data:{provider:a,url:c},error:null}}async _recoverAndRefresh(){var a;let b="#_recoverAndRefresh()";this._debug(b,"begin");try{let c=await bl(this.storage,this.storageKey);if(this._debug(b,"session from storage",c),!this._isValidSession(c)){this._debug(b,"session is not valid"),null!==c&&await this._removeSession();return}let d=Math.round(Date.now()/1e3),e=(null!=(a=c.expires_at)?a:1/0)<d+10;if(this._debug(b,`session has${e?"":" not"} expired with margin of 10s`),e){if(this.autoRefreshToken&&c.refresh_token){let{error:a}=await this._callRefreshToken(c.refresh_token);a&&(console.error(a),bF(a)||(this._debug(b,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",c)}catch(a){this._debug(b,"error",a),console.error(a);return}finally{this._debug(b,"end")}}async _callRefreshToken(a){var b,c;if(!a)throw new bA;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let d=`#_callRefreshToken(${a.substring(0,5)}...)`;this._debug(d,"begin");try{this.refreshingDeferred=new bn;let{data:b,error:c}=await this._refreshAccessToken(a);if(c)throw c;if(!b.session)throw new bA;await this._saveSession(b.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",b.session);let d={session:b.session,error:null};return this.refreshingDeferred.resolve(d),d}catch(a){if(this._debug(d,"error",a),bw(a)){let c={session:null,error:a};return bF(a)||await this._removeSession(),null==(b=this.refreshingDeferred)||b.resolve(c),c}throw null==(c=this.refreshingDeferred)||c.reject(a),a}finally{this.refreshingDeferred=null,this._debug(d,"end")}}async _notifyAllSubscribers(a,b,c=!0){let d=`#_notifyAllSubscribers(${a})`;this._debug(d,"begin",b,`broadcast = ${c}`);try{this.broadcastChannel&&c&&this.broadcastChannel.postMessage({event:a,session:b});let d=[],e=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(a,b)}catch(a){d.push(a)}});if(await Promise.all(e),d.length>0){for(let a=0;a<d.length;a+=1)console.error(d[a]);throw d[0]}}finally{this._debug(d,"end")}}async _saveSession(a){this._debug("#_saveSession()",a),this.suppressGetSessionWarning=!0,await bk(this.storage,this.storageKey,a)}async _removeSession(){this._debug("#_removeSession()"),await bm(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()"),this.visibilityChangedCallback,this.visibilityChangedCallback=null}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let a=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=a,a&&"object"==typeof a&&"function"==typeof a.unref?a.unref():"u">typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(a),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let a=this.autoRefreshTicker;this.autoRefreshTicker=null,a&&clearInterval(a)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let a=Date.now();try{return await this._useSession(async b=>{let{data:{session:c}}=b;if(!c||!c.refresh_token||!c.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let d=Math.floor((1e3*c.expires_at-a)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${d} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),d<=3&&await this._callRefreshToken(c.refresh_token)})}catch(a){console.error("Auto refresh tick failed with error. This is likely a transient error.",a)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(a){if(a.isAcquireTimeout||a instanceof bX)this._debug("auto refresh token tick lock not available");else throw a}}async _handleVisibilityChange(){return this._debug("#_handleVisibilityChange()"),this.autoRefreshToken&&this.startAutoRefresh(),!1}async _onVisibilityChanged(a){let b=`#_onVisibilityChanged(${a})`;this._debug(b,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),a||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"!==document.visibilityState?this._debug(b,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting"):await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(a,b,c){let d=[`provider=${encodeURIComponent(b)}`];if((null==c?void 0:c.redirectTo)&&d.push(`redirect_to=${encodeURIComponent(c.redirectTo)}`),(null==c?void 0:c.scopes)&&d.push(`scopes=${encodeURIComponent(c.scopes)}`),"pkce"===this.flowType){let[a,b]=await bt(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(a)}`,code_challenge_method:`${encodeURIComponent(b)}`});d.push(c.toString())}if(null==c?void 0:c.queryParams){let a=new URLSearchParams(c.queryParams);d.push(a.toString())}return(null==c?void 0:c.skipBrowserRedirect)&&d.push(`skip_http_redirect=${c.skipBrowserRedirect}`),`${a}?${d.join("&")}`}async _unenroll(a){try{return await this._useSession(async b=>{var c;let{data:d,error:e}=b;return e?{data:null,error:e}:await bL(this.fetch,"DELETE",`${this.url}/factors/${a.factorId}`,{headers:this.headers,jwt:null==(c=null==d?void 0:d.session)?void 0:c.access_token})})}catch(a){if(bw(a))return{data:null,error:a};throw a}}async _enroll(a){try{return await this._useSession(async b=>{var c,d;let{data:e,error:f}=b;if(f)return{data:null,error:f};let g=Object.assign({friendly_name:a.friendlyName,factor_type:a.factorType},"phone"===a.factorType?{phone:a.phone}:{issuer:a.issuer}),{data:h,error:i}=await bL(this.fetch,"POST",`${this.url}/factors`,{body:g,headers:this.headers,jwt:null==(c=null==e?void 0:e.session)?void 0:c.access_token});return i?{data:null,error:i}:("totp"===a.factorType&&(null==(d=null==h?void 0:h.totp)?void 0:d.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),{data:h,error:null})})}catch(a){if(bw(a))return{data:null,error:a};throw a}}async _verify(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async b=>{var c;let{data:d,error:e}=b;if(e)return{data:null,error:e};let{data:f,error:g}=await bL(this.fetch,"POST",`${this.url}/factors/${a.factorId}/verify`,{body:{code:a.code,challenge_id:a.challengeId},headers:this.headers,jwt:null==(c=null==d?void 0:d.session)?void 0:c.access_token});return g?{data:null,error:g}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+f.expires_in},f)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",f),{data:f,error:g})})}catch(a){if(bw(a))return{data:null,error:a};throw a}})}async _challenge(a){return this._acquireLock(-1,async()=>{try{return await this._useSession(async b=>{var c;let{data:d,error:e}=b;return e?{data:null,error:e}:await bL(this.fetch,"POST",`${this.url}/factors/${a.factorId}/challenge`,{body:{channel:a.channel},headers:this.headers,jwt:null==(c=null==d?void 0:d.session)?void 0:c.access_token})})}catch(a){if(bw(a))return{data:null,error:a};throw a}})}async _challengeAndVerify(a){let{data:b,error:c}=await this._challenge({factorId:a.factorId});return c?{data:null,error:c}:await this._verify({factorId:a.factorId,challengeId:b.id,code:a.code})}async _listFactors(){let{data:{user:a},error:b}=await this.getUser();if(b)return{data:null,error:b};let c=(null==a?void 0:a.factors)||[],d=c.filter(a=>"totp"===a.factor_type&&"verified"===a.status),e=c.filter(a=>"phone"===a.factor_type&&"verified"===a.status);return{data:{all:c,totp:d,phone:e},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async a=>{var b,c;let{data:{session:d},error:e}=a;if(e)return{data:null,error:e};if(!d)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let f=this._decodeJWT(d.access_token),g=null;f.aal&&(g=f.aal);let h=g;return(null!=(c=null==(b=d.user.factors)?void 0:b.filter(a=>"verified"===a.status))?c:[]).length>0&&(h="aal2"),{data:{currentLevel:g,nextLevel:h,currentAuthenticationMethods:f.amr||[]},error:null}}))}}b$.nextInstanceID=0;let b_=b$;class b0 extends b_{constructor(a){super(a)}}let b1=new class a{constructor(a,b,c){var d,e,f;if(this.supabaseUrl=a,this.supabaseKey=b,!a)throw Error("supabaseUrl is required.");if(!b)throw Error("supabaseKey is required.");const g=a.replace(/\/$/,"");this.realtimeUrl=`${g}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${g}/auth/v1`,this.storageUrl=`${g}/storage/v1`,this.functionsUrl=`${g}/functions/v1`;const h=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,i=function(a,b){let{db:c,auth:d,realtime:e,global:f}=a,{db:g,auth:h,realtime:i,global:j}=b,k={db:Object.assign(Object.assign({},g),c),auth:Object.assign(Object.assign({},h),d),realtime:Object.assign(Object.assign({},i),e),global:Object.assign(Object.assign({},j),f),accessToken:()=>{var a,b,c,d;return a=this,b=void 0,d=function*(){return""},new(c=void 0,c=Promise)(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){var b;a.done?e(a.value):((b=a.value)instanceof c?b:new c(function(a){a(b)})).then(g,h)}i((d=d.apply(a,b||[])).next())})}};return a.accessToken?k.accessToken=a.accessToken:delete k.accessToken,k}(null!=c?c:{},{db:bb,realtime:bd,auth:Object.assign(Object.assign({},bc),{storageKey:h}),global:ba});this.storageKey=null!=(d=i.auth.storageKey)?d:"",this.headers=null!=(e=i.global.headers)?e:{},i.accessToken?(this.accessToken=i.accessToken,this.auth=new Proxy({},{get:(a,b)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(b)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!=(f=i.auth)?f:{},this.headers,i.global.fetch),this.fetch=((a,b,c)=>{let d,e=(d=c||("u"<typeof fetch?be.default:fetch),(...a)=>d(...a)),f="u"<typeof Headers?be.Headers:Headers;return(c,d)=>{var g,h,i,j;return g=void 0,h=void 0,i=void 0,j=function*(){var g;let h=null!=(g=yield b())?g:a,i=new f(null==d?void 0:d.headers);return i.has("apikey")||i.set("apikey",a),i.has("Authorization")||i.set("Authorization",`Bearer ${h}`),e(c,Object.assign(Object.assign({},d),{headers:i}))},new(i||(i=Promise))(function(a,b){function c(a){try{e(j.next(a))}catch(a){b(a)}}function d(a){try{e(j.throw(a))}catch(a){b(a)}}function e(b){var e;b.done?a(b.value):((e=b.value)instanceof i?e:new i(function(a){a(e)})).then(c,d)}e((j=j.apply(g,h||[])).next())})}})(b,this._getAccessToken.bind(this),i.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},i.realtime)),this.rest=new aq(`${g}/rest/v1`,{headers:this.headers,schema:i.db.schema,fetch:this.fetch}),i.accessToken||this._listenForAuthEvents()}get functions(){return new ap(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new a8(this.storageUrl,this.headers,this.fetch)}from(a){return this.rest.from(a)}schema(a){return this.rest.schema(a)}rpc(a,b={},c={}){return this.rest.rpc(a,b,c)}channel(a,b={config:{}}){return this.realtime.channel(a,b)}getChannels(){return this.realtime.getChannels()}removeChannel(a){return this.realtime.removeChannel(a)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var a,b,c,d,e,f;return c=this,d=void 0,e=void 0,f=function*(){if(this.accessToken)return yield this.accessToken();let{data:c}=yield this.auth.getSession();return null!=(b=null==(a=c.session)?void 0:a.access_token)?b:null},new(e||(e=Promise))(function(a,b){function g(a){try{i(f.next(a))}catch(a){b(a)}}function h(a){try{i(f.throw(a))}catch(a){b(a)}}function i(b){var c;b.done?a(b.value):((c=b.value)instanceof e?c:new e(function(a){a(c)})).then(g,h)}i((f=f.apply(c,d||[])).next())})}_initSupabaseAuthClient({autoRefreshToken:a,persistSession:b,detectSessionInUrl:c,storage:d,storageKey:e,flowType:f,lock:g,debug:h},i,j){let k={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new b0({url:this.authUrl,headers:Object.assign(Object.assign({},k),i),storageKey:e,autoRefreshToken:a,persistSession:b,detectSessionInUrl:c,storage:d,flowType:f,lock:g,debug:h,fetch:j,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(a){return new aP(this.realtimeUrl,Object.assign(Object.assign({},a),{params:Object.assign({apikey:this.supabaseKey},null==a?void 0:a.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,b)=>{this._handleTokenChanged(a,"CLIENT",null==b?void 0:b.access_token)})}_handleTokenChanged(a,b,c){("TOKEN_REFRESHED"===a||"SIGNED_IN"===a)&&this.changedAccessToken!==c?this.changedAccessToken=c:"SIGNED_OUT"===a&&(this.realtime.setAuth(),"STORAGE"==b&&this.auth.signOut(),this.changedAccessToken=void 0)}}("https://jextayidnmtsoofugnig.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpleHRheWlkbm10c29vZnVnbmlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwODM1MDAsImV4cCI6MjA4NDY1OTUwMH0.vxRq32MPWyO_znst5nFCiQ7AWJtlJeOFWMY-RlZmjrs",void 0);async function b2(a,b,c,d,e,f){console.log("[Supabase] Uploading metadata:",{cid:a,deviceId:c,mimeType:e,fileSize:b,hasUserKeyHash:!!f});try{let g=await fetch("/api/supabase/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"uploadMetadata",cid:a,fileSize:b,deviceId:c,nonce:d,mimeType:e,userKeyHash:f})}),h=await g.json();if(h.success)return console.log("[Supabase] Metadata uploaded via proxy:",h.data?.[0]?.id),h.data;console.warn("[Supabase] Proxy failed, trying direct client:",h.error)}catch(a){console.warn("[Supabase] Proxy error, trying direct client:",a)}let{data:g,error:h}=await b1.from("photos_metadata").insert([{cid:a,file_size_bytes:b,device_id:c,nonce:d,mime_type:e,user_key_hash:f}]).select();if(h)throw console.error("[Supabase] Metadata Upload Error:",{code:h.code,message:h.message,details:h.details,hint:h.hint}),h;return console.log("[Supabase] Metadata uploaded successfully:",g?.[0]?.id),g}async function b3(a,b){if(!b)return console.error("loadCIDsFromSupabase: userKeyHash is required"),[];try{let a=await fetch("/api/supabase/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"loadCIDs",userKeyHash:b})}),c=await a.json();if(c.success)return console.log("[Supabase] CIDs loaded via proxy:",c.data?.length),c.data||[];console.warn("[Supabase] Proxy failed, trying direct client:",c.error)}catch(a){console.warn("[Supabase] Proxy error, trying direct client:",a)}let{data:c,error:d}=await b1.from("photos_metadata").select("cid, device_id, uploaded_at, file_size_bytes, nonce, mime_type").eq("user_key_hash",b).order("uploaded_at",{ascending:!1});if(d)throw console.error("Supabase Load Error:",d),d;return c||[]}async function b4(a,b){if(!b)return!1;let{data:c,error:d}=await b1.from("photos_metadata").select("id").eq("cid",a).eq("user_key_hash",b).single();return d&&"PGRST116"!==d.code&&console.error("Supabase Check Error:",d),!!c}async function b5(a){try{let b=await fetch("/api/supabase/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"deleteMetadata",cid:a})}),c=await b.json();if(c.success)return void console.log("[Supabase] Metadata deleted via proxy");console.warn("[Supabase] Proxy failed, trying direct client:",c.error)}catch(a){console.warn("[Supabase] Proxy error, trying direct client:",a)}let{error:b}=await b1.from("photos_metadata").delete().eq("cid",a);if(b)throw console.error("Supabase Delete Error:",b),b}async function b6(a,b,c,d,e){if(!d||0===d.length)throw console.error("registerDevice: userKeyHash is required"),Error("userKeyHash is required for device registration");try{let f=await fetch("/api/supabase/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"registerDevice",id:a,deviceName:b,deviceType:c,userKeyHash:d,userId:e})}),g=await f.json();if(g.success)return console.log("[Supabase] Device registered via proxy:",g.updated?"updated":"inserted"),!0;console.warn("[Supabase] Proxy failed, trying direct client:",g.error)}catch(a){console.warn("[Supabase] Proxy error, trying direct client:",a)}let{data:f}=await b1.from("devices").select("id").eq("user_id",e).eq("device_name",b).eq("device_type",c||"").single();if(f){let{error:a}=await b1.from("devices").update({device_name:b,device_type:c,user_key_hash:d}).eq("id",f.id);if(a)throw console.error("[Supabase] Device Update Error:",a),a;return console.log("[Supabase] Device updated:",f.id),!0}let{error:g}=await b1.from("devices").insert({id:a,device_name:b,device_type:c,user_key_hash:d,user_id:e});if(g){if(g.message?.includes("Device limit exceeded"))throw Error("DEVICE_LIMIT_EXCEEDED");throw console.error("[Supabase] Device Insert Error:",g),g}return console.log("[Supabase] Device inserted:",a),!0}async function b7(a){let{data:b,error:c}=await b1.from("devices").select("*").eq("user_key_hash",a).order("created_at",{ascending:!1});if(c)throw console.error("Supabase Get Devices Error:",c),c;return b||[]}var b8=a.i(44077);let b9="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiJlYTcxMDdjNi0yMGE0LTQ5Y2ItODAyYy1kMmRhOWM2Nzk4NjUiLCJlbWFpbCI6ImVpbmFyQGJsYWNrLWtuaWdodC5kZXYiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGluX3BvbGljeSI6eyJyZWdpb25zIjpbeyJkZXNpcmVkUmVwbGljYXRpb25Db3VudCI6MSwiaWQiOiJGUkExIn0seyJkZXNpcmVkUmVwbGljYXRpb25Db3VudCI6MSwiaWQiOiJOWUMxIn1dLCJ2ZXJzaW9uIjoxfSwibWZhX2VuYWJsZWQiOmZhbHNlLCJzdGF0dXMiOiJBQ1RJVkUifSwiYXV0aGVudGljYXRpb25UeXBlIjoic2NvcGVkS2V5Iiwic2NvcGVkS2V5S2V5IjoiNjkyYjcyYTBlOTk2NDhmNjQ4NjgiLCJzY29wZWRLZXlTZWNyZXQiOiJmMmM3ZDUwMWE3NjhiMWI3NTI3ODExODAyZTg1YzJlNmUyZDc5ZjA0YTM1ZTA4ZjNmYWJiYmRiMmFlMGMzMmUwIiwiZXhwIjoxODAwNjgxOTMzfQ.g47clgfFIHt9Bw-pjvytmuMPO8FSXgAsSfhcXaP-YII",ca="red-able-bug-554.mypinata.cloud";async function cb(a,b,c){return console.log("[IPFS] Starting upload to Pinata...",{blobSize:a.size,fileName:b}),new Promise((d,e)=>{let f=new XMLHttpRequest;f.open("POST","https://api.pinata.cloud/pinning/pinFileToIPFS"),f.setRequestHeader("Authorization",`Bearer ${b9}`),f.timeout=12e4,f.upload.onprogress=a=>{if(a.lengthComputable&&c){let b=Math.round(a.loaded/a.total*100);console.log(`[IPFS] Upload progress: ${b}%`),c(b)}},f.onload=()=>{if(console.log("[IPFS] XHR onload, status:",f.status),f.status>=200&&f.status<300)try{let a=JSON.parse(f.responseText);console.log("[IPFS] Upload success, CID:",a.IpfsHash),d(a.IpfsHash)}catch(a){console.error("[IPFS] Failed to parse response:",f.responseText),e(Error("Failed to parse Pinata response"))}else console.error("[IPFS] Upload failed:",{status:f.status,response:f.responseText}),e(Error(`IPFS upload failed: ${f.status} - ${f.responseText}`))},f.onerror=a=>{console.error("[IPFS] XHR network error:",a),e(Error("Network error during IPFS upload - check connection"))},f.ontimeout=()=>{console.error("[IPFS] Upload timeout (2 min)"),e(Error("IPFS upload timeout - file too large or slow connection"))};let g=new FormData;g.append("file",a,b||"encrypted-photo.bin");let h=JSON.stringify({name:b||"photovault-encrypted",keyvalues:{app:"photovault",type:"encrypted-photo"}});g.append("pinataMetadata",h);let i=JSON.stringify({cidVersion:1});g.append("pinataOptions",i),console.log("[IPFS] Sending XHR..."),f.send(g)})}async function cc(a){console.log(`[IPFS] Downloading CID: ${a}`);try{console.log("[IPFS] Trying API proxy...");let b=await fetch(`/api/ipfs/download?cid=${encodeURIComponent(a)}`);if(b.ok){let a=await b.blob();return console.log(`[IPFS] API proxy succeeded, size: ${a.size} bytes`),a}console.warn(`[IPFS] API proxy failed: ${b.status}`)}catch(a){console.warn("[IPFS] API proxy error:",a)}let b=ca.startsWith("http")?ca:ca.includes(".")?`https://${ca}`:`https://${ca}.mypinata.cloud`,c=[()=>{let c=new URL(`${b}/ipfs/${a}`);return c.searchParams.set("pinataGatewayToken","q1z_4lRpNW9NNmISiMudoy79QVUJ_7-V6s5CDJvEM-CadXIF_WIWW5Xizui72HvA"),c.toString()},()=>`https://cloudflare-ipfs.com/ipfs/${a}`],d=new AbortController;try{let a=c.map(async(a,b)=>{let c=a();console.log(`[IPFS] Trying gateway ${b+1}: ${c.substring(0,60)}...`);let e=await fetch(c,{signal:d.signal,mode:"cors",credentials:"omit"});if(!e.ok)throw Error(`Gateway failed: ${e.status}`);return console.log(`[IPFS] Gateway ${b+1} succeeded`),e.blob()}),b=await Promise.any(a);return d.abort(),console.log(`[IPFS] Download complete, size: ${b.size} bytes`),b}catch(b){throw d.abort(),console.error("[IPFS] All methods failed:",b),Error(`IPFS download failed for CID: ${a}. Check network/CORS.`)}}async function cd(a){let b=await fetch(`https://api.pinata.cloud/pinning/unpin/${a}`,{method:"DELETE",headers:{Authorization:`Bearer ${b9}`}});b.ok||console.error("Pinata unpin failed:",await b.text())}let ce=async(a,b,c)=>{try{console.log("Uploading to IPFS...",{size:a.size,fileName:b});let d=await cb(a,b,c);return console.log("IPFS upload successful:",d),d}catch(a){throw console.error("Remote Storage Upload failed:",a),a}},cf=async a=>{try{console.log("Downloading from IPFS:",a);let b=await cc(a);return console.log("IPFS download successful:",{cid:a,size:b.size}),b}catch(a){throw console.error("Remote Storage Download failed:",a),a}};function cg(a){return a.startsWith("Qm")||a.startsWith("bafy")||a.startsWith("bafk")}var ch=a.i(87210);let ci=a=>{let b,c=new Set,d=(a,d)=>{let e="function"==typeof a?a(b):a;if(!Object.is(e,b)){let a=b;b=(null!=d?d:"object"!=typeof e||null===e)?e:Object.assign({},b,e),c.forEach(c=>c(b,a))}},e=()=>b,f={setState:d,getState:e,getInitialState:()=>g,subscribe:a=>(c.add(a),()=>c.delete(a))},g=b=a(d,e,f);return f};function cj(a,b){let c;try{c=a()}catch(a){return}return{getItem:a=>{var d;let e=a=>null===a?null:JSON.parse(a,null==b?void 0:b.reviver),f=null!=(d=c.getItem(a))?d:null;return f instanceof Promise?f.then(e):e(f)},setItem:(a,d)=>c.setItem(a,JSON.stringify(d,null==b?void 0:b.replacer)),removeItem:a=>c.removeItem(a)}}let ck=a=>b=>{try{let c=a(b);if(c instanceof Promise)return c;return{then:a=>ck(a)(c),catch(a){return this}}}catch(a){return{then(a){return this},catch:b=>ck(b)(a)}}},cl={getItem:()=>null,setItem:()=>{},removeItem:()=>{}},cm=(g=(i=(b=a=>({backupActive:!1,autoBackupEnabled:!0,backgroundBackupEnabled:!1,selectedPlan:"free",lastBackup:"Noch nie",permanence:0,setBackupActive:b=>a({backupActive:b}),setAutoBackupEnabled:b=>a({autoBackupEnabled:b}),setBackgroundBackupEnabled:b=>a({backgroundBackupEnabled:b}),setSelectedPlan:b=>a({selectedPlan:b}),setLastBackup:b=>a({lastBackup:b}),setPermanence:b=>a({permanence:b})}),c={name:"photovault-settings",storage:cj(()=>cl)},(a,d,e)=>{let f,g={storage:cj(()=>localStorage),partialize:a=>a,version:0,merge:(a,b)=>({...b,...a}),...c},h=!1,i=0,j=new Set,k=new Set,l=g.storage;if(!l)return b((...b)=>{console.warn(`[zustand persist middleware] Unable to update item '${g.name}', the given storage is currently unavailable.`),a(...b)},d,e);let m=()=>{let a=g.partialize({...d()});return l.setItem(g.name,{state:a,version:g.version})},n=e.setState;e.setState=(a,b)=>(n(a,b),m());let o=b((...b)=>(a(...b),m()),d,e);e.getInitialState=()=>o;let p=()=>{var b,c;if(!l)return;let e=++i;h=!1,j.forEach(a=>{var b;return a(null!=(b=d())?b:o)});let n=(null==(c=g.onRehydrateStorage)?void 0:c.call(g,null!=(b=d())?b:o))||void 0;return ck(l.getItem.bind(l))(g.name).then(a=>{if(a)if("number"!=typeof a.version||a.version===g.version)return[!1,a.state];else{if(g.migrate){let b=g.migrate(a.state,a.version);return b instanceof Promise?b.then(a=>[!0,a]):[!0,b]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(b=>{var c;if(e!==i)return;let[h,j]=b;if(a(f=g.merge(j,null!=(c=d())?c:o),!0),h)return m()}).then(()=>{e===i&&(null==n||n(f,void 0),f=d(),h=!0,k.forEach(a=>a(f)))}).catch(a=>{e===i&&(null==n||n(void 0,a))})};return e.persist={setOptions:a=>{g={...g,...a},a.storage&&(l=a.storage)},clearStorage:()=>{null==l||l.removeItem(g.name)},getOptions:()=>g,rehydrate:()=>p(),hasHydrated:()=>h,onHydrate:a=>(j.add(a),()=>{j.delete(a)}),onFinishHydration:a=>(k.add(a),()=>{k.delete(a)})},g.skipHydration||p(),f||o}))?ci(i):ci,Object.assign(h=a=>(function(a,b=a=>a){let c=K.default.useSyncExternalStore(a.subscribe,K.default.useCallback(()=>b(a.getState()),[a,b]),K.default.useCallback(()=>b(a.getInitialState()),[a,b]));return K.default.useDebugValue(c),c})(g,a),g),h);var cn=Object.defineProperty,co=Object.getOwnPropertySymbols,cp=Object.prototype.hasOwnProperty,cq=Object.prototype.propertyIsEnumerable,cr=(a,b,c)=>b in a?cn(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,cs=(a,b)=>{for(var c in b||(b={}))cp.call(b,c)&&cr(a,c,b[c]);if(co)for(var c of co(b))cq.call(b,c)&&cr(a,c,b[c]);return a},ct=(a,b)=>{var c={};for(var d in a)cp.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&co)for(var d of co(a))0>b.indexOf(d)&&cq.call(a,d)&&(c[d]=a[d]);return c};(a=>{let b=class b{constructor(a,c,d,f){if(this.version=a,this.errorCorrectionLevel=c,this.modules=[],this.isFunction=[],a<b.MIN_VERSION||a>b.MAX_VERSION)throw RangeError("Version value out of range");if(f<-1||f>7)throw RangeError("Mask value out of range");this.size=4*a+17;let g=[];for(let a=0;a<this.size;a++)g.push(!1);for(let a=0;a<this.size;a++)this.modules.push(g.slice()),this.isFunction.push(g.slice());this.drawFunctionPatterns();const h=this.addEccAndInterleave(d);if(this.drawCodewords(h),-1==f){let a=1e9;for(let b=0;b<8;b++){this.applyMask(b),this.drawFormatBits(b);const c=this.getPenaltyScore();c<a&&(f=b,a=c),this.applyMask(b)}}e(0<=f&&f<=7),this.mask=f,this.applyMask(f),this.drawFormatBits(f),this.isFunction=[]}static encodeText(c,d){let e=a.QrSegment.makeSegments(c);return b.encodeSegments(e,d)}static encodeBinary(c,d){let e=a.QrSegment.makeBytes(c);return b.encodeSegments([e],d)}static encodeSegments(a,d,f=1,h=40,i=-1,j=!0){let k,l;if(!(b.MIN_VERSION<=f&&f<=h&&h<=b.MAX_VERSION)||i<-1||i>7)throw RangeError("Invalid value");for(k=f;;k++){let c=8*b.getNumDataCodewords(k,d),e=g.getTotalBits(a,k);if(e<=c){l=e;break}if(k>=h)throw RangeError("Data too long")}for(let a of[b.Ecc.MEDIUM,b.Ecc.QUARTILE,b.Ecc.HIGH])j&&l<=8*b.getNumDataCodewords(k,a)&&(d=a);let m=[];for(let b of a)for(let a of(c(b.mode.modeBits,4,m),c(b.numChars,b.mode.numCharCountBits(k),m),b.getData()))m.push(a);e(m.length==l);let n=8*b.getNumDataCodewords(k,d);e(m.length<=n),c(0,Math.min(4,n-m.length),m),c(0,(8-m.length%8)%8,m),e(m.length%8==0);for(let a=236;m.length<n;a^=253)c(a,8,m);let o=[];for(;8*o.length<m.length;)o.push(0);return m.forEach((a,b)=>o[b>>>3]|=a<<7-(7&b)),new b(k,d,o,i)}getModule(a,b){return 0<=a&&a<this.size&&0<=b&&b<this.size&&this.modules[b][a]}getModules(){return this.modules}drawFunctionPatterns(){for(let a=0;a<this.size;a++)this.setFunctionModule(6,a,a%2==0),this.setFunctionModule(a,6,a%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);let a=this.getAlignmentPatternPositions(),b=a.length;for(let c=0;c<b;c++)for(let d=0;d<b;d++)(0!=c||0!=d)&&(0!=c||d!=b-1)&&(c!=b-1||0!=d)&&this.drawAlignmentPattern(a[c],a[d]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(a){let b=this.errorCorrectionLevel.formatBits<<3|a,c=b;for(let a=0;a<10;a++)c=c<<1^(c>>>9)*1335;let f=(b<<10|c)^21522;e(f>>>15==0);for(let a=0;a<=5;a++)this.setFunctionModule(8,a,d(f,a));this.setFunctionModule(8,7,d(f,6)),this.setFunctionModule(8,8,d(f,7)),this.setFunctionModule(7,8,d(f,8));for(let a=9;a<15;a++)this.setFunctionModule(14-a,8,d(f,a));for(let a=0;a<8;a++)this.setFunctionModule(this.size-1-a,8,d(f,a));for(let a=8;a<15;a++)this.setFunctionModule(8,this.size-15+a,d(f,a));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let a=this.version;for(let b=0;b<12;b++)a=a<<1^(a>>>11)*7973;let b=this.version<<12|a;e(b>>>18==0);for(let a=0;a<18;a++){let c=d(b,a),e=this.size-11+a%3,f=Math.floor(a/3);this.setFunctionModule(e,f,c),this.setFunctionModule(f,e,c)}}drawFinderPattern(a,b){for(let c=-4;c<=4;c++)for(let d=-4;d<=4;d++){let e=Math.max(Math.abs(d),Math.abs(c)),f=a+d,g=b+c;0<=f&&f<this.size&&0<=g&&g<this.size&&this.setFunctionModule(f,g,2!=e&&4!=e)}}drawAlignmentPattern(a,b){for(let c=-2;c<=2;c++)for(let d=-2;d<=2;d++)this.setFunctionModule(a+d,b+c,1!=Math.max(Math.abs(d),Math.abs(c)))}setFunctionModule(a,b,c){this.modules[b][a]=c,this.isFunction[b][a]=!0}addEccAndInterleave(a){let c=this.version,d=this.errorCorrectionLevel;if(a.length!=b.getNumDataCodewords(c,d))throw RangeError("Invalid argument");let f=b.NUM_ERROR_CORRECTION_BLOCKS[d.ordinal][c],g=b.ECC_CODEWORDS_PER_BLOCK[d.ordinal][c],h=Math.floor(b.getNumRawDataModules(c)/8),i=f-h%f,j=Math.floor(h/f),k=[],l=b.reedSolomonComputeDivisor(g);for(let c=0,d=0;c<f;c++){let e=a.slice(d,d+j-g+(c<i?0:1));d+=e.length;let f=b.reedSolomonComputeRemainder(e,l);c<i&&e.push(0),k.push(e.concat(f))}let m=[];for(let a=0;a<k[0].length;a++)k.forEach((b,c)=>{(a!=j-g||c>=i)&&m.push(b[a])});return e(m.length==h),m}drawCodewords(a){if(a.length!=Math.floor(b.getNumRawDataModules(this.version)/8))throw RangeError("Invalid argument");let c=0;for(let b=this.size-1;b>=1;b-=2){6==b&&(b=5);for(let e=0;e<this.size;e++)for(let f=0;f<2;f++){let g=b-f,h=(b+1&2)==0?this.size-1-e:e;!this.isFunction[h][g]&&c<8*a.length&&(this.modules[h][g]=d(a[c>>>3],7-(7&c)),c++)}}e(c==8*a.length)}applyMask(a){if(a<0||a>7)throw RangeError("Mask value out of range");for(let b=0;b<this.size;b++)for(let c=0;c<this.size;c++){let d;switch(a){case 0:d=(c+b)%2==0;break;case 1:d=b%2==0;break;case 2:d=c%3==0;break;case 3:d=(c+b)%3==0;break;case 4:d=(Math.floor(c/3)+Math.floor(b/2))%2==0;break;case 5:d=c*b%2+c*b%3==0;break;case 6:d=(c*b%2+c*b%3)%2==0;break;case 7:d=((c+b)%2+c*b%3)%2==0;break;default:throw Error("Unreachable")}!this.isFunction[b][c]&&d&&(this.modules[b][c]=!this.modules[b][c])}}getPenaltyScore(){let a=0;for(let c=0;c<this.size;c++){let d=!1,e=0,f=[0,0,0,0,0,0,0];for(let g=0;g<this.size;g++)this.modules[c][g]==d?5==++e?a+=b.PENALTY_N1:e>5&&a++:(this.finderPenaltyAddHistory(e,f),d||(a+=this.finderPenaltyCountPatterns(f)*b.PENALTY_N3),d=this.modules[c][g],e=1);a+=this.finderPenaltyTerminateAndCount(d,e,f)*b.PENALTY_N3}for(let c=0;c<this.size;c++){let d=!1,e=0,f=[0,0,0,0,0,0,0];for(let g=0;g<this.size;g++)this.modules[g][c]==d?5==++e?a+=b.PENALTY_N1:e>5&&a++:(this.finderPenaltyAddHistory(e,f),d||(a+=this.finderPenaltyCountPatterns(f)*b.PENALTY_N3),d=this.modules[g][c],e=1);a+=this.finderPenaltyTerminateAndCount(d,e,f)*b.PENALTY_N3}for(let c=0;c<this.size-1;c++)for(let d=0;d<this.size-1;d++){let e=this.modules[c][d];e==this.modules[c][d+1]&&e==this.modules[c+1][d]&&e==this.modules[c+1][d+1]&&(a+=b.PENALTY_N2)}let c=0;for(let a of this.modules)c=a.reduce((a,b)=>a+ +!!b,c);let d=this.size*this.size,f=Math.ceil(Math.abs(20*c-10*d)/d)-1;return e(0<=f&&f<=9),e(0<=(a+=f*b.PENALTY_N4)&&a<=2568888),a}getAlignmentPatternPositions(){if(1==this.version)return[];{let a=Math.floor(this.version/7)+2,b=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*a-2)),c=[6];for(let d=this.size-7;c.length<a;d-=b)c.splice(1,0,d);return c}}static getNumRawDataModules(a){if(a<b.MIN_VERSION||a>b.MAX_VERSION)throw RangeError("Version number out of range");let c=(16*a+128)*a+64;if(a>=2){let b=Math.floor(a/7)+2;c-=(25*b-10)*b-55,a>=7&&(c-=36)}return e(208<=c&&c<=29648),c}static getNumDataCodewords(a,c){return Math.floor(b.getNumRawDataModules(a)/8)-b.ECC_CODEWORDS_PER_BLOCK[c.ordinal][a]*b.NUM_ERROR_CORRECTION_BLOCKS[c.ordinal][a]}static reedSolomonComputeDivisor(a){if(a<1||a>255)throw RangeError("Degree out of range");let c=[];for(let b=0;b<a-1;b++)c.push(0);c.push(1);let d=1;for(let e=0;e<a;e++){for(let a=0;a<c.length;a++)c[a]=b.reedSolomonMultiply(c[a],d),a+1<c.length&&(c[a]^=c[a+1]);d=b.reedSolomonMultiply(d,2)}return c}static reedSolomonComputeRemainder(a,c){let d=c.map(a=>0);for(let e of a){let a=e^d.shift();d.push(0),c.forEach((c,e)=>d[e]^=b.reedSolomonMultiply(c,a))}return d}static reedSolomonMultiply(a,b){if(a>>>8!=0||b>>>8!=0)throw RangeError("Byte out of range");let c=0;for(let d=7;d>=0;d--)c=c<<1^(c>>>7)*285^(b>>>d&1)*a;return e(c>>>8==0),c}finderPenaltyCountPatterns(a){let b=a[1];e(b<=3*this.size);let c=b>0&&a[2]==b&&a[3]==3*b&&a[4]==b&&a[5]==b;return(c&&a[0]>=4*b&&a[6]>=b?1:0)+(c&&a[6]>=4*b&&a[0]>=b?1:0)}finderPenaltyTerminateAndCount(a,b,c){return a&&(this.finderPenaltyAddHistory(b,c),b=0),b+=this.size,this.finderPenaltyAddHistory(b,c),this.finderPenaltyCountPatterns(c)}finderPenaltyAddHistory(a,b){0==b[0]&&(a+=this.size),b.pop(),b.unshift(a)}};function c(a,b,c){if(b<0||b>31||a>>>b!=0)throw RangeError("Value out of range");for(let d=b-1;d>=0;d--)c.push(a>>>d&1)}function d(a,b){return(a>>>b&1)!=0}function e(a){if(!a)throw Error("Assertion error")}b.MIN_VERSION=1,b.MAX_VERSION=40,b.PENALTY_N1=3,b.PENALTY_N2=3,b.PENALTY_N3=40,b.PENALTY_N4=10,b.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],b.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],a.QrCode=b;let f=class a{constructor(a,b,c){if(this.mode=a,this.numChars=b,this.bitData=c,b<0)throw RangeError("Invalid argument");this.bitData=c.slice()}static makeBytes(b){let d=[];for(let a of b)c(a,8,d);return new a(a.Mode.BYTE,b.length,d)}static makeNumeric(b){if(!a.isNumeric(b))throw RangeError("String contains non-numeric characters");let d=[];for(let a=0;a<b.length;){let e=Math.min(b.length-a,3);c(parseInt(b.substring(a,a+e),10),3*e+1,d),a+=e}return new a(a.Mode.NUMERIC,b.length,d)}static makeAlphanumeric(b){let d;if(!a.isAlphanumeric(b))throw RangeError("String contains unencodable characters in alphanumeric mode");let e=[];for(d=0;d+2<=b.length;d+=2){let f=45*a.ALPHANUMERIC_CHARSET.indexOf(b.charAt(d));c(f+=a.ALPHANUMERIC_CHARSET.indexOf(b.charAt(d+1)),11,e)}return d<b.length&&c(a.ALPHANUMERIC_CHARSET.indexOf(b.charAt(d)),6,e),new a(a.Mode.ALPHANUMERIC,b.length,e)}static makeSegments(b){return""==b?[]:a.isNumeric(b)?[a.makeNumeric(b)]:a.isAlphanumeric(b)?[a.makeAlphanumeric(b)]:[a.makeBytes(a.toUtf8ByteArray(b))]}static makeEci(b){let d=[];if(b<0)throw RangeError("ECI assignment value out of range");if(b<128)c(b,8,d);else if(b<16384)c(2,2,d),c(b,14,d);else if(b<1e6)c(6,3,d),c(b,21,d);else throw RangeError("ECI assignment value out of range");return new a(a.Mode.ECI,0,d)}static isNumeric(b){return a.NUMERIC_REGEX.test(b)}static isAlphanumeric(b){return a.ALPHANUMERIC_REGEX.test(b)}getData(){return this.bitData.slice()}static getTotalBits(a,b){let c=0;for(let d of a){let a=d.mode.numCharCountBits(b);if(d.numChars>=1<<a)return 1/0;c+=4+a+d.bitData.length}return c}static toUtf8ByteArray(a){a=encodeURI(a);let b=[];for(let c=0;c<a.length;c++)"%"!=a.charAt(c)?b.push(a.charCodeAt(c)):(b.push(parseInt(a.substring(c+1,c+3),16)),c+=2);return b}};f.NUMERIC_REGEX=/^[0-9]*$/,f.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,f.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let g=f;a.QrSegment=f})(I||(I={})),u=(t=I||(I={})).QrCode||(t.QrCode={}),(d=class{constructor(a,b){this.ordinal=a,this.formatBits=b}}).LOW=new d(0,1),d.MEDIUM=new d(1,0),d.QUARTILE=new d(2,3),d.HIGH=new d(3,2),u.Ecc=d,w=(v=I||(I={})).QrSegment||(v.QrSegment={}),(e=class{constructor(a,b){this.modeBits=a,this.numBitsCharCount=b}numCharCountBits(a){return this.numBitsCharCount[Math.floor((a+7)/17)]}}).NUMERIC=new e(1,[10,12,14]),e.ALPHANUMERIC=new e(2,[9,11,13]),e.BYTE=new e(4,[8,16,16]),e.KANJI=new e(8,[8,10,12]),e.ECI=new e(7,[0,0,0]),w.Mode=e;var cu=I,cv={L:cu.QrCode.Ecc.LOW,M:cu.QrCode.Ecc.MEDIUM,Q:cu.QrCode.Ecc.QUARTILE,H:cu.QrCode.Ecc.HIGH},cw="#FFFFFF",cx="#000000";function cy(a,b=0){let c=[];return a.forEach(function(a,d){let e=null;a.forEach(function(f,g){if(!f&&null!==e){c.push(`M${e+b} ${d+b}h${g-e}v1H${e+b}z`),e=null;return}if(g===a.length-1){if(!f)return;null===e?c.push(`M${g+b},${d+b} h1v1H${g+b}z`):c.push(`M${e+b},${d+b} h${g+1-e}v1H${e+b}z`);return}f&&null===e&&(e=g)})}),c.join("")}function cz(a,b){return a.slice().map((a,c)=>c<b.y||c>=b.y+b.h?a:a.map((a,c)=>(c<b.x||c>=b.x+b.w)&&a))}function cA({value:a,level:b,minVersion:c,includeMargin:d,marginSize:e,imageSettings:f,size:g,boostLevel:h}){let i=K.default.useMemo(()=>{let d=(Array.isArray(a)?a:[a]).reduce((a,b)=>(a.push(...cu.QrSegment.makeSegments(b)),a),[]);return cu.QrCode.encodeSegments(d,cv[b],c,void 0,void 0,h)},[a,b,c,h]),{cells:j,margin:k,numCells:l,calculatedImageSettings:m}=K.default.useMemo(()=>{let a=i.getModules(),b=null!=e?Math.max(Math.floor(e),0):4*!!d,c=a.length+2*b,h=function(a,b,c,d){if(null==d)return null;let e=a.length+2*c,f=Math.floor(.1*b),g=e/b,h=(d.width||f)*g,i=(d.height||f)*g,j=null==d.x?a.length/2-h/2:d.x*g,k=null==d.y?a.length/2-i/2:d.y*g,l=null==d.opacity?1:d.opacity,m=null;if(d.excavate){let a=Math.floor(j),b=Math.floor(k),c=Math.ceil(h+j-a),d=Math.ceil(i+k-b);m={x:a,y:b,w:c,h:d}}return{x:j,y:k,h:i,w:h,excavation:m,opacity:l,crossOrigin:d.crossOrigin}}(a,g,b,f);return{cells:a,margin:b,numCells:c,calculatedImageSettings:h}},[i,g,f,d,e]);return{qrcode:i,margin:k,cells:j,numCells:l,calculatedImageSettings:m}}var cB=function(){try{new Path2D().addPath(new Path2D)}catch(a){return!1}return!0}();K.default.forwardRef(function(a,b){let{value:c,size:d=128,level:e="L",bgColor:f=cw,fgColor:g=cx,includeMargin:h=!1,minVersion:i=1,boostLevel:j,marginSize:k,imageSettings:l}=a,m=ct(a,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:n}=m,o=ct(m,["style"]),p=null==l?void 0:l.src,q=K.default.useRef(null),r=K.default.useRef(null),s=K.default.useCallback(a=>{q.current=a,"function"==typeof b?b(a):b&&(b.current=a)},[b]),[t,u]=K.default.useState(!1),{margin:v,cells:w,numCells:x,calculatedImageSettings:y}=cA({value:c,level:e,minVersion:i,boostLevel:j,includeMargin:h,marginSize:k,imageSettings:l,size:d});K.default.useEffect(()=>{if(null!=q.current){let a=q.current,b=a.getContext("2d");if(!b)return;let c=w,e=r.current,h=null!=y&&null!==e&&e.complete&&0!==e.naturalHeight&&0!==e.naturalWidth;h&&null!=y.excavation&&(c=cz(w,y.excavation));let i=window.devicePixelRatio||1;a.height=a.width=d*i;let j=d/x*i;b.scale(j,j),b.fillStyle=f,b.fillRect(0,0,x,x),b.fillStyle=g,cB?b.fill(new Path2D(cy(c,v))):w.forEach(function(a,c){a.forEach(function(a,d){a&&b.fillRect(d+v,c+v,1,1)})}),y&&(b.globalAlpha=y.opacity),h&&b.drawImage(e,y.x+v,y.y+v,y.w,y.h)}}),K.default.useEffect(()=>{u(!1)},[p]);let z=cs({height:d,width:d},n),A=null;return null!=p&&(A=K.default.createElement("img",{src:p,key:p,style:{display:"none"},onLoad:()=>{u(!0)},ref:r,crossOrigin:null==y?void 0:y.crossOrigin})),K.default.createElement(K.default.Fragment,null,K.default.createElement("canvas",cs({style:z,height:d,width:d,ref:s,role:"img"},o)),A)}).displayName="QRCodeCanvas";var cC=K.default.forwardRef(function(a,b){let{value:c,size:d=128,level:e="L",bgColor:f=cw,fgColor:g=cx,includeMargin:h=!1,minVersion:i=1,boostLevel:j,title:k,marginSize:l,imageSettings:m}=a,n=ct(a,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:o,cells:p,numCells:q,calculatedImageSettings:r}=cA({value:c,level:e,minVersion:i,boostLevel:j,includeMargin:h,marginSize:l,imageSettings:m,size:d}),s=p,t=null;null!=m&&null!=r&&(null!=r.excavation&&(s=cz(p,r.excavation)),t=K.default.createElement("image",{href:m.src,height:r.h,width:r.w,x:r.x+o,y:r.y+o,preserveAspectRatio:"none",opacity:r.opacity,crossOrigin:r.crossOrigin}));let u=cy(s,o);return K.default.createElement("svg",cs({height:d,width:d,viewBox:`0 0 ${q} ${q}`,ref:b,role:"img"},n),!!k&&K.default.createElement("title",null,k),K.default.createElement("path",{fill:f,d:`M0,0 h${q}v${q}H0z`,shapeRendering:"crispEdges"}),K.default.createElement("path",{fill:g,d:u,shapeRendering:"crispEdges"}),t)});cC.displayName="QRCodeSVG";var cD=a.i(33508);let cE=(0,L.default)("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function cF({isOpen:a,onClose:b}){let[c,d]=(0,K.useState)("show"),[e,f]=(0,K.useState)(""),[g,h]=(0,K.useState)(!1),[i,j]=(0,K.useState)(null),[k,l]=(0,K.useState)(!1),{recoveryPhrase:m,restoreFromPhrase:n}=ai(),o=async()=>{if(m)try{await navigator.clipboard.writeText(m),h(!0),setTimeout(()=>h(!1),2e3)}catch{console.error("Failed to copy to clipboard")}};return a?(0,J.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 px-6 backdrop-blur-sm",children:(0,J.jsxs)($,{className:"bg-white w-full max-w-[380px] p-0 shadow-2xl overflow-hidden",children:[(0,J.jsxs)("div",{className:"flex items-center justify-between p-4 border-b-2 border-[#2563EB]/10",children:[(0,J.jsx)("h2",{className:"sketch-heading text-[20px] text-[#1D1D1F]",children:"GerÃ¤t verbinden"}),(0,J.jsx)("button",{onClick:b,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-black/5",children:(0,J.jsx)(cD.X,{className:"w-5 h-5 text-[#6E6E73]"})})]}),(0,J.jsxs)("div",{className:"flex border-b-2 border-[#2563EB]/10",children:[(0,J.jsxs)("button",{onClick:()=>d("show"),className:`flex-1 py-4 sketch-subheading text-[15px] flex items-center justify-center gap-2 transition-colors ${"show"===c?"text-[#2563EB] bg-[#2563EB]/5":"text-[#6E6E73]"}`,children:[(0,J.jsx)(cE,{className:"w-4 h-4"}),"Zeigen"]}),(0,J.jsx)("button",{onClick:()=>d("input"),className:`flex-1 py-4 sketch-subheading text-[15px] flex items-center justify-center gap-2 transition-colors ${"input"===c?"text-[#2563EB] bg-[#2563EB]/5":"text-[#6E6E73]"}`,children:"Eingeben"})]}),(0,J.jsx)("div",{className:"p-5",children:"show"===c?(0,J.jsxs)("div",{className:"flex flex-col items-center",children:[(0,J.jsx)("p",{className:"sketch-body text-[14px] text-[#6E6E73] text-center mb-6",children:"Scanne den QR-Code oder kopiere den SchlÃ¼ssel."}),m&&(0,J.jsx)("div",{className:"mb-6",children:(0,J.jsx)($,{className:"p-4 bg-white",children:(0,J.jsx)(cC,{value:m,size:180,level:"M",includeMargin:!1})})}),(0,J.jsx)("div",{className:"w-full mb-6",children:(0,J.jsxs)($,{className:"bg-[#2563EB]/5 p-3",children:[(0,J.jsx)("p",{className:"sketch-body text-[11px] text-[#6E6E73] mb-1",children:"Backup-Phrase:"}),(0,J.jsx)("p",{className:"sketch-subheading text-[13px] break-all leading-relaxed",children:m||"Kein SchlÃ¼ssel"})]})}),(0,J.jsx)(Z.SketchButton,{onClick:o,disabled:!m,className:"w-full",size:"md",children:g?"âœ“ Kopiert!":"Phrase kopieren"})]}):(0,J.jsxs)("div",{className:"flex flex-col",children:[(0,J.jsx)("p",{className:"sketch-body text-[14px] text-[#6E6E73] text-center mb-6",children:"Gib den SchlÃ¼ssel deines anderen GerÃ¤ts ein."}),(0,J.jsx)(ac,{value:e,onChange:a=>{f(a),j(null)},placeholder:"SchlÃ¼ssel hier einfÃ¼gen...",rows:3,className:"mb-4"}),i&&(0,J.jsx)("p",{className:"sketch-body text-[14px] text-[#FF3B30] text-center mb-4 italic",children:i}),k&&(0,J.jsx)("p",{className:"sketch-body text-[14px] text-[#30D158] text-center mb-4 font-bold",children:"âœ“ Erfolg!"}),(0,J.jsx)(Z.SketchButton,{onClick:()=>{(j(null),e.trim())?n(e.trim())?(l(!0),f(""),setTimeout(()=>{l(!1),b()},1500)):j("UngÃ¼ltiger SchlÃ¼ssel. Bitte Ã¼berprÃ¼fe die Eingabe."):j("Bitte gib einen SchlÃ¼ssel ein")},disabled:!e.trim()||k,className:"w-full",size:"md",children:k?"Verbunden":"Verbinden"}),(0,J.jsx)("p",{className:"sketch-body text-[11px] text-[#FF9500] text-center mt-6",children:"Achtung: Dies ersetzt deinen aktuellen SchlÃ¼ssel!"})]})})]})}):null}function cG({state:b,setState:c,onRestartOnboarding:d,authUser:e}){let[f,g]=(0,K.useState)(!1),[h,i]=(0,K.useState)(!1),[j,k]=(0,K.useState)(!1),[l,m]=(0,K.useState)(!1),[n,o]=(0,K.useState)(!1),[p,q]=(0,K.useState)(!1),[r,s]=(0,K.useState)([]),[t,u]=(0,K.useState)(!1),[v,w]=(0,K.useState)({current:0,total:0}),x=cm(a=>a.autoBackupEnabled),y=cm(a=>a.setAutoBackupEnabled),z=cm(a=>a.backgroundBackupEnabled),A=cm(a=>a.setBackgroundBackupEnabled),B=cm(a=>a.selectedPlan),C=cm(a=>a.setSelectedPlan),D=cm(a=>a.setLastBackup),{secretKey:E,recoveryPhrase:F,generateNewKey:G,clearKey:H}=ai(),[I,L]=(0,K.useState)(null);(0,K.useEffect)(()=>{E&&a.A(42124).then(a=>a.getUserKeyHash(E)).then(L)},[E]),(0,K.useEffect)(()=>{I&&(async()=>{try{let a=await b7(I);s(a)}catch(a){console.error("Failed to fetch devices:",a)}})()},[I]);let M=F?.split("-").slice(0,12)||[],N=async()=>{if(!t&&E){u(!0),console.log("[Backup] Starting manual backup to IPFS...");try{let a=(await (0,ch.getAllPhotos)()).filter(a=>a.encryptedBlob);w({current:0,total:a.length});let b=0,c=(0,b8.getDeviceId)(),d=I||await (0,ag.getUserKeyHash)(E);for(let e of a)if(e.encryptedBlob)try{if(!await b4(e.cid,d)){let a=await ce(e.encryptedBlob,e.fileName);console.log(`[Backup] Uploaded to IPFS: ${a}`),await b2(a,e.fileSize,c,e.nonce,e.mimeType,d)}b++,w({current:b,total:a.length})}catch(a){console.error(`[Backup] Failed to upload ${e.cid}:`,a)}D("Gerade eben"),console.log(`[Backup] Complete: ${b} photos processed`)}catch(a){console.error("[Backup] Failed:",a)}finally{u(!1),w({current:0,total:0})}}},O=async()=>{H(),await G()&&c(a=>({...a,photosCount:0})),k(!1)},[P,Q]=(0,K.useState)(!1),[R,S]=(0,K.useState)(!1),U=async()=>{try{let{db:b}=await a.A(58590);await b.delete(),localStorage.clear(),window.location.reload()}catch(a){console.error("Failed to clear cache:",a)}};if(f){let a=r.map(a=>({id:a.id,name:a.device_name||"Unbekanntes GerÃ¤t",lastActive:""===a.id?"Aktiv":function(a){if(!a)return"Unbekannt";let b=new Date(a),c=new Date().getTime()-b.getTime(),d=Math.floor(c/6e4),e=Math.floor(c/36e5),f=Math.floor(c/864e5);return d<1?"Gerade eben":d<60?`vor ${d} Min.`:e<24?`vor ${e} Std.`:f<7?`vor ${f} Tagen`:b.toLocaleDateString("de-DE")}(a.created_at),syncing:!1}));return 0===a.length&&a.push({id:"",name:"Dieses GerÃ¤t",lastActive:"Aktiv",syncing:!1}),(0,J.jsx)(cH,{devices:a,onBack:()=>g(!1),onAddDevice:()=>{g(!1),Q(!0)}})}return(0,J.jsxs)("div",{className:"h-full flex flex-col pb-4 overflow-y-auto",children:[(0,J.jsx)("header",{className:"px-5 pt-6 pb-4 bg-[#FAFBFC]",children:(0,J.jsx)("h1",{className:"sketch-heading text-[32px]",children:"Einstellungen"})}),(0,J.jsxs)("div",{className:"flex-1 px-5",children:[(0,J.jsxs)("div",{className:"mb-8",children:[(0,J.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"Backup"}),(0,J.jsxs)($,{className:"overflow-hidden p-0",children:[(0,J.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"sketch-subheading text-[17px]",children:"Automatisches Backup"}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Neue Fotos automatisch sichern"})]}),(0,J.jsx)(_,{checked:x,onChange:()=>{y(!x)}})]}),(0,J.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,J.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"sketch-subheading text-[17px]",children:"Hintergrund-Backup"}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Weiter sichern wenn App geschlossen"})]}),(0,J.jsx)(_,{checked:z,onChange:()=>{A(!z)}})]}),(0,J.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,J.jsxs)("button",{onClick:()=>o(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#2563EB]/5 transition-colors",children:[(0,J.jsxs)("div",{className:"flex items-center gap-4",children:[(0,J.jsx)(aa,{icon:"folder",size:28}),(0,J.jsxs)("div",{className:"text-left",children:[(0,J.jsx)("span",{className:"sketch-subheading text-[17px] block",children:"Backup-Quelle"}),(0,J.jsx)("span",{className:"sketch-body text-[14px] text-[#6E6E73]",children:"photos-app"===b.photoSource?"Fotos-App":"Dateien-App"})]})]}),(0,J.jsx)(X,{name:"chevronRight",size:16,className:"opacity-40"})]})]}),(0,J.jsx)("div",{className:"px-4 mt-4",children:(0,J.jsx)(Z.SketchButton,{onClick:N,disabled:t||!E,className:"w-full",size:"lg",children:t?(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(T.Loader2,{className:"w-5 h-5 animate-spin mr-2"}),v.total>0?`${v.current}/${v.total}`:"Wait..."]}):"Jetzt sichern"})}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73] px-4 mt-3 text-center",children:"Alle lokalen Fotos in die Cloud hochladen"})]}),(0,J.jsxs)("div",{className:"mb-8",children:[(0,J.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"Speicher"}),(0,J.jsxs)($,{className:"overflow-hidden p-0",children:[(0,J.jsxs)("div",{className:"p-4",children:[(0,J.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,J.jsx)("span",{className:"sketch-subheading text-[17px]",children:"Aktueller Plan"}),(0,J.jsx)("span",{className:"sketch-subheading text-[16px] text-[#2563EB]",children:"free"===B?"Free":"Backup+"})]}),(0,J.jsx)("p",{className:"sketch-body text-[14px] text-[#6E6E73]",children:"free"===B?"Fotos nur auf deinen GerÃ¤ten":"200 GB Cloud-Backup aktiv"})]}),(0,J.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,J.jsx)("div",{className:"p-4",children:(0,J.jsxs)("div",{className:"flex items-center justify-between",children:[(0,J.jsx)("span",{className:"sketch-body text-[15px] text-[#6E6E73]",children:"Verwendet"}),(0,J.jsxs)("span",{className:"sketch-subheading text-[15px]",children:[b.photosCount.toLocaleString()," Fotos (lokal)"]})]})}),(0,J.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,J.jsxs)("button",{onClick:()=>q(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#2563EB]/5 transition-colors",children:[(0,J.jsx)("span",{className:"sketch-subheading text-[17px] text-[#2563EB]",children:"free"===B?"Upgrade zu Backup+":"Plan verwalten"}),(0,J.jsx)(X,{name:"chevronRight",size:16,className:"opacity-40"})]})]})]}),(0,J.jsxs)("div",{className:"mb-8",children:[(0,J.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"GerÃ¤te"}),(0,J.jsx)($,{className:"overflow-hidden p-0",children:(0,J.jsxs)("button",{onClick:()=>g(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#2563EB]/5 transition-colors",children:[(0,J.jsxs)("div",{className:"flex items-center gap-4",children:[(0,J.jsx)(aa,{icon:"photo",size:28}),(0,J.jsx)("span",{className:"sketch-subheading text-[17px]",children:"Verbundene GerÃ¤te"})]}),(0,J.jsxs)("div",{className:"flex items-center gap-3",children:[(0,J.jsx)("span",{className:"sketch-body text-[15px] text-[#6E6E73]",children:r.length||1}),(0,J.jsx)(X,{name:"chevronRight",size:16,className:"opacity-40"})]})]})})]}),(0,J.jsxs)("div",{className:"mb-8",children:[(0,J.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"Sicherheit"}),(0,J.jsxs)($,{className:"overflow-hidden p-0",children:[(0,J.jsxs)("button",{onClick:()=>i(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#2563EB]/5 transition-colors",children:[(0,J.jsx)("span",{className:"sketch-subheading text-[17px]",children:"Backup-Phrase anzeigen"}),(0,J.jsx)(X,{name:"chevronRight",size:16,className:"opacity-40"})]}),(0,J.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,J.jsxs)("button",{onClick:()=>k(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#FF3B30]/5 transition-colors",children:[(0,J.jsx)("span",{className:"sketch-subheading text-[17px] text-[#FF3B30]",children:"Neuen SchlÃ¼ssel erstellen"}),(0,J.jsx)(X,{name:"chevronRight",size:16,className:"opacity-40"})]})]}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73] px-4 mt-3",children:"Teile diese WÃ¶rter niemals mit anderen."})]}),(0,J.jsxs)("div",{className:"mb-8",children:[(0,J.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"Wartung"}),(0,J.jsx)($,{className:"overflow-hidden p-0",children:(0,J.jsxs)("button",{onClick:()=>S(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#FF9500]/5 transition-colors",children:[(0,J.jsxs)("div",{className:"flex items-center gap-4",children:[(0,J.jsx)(aa,{icon:"warning",size:28,color:"#FF9500"}),(0,J.jsx)("span",{className:"sketch-subheading text-[17px] text-[#FF9500]",children:"Lokalen Cache leeren"})]}),(0,J.jsx)(X,{name:"chevronRight",size:16,className:"opacity-40"})]})}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73] px-4 mt-3",children:"LÃ¶scht lokale Vorschaubilder. Deine Cloud-Fotos bleiben sicher."})]})]}),h&&(0,J.jsx)(cK,{title:"Sicherheitshinweis",message:"Deine Backup-Phrase gibt vollen Zugriff auf deine verschlÃ¼sselten Fotos. Nur an einem privaten Ort anzeigen.",confirmLabel:"Phrase anzeigen",confirmDestructive:!1,onConfirm:()=>{i(!1),m(!0)},onCancel:()=>i(!1)}),l&&(0,J.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-6 backdrop-blur-sm",children:(0,J.jsxs)($,{className:"bg-white w-full max-w-[400px] p-6 shadow-2xl",children:[(0,J.jsx)("h3",{className:"sketch-heading text-[24px] text-center mb-2",children:"Back-up Phrase"}),(0,J.jsx)("p",{className:"sketch-body text-[14px] text-[#6E6E73] text-center mb-6",children:"Notiere diese WÃ¶rter sicher."}),M.length>0?(0,J.jsx)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:M.map((a,b)=>(0,J.jsxs)($,{className:"p-2 text-center bg-[#2563EB]/5",children:[(0,J.jsx)("span",{className:"sketch-body text-[10px] text-[#6E6E73] block",children:b+1}),(0,J.jsx)("span",{className:"sketch-subheading text-[14px]",children:a})]},b))}):(0,J.jsx)("div",{className:"mb-6",children:(0,J.jsx)($,{className:"bg-[#FF9500]/5 border-[#FF9500] p-4",children:(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#FF9500] text-center",children:"Kein SchlÃ¼ssel gefunden."})})}),(0,J.jsx)(Z.SketchButton,{onClick:()=>m(!1),className:"w-full",children:"Fertig"})]})}),j&&(0,J.jsx)(cK,{title:"Datenverlust-Warnung",message:"Das Erstellen eines neuen SchlÃ¼ssels lÃ¶scht alle vorhandenen Backup-Daten permanent. Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.",confirmLabel:"Neuen SchlÃ¼ssel erstellen",confirmDestructive:!0,onConfirm:O,onCancel:()=>k(!1)}),n&&(0,J.jsx)(cI,{currentSource:b.photoSource,onSelect:a=>{console.log("Update backup source preference:",a),c(b=>({...b,photoSource:a})),o(!1)},onClose:()=>o(!1)}),p&&(0,J.jsx)(cJ,{currentPlan:B,onSelect:a=>{console.log("Update plan:",a),C(a),q(!1)},onClose:()=>q(!1)}),R&&(0,J.jsx)(cK,{title:"Cache leeren?",message:"Dies wird lokale Vorschaubilder und GerÃ¤tedaten lÃ¶schen. Deine verschlÃ¼sselten Fotos in der Cloud bleiben sicher. Die App wird neu geladen.",confirmLabel:"Cache leeren",confirmDestructive:!0,onConfirm:U,onCancel:()=>S(!1)}),(0,J.jsx)(cF,{isOpen:P,onClose:()=>Q(!1)})]})}function cH({devices:a,onBack:b,onAddDevice:c}){return(0,J.jsxs)("div",{className:"h-full flex flex-col pb-4 overflow-y-auto bg-[#FAFBFC]",children:[(0,J.jsxs)("header",{className:"px-5 pt-6 pb-4 bg-[#FAFBFC]",children:[(0,J.jsx)("button",{onClick:b,className:"sketch-body text-[#2563EB] mb-2 flex items-center gap-2 hover:underline",children:"â† ZurÃ¼ck"}),(0,J.jsx)("h1",{className:"sketch-heading text-[32px]",children:"GerÃ¤te"})]}),(0,J.jsxs)("div",{className:"flex-1 px-5",children:[(0,J.jsx)($,{className:"overflow-hidden p-0",children:a.map((a,b)=>(0,J.jsxs)("div",{children:[b>0&&(0,J.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,J.jsxs)("div",{className:"flex items-center gap-4 p-4",children:[(0,J.jsx)(aa,{icon:"photo",size:32}),(0,J.jsxs)("div",{className:"flex-1",children:[(0,J.jsx)("p",{className:"sketch-subheading text-[17px] text-[#1D1D1F]",children:a.name}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:a.lastActive})]}),a.syncing?(0,J.jsx)(T.Loader2,{className:"w-5 h-5 text-[#2563EB] animate-spin"}):"Aktiv"===a.lastActive?(0,J.jsxs)("div",{className:"flex items-center gap-1",children:[(0,J.jsx)(ak.Check,{className:"w-4 h-4 text-[#30D158]"}),(0,J.jsx)("span",{className:"sketch-subheading text-[13px] text-[#30D158]",children:"Aktiv"})]}):null]})]},a.id))}),(0,J.jsx)(Z.SketchButton,{onClick:c,className:"w-full mt-8",size:"lg",children:"Neu verbinden"}),(0,J.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73] text-center mt-4 px-4",children:"SchlÃ¼ssel scannen oder Recovery-Phrase eingeben"})]})]})}function cI({currentSource:a,onSelect:b,onClose:c}){return(0,J.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-end justify-center z-50",children:(0,J.jsxs)("div",{className:"bg-white w-full max-w-[428px] rounded-t-2xl p-6 pb-10",children:[(0,J.jsx)("h3",{className:"sketch-heading text-[24px] text-[#1D1D1F] text-center mb-2",children:"Backup-Quelle"}),(0,J.jsx)("p",{className:"text-[15px] text-[#6E6E73] text-center mb-6",children:"Wo sind deine Fotos gespeichert?"}),(0,J.jsx)("div",{className:"space-y-3 mb-6",children:[{id:"photos-app",label:"Fotos-App",description:"Alle Fotos aus der iOS Foto-Bibliothek"},{id:"files-app",label:"Dateien-App",description:"Fotos aus einem bestimmten Ordner"}].map(c=>(0,J.jsx)("button",{onClick:()=>b(c.id),className:`w-full p-4 rounded-xl bg-[#F2F2F7] text-left ios-tap-target ${a===c.id?"ring-2 ring-[#007AFF]":""}`,children:(0,J.jsxs)("div",{className:"flex items-center justify-between",children:[(0,J.jsxs)("div",{children:[(0,J.jsx)("p",{className:"text-[17px] font-medium text-[#1D1D1F]",children:c.label}),(0,J.jsx)("p",{className:"text-[13px] text-[#6E6E73] mt-0.5",children:c.description})]}),(0,J.jsx)("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${a===c.id?"border-[#007AFF] bg-[#007AFF]":"border-[#C7C7CC]"}`,children:a===c.id&&(0,J.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-white"})})]})},c.id))}),(0,J.jsx)("button",{onClick:c,className:"w-full h-[44px] text-[#007AFF] text-[17px] ios-tap-target",children:"Abbrechen"})]})})}function cJ({currentPlan:a,onSelect:b,onClose:c}){return(0,J.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-end justify-center z-50",children:(0,J.jsxs)("div",{className:"bg-white w-full max-w-[428px] rounded-t-2xl p-6 pb-10 max-h-[80vh] overflow-y-auto",children:[(0,J.jsx)("h3",{className:"sketch-heading text-[24px] text-[#1D1D1F] text-center mb-2",children:"Speicherplan"}),(0,J.jsx)("p",{className:"text-[15px] text-[#6E6E73] text-center mb-6",children:"Du kannst jederzeit wechseln"}),(0,J.jsx)("div",{className:"space-y-3 mb-6",children:[{id:"free",label:"FREE",subtitle:"Auf deinen GerÃ¤ten",price:"0â‚¬/Monat",features:["Unbegrenzte Fotos","Zero-Knowledge VerschlÃ¼sselung","Multi-Device Sync"]},{id:"backup-plus",label:"BACKUP+ (Coming Soon)",subtitle:"Dauerhaft im Netz",price:"2,99â‚¬/Monat",features:["Alles von Free","200 GB Cloud-Backup","Schnellere Synchronisierung"],disabled:!0}].map(c=>(0,J.jsx)("button",{onClick:()=>!c.disabled&&b(c.id),disabled:c.disabled,className:`w-full p-4 rounded-xl text-left ios-tap-target ${c.disabled?"bg-[#F2F2F7]/50 cursor-not-allowed opacity-60":a===c.id?"bg-[#F2F2F7] ring-2 ring-[#007AFF]":"bg-[#F2F2F7]"}`,children:(0,J.jsxs)("div",{className:"flex items-start justify-between",children:[(0,J.jsxs)("div",{className:"flex-1",children:[(0,J.jsx)("p",{className:"text-[13px] font-bold text-[#007AFF] tracking-wide",children:c.label}),(0,J.jsx)("p",{className:"text-[17px] font-semibold text-[#1D1D1F] mt-0.5",children:c.subtitle}),(0,J.jsx)("ul",{className:"mt-2 space-y-1",children:c.features.map(a=>(0,J.jsxs)("li",{className:"text-[13px] text-[#6E6E73] flex items-center gap-2",children:[(0,J.jsx)("span",{className:"text-[#30D158]",children:"âœ“"})," ",a]},a))}),(0,J.jsx)("p",{className:"text-[15px] font-semibold text-[#1D1D1F] mt-3",children:c.price})]}),(0,J.jsx)("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${a===c.id?"border-[#007AFF] bg-[#007AFF]":"border-[#C7C7CC]"}`,children:a===c.id&&(0,J.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-white"})})]})},c.id))}),(0,J.jsx)("button",{onClick:c,className:"w-full h-[44px] text-[#007AFF] text-[17px] ios-tap-target",children:"Abbrechen"})]})})}function cK({title:a,message:b,confirmLabel:c,confirmDestructive:d,onConfirm:e,onCancel:f}){return(0,J.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 px-8",children:(0,J.jsxs)("div",{className:"bg-white w-full max-w-[270px] rounded-2xl overflow-hidden",children:[(0,J.jsxs)("div",{className:"p-4 text-center",children:[(0,J.jsx)("h3",{className:"sketch-subheading text-[17px] text-[#1D1D1F] mb-1",children:a}),(0,J.jsx)("p",{className:"text-[13px] text-[#6E6E73] leading-relaxed",children:b})]}),(0,J.jsxs)("div",{className:"border-t border-[#E5E5EA]",children:[(0,J.jsx)("button",{onClick:f,className:"w-full py-3 text-[17px] text-[#007AFF] border-b border-[#E5E5EA] ios-tap-target",children:"Abbrechen"}),(0,J.jsx)("button",{onClick:e,className:`w-full py-3 text-[17px] font-semibold ios-tap-target ${d?"text-[#FF3B30]":"text-[#007AFF]"}`,children:c})]})]})})}var cL=a.i(11508),cM=a.i(99745),cN=a.i(18544),cO=a.i(76644),cP=a.i(33791),cQ=a.i(79715),cR=a.i(42871),cS=a.i(8361),cT=class extends cP.Subscribable{constructor(a,b){super(),this.options=b,this.#a=a,this.#b=null,this.#c=(0,cQ.pendingThenable)(),this.bindMethods(),this.setOptions(b)}#a;#d=void 0;#e=void 0;#f=void 0;#g;#h;#c;#b;#i;#j;#k;#l;#m;#n;#o=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#d.addObserver(this),cU(this.#d,this.options)?this.#p():this.updateResult(),this.#q())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return cV(this.#d,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return cV(this.#d,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#r(),this.#s(),this.#d.removeObserver(this)}setOptions(a){let b=this.options,c=this.#d;if(this.options=this.#a.defaultQueryOptions(a),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,cR.resolveEnabled)(this.options.enabled,this.#d))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#t(),this.#d.setOptions(this.options),b._defaulted&&!(0,cR.shallowEqualObjects)(this.options,b)&&this.#a.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#d,observer:this});let d=this.hasListeners();d&&cW(this.#d,c,this.options,b)&&this.#p(),this.updateResult(),d&&(this.#d!==c||(0,cR.resolveEnabled)(this.options.enabled,this.#d)!==(0,cR.resolveEnabled)(b.enabled,this.#d)||(0,cR.resolveStaleTime)(this.options.staleTime,this.#d)!==(0,cR.resolveStaleTime)(b.staleTime,this.#d))&&this.#u();let e=this.#v();d&&(this.#d!==c||(0,cR.resolveEnabled)(this.options.enabled,this.#d)!==(0,cR.resolveEnabled)(b.enabled,this.#d)||e!==this.#n)&&this.#w(e)}getOptimisticResult(a){var b,c;let d=this.#a.getQueryCache().build(this.#a,a),e=this.createResult(d,a);return b=this,c=e,(0,cR.shallowEqualObjects)(b.getCurrentResult(),c)||(this.#f=e,this.#h=this.options,this.#g=this.#d.state),e}getCurrentResult(){return this.#f}trackResult(a,b){return new Proxy(a,{get:(a,c)=>(this.trackProp(c),b?.(c),"promise"===c&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#c.status||this.#c.reject(Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(a,c))})}trackProp(a){this.#o.add(a)}getCurrentQuery(){return this.#d}refetch({...a}={}){return this.fetch({...a})}fetchOptimistic(a){let b=this.#a.defaultQueryOptions(a),c=this.#a.getQueryCache().build(this.#a,b);return c.fetch().then(()=>this.createResult(c,b))}fetch(a){return this.#p({...a,cancelRefetch:a.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#f))}#p(a){this.#t();let b=this.#d.fetch(this.options,a);return a?.throwOnError||(b=b.catch(cR.noop)),b}#u(){this.#r();let a=(0,cR.resolveStaleTime)(this.options.staleTime,this.#d);if(cR.isServer||this.#f.isStale||!(0,cR.isValidTimeout)(a))return;let b=(0,cR.timeUntilStale)(this.#f.dataUpdatedAt,a);this.#l=cS.timeoutManager.setTimeout(()=>{this.#f.isStale||this.updateResult()},b+1)}#v(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#d):this.options.refetchInterval)??!1}#w(a){this.#s(),this.#n=a,!cR.isServer&&!1!==(0,cR.resolveEnabled)(this.options.enabled,this.#d)&&(0,cR.isValidTimeout)(this.#n)&&0!==this.#n&&(this.#m=cS.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||cM.focusManager.isFocused())&&this.#p()},this.#n))}#q(){this.#u(),this.#w(this.#v())}#r(){this.#l&&(cS.timeoutManager.clearTimeout(this.#l),this.#l=void 0)}#s(){this.#m&&(cS.timeoutManager.clearInterval(this.#m),this.#m=void 0)}createResult(a,b){let c,d=this.#d,e=this.options,f=this.#f,g=this.#g,h=this.#h,i=a!==d?a.state:this.#e,{state:j}=a,k={...j},l=!1;if(b._optimisticResults){let c=this.hasListeners(),f=!c&&cU(a,b),g=c&&cW(a,d,b,e);(f||g)&&(k={...k,...(0,cO.fetchState)(j.data,a.options)}),"isRestoring"===b._optimisticResults&&(k.fetchStatus="idle")}let{error:m,errorUpdatedAt:n,status:o}=k;c=k.data;let p=!1;if(void 0!==b.placeholderData&&void 0===c&&"pending"===o){let a;f?.isPlaceholderData&&b.placeholderData===h?.placeholderData?(a=f.data,p=!0):a="function"==typeof b.placeholderData?b.placeholderData(this.#k?.state.data,this.#k):b.placeholderData,void 0!==a&&(o="success",c=(0,cR.replaceData)(f?.data,a,b),l=!0)}if(b.select&&void 0!==c&&!p)if(f&&c===g?.data&&b.select===this.#i)c=this.#j;else try{this.#i=b.select,c=b.select(c),c=(0,cR.replaceData)(f?.data,c,b),this.#j=c,this.#b=null}catch(a){this.#b=a}this.#b&&(m=this.#b,c=this.#j,n=Date.now(),o="error");let q="fetching"===k.fetchStatus,r="pending"===o,s="error"===o,t=r&&q,u=void 0!==c,v={status:o,fetchStatus:k.fetchStatus,isPending:r,isSuccess:"success"===o,isError:s,isInitialLoading:t,isLoading:t,data:c,dataUpdatedAt:k.dataUpdatedAt,error:m,errorUpdatedAt:n,failureCount:k.fetchFailureCount,failureReason:k.fetchFailureReason,errorUpdateCount:k.errorUpdateCount,isFetched:k.dataUpdateCount>0||k.errorUpdateCount>0,isFetchedAfterMount:k.dataUpdateCount>i.dataUpdateCount||k.errorUpdateCount>i.errorUpdateCount,isFetching:q,isRefetching:q&&!r,isLoadingError:s&&!u,isPaused:"paused"===k.fetchStatus,isPlaceholderData:l,isRefetchError:s&&u,isStale:cX(a,b),refetch:this.refetch,promise:this.#c,isEnabled:!1!==(0,cR.resolveEnabled)(b.enabled,a)};if(this.options.experimental_prefetchInRender){let b=void 0!==v.data,c="error"===v.status&&!b,e=a=>{c?a.reject(v.error):b&&a.resolve(v.data)},f=()=>{e(this.#c=v.promise=(0,cQ.pendingThenable)())},g=this.#c;switch(g.status){case"pending":a.queryHash===d.queryHash&&e(g);break;case"fulfilled":(c||v.data!==g.value)&&f();break;case"rejected":c&&v.error===g.reason||f()}}return v}updateResult(){let a=this.#f,b=this.createResult(this.#d,this.options);if(this.#g=this.#d.state,this.#h=this.options,void 0!==this.#g.data&&(this.#k=this.#d),(0,cR.shallowEqualObjects)(b,a))return;this.#f=b;let c=()=>{if(!a)return!0;let{notifyOnChangeProps:b}=this.options,c="function"==typeof b?b():b;if("all"===c||!c&&!this.#o.size)return!0;let d=new Set(c??this.#o);return this.options.throwOnError&&d.add("error"),Object.keys(this.#f).some(b=>this.#f[b]!==a[b]&&d.has(b))};this.#x({listeners:c()})}#t(){let a=this.#a.getQueryCache().build(this.#a,this.options);if(a===this.#d)return;let b=this.#d;this.#d=a,this.#e=a.state,this.hasListeners()&&(b?.removeObserver(this),a.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#q()}#x(a){cN.notifyManager.batch(()=>{a.listeners&&this.listeners.forEach(a=>{a(this.#f)}),this.#a.getQueryCache().notify({query:this.#d,type:"observerResultsUpdated"})})}};function cU(a,b){return!1!==(0,cR.resolveEnabled)(b.enabled,a)&&void 0===a.state.data&&("error"!==a.state.status||!1!==b.retryOnMount)||void 0!==a.state.data&&cV(a,b,b.refetchOnMount)}function cV(a,b,c){if(!1!==(0,cR.resolveEnabled)(b.enabled,a)&&"static"!==(0,cR.resolveStaleTime)(b.staleTime,a)){let d="function"==typeof c?c(a):c;return"always"===d||!1!==d&&cX(a,b)}return!1}function cW(a,b,c,d){return(a!==b||!1===(0,cR.resolveEnabled)(d.enabled,a))&&(!c.suspense||"error"!==a.state.status)&&cX(a,c)}function cX(a,b){return!1!==(0,cR.resolveEnabled)(b.enabled,a)&&a.isStaleByTime((0,cR.resolveStaleTime)(b.staleTime,a))}var cY=K.createContext((f=!1,{clearReset:()=>{f=!1},reset:()=>{f=!0},isReset:()=>f})),cZ=K.createContext(!1);cZ.Provider;var c$=(a,b,c)=>b.fetchOptimistic(a).catch(()=>{c.clearReset()});function c_(a,b){return function(a,b,c){let d,e=K.useContext(cZ),f=K.useContext(cY),g=(0,cL.useQueryClient)(c),h=g.defaultQueryOptions(a);g.getDefaultOptions().queries?._experimental_beforeQuery?.(h);let i=g.getQueryCache().get(h.queryHash);if(h._optimisticResults=e?"isRestoring":"optimistic",h.suspense){let a=a=>"static"===a?a:Math.max(a??1e3,1e3),b=h.staleTime;h.staleTime="function"==typeof b?(...c)=>a(b(...c)):a(b),"number"==typeof h.gcTime&&(h.gcTime=Math.max(h.gcTime,1e3))}d=i?.state.error&&"function"==typeof h.throwOnError?(0,cR.shouldThrowError)(h.throwOnError,[i.state.error,i]):h.throwOnError,(h.suspense||h.experimental_prefetchInRender||d)&&!f.isReset()&&(h.retryOnMount=!1),K.useEffect(()=>{f.clearReset()},[f]);let j=!g.getQueryCache().get(h.queryHash),[k]=K.useState(()=>new b(g,h)),l=k.getOptimisticResult(h),m=!e&&!1!==a.subscribed;if(K.useSyncExternalStore(K.useCallback(a=>{let b=m?k.subscribe(cN.notifyManager.batchCalls(a)):cR.noop;return k.updateResult(),b},[k,m]),()=>k.getCurrentResult(),()=>k.getCurrentResult()),K.useEffect(()=>{k.setOptions(h)},[h,k]),h?.suspense&&l.isPending)throw c$(h,k,f);if((({result:a,errorResetBoundary:b,throwOnError:c,query:d,suspense:e})=>a.isError&&!b.isReset()&&!a.isFetching&&d&&(e&&void 0===a.data||(0,cR.shouldThrowError)(c,[a.error,d])))({result:l,errorResetBoundary:f,throwOnError:h.throwOnError,query:i,suspense:h.suspense}))throw l.error;if(g.getDefaultOptions().queries?._experimental_afterQuery?.(h,l),h.experimental_prefetchInRender&&!cR.isServer&&l.isLoading&&l.isFetching&&!e){let a=j?c$(h,k,f):i?.promise;a?.catch(cR.noop).finally(()=>{k.updateResult()})}return h.notifyOnChangeProps?l:k.trackResult(l)}(a,cT,b)}var c0=a.i(12794),c1=cP,c2=class extends c1.Subscribable{#a;#f=void 0;#y;#z;constructor(a,b){super(),this.#a=a,this.setOptions(b),this.bindMethods(),this.#A()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(a){let b=this.options;this.options=this.#a.defaultMutationOptions(a),(0,cR.shallowEqualObjects)(this.options,b)||this.#a.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#y,observer:this}),b?.mutationKey&&this.options.mutationKey&&(0,cR.hashKey)(b.mutationKey)!==(0,cR.hashKey)(this.options.mutationKey)?this.reset():this.#y?.state.status==="pending"&&this.#y.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#y?.removeObserver(this)}onMutationUpdate(a){this.#A(),this.#x(a)}getCurrentResult(){return this.#f}reset(){this.#y?.removeObserver(this),this.#y=void 0,this.#A(),this.#x()}mutate(a,b){return this.#z=b,this.#y?.removeObserver(this),this.#y=this.#a.getMutationCache().build(this.#a,this.options),this.#y.addObserver(this),this.#y.execute(a)}#A(){let a=this.#y?.state??(0,c0.getDefaultState)();this.#f={...a,isPending:"pending"===a.status,isSuccess:"success"===a.status,isError:"error"===a.status,isIdle:"idle"===a.status,mutate:this.mutate,reset:this.reset}}#x(a){cN.notifyManager.batch(()=>{if(this.#z&&this.hasListeners()){let b=this.#f.variables,c=this.#f.context,d={client:this.#a,meta:this.options.meta,mutationKey:this.options.mutationKey};if(a?.type==="success"){try{this.#z.onSuccess?.(a.data,b,c,d)}catch(a){Promise.reject(a)}try{this.#z.onSettled?.(a.data,null,b,c,d)}catch(a){Promise.reject(a)}}else if(a?.type==="error"){try{this.#z.onError?.(a.error,b,c,d)}catch(a){Promise.reject(a)}try{this.#z.onSettled?.(void 0,a.error,b,c,d)}catch(a){Promise.reject(a)}}}this.listeners.forEach(a=>{a(this.#f)})})}};function c3(a,b){let c=(0,cL.useQueryClient)(b),[d]=K.useState(()=>new c2(c,a));K.useEffect(()=>{d.setOptions(a)},[d,a]);let e=K.useSyncExternalStore(K.useCallback(a=>d.subscribe(cN.notifyManager.batchCalls(a)),[d]),()=>d.getCurrentResult(),()=>d.getCurrentResult()),f=K.useCallback((a,b)=>{d.mutate(a,b).catch(cR.noop)},[d]);if(e.error&&(0,cR.shouldThrowError)(d.options.throwOnError,[e.error]))throw e.error;return{...e,mutate:f,mutateAsync:e.mutate}}async function c4(a,b){let c={local:!1,supabase:!1,ipfs:!1,errors:[]};if(console.log("[PhotoManager] Starting global delete for CID:",a),void 0!==b&&b>0)try{await (0,ch.deletePhoto)(b),c.local=!0,console.log("[PhotoManager] Deleted from IndexedDB:",b)}catch(b){let a=`IndexedDB delete failed: ${b}`;c.errors.push(a),console.error("[PhotoManager]",a)}else console.log("[PhotoManager] No local ID provided, skipping IndexedDB delete"),c.local=!0;try{await b5(a),c.supabase=!0,console.log("[PhotoManager] Deleted from Supabase:",a)}catch(b){let a=`Supabase delete failed: ${b}`;c.errors.push(a),console.error("[PhotoManager]",a)}if(a.startsWith("Qm")&&46===a.length||a.startsWith("bafy")||a.startsWith("bafk"))try{await cd(a),c.ipfs=!0,console.log("[PhotoManager] Unpinned from IPFS:",a)}catch(a){console.warn("[PhotoManager] IPFS unpin failed (non-critical):",a),c.ipfs=!1}else console.log("[PhotoManager] Skipping IPFS unpin for mock/temp CID:",a),c.ipfs=!0;return console.log("[PhotoManager] Global delete complete:",c),c}async function c5(a,b=.92){return["image/heic","image/heif","image/heic-sequence","image/heif-sequence"].includes(a.type?.toLowerCase())||a.name?.toLowerCase().endsWith(".heic")||a.name?.toLowerCase().endsWith(".heif")?(console.log("[HEIC] Using main thread conversion"),c6(a,b)):{file:a,converted:!1}}async function c6(b,c){try{let d=(await a.A(46269)).default,e=await d({blob:b,toType:"image/jpeg",quality:c}),f=Array.isArray(e)?e[0]:e,g=b.name.replace(/\.(heic|heif)$/i,".jpg"),h=new File([f],g,{type:"image/jpeg",lastModified:b.lastModified});return{file:h,converted:!0,originalSize:b.size,convertedSize:h.size}}catch(a){return console.error("[HEIC] Main thread conversion failed:",a),{file:b,converted:!1}}}var c7=a.i(35133);function c8({photo:a,secretKey:b,showCloudBadge:c=!0}){let[d,e]=(0,K.useState)(null),[f,g]=(0,K.useState)(!1),[h,i]=(0,K.useState)(!1),[j,k]=(0,K.useState)(!1),[l,m]=(0,K.useState)(!1),n=(0,K.useRef)(null);return((0,K.useEffect)(()=>{if(b&&!d)return(async()=>{i(!0);try{let c=a.encryptedBlob;if(!c&&a.cid&&cg(a.cid)){k(!0),m(!0),console.log("Fetching from IPFS for thumbnail:",a.cid);try{c=await cf(a.cid),console.log("Fetched from IPFS:",{cid:a.cid,size:c.size})}catch(b){console.error(`Failed to fetch from IPFS (CID: ${a.cid}):`,b),g(!0);return}finally{k(!1)}}if(!c){console.log("No blob available for:",a.cid),m(!0);return}let d=await (0,ag.decryptFile)(c,a.nonce,b,a.mimeType);if(d){let a=URL.createObjectURL(d);n.current=a,e(a)}else g(!0)}catch(b){console.error("Failed to decrypt photo:",a.cid,b),g(!0)}finally{i(!1)}})(),()=>{if(n.current){let a=n.current;setTimeout(()=>{try{URL.revokeObjectURL(a)}catch(a){}},1e3),n.current=null}}},[a,b,d]),f)?(0,J.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-red-50 text-red-500 p-2 text-center",children:[(0,J.jsx)(X,{name:"lock",size:24,className:"mb-1 opacity-50"}),(0,J.jsx)("span",{className:"text-[10px]",children:"Fehler"})]}):j?(0,J.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-blue-50",children:[(0,J.jsx)(c7.Cloud,{className:"w-5 h-5 text-blue-400 mb-1 animate-pulse"}),(0,J.jsx)(T.Loader2,{className:"w-4 h-4 animate-spin text-blue-400"}),(0,J.jsx)("span",{className:"text-[9px] text-blue-500 mt-1",children:"Laden..."})]}):h||!d?!l||d||h?(0,J.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,J.jsx)(T.Loader2,{className:"w-6 h-6 animate-spin text-gray-400"})}):(0,J.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gray-100 relative",children:[(0,J.jsx)(c7.Cloud,{className:"w-6 h-6 text-gray-400"}),(0,J.jsx)("span",{className:"text-[9px] text-gray-500 mt-1",children:"In der Cloud"})]}):(0,J.jsxs)("div",{className:"relative w-full h-full",children:[(0,J.jsx)("img",{src:d,alt:"",className:"w-full h-full object-cover animate-in fade-in duration-500",loading:"lazy"}),c&&l&&(0,J.jsx)("div",{className:"absolute bottom-1 right-1 bg-black/50 rounded-full p-1",children:(0,J.jsx)(c7.Cloud,{className:"w-3 h-3 text-white"})})]})}let c9=(0,L.default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),da=(0,L.default)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),db=(0,L.default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),dc=(0,L.default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),dd=(0,L.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var de=a.i(84505);function df({photosCount:a=0,authUser:b}){let c,d,e=(0,cL.useQueryClient)(),[f,g]=(0,K.useState)(""),[h,i]=(0,K.useState)(!1),[j,k]=(0,K.useState)(!1),[l,m]=(0,K.useState)(null),[n,o]=(0,K.useState)(!1),[p,q]=(0,K.useState)(new Set),[r,s]=(0,K.useState)(null),[t,u]=(0,K.useState)(null),[v,w]=(0,K.useState)(null),[x,y]=(0,K.useState)(!1),[z,A]=(0,K.useState)(!1),B=(0,K.useRef)(null),C=(0,K.useRef)(null),{secretKey:D}=ai(),{photos:E,uploadPhoto:F,isUploading:G,uploadProgress:H}=function(a){let b=(0,cL.useQueryClient)(),[c,d]=(0,K.useState)(null);(0,K.useEffect)(()=>{a?(0,ag.getUserKeyHash)(a).then(d):d(null)},[a]);let{data:e=[],isLoading:f,error:g}=c_({queryKey:["photos"],queryFn:ch.getAllPhotos,enabled:!0}),{data:h=0}=c_({queryKey:["photoCount"],queryFn:ch.getPhotoCount}),[i,j]=(0,K.useState)(0),[k,l]=(0,K.useState)(new Map),m=c3({mutationFn:async b=>{if(!a)throw Error("No encryption key");if(!c)throw Error("userKeyHash not ready - bitte kurz warten");let d=`temp_${Date.now()}_${Math.random().toString(36).slice(2)}`;console.log("[Upload] Starting upload:",b.name,"tempId:",d),j(0);let e=URL.createObjectURL(b);l(a=>new Map(a).set(d,{file:b,objectUrl:e,progress:0}));try{let e,f=await c5(b),g=f.file;f.converted&&console.log("[Upload] HEIC converted:",{originalSize:f.originalSize,convertedSize:f.convertedSize});let{encrypted:h,nonce:i}=await (0,ag.encryptFile)(g,a);console.log("[Upload] Encrypted:",{size:h.size}),l(a=>{let b=new Map(a),c=b.get(d);return c&&b.set(d,{...c,progress:20}),b});try{e=await ce(h,g.name,a=>{let b=20+.6*a;j(b),l(a=>{let c=new Map(a),e=c.get(d);return e&&c.set(d,{...e,progress:b}),c})}),console.log("[Upload] IPFS CID:",e)}catch(a){console.error("[Upload] IPFS failed:",a),e=`cid_${Date.now()}_${Math.random().toString(36).slice(2)}`,console.log("[Upload] Using fallback CID:",e)}l(a=>{let b=new Map(a),c=b.get(d);return c&&b.set(d,{...c,progress:85}),b});let k={cid:e,nonce:i,fileName:g.name,mimeType:g.type,fileSize:g.size,uploadedAt:new Date,encryptedBlob:h};try{await (0,ch.savePhoto)(k),console.log("[Upload] Saved to IndexedDB:",e)}catch(a){throw console.error("[Upload] IndexedDB save FAILED:",a),a}let m=(0,b8.getDeviceId)();try{await b2(e,g.size,m,i,g.type,c),console.log("[Upload] Supabase synced:",e)}catch(a){console.error("[Upload] Supabase sync failed (local + IPFS OK):",a)}return l(a=>{let b=new Map(a),c=b.get(d);return c&&URL.revokeObjectURL(c.objectUrl),b.delete(d),b}),k}catch(a){throw l(a=>{let b=new Map(a),c=b.get(d);return c&&URL.revokeObjectURL(c.objectUrl),b.delete(d),b}),a}},onSuccess:()=>{b.invalidateQueries({queryKey:["photos"]}),b.invalidateQueries({queryKey:["photoCount"]}),console.log("[Upload] Complete - queries invalidated")},onError:a=>{console.error("[Upload] Mutation failed:",a)}}),n=c3({mutationFn:async a=>{console.log("[Delete] Starting global delete:",a.cid);let b=await c4(a.cid,a.id);return b.errors.length>0&&console.warn("[Delete] Some operations failed:",b.errors),b},onSuccess:a=>{b.invalidateQueries({queryKey:["photos"]}),b.invalidateQueries({queryKey:["photoCount"]}),console.log("[Delete] Complete:",{local:a.local,supabase:a.supabase,ipfs:a.ipfs})},onError:a=>{console.error("[Delete] Mutation failed:",a)}}),o=(0,K.useCallback)(async b=>{if(!a||!b.encryptedBlob)return null;let c=await (0,ag.decryptFile)(b.encryptedBlob,b.nonce,a,b.mimeType);return c?URL.createObjectURL(c):null},[a]),p=Array.from(k.entries()).map(([a,b])=>({id:-1,cid:a,nonce:"",fileName:b.file.name,mimeType:b.file.type,fileSize:b.file.size,uploadedAt:new Date,encryptedBlob:void 0,isUploading:!0,uploadProgress:b.progress,previewUrl:b.objectUrl}));return{photos:e,photoCount:h,isLoading:f,error:g,uploadPhoto:m.mutate,deletePhoto:n.mutate,isDeleting:n.isPending,decryptPhoto:o,isUploading:m.isPending,uploadProgress:i,userKeyHash:c,uploadingPhotos:p}}(D),{remoteCIDs:I,remoteCIDsFromOtherDevices:L,isConnected:M}=function(a={}){let{onNewPhoto:b,onPhotoDeleted:c,enabled:d=!0,secretKey:e}=a,[f,g]=(0,K.useState)([]),[h,i]=(0,K.useState)(!1),[j,k]=(0,K.useState)(null),[l,m]=(0,K.useState)(null),n=(0,K.useRef)(null),o=(0,K.useRef)("server"),p=(0,K.useRef)(b),q=(0,K.useRef)(c);(0,K.useRef)(null),(0,K.useRef)(!1),(0,K.useEffect)(()=>{p.current=b,q.current=c},[b,c]),(0,K.useEffect)(()=>{},[]),(0,K.useEffect)(()=>{let a=!0;return e?(0,ag.getUserKeyHash)(e).then(b=>{a&&(m(b),n.current=b)}):(m(null),n.current=null),()=>{a=!1}},[e]);let r=(0,K.useCallback)(async()=>{let a=n.current,b=o.current;if(!a)return[];try{let c=(await b3(b,a)).map(a=>({cid:a.cid,device_id:a.device_id,uploaded_at:a.uploaded_at,file_size_bytes:a.file_size_bytes,nonce:a.nonce||null,mime_type:a.mime_type||null,isFromOtherDevice:a.device_id!==b}));return g(c),k(null),c}catch(a){return console.error("Failed to load remote CIDs:",a),k(a),[]}},[]);(0,K.useEffect)(()=>{l&&d&&r()},[l,d,r]),(0,K.useEffect)(()=>{},[d,l]);let s=(0,K.useCallback)(async()=>r(),[r]),t=f.filter(a=>a.isFromOtherDevice);return{remoteCIDs:f,remoteCIDsFromOtherDevices:t,isConnected:h,lastSyncError:j,refresh:s,deviceId:o.current,userKeyHash:l}}({onNewPhoto:(0,K.useCallback)(a=>{console.log("[Realtime] New photo from device:",a.device_id,a.cid),u(`Neues Foto von anderem Ger\xe4t empfangen`),setTimeout(()=>u(null),3e3),e.invalidateQueries({queryKey:["photos"]}),e.invalidateQueries({queryKey:["photoCount"]})},[e]),onPhotoDeleted:(0,K.useCallback)(a=>{console.log("[Realtime] Photo deleted from another device:",a),u(`Foto von anderem Ger\xe4t gel\xf6scht`),setTimeout(()=>u(null),3e3),e.invalidateQueries({queryKey:["photos"]}),e.invalidateQueries({queryKey:["photoCount"]})},[e]),enabled:!0,secretKey:D}),N=(c=E.map(a=>({id:a.id?.toString()||a.cid,cid:a.cid,placeholderUrl:"",category:"photo",date:a.uploadedAt.toISOString().split("T")[0],metadata:a,isLocal:!0,isCloud:cg(a.cid)})),d=new Set(E.map(a=>a.cid)),[...c,...I.filter(a=>!d.has(a.cid)).map(a=>({id:a.cid,cid:a.cid,placeholderUrl:"",category:"cloud",date:a.uploaded_at?new Date(a.uploaded_at).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],metadata:{cid:a.cid,nonce:a.nonce||"",fileName:`cloud_${a.cid}`,mimeType:a.mime_type||"image/jpeg",fileSize:a.file_size_bytes||0,uploadedAt:a.uploaded_at?new Date(a.uploaded_at):new Date},isLocal:!1,isCloud:!0}))]),O=(0,K.useMemo)(()=>{var b;let c,d;return N.length>0?N:(b=Math.min(a,50),c=["nature","architecture","travel","food","animals","city","landscape","portrait","ocean","forest"],d=new Date,Array.from({length:b},(a,b)=>{let e=new Date(d);return e.setDate(e.getDate()-Math.floor(b/3)),{id:`photo-${b}`,cid:`Qm${Math.random().toString(36).substring(2,15)}${Math.random().toString(36).substring(2,15)}`,placeholderUrl:`https://picsum.photos/seed/${b+100}/400/400`,category:c[b%c.length],date:e.toISOString().split("T")[0],metadata:void 0}}))},[N,a]),P=(0,K.useMemo)(()=>O.filter(a=>(!l||a.category===l)&&(!f||!!a.category.includes(f.toLowerCase()))),[O,l,f]),Q=(0,K.useMemo)(()=>{let a;return a={},P.forEach(b=>{a[b.date]||(a[b.date]=[]),a[b.date].push(b)}),Object.entries(a).map(([a,b])=>{var c;let d,e,f;return{date:a,photos:b,label:(d=new Date(c=a),((f=new Date(e=new Date)).setDate(f.getDate()-1),c===e.toISOString().split("T")[0])?"Heute":c===f.toISOString().split("T")[0]?"Gestern":d.toLocaleDateString("de-DE",{weekday:"long",day:"numeric",month:"long"}))}})},[P]),R=async a=>{if(D&&a.metadata){y(!0),w(null);try{let b=a.metadata.encryptedBlob;if(!b&&a.cid&&cg(a.cid)&&(console.log("Loading full-res from IPFS:",a.cid),b=await cf(a.cid)),!b)return void console.error("No blob available for fullscreen");let c=await (0,ag.decryptFile)(b,a.metadata.nonce,D,a.metadata.mimeType);if(c){let a=URL.createObjectURL(c);w(a)}}catch(a){console.error("Failed to load fullscreen photo:",a)}finally{y(!1)}}},S=async a=>{if(D&&a.metadata){A(!0);try{let b=a.metadata.encryptedBlob;if(!b&&a.cid&&cg(a.cid)&&(b=await cf(a.cid)),!b)return;let c=await (0,ag.decryptFile)(b,a.metadata.nonce,D,a.metadata.mimeType);if(c){let b=URL.createObjectURL(c),d=document.createElement("a");d.href=b,d.download=a.metadata.fileName||`photo_${a.cid.slice(0,8)}.jpg`,document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(b),u("Foto heruntergeladen!"),setTimeout(()=>u(null),2e3)}}catch(a){console.error("Failed to download photo:",a)}finally{A(!1)}}},U=()=>{B.current&&(clearTimeout(B.current),B.current=null)},V=O.length;return(0,J.jsxs)("div",{className:"flex flex-col h-full bg-[#FAFBFC]",children:[(0,J.jsxs)("header",{className:"px-5 pt-10 pb-4 bg-[#FAFBFC] sticky top-0 z-30 border-b-2 border-[#2563EB]/10",children:[(0,J.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,J.jsx)("h1",{className:"sketch-heading text-[32px]",children:"Galerie"}),(0,J.jsxs)("div",{className:"flex items-center gap-3",children:[(0,J.jsx)("button",{onClick:()=>i(!h),className:`p-2 rounded-full transition-colors ${h?"bg-[#2563EB]/10 text-[#2563EB]":"text-[#6E6E73]"}`,children:(0,J.jsx)(c9,{className:"w-6 h-6"})}),(0,J.jsx)(Z.SketchButton,{onClick:()=>{C.current?.click()},size:"sm",className:"scale-90",children:"HinzufÃ¼gen"})]})]}),(0,J.jsxs)("div",{className:"flex items-center justify-between px-1 mb-4",children:[(0,J.jsxs)("p",{className:"sketch-body text-[15px] text-[#3B82F6]",children:[V," Fotos gesichert"]}),(0,J.jsx)("div",{className:"flex items-center gap-2",children:M?(0,J.jsx)(aa,{icon:"cloud",size:20,color:"#30D158"}):(0,J.jsx)(aa,{icon:"warning",size:20,color:"#8E8E93"})})]}),h&&(0,J.jsx)("div",{className:"mb-4",children:(0,J.jsx)(ab,{value:f,onChange:a=>g(a),placeholder:"Suchen...",icon:(0,J.jsx)(c9,{className:"w-5 h-5"}),className:"w-full"})}),(0,J.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1",children:[(0,J.jsx)("button",{onClick:()=>m(null),className:`sketch-subheading text-[15px] px-4 py-1.5 rounded-full transition-colors ${null===l?"bg-[#2563EB] text-white":"bg-[#2563EB]/5 text-[#2563EB]"}`,children:"Alle"}),[{id:"nature",label:"Natur (Coming Soon)"},{id:"architecture",label:"Architektur (Coming Soon)"},{id:"travel",label:"Reisen (Coming Soon)"},{id:"food",label:"Essen (Coming Soon)"},{id:"animals",label:"Tiere (Coming Soon)"},{id:"city",label:"Stadt (Coming Soon)"},{id:"landscape",label:"Landschaft (Coming Soon)"}].map(a=>(0,J.jsx)("button",{onClick:()=>m(a.id),className:`sketch-subheading text-[15px] px-4 py-1.5 rounded-full transition-colors whitespace-nowrap ${l===a.id?"bg-[#2563EB] text-white":"bg-[#2563EB]/5 text-[#2563EB]"}`,children:a.label},a.id))]})]}),(0,J.jsx)("main",{className:"flex-1 overflow-y-auto px-1 pb-[100px]",children:0===Q.length?(0,J.jsxs)("div",{className:"pt-20 text-center px-10",children:[(0,J.jsx)(aa,{icon:"photo",size:64,className:"mx-auto mb-4 opacity-20"}),(0,J.jsx)("p",{className:"sketch-subheading text-lg text-[#6E6E73]",children:"Keine Fotos gefunden"}),(0,J.jsx)("p",{className:"sketch-body text-sm text-[#8E8E93] mt-2",children:"Versuche es mit einem anderen Suchbegriff oder Filter"})]}):Q.map(a=>(0,J.jsxs)("div",{className:"mb-8",children:[(0,J.jsx)("h2",{className:"sketch-subheading text-[19px] px-4 mb-3 sticky top-[160px] bg-[#FAFBFC]/80 backdrop-blur-sm z-10 py-1",children:a.label}),(0,J.jsx)("div",{className:"grid grid-cols-3 gap-1",children:a.photos.map(a=>(0,J.jsxs)("div",{className:`relative aspect-square overflow-hidden cursor-pointer active:opacity-70 transition-opacity ${p.has(a.id)?"ring-4 ring-[#2563EB] ring-inset":""}`,onClick:()=>{var b;return b=a.id,void(n?q(a=>{let c=new Set(a);return c.has(b)?c.delete(b):c.add(b),c}):(s(b),a.metadata&&R(a)))},onTouchStart:()=>{var b;return b=a.id,void(B.current=setTimeout(()=>{o(!0),q(new Set([b]))},500))},onTouchEnd:U,onContextMenu:b=>{b.preventDefault(),o(!0),q(new Set([a.id]))},children:[(0,J.jsx)(c8,{photo:a.metadata,secretKey:D,showCloudBadge:!0}),n&&(0,J.jsx)("div",{className:"absolute top-2 right-2 z-10 w-6 h-6",children:(0,J.jsx)($,{className:`w-6 h-6 rounded-full p-0 flex items-center justify-center ${p.has(a.id)?"bg-[#2563EB] border-[#2563EB]":"bg-white/80 border-[#2563EB]"}`,children:p.has(a.id)&&(0,J.jsx)(ak.Check,{className:"w-4 h-4 text-white"})})})]},a.id))})]},a.date))}),t&&(0,J.jsx)("div",{className:"fixed bottom-[100px] left-1/2 -translate-x-1/2 z-50 w-[90%] max-w-[400px]",children:(0,J.jsx)($,{className:"bg-[#2563EB] border-[#1E40AF] py-3 px-5 shadow-xl",children:(0,J.jsxs)("p",{className:"sketch-body text-white text-center flex items-center justify-center gap-3",children:[(0,J.jsx)(T.Loader2,{className:"w-4 h-4 animate-spin text-white/80"}),t]})})}),r&&(0,J.jsxs)("div",{className:"fixed inset-0 bg-black z-[100] flex flex-col",children:[(0,J.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,J.jsx)("button",{onClick:()=>{s(null),v&&(URL.revokeObjectURL(v),w(null))},className:"p-2 text-white/80 hover:text-white",children:(0,J.jsx)(cD.X,{className:"w-6 h-6"})}),(0,J.jsxs)("div",{className:"flex items-center gap-4",children:[(0,J.jsx)("button",{className:"p-2 text-white/80 hover:text-white",children:(0,J.jsx)(da,{className:"w-6 h-6"})}),(0,J.jsx)("button",{className:"p-2 text-white/80 hover:text-white",children:(0,J.jsx)(dc,{className:"w-6 h-6"})})]})]}),(0,J.jsx)("div",{className:"flex-1 relative flex items-center justify-center overflow-hidden",children:x?(0,J.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,J.jsx)(T.Loader2,{className:"w-12 h-12 text-[#2563EB] animate-spin"}),(0,J.jsx)("p",{className:"sketch-body text-white/60",children:"EntschlÃ¼sseln..."})]}):v?(0,J.jsx)("img",{src:v,alt:"Vollbild",className:"max-w-full max-h-full object-contain"}):(0,J.jsxs)("div",{className:"text-center p-10",children:[(0,J.jsx)(aa,{icon:"warning",size:48,color:"#FF3B30",className:"mx-auto mb-4"}),(0,J.jsx)("p",{className:"sketch-body text-white",children:"Laden fehlgeschlagen"})]})}),(0,J.jsxs)("div",{className:"p-6 flex items-center justify-around bg-black/40 backdrop-blur-md",children:[(0,J.jsxs)("button",{className:"flex flex-col items-center gap-1 text-white/70",onClick:()=>{let a=O.find(a=>a.id===r);a&&S(a)},disabled:z,children:[z?(0,J.jsx)(T.Loader2,{className:"w-6 h-6 animate-spin"}):(0,J.jsx)(de.Download,{className:"w-6 h-6"}),(0,J.jsx)("span",{className:"sketch-body text-[10px]",children:"Speichern"})]}),(0,J.jsxs)("button",{className:"flex flex-col items-center gap-1 text-white/70",children:[(0,J.jsx)(dd,{className:"w-6 h-6"}),(0,J.jsx)("span",{className:"sketch-body text-[10px]",children:"Exportieren"})]}),(0,J.jsxs)("button",{className:"flex flex-col items-center gap-1 text-[#FF3B30]",children:[(0,J.jsx)(db,{className:"w-6 h-6"}),(0,J.jsx)("span",{className:"sketch-body text-[10px]",children:"LÃ¶schen"})]})]})]}),(0,J.jsx)("input",{ref:C,type:"file",multiple:!0,accept:"image/*",onChange:a=>{Array.from(a.target.files||[]).forEach(a=>F(a))},className:"hidden"}),G&&(0,J.jsx)("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[60] flex items-center justify-center p-6",children:(0,J.jsxs)($,{className:"bg-white w-full max-w-[280px] p-6 flex flex-col items-center",children:[(0,J.jsx)("div",{className:"w-16 h-16 rounded-full bg-[#2563EB]/10 flex items-center justify-center mb-4",children:(0,J.jsx)(T.Loader2,{className:"w-8 h-8 text-[#2563EB] animate-spin"})}),(0,J.jsx)("h3",{className:"sketch-subheading text-lg text-center mb-2",children:"Sicherung lÃ¤uft..."}),(0,J.jsx)("p",{className:"sketch-body text-sm text-[#6E6E73] text-center mb-4",children:H>0?`${H}% hochgeladen`:"Vorbereiten..."}),(0,J.jsx)("div",{className:"w-full bg-[#E5E7EB] h-2 rounded-full overflow-hidden",children:(0,J.jsx)("div",{className:"bg-[#2563EB] h-full transition-all duration-300",style:{width:`${H}%`}})})]})})]})}let dg={isOnboarded:!1,backupActive:!1,selectedPlan:"free",autoBackupEnabled:!0,backgroundBackupEnabled:!1,photosCount:0,lastBackup:"Noch nie",permanence:0,encryptionKey:"",backupPhrase:[],devices:[],photoSource:"photos-app"};function dh(){let[a,b]=(0,K.useState)(dg),[c,d]=(0,K.useState)("gallery"),[e,f]=(0,K.useState)("loading"),[g,h]=(0,K.useState)(null),{data:i,isPending:j}=(0,Y.useSession)(),k=(0,K.useRef)(!1),l=(0,K.useCallback)(async(a,b)=>{if(k.current)return void console.log("[Device] Already registered this session, skipping");try{let c=(0,b8.getDeviceId)(),d=(0,b8.getDeviceName)(),e=(0,b8.getDeviceType)();await b6(c,d,e,a,b),k.current=!0,console.log("[Device] Registered successfully:",c)}catch(a){console.error("[Device] Registration failed:",a)}},[]);(0,K.useEffect)(()=>{(async()=>{if(j)return;if(!i?.user)return f("auth");let a=i.user,c=null;try{let a=await fetch("/api/auth/get-vault-key-hash");a.ok&&(c=(await a.json()).vaultKeyHash)}catch(a){console.error("Failed to fetch vault_key_hash:",a)}h({id:a.id,email:a.email,vaultKeyHash:c});let d=(0,ag.loadKeyFromStorage)();if(d){let e=await (0,ag.getUserKeyHash)(d);if(c&&e!==c){console.warn("Local key doesn't match account's vault_key_hash"),(0,ag.clearKeyFromStorage)(),f("unlock");return}await l(e,a.id),b(a=>({...a,isOnboarded:!0})),f("main")}else c?f("unlock"):f("setup")})()},[i,j,l]);let m=(0,K.useCallback)(async a=>{let c=a.vaultKeyHash;try{let a=await fetch("/api/auth/get-vault-key-hash");a.ok&&(c=(await a.json()).vaultKeyHash)}catch(a){console.error("Failed to fetch vault_key_hash:",a)}h({...a,vaultKeyHash:c});let d=(0,ag.loadKeyFromStorage)();if(d){let e=await (0,ag.getUserKeyHash)(d);c&&e!==c?((0,ag.clearKeyFromStorage)(),f("unlock")):(await l(e,a.id),b(a=>({...a,isOnboarded:!0})),f("main"))}else c?f("unlock"):f("setup")},[l]),n=(0,K.useCallback)(async(a,c)=>{g&&(g.vaultKeyHash||(await di(g.id,c),h({...g,vaultKeyHash:c})),await l(c,g.id),b(a=>({...a,isOnboarded:!0})),f("main"))},[g,l]),o=(0,K.useCallback)(async a=>{g&&(await di(g.id,a),h({...g,vaultKeyHash:a}),await l(a,g.id),b(a=>({...a,isOnboarded:!0})),f("main"))},[g,l]),p=(0,K.useCallback)(async()=>{await (0,Y.signOut)(),(0,ag.clearKeyFromStorage)(),h(null),b(dg),f("auth")},[]);return"loading"===e||j?(0,J.jsx)(N,{}):"auth"===e?(0,J.jsx)("div",{className:"min-h-screen ios-bg-gray",children:(0,J.jsx)("div",{className:"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7]",children:(0,J.jsx)(ad,{onSuccess:m})})}):"unlock"===e&&g?(0,J.jsx)("div",{className:"min-h-screen ios-bg-gray",children:(0,J.jsx)("div",{className:"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7]",children:(0,J.jsx)(ah,{userEmail:g.email,expectedKeyHash:g.vaultKeyHash,onUnlock:n,onCreateNewVault:()=>f("setup"),onLogout:p})})}):"setup"===e&&g?(0,J.jsx)("div",{className:"min-h-screen ios-bg-gray",children:(0,J.jsx)("div",{className:"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7]",children:(0,J.jsx)(aj,{userId:g.id,onComplete:o,onBack:()=>f("unlock")})})}):(0,J.jsx)("div",{className:"min-h-screen ios-bg-gray",children:(0,J.jsxs)("div",{className:"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7] flex flex-col relative",children:[(0,J.jsxs)("div",{className:"flex-1 overflow-hidden pb-[80px]",children:["gallery"===c&&(0,J.jsx)(df,{photosCount:a.photosCount,authUser:g}),"settings"===c&&(0,J.jsx)(cG,{state:a,setState:b,onRestartOnboarding:p,authUser:g})]}),(0,J.jsx)(dj,{currentScreen:c,onNavigate:a=>{d(a)}})]})})}async function di(a,b){try{if(!(await fetch("/api/auth/update-vault-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:a,keyHash:b})})).ok)throw Error("Failed to update vault key hash")}catch(a){throw console.error("Failed to update vault_key_hash:",a),a}}function dj({currentScreen:a,onNavigate:b}){return(0,J.jsxs)("nav",{className:"fixed bottom-0 left-0 right-0 h-[85px] bg-[#FAFBFC]/90 backdrop-blur-xl border-t-2 border-[#2563EB]/10 flex items-start justify-around pt-3 pb-7 max-w-[1200px] mx-auto z-40",children:[(0,J.jsxs)("button",{onClick:()=>b("gallery"),className:"flex flex-col items-center gap-1 px-8 transition-transform active:scale-95",children:[(0,J.jsx)(aa,{icon:"photo",size:28,color:"gallery"===a?"#2563EB":"#9CA3AF"}),(0,J.jsx)("span",{className:`sketch-subheading text-[12px] ${"gallery"===a?"text-[#2563EB]":"text-[#9CA3AF]"}`,children:"Galerie"})]}),(0,J.jsxs)("button",{onClick:()=>b("settings"),className:"flex flex-col items-center gap-1 px-8 transition-transform active:scale-95",children:[(0,J.jsx)(aa,{icon:"folder",size:28,color:"settings"===a?"#2563EB":"#9CA3AF"}),(0,J.jsx)("span",{className:`sketch-subheading text-[12px] ${"settings"===a?"text-[#2563EB]":"text-[#9CA3AF]"}`,children:"Optionen"})]})]})}a.s(["PhotoVaultApp",()=>dh],23605)}];

//# sourceMappingURL=_6ec9cefd._.js.map