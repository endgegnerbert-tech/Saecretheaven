(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16015,(e,t,s)=>{},98547,(e,t,s)=>{var r=e.i(47167);e.r(16015);var i=e.r(71645),n=i&&"object"==typeof i&&"default"in i?i:{default:i},a=void 0!==r.default&&r.default.env&&!0,o=function(e){return"[object String]"===Object.prototype.toString.call(e)},l=function(){function e(e){var t=void 0===e?{}:e,s=t.name,r=void 0===s?"stylesheet":s,i=t.optimizeForSpeed,n=void 0===i?a:i;c(o(r),"`name` must be a string"),this._name=r,this._deletedRulePlaceholder="#"+r+"-deleted-rule____{}",c("boolean"==typeof n,"`optimizeForSpeed` must be a boolean"),this._optimizeForSpeed=n,this._serverSheet=void 0,this._tags=[],this._injected=!1,this._rulesCount=0;var l="u">typeof window&&document.querySelector('meta[property="csp-nonce"]');this._nonce=l?l.getAttribute("content"):null}var t,s=e.prototype;return s.setOptimizeForSpeed=function(e){c("boolean"==typeof e,"`setOptimizeForSpeed` accepts a boolean"),c(0===this._rulesCount,"optimizeForSpeed cannot be when rules have already been inserted"),this.flush(),this._optimizeForSpeed=e,this.inject()},s.isOptimizeForSpeed=function(){return this._optimizeForSpeed},s.inject=function(){var e=this;if(c(!this._injected,"sheet already injected"),this._injected=!0,"u">typeof window&&this._optimizeForSpeed){this._tags[0]=this.makeStyleTag(this._name),this._optimizeForSpeed="insertRule"in this.getSheet(),this._optimizeForSpeed||(a||console.warn("StyleSheet: optimizeForSpeed mode not supported falling back to standard mode."),this.flush(),this._injected=!0);return}this._serverSheet={cssRules:[],insertRule:function(t,s){return"number"==typeof s?e._serverSheet.cssRules[s]={cssText:t}:e._serverSheet.cssRules.push({cssText:t}),s},deleteRule:function(t){e._serverSheet.cssRules[t]=null}}},s.getSheetForTag=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]},s.getSheet=function(){return this.getSheetForTag(this._tags[this._tags.length-1])},s.insertRule=function(e,t){if(c(o(e),"`insertRule` accepts only strings"),"u"<typeof window)return"number"!=typeof t&&(t=this._serverSheet.cssRules.length),this._serverSheet.insertRule(e,t),this._rulesCount++;if(this._optimizeForSpeed){var s=this.getSheet();"number"!=typeof t&&(t=s.cssRules.length);try{s.insertRule(e,t)}catch(t){return a||console.warn("StyleSheet: illegal rule: \n\n"+e+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),-1}}else{var r=this._tags[t];this._tags.push(this.makeStyleTag(this._name,e,r))}return this._rulesCount++},s.replaceRule=function(e,t){if(this._optimizeForSpeed||"u"<typeof window){var s="u">typeof window?this.getSheet():this._serverSheet;if(t.trim()||(t=this._deletedRulePlaceholder),!s.cssRules[e])return e;s.deleteRule(e);try{s.insertRule(t,e)}catch(r){a||console.warn("StyleSheet: illegal rule: \n\n"+t+"\n\nSee https://stackoverflow.com/q/20007992 for more info"),s.insertRule(this._deletedRulePlaceholder,e)}}else{var r=this._tags[e];c(r,"old rule at index `"+e+"` not found"),r.textContent=t}return e},s.deleteRule=function(e){if("u"<typeof window)return void this._serverSheet.deleteRule(e);if(this._optimizeForSpeed)this.replaceRule(e,"");else{var t=this._tags[e];c(t,"rule at index `"+e+"` not found"),t.parentNode.removeChild(t),this._tags[e]=null}},s.flush=function(){this._injected=!1,this._rulesCount=0,"u">typeof window?(this._tags.forEach(function(e){return e&&e.parentNode.removeChild(e)}),this._tags=[]):this._serverSheet.cssRules=[]},s.cssRules=function(){var e=this;return"u"<typeof window?this._serverSheet.cssRules:this._tags.reduce(function(t,s){return s?t=t.concat(Array.prototype.map.call(e.getSheetForTag(s).cssRules,function(t){return t.cssText===e._deletedRulePlaceholder?null:t})):t.push(null),t},[])},s.makeStyleTag=function(e,t,s){t&&c(o(t),"makeStyleTag accepts only strings as second parameter");var r=document.createElement("style");this._nonce&&r.setAttribute("nonce",this._nonce),r.type="text/css",r.setAttribute("data-"+e,""),t&&r.appendChild(document.createTextNode(t));var i=document.head||document.getElementsByTagName("head")[0];return s?i.insertBefore(r,s):i.appendChild(r),r},t=[{key:"length",get:function(){return this._rulesCount}}],function(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(e.prototype,t),e}();function c(e,t){if(!e)throw Error("StyleSheet: "+t+".")}var h=function(e){for(var t=5381,s=e.length;s;)t=33*t^e.charCodeAt(--s);return t>>>0},u={};function d(e,t){if(!t)return"jsx-"+e;var s=String(t),r=e+s;return u[r]||(u[r]="jsx-"+h(e+"-"+s)),u[r]}function p(e,t){"u"<typeof window&&(t=t.replace(/\/style/gi,"\\/style"));var s=e+t;return u[s]||(u[s]=t.replace(/__jsx-style-dynamic-selector/g,e)),u[s]}var f=function(){function e(e){var t=void 0===e?{}:e,s=t.styleSheet,r=void 0===s?null:s,i=t.optimizeForSpeed,n=void 0!==i&&i;this._sheet=r||new l({name:"styled-jsx",optimizeForSpeed:n}),this._sheet.inject(),r&&"boolean"==typeof n&&(this._sheet.setOptimizeForSpeed(n),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),this._fromServer=void 0,this._indices={},this._instancesCounts={}}var t=e.prototype;return t.add=function(e){var t=this;void 0===this._optimizeForSpeed&&(this._optimizeForSpeed=Array.isArray(e.children),this._sheet.setOptimizeForSpeed(this._optimizeForSpeed),this._optimizeForSpeed=this._sheet.isOptimizeForSpeed()),"u">typeof window&&!this._fromServer&&(this._fromServer=this.selectFromServer(),this._instancesCounts=Object.keys(this._fromServer).reduce(function(e,t){return e[t]=0,e},{}));var s=this.getIdAndRules(e),r=s.styleId,i=s.rules;if(r in this._instancesCounts){this._instancesCounts[r]+=1;return}var n=i.map(function(e){return t._sheet.insertRule(e)}).filter(function(e){return -1!==e});this._indices[r]=n,this._instancesCounts[r]=1},t.remove=function(e){var t=this,s=this.getIdAndRules(e).styleId;if(function(e,t){if(!e)throw Error("StyleSheetRegistry: "+t+".")}(s in this._instancesCounts,"styleId: `"+s+"` not found"),this._instancesCounts[s]-=1,this._instancesCounts[s]<1){var r=this._fromServer&&this._fromServer[s];r?(r.parentNode.removeChild(r),delete this._fromServer[s]):(this._indices[s].forEach(function(e){return t._sheet.deleteRule(e)}),delete this._indices[s]),delete this._instancesCounts[s]}},t.update=function(e,t){this.add(t),this.remove(e)},t.flush=function(){this._sheet.flush(),this._sheet.inject(),this._fromServer=void 0,this._indices={},this._instancesCounts={}},t.cssRules=function(){var e=this,t=this._fromServer?Object.keys(this._fromServer).map(function(t){return[t,e._fromServer[t]]}):[],s=this._sheet.cssRules();return t.concat(Object.keys(this._indices).map(function(t){return[t,e._indices[t].map(function(e){return s[e].cssText}).join(e._optimizeForSpeed?"":"\n")]}).filter(function(e){return!!e[1]}))},t.styles=function(e){var t,s;return t=this.cssRules(),void 0===(s=e)&&(s={}),t.map(function(e){var t=e[0],r=e[1];return n.default.createElement("style",{id:"__"+t,key:"__"+t,nonce:s.nonce?s.nonce:void 0,dangerouslySetInnerHTML:{__html:r}})})},t.getIdAndRules=function(e){var t=e.children,s=e.dynamic,r=e.id;if(s){var i=d(r,s);return{styleId:i,rules:Array.isArray(t)?t.map(function(e){return p(i,e)}):[p(i,t)]}}return{styleId:d(r),rules:Array.isArray(t)?t:[t]}},t.selectFromServer=function(){return Array.prototype.slice.call(document.querySelectorAll('[id^="__jsx-"]')).reduce(function(e,t){return e[t.id.slice(2)]=t,e},{})},e}(),m=i.createContext(null);function g(){return new f}function y(){return i.useContext(m)}m.displayName="StyleSheetContext";var b=n.default.useInsertionEffect||n.default.useLayoutEffect,x="u">typeof window?g():void 0;function v(e){var t=x||y();return t&&("u"<typeof window?t.add(e):b(function(){return t.add(e),function(){t.remove(e)}},[e.id,String(e.dynamic)])),null}v.dynamic=function(e){return e.map(function(e){return d(e[0],e[1])}).join(" ")},s.StyleRegistry=function(e){var t=e.registry,s=e.children,r=i.useContext(m),a=i.useState(function(){return r||t||g()})[0];return n.default.createElement(m.Provider,{value:a},s)},s.createStyleRegistry=g,s.style=v,s.useStyleRegistry=y},37902,(e,t,s)=>{t.exports=e.r(98547).style},67423,(e,t,s)=>{"use strict";function r({widthInt:e,heightInt:t,blurWidth:s,blurHeight:r,blurDataURL:i,objectFit:n}){let a=s?40*s:e,o=r?40*r:t,l=a&&o?`viewBox='0 0 ${a} ${o}'`:"";return`%3Csvg xmlns='http://www.w3.org/2000/svg' ${l}%3E%3Cfilter id='b' color-interpolation-filters='sRGB'%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3CfeColorMatrix values='1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1' result='s'/%3E%3CfeFlood x='0' y='0' width='100%25' height='100%25'/%3E%3CfeComposite operator='out' in='s'/%3E%3CfeComposite in2='SourceGraphic'/%3E%3CfeGaussianBlur stdDeviation='20'/%3E%3C/filter%3E%3Cimage width='100%25' height='100%25' x='0' y='0' preserveAspectRatio='${l?"none":"contain"===n?"xMidYMid":"cover"===n?"xMidYMid slice":"none"}' style='filter: url(%23b);' href='${i}'/%3E%3C/svg%3E`}Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"getImageBlurSvg",{enumerable:!0,get:function(){return r}})},87690,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r={VALID_LOADERS:function(){return n},imageConfigDefault:function(){return a}};for(var i in r)Object.defineProperty(s,i,{enumerable:!0,get:r[i]});let n=["default","imgix","cloudinary","akamai","custom"],a={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],path:"/_next/image",loader:"default",loaderFile:"",domains:[],disableStaticImages:!1,minimumCacheTTL:14400,formats:["image/webp"],maximumRedirects:3,dangerouslyAllowLocalIP:!1,dangerouslyAllowSVG:!1,contentSecurityPolicy:"script-src 'none'; frame-src 'none'; sandbox;",contentDispositionType:"attachment",localPatterns:void 0,remotePatterns:[],qualities:[75],unoptimized:!1}},8927,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"getImgProps",{enumerable:!0,get:function(){return c}}),e.r(33525);let r=e.r(43369),i=e.r(67423),n=e.r(87690),a=["-moz-initial","fill","none","scale-down",void 0];function o(e){return void 0!==e.default}function l(e){return void 0===e?e:"number"==typeof e?Number.isFinite(e)?e:NaN:"string"==typeof e&&/^[0-9]+$/.test(e)?parseInt(e,10):NaN}function c({src:e,sizes:t,unoptimized:s=!1,priority:c=!1,preload:h=!1,loading:u,className:d,quality:p,width:f,height:m,fill:g=!1,style:y,overrideSrc:b,onLoad:x,onLoadingComplete:v,placeholder:w="empty",blurDataURL:_,fetchPriority:k,decoding:j="async",layout:S,objectFit:E,objectPosition:N,lazyBoundary:C,lazyRoot:R,...P},T){var O;let $,F,A,{imgConf:I,showAltText:M,blurComplete:D,defaultLoader:L}=T,B=I||n.imageConfigDefault;if("allSizes"in B)$=B;else{let e=[...B.deviceSizes,...B.imageSizes].sort((e,t)=>e-t),t=B.deviceSizes.sort((e,t)=>e-t),s=B.qualities?.sort((e,t)=>e-t);$={...B,allSizes:e,deviceSizes:t,qualities:s}}if(void 0===L)throw Object.defineProperty(Error("images.loaderFile detected but the file is missing default export.\nRead more: https://nextjs.org/docs/messages/invalid-images-config"),"__NEXT_ERROR_CODE",{value:"E163",enumerable:!1,configurable:!0});let z=P.loader||L;delete P.loader,delete P.srcSet;let U="__next_img_default"in z;if(U){if("custom"===$.loader)throw Object.defineProperty(Error(`Image with src "${e}" is missing "loader" prop.
Read more: https://nextjs.org/docs/messages/next-image-missing-loader`),"__NEXT_ERROR_CODE",{value:"E252",enumerable:!1,configurable:!0})}else{let e=z;z=t=>{let{config:s,...r}=t;return e(r)}}if(S){"fill"===S&&(g=!0);let e={intrinsic:{maxWidth:"100%",height:"auto"},responsive:{width:"100%",height:"auto"}}[S];e&&(y={...y,...e});let s={responsive:"100vw",fill:"100vw"}[S];s&&!t&&(t=s)}let Q="",W=l(f),H=l(m);if((O=e)&&"object"==typeof O&&(o(O)||void 0!==O.src)){let t=o(e)?e.default:e;if(!t.src)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include src. Received ${JSON.stringify(t)}`),"__NEXT_ERROR_CODE",{value:"E460",enumerable:!1,configurable:!0});if(!t.height||!t.width)throw Object.defineProperty(Error(`An object should only be passed to the image component src parameter if it comes from a static image import. It must include height and width. Received ${JSON.stringify(t)}`),"__NEXT_ERROR_CODE",{value:"E48",enumerable:!1,configurable:!0});if(F=t.blurWidth,A=t.blurHeight,_=_||t.blurDataURL,Q=t.src,!g)if(W||H){if(W&&!H){let e=W/t.width;H=Math.round(t.height*e)}else if(!W&&H){let e=H/t.height;W=Math.round(t.width*e)}}else W=t.width,H=t.height}let q=!c&&!h&&("lazy"===u||void 0===u);(!(e="string"==typeof e?e:Q)||e.startsWith("data:")||e.startsWith("blob:"))&&(s=!0,q=!1),$.unoptimized&&(s=!0),U&&!$.dangerouslyAllowSVG&&e.split("?",1)[0].endsWith(".svg")&&(s=!0);let K=l(p),G=Object.assign(g?{position:"absolute",height:"100%",width:"100%",left:0,top:0,right:0,bottom:0,objectFit:E,objectPosition:N}:{},M?{}:{color:"transparent"},y),J=D||"empty"===w?null:"blur"===w?`url("data:image/svg+xml;charset=utf-8,${(0,i.getImageBlurSvg)({widthInt:W,heightInt:H,blurWidth:F,blurHeight:A,blurDataURL:_||"",objectFit:G.objectFit})}")`:`url("${w}")`,V=a.includes(G.objectFit)?"fill"===G.objectFit?"100% 100%":"cover":G.objectFit,Z=J?{backgroundSize:V,backgroundPosition:G.objectPosition||"50% 50%",backgroundRepeat:"no-repeat",backgroundImage:J}:{},X=function({config:e,src:t,unoptimized:s,width:i,quality:n,sizes:a,loader:o}){if(s){let e=(0,r.getDeploymentId)();if(t.startsWith("/")&&!t.startsWith("//")&&e){let s=t.includes("?")?"&":"?";t=`${t}${s}dpl=${e}`}return{src:t,srcSet:void 0,sizes:void 0}}let{widths:l,kind:c}=function({deviceSizes:e,allSizes:t},s,r){if(r){let s=/(^|\s)(1?\d?\d)vw/g,i=[];for(let e;e=s.exec(r);)i.push(parseInt(e[2]));if(i.length){let s=.01*Math.min(...i);return{widths:t.filter(t=>t>=e[0]*s),kind:"w"}}return{widths:t,kind:"w"}}return"number"!=typeof s?{widths:e,kind:"w"}:{widths:[...new Set([s,2*s].map(e=>t.find(t=>t>=e)||t[t.length-1]))],kind:"x"}}(e,i,a),h=l.length-1;return{sizes:a||"w"!==c?a:"100vw",srcSet:l.map((s,r)=>`${o({config:e,src:t,quality:n,width:s})} ${"w"===c?s:r+1}${c}`).join(", "),src:o({config:e,src:t,quality:n,width:l[h]})}}({config:$,src:e,unoptimized:s,width:W,quality:K,sizes:t,loader:z}),Y=q?"lazy":u;return{props:{...P,loading:Y,fetchPriority:k,width:W,height:H,decoding:j,className:d,style:{...G,...Z},sizes:X.sizes,srcSet:X.srcSet,src:b||X.src},meta:{unoptimized:s,preload:h||c,placeholder:w,fill:g}}}},98879,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return o}});let r=e.r(71645),i="u"<typeof window,n=i?()=>{}:r.useLayoutEffect,a=i?()=>{}:r.useEffect;function o(e){let{headManager:t,reduceComponentsToState:s}=e;function o(){if(t&&t.mountedInstances){let e=r.Children.toArray(Array.from(t.mountedInstances).filter(Boolean));t.updateHead(s(e))}}return i&&(t?.mountedInstances?.add(e.children),o()),n(()=>(t?.mountedInstances?.add(e.children),()=>{t?.mountedInstances?.delete(e.children)})),n(()=>(t&&(t._pendingUpdate=o),()=>{t&&(t._pendingUpdate=o)})),a(()=>(t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null),()=>{t&&t._pendingUpdate&&(t._pendingUpdate(),t._pendingUpdate=null)})),null}},25633,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r={default:function(){return m},defaultHead:function(){return u}};for(var i in r)Object.defineProperty(s,i,{enumerable:!0,get:r[i]});let n=e.r(55682),a=e.r(90809),o=e.r(43476),l=a._(e.r(71645)),c=n._(e.r(98879)),h=e.r(42732);function u(){return[(0,o.jsx)("meta",{charSet:"utf-8"},"charset"),(0,o.jsx)("meta",{name:"viewport",content:"width=device-width"},"viewport")]}function d(e,t){return"string"==typeof t||"number"==typeof t?e:t.type===l.default.Fragment?e.concat(l.default.Children.toArray(t.props.children).reduce((e,t)=>"string"==typeof t||"number"==typeof t?e:e.concat(t),[])):e.concat(t)}e.r(33525);let p=["name","httpEquiv","charSet","itemProp"];function f(e){let t,s,r,i;return e.reduce(d,[]).reverse().concat(u().reverse()).filter((t=new Set,s=new Set,r=new Set,i={},e=>{let n=!0,a=!1;if(e.key&&"number"!=typeof e.key&&e.key.indexOf("$")>0){a=!0;let s=e.key.slice(e.key.indexOf("$")+1);t.has(s)?n=!1:t.add(s)}switch(e.type){case"title":case"base":s.has(e.type)?n=!1:s.add(e.type);break;case"meta":for(let t=0,s=p.length;t<s;t++){let s=p[t];if(e.props.hasOwnProperty(s))if("charSet"===s)r.has(s)?n=!1:r.add(s);else{let t=e.props[s],r=i[s]||new Set;("name"!==s||!a)&&r.has(t)?n=!1:(r.add(t),i[s]=r)}}}return n})).reverse().map((e,t)=>{let s=e.key||t;return l.default.cloneElement(e,{key:s})})}let m=function({children:e}){let t=(0,l.useContext)(h.HeadManagerContext);return(0,o.jsx)(c.default,{reduceComponentsToState:f,headManager:t,children:e})};("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),t.exports=s.default)},18556,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"ImageConfigContext",{enumerable:!0,get:function(){return n}});let r=e.r(55682)._(e.r(71645)),i=e.r(87690),n=r.default.createContext(i.imageConfigDefault)},65856,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"RouterContext",{enumerable:!0,get:function(){return r}});let r=e.r(55682)._(e.r(71645)).default.createContext(null)},70965,(e,t,s)=>{"use strict";function r(e,t){let s=e||75;return t?.qualities?.length?t.qualities.reduce((e,t)=>Math.abs(t-s)<Math.abs(e-s)?t:e,0):s}Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"findClosestQuality",{enumerable:!0,get:function(){return r}})},1948,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"default",{enumerable:!0,get:function(){return a}});let r=e.r(70965),i=e.r(43369);function n({config:e,src:t,width:s,quality:n}){if(t.startsWith("/")&&t.includes("?")&&e.localPatterns?.length===1&&"**"===e.localPatterns[0].pathname&&""===e.localPatterns[0].search)throw Object.defineProperty(Error(`Image with src "${t}" is using a query string which is not configured in images.localPatterns.
Read more: https://nextjs.org/docs/messages/next-image-unconfigured-localpatterns`),"__NEXT_ERROR_CODE",{value:"E871",enumerable:!1,configurable:!0});let a=(0,r.findClosestQuality)(n,e),o=(0,i.getDeploymentId)();return`${e.path}?url=${encodeURIComponent(t)}&w=${s}&q=${a}${t.startsWith("/")&&o?`&dpl=${o}`:""}`}n.__next_img_default=!0;let a=n},18581,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"useMergedRef",{enumerable:!0,get:function(){return i}});let r=e.r(71645);function i(e,t){let s=(0,r.useRef)(null),i=(0,r.useRef)(null);return(0,r.useCallback)(r=>{if(null===r){let e=s.current;e&&(s.current=null,e());let t=i.current;t&&(i.current=null,t())}else e&&(s.current=n(e,r)),t&&(i.current=n(t,r))},[e,t])}function n(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let s=e(t);return"function"==typeof s?s:()=>e(null)}}("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),t.exports=s.default)},85437,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),Object.defineProperty(s,"Image",{enumerable:!0,get:function(){return v}});let r=e.r(55682),i=e.r(90809),n=e.r(43476),a=i._(e.r(71645)),o=r._(e.r(74080)),l=r._(e.r(25633)),c=e.r(8927),h=e.r(87690),u=e.r(18556);e.r(33525);let d=e.r(65856),p=r._(e.r(1948)),f=e.r(18581),m={deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1};function g(e,t,s,r,i,n,a){let o=e?.src;e&&e["data-loaded-src"]!==o&&(e["data-loaded-src"]=o,("decode"in e?e.decode():Promise.resolve()).catch(()=>{}).then(()=>{if(e.parentElement&&e.isConnected){if("empty"!==t&&i(!0),s?.current){let t=new Event("load");Object.defineProperty(t,"target",{writable:!1,value:e});let r=!1,i=!1;s.current({...t,nativeEvent:t,currentTarget:e,target:e,isDefaultPrevented:()=>r,isPropagationStopped:()=>i,persist:()=>{},preventDefault:()=>{r=!0,t.preventDefault()},stopPropagation:()=>{i=!0,t.stopPropagation()}})}r?.current&&r.current(e)}}))}function y(e){return a.use?{fetchPriority:e}:{fetchpriority:e}}"u"<typeof window&&(globalThis.__NEXT_IMAGE_IMPORTED=!0);let b=(0,a.forwardRef)(({src:e,srcSet:t,sizes:s,height:r,width:i,decoding:o,className:l,style:c,fetchPriority:h,placeholder:u,loading:d,unoptimized:p,fill:m,onLoadRef:b,onLoadingCompleteRef:x,setBlurComplete:v,setShowAltText:w,sizesInput:_,onLoad:k,onError:j,...S},E)=>{let N=(0,a.useCallback)(e=>{e&&(j&&(e.src=e.src),e.complete&&g(e,u,b,x,v,p,_))},[e,u,b,x,v,j,p,_]),C=(0,f.useMergedRef)(E,N);return(0,n.jsx)("img",{...S,...y(h),loading:d,width:i,height:r,decoding:o,"data-nimg":m?"fill":"1",className:l,style:c,sizes:s,srcSet:t,src:e,ref:C,onLoad:e=>{g(e.currentTarget,u,b,x,v,p,_)},onError:e=>{w(!0),"empty"!==u&&v(!0),j&&j(e)}})});function x({isAppRouter:e,imgAttributes:t}){let s={as:"image",imageSrcSet:t.srcSet,imageSizes:t.sizes,crossOrigin:t.crossOrigin,referrerPolicy:t.referrerPolicy,...y(t.fetchPriority)};return e&&o.default.preload?(o.default.preload(t.src,s),null):(0,n.jsx)(l.default,{children:(0,n.jsx)("link",{rel:"preload",href:t.srcSet?void 0:t.src,...s},"__nimg-"+t.src+t.srcSet+t.sizes)})}let v=(0,a.forwardRef)((e,t)=>{let s=(0,a.useContext)(d.RouterContext),r=(0,a.useContext)(u.ImageConfigContext),i=(0,a.useMemo)(()=>{let e=m||r||h.imageConfigDefault,t=[...e.deviceSizes,...e.imageSizes].sort((e,t)=>e-t),s=e.deviceSizes.sort((e,t)=>e-t),i=e.qualities?.sort((e,t)=>e-t);return{...e,allSizes:t,deviceSizes:s,qualities:i,localPatterns:"u"<typeof window?r?.localPatterns:e.localPatterns}},[r]),{onLoad:o,onLoadingComplete:l}=e,f=(0,a.useRef)(o);(0,a.useEffect)(()=>{f.current=o},[o]);let g=(0,a.useRef)(l);(0,a.useEffect)(()=>{g.current=l},[l]);let[y,v]=(0,a.useState)(!1),[w,_]=(0,a.useState)(!1),{props:k,meta:j}=(0,c.getImgProps)(e,{defaultLoader:p.default,imgConf:i,blurComplete:y,showAltText:w});return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(b,{...k,unoptimized:j.unoptimized,placeholder:j.placeholder,fill:j.fill,onLoadRef:f,onLoadingCompleteRef:g,setBlurComplete:v,setShowAltText:_,sizesInput:e.sizes,ref:t}),j.preload?(0,n.jsx)(x,{isAppRouter:!s,imgAttributes:k}):null]})});("function"==typeof s.default||"object"==typeof s.default&&null!==s.default)&&void 0===s.default.__esModule&&(Object.defineProperty(s.default,"__esModule",{value:!0}),Object.assign(s.default,s),t.exports=s.default)},94909,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0});var r={default:function(){return h},getImageProps:function(){return c}};for(var i in r)Object.defineProperty(s,i,{enumerable:!0,get:r[i]});let n=e.r(55682),a=e.r(8927),o=e.r(85437),l=n._(e.r(1948));function c(e){let{props:t}=(0,a.getImgProps)(e,{defaultLoader:l.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[32,48,64,96,128,256,384],qualities:[75],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!1}});for(let[e,s]of Object.entries(t))void 0===s&&delete t[e];return{props:t}}let h=o.Image},57688,(e,t,s)=>{t.exports=e.r(94909)},54385,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.default=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}}},43173,(e,t,s)=>{"use strict";var r=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0});let i=r(e.r(6085)),n=r(e.r(54385));s.default=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:"u"<typeof fetch?this.fetch=i.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){void 0===this.schema||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),"GET"!==this.method&&"HEAD"!==this.method&&(this.headers["Content-Type"]="application/json");let s=(0,this.fetch)(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async e=>{var t,s,r;let i=null,a=null,o=null,l=e.status,c=e.statusText;if(e.ok){if("HEAD"!==this.method){let t=await e.text();""===t||(a="text/csv"===this.headers.Accept||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?t:JSON.parse(t))}let r=null==(t=this.headers.Prefer)?void 0:t.match(/count=(exact|planned|estimated)/),n=null==(s=e.headers.get("content-range"))?void 0:s.split("/");r&&n&&n.length>1&&(o=parseInt(n[1])),this.isMaybeSingle&&"GET"===this.method&&Array.isArray(a)&&(a.length>1?(i={code:"PGRST116",details:`Results contain ${a.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},a=null,o=null,l=406,c="Not Acceptable"):a=1===a.length?a[0]:null)}else{let t=await e.text();try{i=JSON.parse(t),Array.isArray(i)&&404===e.status&&(a=[],i=null,l=200,c="OK")}catch(s){404===e.status&&""===t?(l=204,c="No Content"):i={message:t}}if(i&&this.isMaybeSingle&&(null==(r=null==i?void 0:i.details)?void 0:r.includes("0 rows"))&&(i=null,l=200,c="OK"),i&&this.shouldThrowOnError)throw new n.default(i)}return{error:i,data:a,count:o,status:l,statusText:c}});return this.shouldThrowOnError||(s=s.catch(e=>{var t,s,r;return{error:{message:`${null!=(t=null==e?void 0:e.name)?t:"FetchError"}: ${null==e?void 0:e.message}`,details:`${null!=(s=null==e?void 0:e.stack)?s:""}`,hint:"",code:`${null!=(r=null==e?void 0:e.code)?r:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}}},82191,(e,t,s)=>{"use strict";var r=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0});let i=r(e.r(43173));class n extends i.default{select(e){let t=!1,s=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!t?"":('"'===e&&(t=!t),e)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:r,referencedTable:i=r}={}){let n=i?`${i}.order`:"order",a=this.url.searchParams.get(n);return this.url.searchParams.set(n,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${void 0===s?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){let r=void 0===s?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:r=s}={}){let i=void 0===r?"offset":`${r}.offset`,n=void 0===r?"limit":`${r}.limit`;return this.url.searchParams.set(i,`${e}`),this.url.searchParams.set(n,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return"GET"===this.method?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:r=!1,wal:i=!1,format:n="text"}={}){var a;let o=[e?"analyze":null,t?"verbose":null,s?"settings":null,r?"buffers":null,i?"wal":null].filter(Boolean).join("|"),l=null!=(a=this.headers.Accept)?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${n}; for="${l}"; options=${o};`,this}rollback(){var e;return(null!=(e=this.headers.Prefer)?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}s.default=n},14633,(e,t,s)=>{"use strict";var r=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0});let i=r(e.r(82191));class n extends i.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){let s=Array.from(new Set(t)).map(e=>"string"==typeof e&&RegExp("[,()]").test(e)?`"${e}"`:`${e}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return"string"==typeof t?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return"string"==typeof t?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:r}={}){let i="";"plain"===r?i="pl":"phrase"===r?i="ph":"websearch"===r&&(i="w");let n=void 0===s?"":`(${s})`;return this.url.searchParams.append(e,`${i}fts${n}.${t}`),this}match(e){return Object.entries(e).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){let r=s?`${s}.or`:"or";return this.url.searchParams.append(r,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}}s.default=n},38290,(e,t,s)=>{"use strict";var r=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0});let i=r(e.r(14633));s.default=class{constructor(e,{headers:t={},schema:s,fetch:r}){this.url=e,this.headers=t,this.schema=s,this.fetch=r}select(e,{head:t=!1,count:s}={}){let r=!1,n=(null!=e?e:"*").split("").map(e=>/\s/.test(e)&&!r?"":('"'===e&&(r=!r),e)).join("");return this.url.searchParams.set("select",n),s&&(this.headers.Prefer=`count=${s}`),new i.default({method:t?"HEAD":"GET",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){let r=[];if(this.headers.Prefer&&r.push(this.headers.Prefer),t&&r.push(`count=${t}`),s||r.push("missing=default"),this.headers.Prefer=r.join(","),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new i.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:r,defaultToNull:n=!0}={}){let a=[`resolution=${s?"ignore":"merge"}-duplicates`];if(void 0!==t&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),r&&a.push(`count=${r}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){let t=e.reduce((e,t)=>e.concat(Object.keys(t)),[]);if(t.length>0){let e=[...new Set(t)].map(e=>`"${e}"`);this.url.searchParams.set("columns",e.join(","))}}return new i.default({method:"POST",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){let s=[];return this.headers.Prefer&&s.push(this.headers.Prefer),t&&s.push(`count=${t}`),this.headers.Prefer=s.join(","),new i.default({method:"PATCH",url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){let t=[];return e&&t.push(`count=${e}`),this.headers.Prefer&&t.unshift(this.headers.Prefer),this.headers.Prefer=t.join(","),new i.default({method:"DELETE",url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}},98042,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.version=void 0,s.version="0.0.0-automated"},85511,(e,t,s)=>{"use strict";Object.defineProperty(s,"__esModule",{value:!0}),s.DEFAULT_HEADERS=void 0;let r=e.r(98042);s.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`}},2259,(e,t,s)=>{"use strict";var r=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0});let i=r(e.r(38290)),n=r(e.r(14633)),a=e.r(85511);class o{constructor(e,{headers:t={},schema:s,fetch:r}={}){this.url=e,this.headers=Object.assign(Object.assign({},a.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=r}from(e){let t=new URL(`${this.url}/${e}`);return new i.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new o(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:r=!1,count:i}={}){let a,o,l=new URL(`${this.url}/rpc/${e}`);s||r?(a=s?"HEAD":"GET",Object.entries(t).filter(([e,t])=>void 0!==t).map(([e,t])=>[e,Array.isArray(t)?`{${t.join(",")}}`:`${t}`]).forEach(([e,t])=>{l.searchParams.append(e,t)})):(a="POST",o=t);let c=Object.assign({},this.headers);return i&&(c.Prefer=`count=${i}`),new n.default({method:a,url:l,headers:c,schema:this.schemaName,body:o,fetch:this.fetch,allowEmpty:!1})}}s.default=o},82215,(e,t,s)=>{"use strict";var r=e.e&&e.e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(s,"__esModule",{value:!0}),s.PostgrestError=s.PostgrestBuilder=s.PostgrestTransformBuilder=s.PostgrestFilterBuilder=s.PostgrestQueryBuilder=s.PostgrestClient=void 0;let i=r(e.r(2259));s.PostgrestClient=i.default;let n=r(e.r(38290));s.PostgrestQueryBuilder=n.default;let a=r(e.r(14633));s.PostgrestFilterBuilder=a.default;let o=r(e.r(82191));s.PostgrestTransformBuilder=o.default;let l=r(e.r(43173));s.PostgrestBuilder=l.default;let c=r(e.r(54385));s.PostgrestError=c.default,s.default={PostgrestClient:i.default,PostgrestQueryBuilder:n.default,PostgrestFilterBuilder:a.default,PostgrestTransformBuilder:o.default,PostgrestBuilder:l.default,PostgrestError:c.default}},71058,e=>{"use strict";let t,s,r,i,n,a,o;var l,c,h,u,d,p,f,m,g,y,b,x,v,w,_,k,j,S,E,N,C,R,P,T,O,$,F,A=e.i(43476),I=e.i(71645),M=e.i(75254);let D=(0,M.default)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]),L=()=>(0,A.jsxs)("div",{className:"loader-container",children:[(0,A.jsx)("div",{className:"peeking-photo-icon",children:(0,A.jsx)(D,{strokeWidth:1.5})}),(0,A.jsxs)("div",{className:"shield-container",children:[Array.from({length:150}).map((e,t)=>(0,A.jsx)("div",{className:"particle",style:{animationDelay:`${t%10*.1+.02*Math.floor(t/10)}s`}},t)),(0,A.jsxs)("div",{className:"shield-structure",children:[(0,A.jsx)("div",{className:"structure-line line-1"}),(0,A.jsx)("div",{className:"structure-line line-2"}),(0,A.jsx)("div",{className:"structure-line line-3"}),(0,A.jsx)("div",{className:"structure-line line-4"})]})]}),(0,A.jsx)("div",{className:"loading-text",children:"LÃ„DT..."})]});var B=e.i(37902);let z=(0,M.default)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var U=e.i(70756),Q=e.i(86536);let W=(0,M.default)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var H=e.i(31278),q=e.i(57688),K=e.i(75157);let G={key:"/key.svg",lock:"/lock.svg",shield:"/shield.svg",upload:"/upload.svg",smartphone:"/smartphone.svg",cloud:"/cloud.svg",clock:"/clock.svg",search:"/search.svg",image:"/image.svg",folder:"/Openfolder.svg",refresh:"/RefreshCw.svg",chevronRight:"/ChevronRight.svg"};function J({name:e,className:t,size:s=24}){return(0,A.jsx)("div",{className:(0,K.cn)("relative inline-block shrink-0",t),style:{width:s,height:s},children:(0,A.jsx)(q.default,{src:G[e],alt:e,fill:!0,className:"object-contain",unoptimized:!0})})}var V=e.i(78938),Z=e.i(37218);function X({children:e,className:t="",onClick:s,variant:r="default"}){let i=(0,I.useMemo)(()=>Array.from({length:12},()=>(Math.random()-.5)*6),[]),n={default:{fill:"#FFFFFF",stroke:"#2563EB",strokeWidth:3},elevated:{fill:"#FFFFFF",stroke:"#2563EB",strokeWidth:4},outline:{fill:"transparent",stroke:"#3B82F6",strokeWidth:2}}[r];return(0,A.jsxs)("div",{onClick:s,className:`
        relative
        ${s?"cursor-pointer hover:scale-[1.01] active:scale-[0.99]":""}
        transition-transform duration-150
        ${t}
      `,children:[(0,A.jsxs)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",preserveAspectRatio:"none",children:[(0,A.jsx)("defs",{children:(0,A.jsxs)("filter",{id:"card-rough",x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,A.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.04",numOctaves:"2",result:"noise"}),(0,A.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1"})]})}),(0,A.jsx)("path",{d:`
            M ${5+i[0]}% ${3+i[1]}%
            Q 25% ${-.5+i[2]}%, 50% ${2+i[3]}%
            Q 75% -0.5%, ${95+i[4]}% 3%
            Q 100.5% 25%, 97% 50%
            Q 100.5% 75%, ${95+i[5]}% 97%
            Q 75% 100.5%, 50% ${97+i[6]}%
            Q 25% 100.5%, ${5+i[7]}% 97%
            Q -0.5% 75%, 3% 50%
            Q -0.5% 25%, ${5+i[8]}% 3%
            Z
          `,fill:n.fill,stroke:n.stroke,strokeWidth:n.strokeWidth,strokeLinecap:"round",strokeLinejoin:"round",style:{filter:"url(#card-rough)"}}),(0,A.jsx)("path",{d:`
            M ${6+i[9]}% ${4+i[10]}%
            Q 25% 0.5%, 50% 3%
            Q 75% 0.5%, ${94+i[11]}% 4%
            Q 99.5% 25%, 96% 50%
            Q 99.5% 75%, 94% 96%
            Q 75% 99.5%, 50% 96%
            Q 25% 99.5%, 6% 96%
            Q 0.5% 75%, 4% 50%
            Q 0.5% 25%, 6% 4%
            Z
          `,fill:"none",stroke:n.stroke,strokeWidth:"1",strokeLinecap:"round",opacity:"0.4"}),"elevated"===r&&(0,A.jsx)("path",{d:`
              M 7% 6%
              Q 25% 2%, 50% 5%
              Q 75% 2%, 93% 6%
              Q 98% 25%, 95% 50%
              Q 98% 75%, 93% 95%
              Q 75% 98%, 50% 95%
              Q 25% 98%, 7% 95%
              Q 2% 75%, 5% 50%
              Q 2% 25%, 7% 6%
              Z
            `,fill:"none",stroke:"#1E40AF",strokeWidth:"2",opacity:"0.2",transform:"translate(3, 3)"})]}),(0,A.jsx)("div",{className:"relative z-10 p-6",children:e})]})}function Y({checked:e,onChange:t,label:s,disabled:r=!1}){let i=(0,I.useMemo)(()=>Array.from({length:8},()=>(Math.random()-.5)*3),[]),n=`
    M ${16+i[0]} ${2+i[1]}
    Q 30 0, ${44+i[2]} 2
    Q 58 6, ${58+i[3]} 16
    Q 58 26, 44 ${30+i[4]}
    Q 30 32, ${16+i[5]} 30
    Q 2 26, ${2+i[6]} 16
    Q 2 6, ${16+i[7]} 2
    Z
  `,a=e=>{let t="";for(let s=0;s<=16;s++){let r=s/16*Math.PI*2,i=.96*Math.sin(3*s),n=e+(12+i)*Math.cos(r),a=16+(12+i)*Math.sin(r);t+=(0===s?"M ":"L ")+`${n} ${a} `}return t+"Z"},o=e?44:16;return(0,A.jsxs)("label",{className:`
        inline-flex items-center gap-3
        ${r?"opacity-50 cursor-not-allowed":"cursor-pointer"}
      `,children:[(0,A.jsx)("button",{type:"button",onClick:()=>!r&&t(!e),disabled:r,className:"relative focus:outline-none focus:ring-2 focus:ring-blue-300 rounded-full",style:{width:60,height:32},children:(0,A.jsxs)("svg",{width:60,height:32,viewBox:"0 0 60 32",children:[(0,A.jsx)("defs",{children:(0,A.jsxs)("filter",{id:"toggle-rough",x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,A.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.05",numOctaves:"2",result:"noise"}),(0,A.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1"})]})}),(0,A.jsx)("path",{d:n,fill:e?"#2563EB":"#E5E7EB",stroke:e?"#1D4ED8":"#9CA3AF",strokeWidth:"2.5",strokeLinecap:"round",style:{filter:"url(#toggle-rough)"}}),(0,A.jsx)("path",{d:n,fill:"none",stroke:e?"#1E40AF":"#6B7280",strokeWidth:"1",opacity:"0.3",transform:"translate(1, 1)"}),(0,A.jsxs)("g",{style:{transition:"transform 0.2s ease-out"},children:[(0,A.jsx)("path",{d:a(o),fill:"#1E40AF",opacity:"0.15",transform:"translate(2, 2)"}),(0,A.jsx)("path",{d:a(o),fill:"#FFFFFF",stroke:"#2563EB",strokeWidth:"2.5",strokeLinecap:"round"}),(0,A.jsx)("path",{d:a(o),fill:"none",stroke:"#3B82F6",strokeWidth:"1",opacity:"0.4",transform:"scale(0.85)",style:{transformOrigin:`${o}px 16px`}})]})]})}),s&&(0,A.jsx)("span",{className:"font-['Google Sans',_sans-serif] text-xl text-[#1E40AF]",children:s})]})}function ee({icon:e,size:t=48,color:s="#2563EB",className:r=""}){let i=(0,I.useMemo)(()=>Array.from({length:20},()=>(Math.random()-.5)*2),[]),n=t>40?3:2;return(0,A.jsxs)("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,className:r,children:[(0,A.jsx)("defs",{children:(0,A.jsxs)("filter",{id:`icon-rough-${e}`,x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,A.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.03",numOctaves:"2",result:"noise"}),(0,A.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"0.5"})]})}),(0,A.jsx)("g",{style:{filter:`url(#icon-rough-${e})`},children:(()=>{switch(e){case"shield":return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("path",{d:`
                M ${t/2+i[0]} ${4+i[1]}
                Q ${t-6+i[2]} 6, ${t-6} ${t/3}
                Q ${t-6} ${.6*t}, ${t/2} ${t-4+i[3]}
                Q 6 ${.6*t}, ${6+i[4]} ${t/3}
                Q 6 6, ${t/2+i[5]} 4
                Z
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"}),(0,A.jsx)("path",{d:`
                M ${.3*t+i[6]} ${.5*t}
                L ${.45*t} ${.65*t+i[7]}
                L ${.7*t+i[8]} ${.35*t}
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"})]});case"photo":return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("path",{d:`
                M ${6+i[0]} ${8+i[1]}
                L ${t-6+i[2]} 8
                L ${t-6} ${t-8+i[3]}
                L ${6+i[4]} ${t-8}
                Z
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"}),(0,A.jsx)("path",{d:`
                M ${10+i[5]} ${t-14}
                L ${.35*t} ${.45*t+i[6]}
                L ${.5*t} ${.55*t}
                L ${.65*t+i[7]} ${.4*t}
                L ${t-10} ${t-14+i[8]}
              `,fill:"none",stroke:s,strokeWidth:n-.5,strokeLinecap:"round",strokeLinejoin:"round"}),(0,A.jsx)("circle",{cx:.7*t,cy:.3*t,r:.08*t,fill:"none",stroke:s,strokeWidth:n-.5})]});case"clock":return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("path",{d:(()=>{let e="",s=t/2,r=t/2,n=t/2-6;for(let t=0;t<=24;t++){let a=t/24*Math.PI*2-Math.PI/2,o=.04*n*(i[t%10]||0),l=s+(n+o)*Math.cos(a),c=r+(n+o)*Math.sin(a);e+=(0===t?"M ":"L ")+`${l} ${c} `}return e+"Z"})(),fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round"}),(0,A.jsx)("path",{d:`
                M ${t/2+i[0]} ${t/2}
                L ${t/2-.15*t+i[1]} ${t/2-.15*t}
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round"}),(0,A.jsx)("path",{d:`
                M ${t/2} ${t/2+i[2]}
                L ${t/2+.2*t} ${t/2-.25*t+i[3]}
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round"}),(0,A.jsx)("circle",{cx:t/2,cy:t/2,r:3,fill:s})]});case"key":return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("path",{d:(()=>{let e="",s=.3*t,r=.35*t,n=.2*t;for(let t=0;t<=16;t++){let a=t/16*Math.PI*2,o=.06*n*(i[t%10]||0),l=s+(n+o)*Math.cos(a),c=r+(n+o)*Math.sin(a);e+=(0===t?"M ":"L ")+`${l} ${c} `}return e+"Z"})(),fill:"none",stroke:s,strokeWidth:n}),(0,A.jsx)("circle",{cx:.3*t,cy:.35*t,r:.08*t,fill:"none",stroke:s,strokeWidth:n-.5}),(0,A.jsx)("path",{d:`
                M ${.45*t+i[0]} ${.45*t}
                L ${t-8+i[1]} ${t-10}
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round"}),(0,A.jsx)("path",{d:`
                M ${.65*t+i[2]} ${.6*t}
                L ${.72*t} ${.68*t+i[3]}
                M ${.75*t} ${.7*t+i[4]}
                L ${.82*t+i[5]} ${.78*t}
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round"})]});case"cloud":return(0,A.jsx)("path",{d:`
              M ${.25*t+i[0]} ${.65*t}
              Q ${.1*t} ${.65*t}, ${.1*t+i[1]} ${.5*t}
              Q ${.1*t} ${.35*t}, ${.25*t} ${.35*t+i[2]}
              Q ${.3*t} ${.2*t}, ${.45*t+i[3]} ${.2*t}
              Q ${.55*t} ${.15*t+i[4]}, ${.65*t} ${.25*t}
              Q ${.8*t} ${.2*t}, ${.85*t+i[5]} ${.35*t}
              Q ${.95*t} ${.4*t+i[6]}, ${.9*t} ${.55*t}
              Q ${.95*t} ${.65*t}, ${.8*t+i[7]} ${.65*t}
              Z
            `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"});case"folder":return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("path",{d:`
                M ${8+i[0]} ${.35*t}
                L 8 ${.25*t+i[1]}
                L ${.35*t+i[2]} ${.25*t}
                L ${.4*t} ${.35*t+i[3]}
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"}),(0,A.jsx)("path",{d:`
                M ${8+i[4]} ${.35*t}
                L ${t-8+i[5]} ${.35*t}
                L ${t-8} ${t-10+i[6]}
                L ${8+i[7]} ${t-10}
                Z
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"})]});case"check":return(0,A.jsx)("path",{d:`
              M ${.2*t+i[0]} ${.5*t}
              L ${.4*t+i[1]} ${.7*t+i[2]}
              L ${.8*t+i[3]} ${.3*t}
            `,fill:"none",stroke:s,strokeWidth:n+1,strokeLinecap:"round",strokeLinejoin:"round"});case"warning":return(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)("path",{d:`
                M ${t/2+i[0]} 8
                L ${t-8+i[1]} ${t-10}
                L ${8+i[2]} ${t-10}
                Z
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round"}),(0,A.jsx)("path",{d:`
                M ${t/2+i[3]} ${.35*t}
                L ${t/2} ${.55*t+i[4]}
              `,fill:"none",stroke:s,strokeWidth:n,strokeLinecap:"round"}),(0,A.jsx)("circle",{cx:t/2,cy:.7*t,r:2.5,fill:s})]});default:return null}})()})]})}function et({value:e,onChange:t,placeholder:s="",type:r="text",label:i,icon:n,disabled:a=!1,className:o=""}){return(0,I.useMemo)(()=>Array.from({length:8},()=>(Math.random()-.5)*4),[]),(0,A.jsxs)("div",{className:`relative ${o}`,children:[i&&(0,A.jsx)("label",{className:"block font-['Google Sans',_sans-serif] text-xl text-[#1E40AF] mb-2",children:i}),(0,A.jsxs)("div",{className:"relative",children:[(0,A.jsxs)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",preserveAspectRatio:"none",children:[(0,A.jsx)("defs",{children:(0,A.jsxs)("filter",{id:"input-rough",x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,A.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.04",numOctaves:"2",result:"noise"}),(0,A.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1",xChannelSelector:"R",yChannelSelector:"G"})]})}),(0,A.jsx)("path",{d:"M0,0 L${width},0 L${width},${height} L0,${height} Z",className:"stroke-[#2563EB] stroke-[3] fill-none",filter:"url(#input-rough)"})]}),(0,A.jsx)("input",{type:r,value:e,onChange:e=>t(e.target.value),placeholder:s,disabled:a,className:`
             relative z-10
             w-full
             ${n?"pl-12":"px-5"} py-4
             bg-transparent
             font-['Google Sans',_sans-serif] text-xl text-[#1E40AF]
             placeholder:text-[#9CA3AF]
             focus:outline-none
             ${a?"opacity-50 cursor-not-allowed":""}
           `}),n&&(0,A.jsx)("div",{className:"absolute left-4 top-1/2 -translate-y-1/2 z-20 text-[#2563EB]/40",children:n})]})]})}function es({value:e,onChange:t,placeholder:s="",label:r,rows:i=4,disabled:n=!1,className:a=""}){return(0,I.useMemo)(()=>Array.from({length:8},()=>(Math.random()-.5)*4),[]),(0,A.jsxs)("div",{className:`relative ${a}`,children:[r&&(0,A.jsx)("label",{className:"block font-['Google Sans',_sans-serif] text-xl text-[#1E40AF] mb-2",children:r}),(0,A.jsxs)("div",{className:"relative",children:[(0,A.jsxs)("svg",{className:"absolute inset-0 w-full h-full pointer-events-none",preserveAspectRatio:"none",children:[(0,A.jsx)("defs",{children:(0,A.jsxs)("filter",{id:"textarea-rough",x:"-5%",y:"-5%",width:"110%",height:"110%",children:[(0,A.jsx)("feTurbulence",{type:"turbulence",baseFrequency:"0.03",numOctaves:"2",result:"noise"}),(0,A.jsx)("feDisplacementMap",{in:"SourceGraphic",in2:"noise",scale:"1",xChannelSelector:"R",yChannelSelector:"G"})]})}),(0,A.jsx)("path",{d:"M0,0 L${width},0 L${width},${height} L0,${height} Z",className:"stroke-[#2563EB] stroke-[3] fill-none",filter:"url(#textarea-rough)"})]}),(0,A.jsx)("textarea",{value:e,onChange:e=>t(e.target.value),placeholder:s,rows:i,disabled:n,className:`
             relative z-10
             w-full
             px-5 py-4
             bg-transparent
             font-['Google Sans',_sans-serif] text-xl text-[#1E40AF]
             placeholder:text-[#9CA3AF]
             focus:outline-none
             resize-none
             ${n?"opacity-50 cursor-not-allowed":""}
           `})]})]})}function er({onSuccess:e}){let[t,s]=(0,I.useState)("welcome"),[r,i]=(0,I.useState)(""),[n,a]=(0,I.useState)(""),[o,l]=(0,I.useState)(!1),[c,h]=(0,I.useState)(!1),[u,d]=(0,I.useState)(null),p=async()=>{if(!r||!n)return void d("Bitte E-Mail und Passwort eingeben");h(!0),d(null);try{let t=await V.signIn.email({email:r,password:n});if(t.error)return void d(t.error.message||"Anmeldung fehlgeschlagen");t.data?.user&&e({id:t.data.user.id,email:t.data.user.email,vaultKeyHash:t.data.user.vault_key_hash||null})}catch(e){console.error("Login error:",e),d("Ein Fehler ist aufgetreten. Bitte versuche es erneut.")}finally{h(!1)}};return"welcome"===t?(0,A.jsxs)("div",{className:"min-h-screen flex flex-col px-6 pt-16 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,A.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[(0,A.jsxs)("div",{className:"relative w-28 h-28 mb-8",children:[(0,A.jsx)("svg",{className:"absolute inset-0 w-full h-full",viewBox:"0 0 100 100",children:(0,A.jsx)("path",{d:"M 10 10 Q 30 5, 50 10 Q 70 5, 90 10 Q 95 30, 90 50 Q 95 70, 90 90 Q 70 95, 50 90 Q 30 95, 10 90 Q 5 70, 10 50 Q 5 30, 10 10 Z",fill:"white",stroke:"#2563EB",strokeWidth:"3"})}),(0,A.jsx)("div",{className:"relative z-10 w-full h-full flex items-center justify-center",children:(0,A.jsx)(J,{name:"shield",size:56,className:"text-[#2563EB]"})})]}),(0,A.jsx)("h1",{className:"sketch-heading text-[42px] mb-3",children:"PhotoVault"}),(0,A.jsx)("p",{className:"sketch-body text-[#3B82F6] max-w-[280px] mb-12",children:"Sichere deine Fotos mit Zero-Knowledge Verschluesselung"}),(0,A.jsxs)("div",{className:"w-full max-w-[320px] space-y-4 mb-12",children:[(0,A.jsx)(ei,{icon:"lock",text:"Ende-zu-Ende verschluesselt"}),(0,A.jsx)(ei,{icon:"smartphone",text:"Multi-Device Sync"}),(0,A.jsx)(ei,{icon:"cloud",text:"Dezentrales IPFS Backup"})]})]}),(0,A.jsxs)("div",{className:"space-y-4",children:[(0,A.jsx)(Z.SketchButton,{onClick:()=>s("login"),className:"w-full",size:"lg",children:"Anmelden"}),(0,A.jsx)("p",{className:"text-center sketch-body text-gray-400 text-sm",children:"Registrierung ist derzeit deaktiviert"})]})]}):(0,A.jsxs)("div",{className:"jsx-d70472d407c31818 min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,A.jsx)("button",{onClick:()=>s("welcome"),className:"jsx-d70472d407c31818 self-start sketch-body text-[#2563EB] mb-8 ios-tap-target flex items-center gap-2",children:"â† Zurueck"}),(0,A.jsxs)("div",{className:"jsx-d70472d407c31818 flex-1",children:[(0,A.jsx)("h1",{className:"jsx-d70472d407c31818 sketch-heading text-[32px] mb-2",children:"Willkommen zurueck"}),(0,A.jsx)("p",{className:"jsx-d70472d407c31818 sketch-body text-[#3B82F6] mb-8",children:"Melde dich an, um auf deinen Vault zuzugreifen"}),(0,A.jsxs)("div",{className:"jsx-d70472d407c31818 space-y-6",children:[(0,A.jsx)("div",{className:"jsx-d70472d407c31818 relative",children:(0,A.jsx)(et,{type:"email",value:r,onChange:e=>i(e),placeholder:"E-Mail",label:"E-Mail",icon:(0,A.jsx)(z,{className:"w-5 h-5"})})}),(0,A.jsxs)("div",{className:"jsx-d70472d407c31818 relative flex flex-col gap-1",children:[(0,A.jsx)(et,{type:o?"text":"password",value:n,onChange:e=>a(e),placeholder:"Passwort",label:"Passwort",icon:(0,A.jsx)(U.Lock,{className:"w-5 h-5"})}),(0,A.jsx)("button",{type:"button",onClick:()=>l(!o),className:"jsx-d70472d407c31818 absolute right-4 top-[38px] text-[#2563EB]/40 z-20",children:o?(0,A.jsx)(W,{className:"w-5 h-5"}):(0,A.jsx)(Q.Eye,{className:"w-5 h-5"})})]}),u&&(0,A.jsxs)("div",{className:"jsx-d70472d407c31818 relative py-3 px-4",children:[(0,A.jsx)("svg",{preserveAspectRatio:"none",className:"jsx-d70472d407c31818 absolute inset-0 w-full h-full",children:(0,A.jsx)("path",{d:"M 2 5 Q 25 2, 50 5 Q 75 2, 98 5 Q 99 30, 98 60 Q 75 63, 50 60 Q 25 63, 2 60 Q 1 30, 2 5 Z",fill:"#FF3B3010",stroke:"#FF3B30",strokeWidth:"1",className:"jsx-d70472d407c31818"})}),(0,A.jsx)("p",{className:"jsx-d70472d407c31818 relative z-10 sketch-body text-[#FF3B30] text-center text-sm",children:u})]})]})]}),(0,A.jsx)("div",{className:"jsx-d70472d407c31818 space-y-4",children:(0,A.jsx)(Z.SketchButton,{onClick:p,disabled:c,className:"w-full",size:"lg",children:c?(0,A.jsx)(H.Loader2,{className:"w-6 h-6 animate-spin"}):"Anmelden"})}),(0,A.jsx)(B.default,{id:"d70472d407c31818",children:".sketch-input-field.jsx-d70472d407c31818{color:#1d1d1f;background-color:#0000;border:2px solid #2563eb;border-radius:12px;width:100%;height:54px;padding-left:3rem;padding-right:1rem;font-family:Google Sans,sans-serif;font-size:17px;transition:border-color .2s}.sketch-input-field.jsx-d70472d407c31818:focus{border-color:#1e40af;outline:none}.sketch-input-field.jsx-d70472d407c31818::placeholder{color:#8e8e93}"})]})}function ei({icon:e,text:t}){return(0,A.jsxs)("div",{className:"relative group",children:[(0,A.jsx)("svg",{className:"absolute inset-0 w-full h-full",preserveAspectRatio:"none",children:(0,A.jsx)("path",{d:"M 2 2 Q 25 -1, 50 2 Q 75 -1, 98 2 Q 100 25, 98 50 Q 75 53, 50 50 Q 25 53, 2 50 Q 0 25, 2 2 Z",fill:"white",stroke:"#2563EB40",strokeWidth:"1.5"})}),(0,A.jsxs)("div",{className:"relative z-10 flex items-center gap-4 p-4",children:[(0,A.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center",children:(0,A.jsx)(J,{name:e,size:24,className:"text-[#2563EB]"})}),(0,A.jsx)("span",{className:"sketch-body text-base text-[#1E40AF]",children:t})]})]})}let en=(0,M.default)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);var ea=e.i(3809);function eo({userEmail:e,expectedKeyHash:t,onUnlock:s,onCreateNewVault:r,onLogout:i}){let[n,a]=(0,I.useState)(""),[o,l]=(0,I.useState)(!1),[c,h]=(0,I.useState)(null),u=async()=>{if(!n.trim())return void h("Bitte gib deine Recovery-Phrase ein");l(!0),h(null);try{let e=n.trim().replace(/[\s\n]+/g,"-").replace(/-+/g,"-"),r=(0,ea.recoveryPhraseToKey)(e);if(!r||32!==r.length){h("Ungueltige Recovery-Phrase"),l(!1);return}let i=await (0,ea.getUserKeyHash)(r);if(t&&i!==t){h("Diese Recovery-Phrase gehoert nicht zu diesem Konto. Bitte ueberpruefe deine Eingabe."),l(!1);return}(0,ea.saveKeyToStorage)(r),s(r,i)}catch(e){console.error("Unlock error:",e),h("Ungueltige Recovery-Phrase. Bitte ueberpruefe deine Eingabe.")}finally{l(!1)}};return(0,A.jsxs)("div",{className:"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,A.jsxs)("div",{className:"sketch-body text-[14px] text-[#6E6E73]",children:["Angemeldet als",(0,A.jsx)("br",{}),(0,A.jsx)("span",{className:"text-[#2563EB] font-bold",children:e})]}),(0,A.jsx)("button",{onClick:i,className:"sketch-body text-[#FF3B30] text-[15px] hover:text-[#D73A49]",children:"Abmelden"})]}),(0,A.jsxs)("div",{className:"flex-1 flex flex-col",children:[(0,A.jsxs)("div",{className:"flex flex-col items-center text-center mb-8",children:[(0,A.jsx)("div",{className:"mb-6",children:(0,A.jsx)(ee,{icon:"shield",size:80})}),(0,A.jsx)("h1",{className:"sketch-heading text-[32px] mb-2 text-[#1D1D1F]",children:"Vault entsperren"}),(0,A.jsx)("p",{className:"sketch-body text-[15px] text-[#6E6E73] max-w-[300px]",children:t?"Gib deine Recovery-Phrase ein, um auf deine verschluesselten Fotos zuzugreifen":"Du hast noch keinen Vault. Erstelle einen neuen oder stelle einen bestehenden wieder her."})]}),(0,A.jsxs)("div",{className:"mb-6",children:[(0,A.jsx)(es,{value:n,onChange:e=>{a(e),h(null)},label:"Recovery-Phrase (12 Woerter)",placeholder:"abc123XY-def456AB-...",rows:4}),(0,A.jsx)("p",{className:"sketch-body text-[12px] text-[#8E8E93] mt-2 px-1",children:"Mit Bindestrichen oder Leerzeichen getrennt"})]}),c&&(0,A.jsx)("div",{className:"relative py-3 px-4 mb-6",children:(0,A.jsx)(X,{className:"bg-[#FF3B30]/5 border-[#FF3B30]",children:(0,A.jsx)("p",{className:"sketch-body text-[14px] text-[#FF3B30] text-center",children:c})})}),(0,A.jsx)("div",{className:"mb-6",children:(0,A.jsx)(X,{className:"bg-[#2563EB]/5",children:(0,A.jsxs)("div",{className:"flex items-start gap-3",children:[(0,A.jsx)(en,{className:"w-5 h-5 text-[#2563EB] mt-0.5 flex-shrink-0"}),(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"sketch-subheading text-[15px] mb-1",children:"Warum brauche ich die Phrase?"}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Deine Fotos sind lokal verschluesselt. Nur mit der Recovery-Phrase kannst du sie entschluesseln. Wir speichern sie niemals."})]})]})})})]}),(0,A.jsxs)("div",{className:"space-y-4",children:[(0,A.jsx)(Z.SketchButton,{onClick:u,disabled:o||!n.trim(),className:"w-full",size:"lg",children:o?(0,A.jsx)(H.Loader2,{className:"w-6 h-6 animate-spin"}):"Vault entsperren"}),!t&&(0,A.jsx)("button",{onClick:r,className:"w-full py-2 sketch-body text-[#2563EB] text-[17px] hover:underline",children:"Neuen Vault erstellen"})]})]})}function el(){let[e,t]=(0,I.useState)(null),[s,r]=(0,I.useState)(!1),[i,n]=(0,I.useState)(null),[a,o]=(0,I.useState)(!1),[l,c]=(0,I.useState)(null);(0,I.useEffect)(()=>{(async()=>{let e=(0,ea.loadKeyFromStorage)();e&&(t(e),n((0,ea.keyToRecoveryPhrase)(e)),c(await (0,ea.getUserKeyHash)(e))),r(!0)})()},[]);let h=(0,I.useCallback)(()=>new Promise(e=>{o(!0),setTimeout(async()=>{let s=(0,ea.generateKeyPair)().secretKey;t(s),(0,ea.saveKeyToStorage)(s);let r=(0,ea.keyToRecoveryPhrase)(s);n(r),c(await (0,ea.getUserKeyHash)(s)),o(!1),e(r)},1500)}),[]);return{secretKey:e,isInitialized:s,hasKey:!!e,recoveryPhrase:i,userKeyHash:l,isGeneratingKey:a,generateNewKey:h,restoreFromPhrase:(0,I.useCallback)(e=>{try{let s=(0,ea.recoveryPhraseToKey)(e);return t(s),(0,ea.saveKeyToStorage)(s),n(e),!0}catch{return!1}},[]),clearKey:(0,I.useCallback)(()=>{t(null),n(null),(0,ea.clearKeyFromStorage)()},[])}}function ec({userId:e,onComplete:t,onBack:s}){let[r,i]=(0,I.useState)("intro"),[n,a]=(0,I.useState)(!1),[o,l]=(0,I.useState)(!1),{isGeneratingKey:c,generateNewKey:h,recoveryPhrase:u,userKeyHash:d}=el(),p=async()=>{i("generating");try{await h(),i("phrase")}catch(e){console.error("Failed to generate key:",e),i("intro")}},f=async()=>{u&&(await navigator.clipboard.writeText(u),l(!0),setTimeout(()=>l(!1),2e3))},m=u?.split("-").slice(0,12)||[];return"generating"===r||c?(0,A.jsx)(L,{}):"intro"===r?(0,A.jsxs)("div",{className:"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,A.jsx)("button",{onClick:s,className:"self-start sketch-body text-[#2563EB] text-[17px] mb-8 hover:text-[#1E40AF]",children:"â† Zurueck"}),(0,A.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center text-center",children:[(0,A.jsx)("div",{className:"mb-6",children:(0,A.jsx)(ee,{icon:"key",size:80})}),(0,A.jsx)("h1",{className:"sketch-heading text-[32px] mb-3 text-[#1D1D1F]",children:"Erstelle deinen Vault"}),(0,A.jsx)("p",{className:"sketch-body text-[17px] text-[#3B82F6] max-w-[300px] mb-8",children:"Dein persoenlicher Verschluesselungsschluessel schuetzt alle deine Fotos"}),(0,A.jsxs)("div",{className:"w-full max-w-[320px] space-y-4 mb-8",children:[(0,A.jsx)(X,{className:"p-4",children:(0,A.jsxs)("div",{className:"flex items-start gap-4",children:[(0,A.jsx)(ee,{icon:"shield",size:32,color:"#30D158"}),(0,A.jsxs)("div",{className:"text-left",children:[(0,A.jsx)("p",{className:"sketch-subheading text-[16px]",children:"Zero-Knowledge"}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Nur du kannst deine Fotos entschluesseln"})]})]})}),(0,A.jsx)(X,{className:"p-4",children:(0,A.jsxs)("div",{className:"flex items-start gap-4",children:[(0,A.jsx)(ee,{icon:"clock",size:32,color:"#2563EB"}),(0,A.jsxs)("div",{className:"text-left",children:[(0,A.jsx)("p",{className:"sketch-subheading text-[16px]",children:"Recovery-Phrase"}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"12 Woerter zum Wiederherstellen"})]})]})}),(0,A.jsx)(X,{className:"p-4",children:(0,A.jsxs)("div",{className:"flex items-start gap-4",children:[(0,A.jsx)(ee,{icon:"photo",size:32,color:"#FF9500"}),(0,A.jsxs)("div",{className:"text-left",children:[(0,A.jsx)("p",{className:"sketch-subheading text-[16px]",children:"Multi-Device"}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Synchronisiere all deine Geraete"})]})]})})]})]}),(0,A.jsx)(Z.SketchButton,{onClick:p,className:"w-full",size:"lg",children:"Vault erstellen"})]}):"phrase"===r?(0,A.jsxs)("div",{className:"min-h-screen flex flex-col px-6 pt-12 pb-8 safe-area-inset bg-[#FAFBFC]",children:[(0,A.jsxs)("div",{className:"flex-1",children:[(0,A.jsxs)("div",{className:"text-center mb-6",children:[(0,A.jsx)("h1",{className:"sketch-heading text-[32px] mb-2 text-[#1D1D1F]",children:"Deine Phrase"}),(0,A.jsx)("p",{className:"sketch-body text-[15px] text-[#6E6E73]",children:"Notiere diese Woerter sicher. Du brauchst sie zur Wiederherstellung."})]}),(0,A.jsx)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:m.map((e,t)=>(0,A.jsxs)(X,{className:"p-3 text-center",children:[(0,A.jsx)("span",{className:"sketch-body text-[11px] text-[#6E6E73] block mb-0.5",children:t+1}),(0,A.jsx)("span",{className:"sketch-subheading text-[16px] break-all",children:e})]},t))}),(0,A.jsx)("button",{onClick:f,className:"w-full py-3 sketch-body text-[#2563EB] text-[16px] hover:underline mb-4",children:o?"âœ“ Kopiert!":"Phrase kopieren"}),(0,A.jsx)("div",{className:"mb-6",children:(0,A.jsx)(X,{className:"bg-[#FF3B30]/5 border-[#FF3B30]",children:(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#FF3B30] text-center",children:"Teile diese Woerter niemals mit anderen. Wer sie hat, kann auf deine Fotos zugreifen."})})}),(0,A.jsx)("div",{className:"mb-8",children:(0,A.jsxs)(X,{className:"p-4 flex items-center justify-between",children:[(0,A.jsx)("span",{className:"sketch-subheading text-[17px] text-[#1D1D1F]",children:"Sicher gespeichert?"}),(0,A.jsx)(Y,{checked:n,onChange:a})]})})]}),(0,A.jsx)(Z.SketchButton,{onClick:()=>{d&&t(d)},disabled:!n,className:"w-full",size:"lg",children:"Weiter"})]}):null}var eh=e.i(43531);e.i(47167);class eu extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class ed extends eu{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ep extends eu{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class ef extends eu{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}(c=k||(k={})).Any="any",c.ApNortheast1="ap-northeast-1",c.ApNortheast2="ap-northeast-2",c.ApSouth1="ap-south-1",c.ApSoutheast1="ap-southeast-1",c.ApSoutheast2="ap-southeast-2",c.CaCentral1="ca-central-1",c.EuCentral1="eu-central-1",c.EuWest1="eu-west-1",c.EuWest2="eu-west-2",c.EuWest3="eu-west-3",c.SaEast1="sa-east-1",c.UsEast1="us-east-1",c.UsWest1="us-west-1",c.UsWest2="us-west-2";class em{constructor(t,{headers:s={},customFetch:r,region:i=k.Any}={}){this.url=t,this.headers=s,this.region=i,this.fetch=(t=>{let s;return s=t||("u"<typeof fetch?(...t)=>e.A(11737).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)})(r)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s,r,i,n,a;return r=this,i=void 0,n=void 0,a=function*(){try{let r,{headers:i,method:n,body:a}=t,o={},{region:l}=t;l||(l=this.region),l&&"any"!==l&&(o["x-region"]=l),a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&("u">typeof Blob&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",r=a):"string"==typeof a?(o["Content-Type"]="text/plain",r=a):"u">typeof FormData&&a instanceof FormData?r=a:(o["Content-Type"]="application/json",r=JSON.stringify(a)));let c=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:r}).catch(e=>{throw new ed(e)}),h=c.headers.get("x-relay-error");if(h&&"true"===h)throw new ep(c);if(!c.ok)throw new ef(c);let u=(null!=(s=c.headers.get("Content-Type"))?s:"text/plain").split(";")[0].trim();return{data:"application/json"===u?yield c.json():"application/octet-stream"===u?yield c.blob():"text/event-stream"===u?c:"multipart/form-data"===u?yield c.formData():yield c.text(),error:null}}catch(e){return{data:null,error:e}}},new(n||(n=Promise))(function(e,t){function s(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var r;t.done?e(t.value):((r=t.value)instanceof n?r:new n(function(e){e(r)})).then(s,o)}l((a=a.apply(r,i||[])).next())})}}let{PostgrestClient:eg,PostgrestQueryBuilder:ey,PostgrestFilterBuilder:eb,PostgrestTransformBuilder:ex,PostgrestBuilder:ev,PostgrestError:ew}=e.i(82215).default,e_={"X-Client-Info":"realtime-js/2.11.2"};(h=j||(j={}))[h.connecting=0]="connecting",h[h.open=1]="open",h[h.closing=2]="closing",h[h.closed=3]="closed",(u=S||(S={})).closed="closed",u.errored="errored",u.joined="joined",u.joining="joining",u.leaving="leaving",(d=E||(E={})).close="phx_close",d.error="phx_error",d.join="phx_join",d.reply="phx_reply",d.leave="phx_leave",d.access_token="access_token",(N||(N={})).websocket="websocket",(p=C||(C={})).Connecting="connecting",p.Open="open",p.Closing="closing",p.Closed="closed";class ek{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):"string"==typeof e?t(JSON.parse(e)):t({})}_binaryDecode(e){let t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){let r=t.getUint8(1),i=t.getUint8(2),n=this.HEADER_LENGTH+2,a=s.decode(e.slice(n,n+r));n+=r;let o=s.decode(e.slice(n,n+i));return n+=i,{ref:null,topic:a,event:o,payload:JSON.parse(s.decode(e.slice(n,e.byteLength)))}}}class ej{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}(f=R||(R={})).abstime="abstime",f.bool="bool",f.date="date",f.daterange="daterange",f.float4="float4",f.float8="float8",f.int2="int2",f.int4="int4",f.int4range="int4range",f.int8="int8",f.int8range="int8range",f.json="json",f.jsonb="jsonb",f.money="money",f.numeric="numeric",f.oid="oid",f.reltime="reltime",f.text="text",f.time="time",f.timestamp="timestamp",f.timestamptz="timestamptz",f.timetz="timetz",f.tsrange="tsrange",f.tstzrange="tstzrange";let eS=(e,t,s={})=>{var r;let i=null!=(r=s.skipTypes)?r:[];return Object.keys(t).reduce((s,r)=>(s[r]=eE(r,e,t,i),s),{})},eE=(e,t,s,r)=>{let i=t.find(t=>t.name===e),n=null==i?void 0:i.type,a=s[e];return n&&!r.includes(n)?eN(n,a):eC(a)},eN=(e,t)=>{if("_"===e.charAt(0))return eO(t,e.slice(1,e.length));switch(e){case R.bool:return eR(t);case R.float4:case R.float8:case R.int2:case R.int4:case R.int8:case R.numeric:case R.oid:return eP(t);case R.json:case R.jsonb:return eT(t);case R.timestamp:return e$(t);case R.abstime:case R.date:case R.daterange:case R.int4range:case R.int8range:case R.money:case R.reltime:case R.text:case R.time:case R.timestamptz:case R.timetz:case R.tsrange:case R.tstzrange:default:return eC(t)}},eC=e=>e,eR=e=>{switch(e){case"t":return!0;case"f":return!1;default:return e}},eP=e=>{if("string"==typeof e){let t=parseFloat(e);if(!Number.isNaN(t))return t}return e},eT=e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){console.log(`JSON parse error: ${e}`)}return e},eO=(e,t)=>{if("string"!=typeof e)return e;let s=e.length-1,r=e[s];if("{"===e[0]&&"}"===r){let r,i=e.slice(1,s);try{r=JSON.parse("["+i+"]")}catch(e){r=i?i.split(","):[]}return r.map(e=>eN(t,e))}return e},e$=e=>"string"==typeof e?e.replace(" ","T"):e,eF=e=>{let t=e;return(t=(t=t.replace(/^ws/i,"http")).replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,"")).replace(/\/+$/,"")};class eA{constructor(e,t,s={},r=1e4){this.channel=e,this.event=t,this.payload=s,this.timeout=r,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t(null==(s=this.receivedResp)?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);let e=e=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=e,this._matchReceive(e)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(t=>t.status===e).forEach(e=>e.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}(m=P||(P={})).SYNC="sync",m.JOIN="join",m.LEAVE="leave";class eI{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(null==t?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},e=>{let{onJoin:t,onLeave:s,onSync:r}=this.caller;this.joinRef=this.channel._joinRef(),this.state=eI.syncState(this.state,e,t,s),this.pendingDiffs.forEach(e=>{this.state=eI.syncDiff(this.state,e,t,s)}),this.pendingDiffs=[],r()}),this.channel._on(s.diff,{},e=>{let{onJoin:t,onLeave:s,onSync:r}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(e):(this.state=eI.syncDiff(this.state,e,t,s),r())}),this.onJoin((e,t,s)=>{this.channel._trigger("presence",{event:"join",key:e,currentPresences:t,newPresences:s})}),this.onLeave((e,t,s)=>{this.channel._trigger("presence",{event:"leave",key:e,currentPresences:t,leftPresences:s})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,r){let i=this.cloneDeep(e),n=this.transformState(t),a={},o={};return this.map(i,(e,t)=>{n[e]||(o[e]=t)}),this.map(n,(e,t)=>{let s=i[e];if(s){let r=t.map(e=>e.presence_ref),i=s.map(e=>e.presence_ref),n=t.filter(e=>0>i.indexOf(e.presence_ref)),l=s.filter(e=>0>r.indexOf(e.presence_ref));n.length>0&&(a[e]=n),l.length>0&&(o[e]=l)}else a[e]=t}),this.syncDiff(i,{joins:a,leaves:o},s,r)}static syncDiff(e,t,s,r){let{joins:i,leaves:n}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),r||(r=()=>{}),this.map(i,(t,r)=>{var i;let n=null!=(i=e[t])?i:[];if(e[t]=this.cloneDeep(r),n.length>0){let s=e[t].map(e=>e.presence_ref),r=n.filter(e=>0>s.indexOf(e.presence_ref));e[t].unshift(...r)}s(t,n,r)}),this.map(n,(t,s)=>{let i=e[t];if(!i)return;let n=s.map(e=>e.presence_ref);i=i.filter(e=>0>n.indexOf(e.presence_ref)),e[t]=i,r(t,i,s),0===i.length&&delete e[t]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return Object.getOwnPropertyNames(e=this.cloneDeep(e)).reduce((t,s)=>{let r=e[s];return"metas"in r?t[s]=r.metas.map(e=>(e.presence_ref=e.phx_ref,delete e.phx_ref,delete e.phx_ref_prev,e)):t[s]=r,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}(g=T||(T={})).ALL="*",g.INSERT="INSERT",g.UPDATE="UPDATE",g.DELETE="DELETE",(y=O||(O={})).BROADCAST="broadcast",y.PRESENCE="presence",y.POSTGRES_CHANGES="postgres_changes",y.SYSTEM="system",(b=$||($={})).SUBSCRIBED="SUBSCRIBED",b.TIMED_OUT="TIMED_OUT",b.CLOSED="CLOSED",b.CHANNEL_ERROR="CHANNEL_ERROR";class eM{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=S.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new eA(this,E.join,this.params,this.timeout),this.rejoinTimer=new ej(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=S.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(e=>e.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=S.closed,this.socket._remove(this)}),this._onError(e=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,e),this.state=S.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=S.errored,this.rejoinTimer.scheduleTimeout())}),this._on(E.reply,{},(e,t)=>{this._trigger(this._replyEventName(t),e)}),this.presence=new eI(this),this.broadcastEndpointURL=eF(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,r;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{let{config:{broadcast:i,presence:n,private:a}}=this.params;this._onError(t=>null==e?void 0:e($.CHANNEL_ERROR,t)),this._onClose(()=>null==e?void 0:e($.CLOSED));let o={},l={broadcast:i,presence:n,postgres_changes:null!=(r=null==(s=this.bindings.postgres_changes)?void 0:s.map(e=>e.filter))?r:[],private:a};this.socket.accessTokenValue&&(o.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},o)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:t})=>{var s;if(this.socket.setAuth(),void 0===t){null==e||e($.SUBSCRIBED);return}{let r=this.bindings.postgres_changes,i=null!=(s=null==r?void 0:r.length)?s:0,n=[];for(let s=0;s<i;s++){let i=r[s],{filter:{event:a,schema:o,table:l,filter:c}}=i,h=t&&t[s];if(h&&h.event===a&&h.schema===o&&h.table===l&&h.filter===c)n.push(Object.assign(Object.assign({},i),{id:h.id}));else{this.unsubscribe(),null==e||e($.CHANNEL_ERROR,Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=n,e&&e($.SUBSCRIBED);return}}).receive("error",t=>{null==e||e($.CHANNEL_ERROR,Error(JSON.stringify(Object.values(t).join(", ")||"error")))}).receive("timeout",()=>{null==e||e($.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,r;if(this._canPush()||"broadcast"!==e.type)return new Promise(s=>{var r,i,n;let a=this._push(e.type,e,t.timeout||this.timeout);"broadcast"!==e.type||(null==(n=null==(i=null==(r=this.params)?void 0:r.config)?void 0:i.broadcast)?void 0:n.ack)||s("ok"),a.receive("ok",()=>s("ok")),a.receive("error",()=>s("error")),a.receive("timeout",()=>s("timed out"))});{let{event:i,payload:n}=e,a={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:i,payload:n,private:this.private}]})};try{let e=await this._fetchWithTimeout(this.broadcastEndpointURL,a,null!=(s=t.timeout)?s:this.timeout);return await (null==(r=e.body)?void 0:r.cancel()),e.ok?"ok":"error"}catch(e){if("AbortError"===e.name)return"timed out";return"error"}}}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=S.leaving;let t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(E.close,"leave",this._joinRef())};return this.rejoinTimer.reset(),this.joinPush.destroy(),new Promise(s=>{let r=new eA(this,E.leave,{},e);r.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),r.send(),this._canPush()||r.trigger("ok",{})})}async _fetchWithTimeout(e,t,s){let r=new AbortController,i=setTimeout(()=>r.abort(),s),n=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:r.signal}));return clearTimeout(i),n}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let r=new eA(this,e,t,s);return this._canPush()?r.send():(r.startTimeout(),this.pushBuffer.push(r)),r}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var r,i;let n=e.toLocaleLowerCase(),{close:a,error:o,leave:l,join:c}=E;if(s&&[a,o,l,c].indexOf(n)>=0&&s!==this._joinRef())return;let h=this._onMessage(n,t,s);if(t&&!h)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(n)?null==(r=this.bindings.postgres_changes)||r.filter(e=>{var t,s,r;return(null==(t=e.filter)?void 0:t.event)==="*"||(null==(r=null==(s=e.filter)?void 0:s.event)?void 0:r.toLocaleLowerCase())===n}).map(e=>e.callback(h,s)):null==(i=this.bindings[n])||i.filter(e=>{var s,r,i,a,o,l;if(!["broadcast","presence","postgres_changes"].includes(n))return e.type.toLocaleLowerCase()===n;if("id"in e){let n=e.id,a=null==(s=e.filter)?void 0:s.event;return n&&(null==(r=t.ids)?void 0:r.includes(n))&&("*"===a||(null==a?void 0:a.toLocaleLowerCase())===(null==(i=t.data)?void 0:i.type.toLocaleLowerCase()))}{let s=null==(o=null==(a=null==e?void 0:e.filter)?void 0:a.event)?void 0:o.toLocaleLowerCase();return"*"===s||s===(null==(l=null==t?void 0:t.event)?void 0:l.toLocaleLowerCase())}}).map(e=>{if("object"==typeof h&&"ids"in h){let e=h.data,{schema:t,table:s,commit_timestamp:r,type:i,errors:n}=e;h=Object.assign(Object.assign({},{schema:t,table:s,commit_timestamp:r,eventType:i,new:{},old:{},errors:n}),this._getPayloadRecords(e))}e.callback(h,s)})}_isClosed(){return this.state===S.closed}_isJoined(){return this.state===S.joined}_isJoining(){return this.state===S.joining}_isLeaving(){return this.state===S.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){let r=e.toLocaleLowerCase(),i={type:r,filter:t,callback:s};return this.bindings[r]?this.bindings[r].push(i):this.bindings[r]=[i],this}_off(e,t){let s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(e=>{var r;return!((null==(r=e.type)?void 0:r.toLocaleLowerCase())===s&&eM.isEqual(e.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(let s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(E.close,{},e)}_onError(e){this._on(E.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=S.joining,this.joinPush.resend(e))}_getPayloadRecords(e){let t={new:{},old:{}};return("INSERT"===e.type||"UPDATE"===e.type)&&(t.new=eS(e.columns,e.record)),("UPDATE"===e.type||"DELETE"===e.type)&&(t.old=eS(e.columns,e.old_record)),t}}let eD=()=>{},eL="u">typeof WebSocket,eB=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class ez{constructor(t,s){var r;this.accessTokenValue=null,this.apiKey=null,this.channels=[],this.endPoint="",this.httpEndpoint="",this.headers=e_,this.params={},this.timeout=1e4,this.heartbeatIntervalMs=3e4,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.ref=0,this.logger=eD,this.conn=null,this.sendBuffer=[],this.serializer=new ek,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=t=>{let s;return s=t||("u"<typeof fetch?(...t)=>e.A(11737).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},this.endPoint=`${t}/${N.websocket}`,this.httpEndpoint=eF(t),(null==s?void 0:s.transport)?this.transport=s.transport:this.transport=null,(null==s?void 0:s.params)&&(this.params=s.params),(null==s?void 0:s.headers)&&(this.headers=Object.assign(Object.assign({},this.headers),s.headers)),(null==s?void 0:s.timeout)&&(this.timeout=s.timeout),(null==s?void 0:s.logger)&&(this.logger=s.logger),(null==s?void 0:s.heartbeatIntervalMs)&&(this.heartbeatIntervalMs=s.heartbeatIntervalMs);const i=null==(r=null==s?void 0:s.params)?void 0:r.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=(null==s?void 0:s.reconnectAfterMs)?s.reconnectAfterMs:e=>[1e3,2e3,5e3,1e4][e-1]||1e4,this.encode=(null==s?void 0:s.encode)?s.encode:(e,t)=>t(JSON.stringify(e)),this.decode=(null==s?void 0:s.decode)?s.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new ej(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(null==s?void 0:s.fetch),null==s?void 0:s.worker){if("u">typeof window&&!window.Worker)throw Error("Web Worker is not supported");this.worker=(null==s?void 0:s.worker)||!1,this.workerUrl=null==s?void 0:s.workerUrl}this.accessToken=(null==s?void 0:s.accessToken)||null}connect(){if(!this.conn){if(this.transport){this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers});return}if(eL){this.conn=new WebSocket(this.endpointURL()),this.setupConnection();return}this.conn=new eU(this.endpointURL(),void 0,{close:()=>{this.conn=null}}),e.A(56555).then(({default:e})=>{this.conn=new e(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection()})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:"1.0.0"}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,null!=t?t:""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset())}getChannels(){return this.channels}async removeChannel(e){let t=await e.unsubscribe();return 0===this.channels.length&&this.disconnect(),t}async removeAllChannels(){let e=await Promise.all(this.channels.map(e=>e.unsubscribe()));return this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case j.connecting:return C.Connecting;case j.open:return C.Open;case j.closing:return C.Closing;default:return C.Closed}}isConnected(){return this.connectionState()===C.Open}channel(e,t={config:{}}){let s=new eM(`realtime:${e}`,t,this);return this.channels.push(s),s}push(e){let{topic:t,event:s,payload:r,ref:i}=e,n=()=>{this.encode(e,e=>{var t;null==(t=this.conn)||t.send(e)})};this.log("push",`${t} ${s} (${i})`,r),this.isConnected()?n():this.sendBuffer.push(n)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;if(t){let e=null;try{e=JSON.parse(atob(t.split(".")[1]))}catch(e){}if(e&&e.exp&&!(Math.floor(Date.now()/1e3)-e.exp<0))return this.log("auth",`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`),Promise.reject(`InvalidJWTToken: Invalid value for JWT claim "exp" with value ${e.exp}`);this.accessTokenValue=t,this.channels.forEach(e=>{t&&e.updateJoinPayload({access_token:t}),e.joinedOnce&&e._isJoined()&&e._push(E.access_token,{access_token:t})})}}async sendHeartbeat(){var e;if(this.isConnected()){if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),null==(e=this.conn)||e.close(1e3,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.setAuth()}}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(t=>t.topic===e&&(t._isJoined()||t._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t._joinRef()!==e._joinRef())}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,e=>{let{topic:t,event:s,payload:r,ref:i}=e;i&&i===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${r.status||""} ${t} ${s} ${i&&"("+i+")"||""}`,r),this.channels.filter(e=>e._isMember(t)).forEach(e=>e._trigger(s,r,i)),this.stateChangeCallbacks.message.forEach(t=>t(e))})}async _onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");let e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=e=>{this.log("worker","worker error",e.message),this.workerRef.terminate()},this.workerRef.onmessage=e=>{"keepAlive"===e.data.event&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}else this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(E.error))}_appendParams(e,t){if(0===Object.keys(t).length)return e;let s=e.match(/\?/)?"&":"?",r=new URLSearchParams(t);return`${e}${s}${r}`}_workerObjectUrl(e){let t;if(e)t=e;else{let e=new Blob([eB],{type:"application/javascript"});t=URL.createObjectURL(e)}return t}}class eU{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=j.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}var eQ=e.i(67034);class eW extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function eH(e){return"object"==typeof e&&null!==e&&"__isStorageError"in e}class eq extends eW{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class eK extends eW{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}let eG=t=>{let s;return s=t||("u"<typeof fetch?(...t)=>e.A(11737).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},eJ=e=>{if(Array.isArray(e))return e.map(e=>eJ(e));if("function"==typeof e||e!==Object(e))return e;let t={};return Object.entries(e).forEach(([e,s])=>{t[e.replace(/([-_][a-z])/gi,e=>e.toUpperCase().replace(/[-_]/g,""))]=eJ(s)}),t};var eV=function(e,t,s,r){return new(s||(s=Promise))(function(i,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function o(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})};let eZ=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e);function eX(t,s,r,i,n,a){return eV(this,void 0,void 0,function*(){return new Promise((o,l)=>{let c;t(r,(c={method:s,headers:(null==i?void 0:i.headers)||{}},"GET"===s?c:(c.headers=Object.assign({"Content-Type":"application/json"},null==i?void 0:i.headers),a&&(c.body=JSON.stringify(a)),Object.assign(Object.assign({},c),n)))).then(e=>{if(!e.ok)throw e;return(null==i?void 0:i.noResolveJson)?e:e.json()}).then(e=>o(e)).catch(t=>eV(void 0,void 0,void 0,function*(){var s,r,n,a;let o=yield(s=void 0,r=void 0,n=void 0,a=function*(){return"u"<typeof Response?(yield e.A(11737)).Response:Response},new(n||(n=Promise))(function(e,t){function i(e){try{l(a.next(e))}catch(e){t(e)}}function o(e){try{l(a.throw(e))}catch(e){t(e)}}function l(t){var s;t.done?e(t.value):((s=t.value)instanceof n?s:new n(function(e){e(s)})).then(i,o)}l((a=a.apply(s,r||[])).next())}));t instanceof o&&!(null==i?void 0:i.noResolveJson)?t.json().then(e=>{l(new eq(eZ(e),t.status||500))}).catch(e=>{l(new eK(eZ(e),e))}):l(new eK(eZ(t),t))}))})})}function eY(e,t,s,r){return eV(this,void 0,void 0,function*(){return eX(e,"GET",t,s,r)})}function e0(e,t,s,r,i){return eV(this,void 0,void 0,function*(){return eX(e,"POST",t,r,i,s)})}function e1(e,t,s,r,i){return eV(this,void 0,void 0,function*(){return eX(e,"DELETE",t,r,i,s)})}var e2=function(e,t,s,r){return new(s||(s=Promise))(function(i,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function o(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})};let e3={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},e5={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class e4{constructor(e,t={},s,r){this.url=e,this.headers=t,this.bucketId=s,this.fetch=eG(r)}uploadOrUpdate(e,t,s,r){return e2(this,void 0,void 0,function*(){try{let i,n=Object.assign(Object.assign({},e5),r),a=Object.assign(Object.assign({},this.headers),"POST"===e&&{"x-upsert":String(n.upsert)}),o=n.metadata;"u">typeof Blob&&s instanceof Blob?((i=new FormData).append("cacheControl",n.cacheControl),o&&i.append("metadata",this.encodeMetadata(o)),i.append("",s)):"u">typeof FormData&&s instanceof FormData?((i=s).append("cacheControl",n.cacheControl),o&&i.append("metadata",this.encodeMetadata(o))):(i=s,a["cache-control"]=`max-age=${n.cacheControl}`,a["content-type"]=n.contentType,o&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(o)))),(null==r?void 0:r.headers)&&(a=Object.assign(Object.assign({},a),r.headers));let l=this._removeEmptyFolders(t),c=this._getFinalPath(l),h=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:i,headers:a},(null==n?void 0:n.duplex)?{duplex:n.duplex}:{})),u=yield h.json();if(h.ok)return{data:{path:l,id:u.Id,fullPath:u.Key},error:null};return{data:null,error:u}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}upload(e,t,s){return e2(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,r){return e2(this,void 0,void 0,function*(){let i=this._removeEmptyFolders(e),n=this._getFinalPath(i),a=new URL(this.url+`/object/upload/sign/${n}`);a.searchParams.set("token",t);try{let e,t=Object.assign({upsert:e5.upsert},r),n=Object.assign(Object.assign({},this.headers),{"x-upsert":String(t.upsert)});"u">typeof Blob&&s instanceof Blob?((e=new FormData).append("cacheControl",t.cacheControl),e.append("",s)):"u">typeof FormData&&s instanceof FormData?(e=s).append("cacheControl",t.cacheControl):(e=s,n["cache-control"]=`max-age=${t.cacheControl}`,n["content-type"]=t.contentType);let o=yield this.fetch(a.toString(),{method:"PUT",body:e,headers:n}),l=yield o.json();if(o.ok)return{data:{path:i,fullPath:l.Key},error:null};return{data:null,error:l}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}createSignedUploadUrl(e,t){return e2(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),r=Object.assign({},this.headers);(null==t?void 0:t.upsert)&&(r["x-upsert"]="true");let i=yield e0(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:r}),n=new URL(this.url+i.url),a=n.searchParams.get("token");if(!a)throw new eW("No token returned by API");return{data:{signedUrl:n.toString(),path:e,token:a},error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}update(e,t,s){return e2(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return e2(this,void 0,void 0,function*(){try{return{data:yield e0(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}copy(e,t,s){return e2(this,void 0,void 0,function*(){try{return{data:{path:(yield e0(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:null==s?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}createSignedUrl(e,t,s){return e2(this,void 0,void 0,function*(){try{let r=this._getFinalPath(e),i=yield e0(this.fetch,`${this.url}/object/sign/${r}`,Object.assign({expiresIn:t},(null==s?void 0:s.transform)?{transform:s.transform}:{}),{headers:this.headers}),n=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:i={signedUrl:encodeURI(`${this.url}${i.signedURL}${n}`)},error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}createSignedUrls(e,t,s){return e2(this,void 0,void 0,function*(){try{let r=yield e0(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),i=(null==s?void 0:s.download)?`&download=${!0===s.download?"":s.download}`:"";return{data:r.map(e=>Object.assign(Object.assign({},e),{signedUrl:e.signedURL?encodeURI(`${this.url}${e.signedURL}${i}`):null})),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}download(e,t){return e2(this,void 0,void 0,function*(){let s=void 0!==(null==t?void 0:t.transform),r=this.transformOptsToQueryString((null==t?void 0:t.transform)||{}),i=r?`?${r}`:"";try{let t=this._getFinalPath(e),r=yield eY(this.fetch,`${this.url}/${s?"render/image/authenticated":"object"}/${t}${i}`,{headers:this.headers,noResolveJson:!0});return{data:yield r.blob(),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}info(e){return e2(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{let e=yield eY(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:eJ(e),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}exists(e){return e2(this,void 0,void 0,function*(){let t=this._getFinalPath(e);try{return yield function(e,t,s,r){return eV(this,void 0,void 0,function*(){return eX(e,"HEAD",t,Object.assign(Object.assign({},s),{noResolveJson:!0}),void 0)})}(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(e){if(eH(e)&&e instanceof eK){let t=e.originalError;if([400,404].includes(null==t?void 0:t.status))return{data:!1,error:e}}throw e}})}getPublicUrl(e,t){let s=this._getFinalPath(e),r=[],i=(null==t?void 0:t.download)?`download=${!0===t.download?"":t.download}`:"";""!==i&&r.push(i);let n=void 0!==(null==t?void 0:t.transform),a=this.transformOptsToQueryString((null==t?void 0:t.transform)||{});""!==a&&r.push(a);let o=r.join("&");return""!==o&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${n?"render/image":"object"}/public/${s}${o}`)}}}remove(e){return e2(this,void 0,void 0,function*(){try{return{data:yield e1(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}list(e,t,s){return e2(this,void 0,void 0,function*(){try{let r=Object.assign(Object.assign(Object.assign({},e3),t),{prefix:e||""});return{data:yield e0(this.fetch,`${this.url}/object/list/${this.bucketId}`,r,{headers:this.headers},s),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return void 0!==eQ.Buffer?eQ.Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){let t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}let e6={"X-Client-Info":"storage-js/2.7.1"};var e8=function(e,t,s,r){return new(s||(s=Promise))(function(i,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function o(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})};class e7{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},e6),t),this.fetch=eG(s)}listBuckets(){return e8(this,void 0,void 0,function*(){try{return{data:yield eY(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}getBucket(e){return e8(this,void 0,void 0,function*(){try{return{data:yield eY(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}createBucket(e,t={public:!1}){return e8(this,void 0,void 0,function*(){try{return{data:yield e0(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}updateBucket(e,t){return e8(this,void 0,void 0,function*(){try{return{data:yield function(e,t,s,r,i){return eV(this,void 0,void 0,function*(){return eX(e,"PUT",t,r,void 0,s)})}(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}emptyBucket(e){return e8(this,void 0,void 0,function*(){try{return{data:yield e0(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}deleteBucket(e){return e8(this,void 0,void 0,function*(){try{return{data:yield e1(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(e){if(eH(e))return{data:null,error:e};throw e}})}}class e9 extends e7{constructor(e,t={},s){super(e,t,s)}from(e){return new e4(this.url,this.headers,e,this.fetch)}}let te="";te="u">typeof Deno?"deno":"u">typeof document?"web":"u">typeof navigator&&"ReactNative"===navigator.product?"react-native":"node";let tt={headers:{"X-Client-Info":`supabase-js-${te}/2.48.1`}},ts={schema:"public"},tr={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},ti={};var tn=e.i(6085);let ta="2.67.3",to={"X-Client-Info":`gotrue-js/${ta}`},tl="X-Supabase-Api-Version",tc={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},th=()=>"u">typeof window&&"u">typeof document,tu={tested:!1,writable:!1},td=()=>{if(!th())return!1;try{if("object"!=typeof globalThis.localStorage)return!1}catch(e){return!1}if(tu.tested)return tu.writable;let e=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(e,e),globalThis.localStorage.removeItem(e),tu.tested=!0,tu.writable=!0}catch(e){tu.tested=!0,tu.writable=!1}return tu.writable},tp=t=>{let s;return s=t||("u"<typeof fetch?(...t)=>e.A(11737).then(({default:e})=>e(...t)):fetch),(...e)=>s(...e)},tf=async(e,t,s)=>{await e.setItem(t,JSON.stringify(s))},tm=async(e,t)=>{let s=await e.getItem(t);if(!s)return null;try{return JSON.parse(s)}catch(e){return s}},tg=async(e,t)=>{await e.removeItem(t)};class ty{constructor(){this.promise=new ty.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}function tb(e){let t=e.split(".");if(3!==t.length)throw Error("JWT is not valid: not a JWT structure");if(!/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}=?$|[a-z0-9_-]{2}(==)?$)$/i.test(t[1]))throw Error("JWT is not valid: payload is not in base64url format");return JSON.parse(function(e){let t,s,r,i,n,a,o,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",h=0;for(e=e.replace("-","+").replace("_","/");h<e.length;)i=l.indexOf(e.charAt(h++)),n=l.indexOf(e.charAt(h++)),a=l.indexOf(e.charAt(h++)),o=l.indexOf(e.charAt(h++)),t=i<<2|n>>4,s=(15&n)<<4|a>>2,r=(3&a)<<6|o,c+=String.fromCharCode(t),64!=a&&0!=s&&(c+=String.fromCharCode(s)),64!=o&&0!=r&&(c+=String.fromCharCode(r));return c}(t[1]))}async function tx(e){return await new Promise(t=>{setTimeout(()=>t(null),e)})}function tv(e){return("0"+e.toString(16)).substr(-2)}async function tw(e){let t=new TextEncoder().encode(e);return Array.from(new Uint8Array(await crypto.subtle.digest("SHA-256",t))).map(e=>String.fromCharCode(e)).join("")}async function t_(e){return"u">typeof crypto&&void 0!==crypto.subtle&&"u">typeof TextEncoder?btoa(await tw(e)).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,""):(console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),e)}async function tk(e,t,s=!1){let r=function(){let e=new Uint32Array(56);if("u"<typeof crypto){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",t=e.length,s="";for(let r=0;r<56;r++)s+=e.charAt(Math.floor(Math.random()*t));return s}return crypto.getRandomValues(e),Array.from(e,tv).join("")}(),i=r;s&&(i+="/PASSWORD_RECOVERY"),await tf(e,`${t}-code-verifier`,i);let n=await t_(r),a=r===n?"plain":"s256";return[n,a]}ty.promiseConstructor=Promise;let tj=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;class tS extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function tE(e){return"object"==typeof e&&null!==e&&"__isAuthError"in e}class tN extends tS{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}class tC extends tS{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class tR extends tS{constructor(e,t,s,r){super(e,s,r),this.name=t,this.status=s}}class tP extends tR{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}class tT extends tR{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class tO extends tR{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class t$ extends tR{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tF extends tR{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class tA extends tR{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function tI(e){return tE(e)&&"AuthRetryableFetchError"===e.name}class tM extends tR{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}var tD=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]]);return s};let tL=e=>e.msg||e.message||e.error_description||e.error||JSON.stringify(e),tB=[502,503,504];async function tz(e){var t;let s,r;if(!("object"==typeof e&&null!==e&&"status"in e&&"ok"in e&&"json"in e&&"function"==typeof e.json))throw new tA(tL(e),0);if(tB.includes(e.status))throw new tA(tL(e),e.status);try{s=await e.json()}catch(e){throw new tC(tL(e),e)}let i=function(e){let t=e.headers.get(tl);if(!t||!t.match(tj))return null;try{return new Date(`${t}T00:00:00.0Z`)}catch(e){return null}}(e);if(i&&i.getTime()>=tc["2024-01-01"].timestamp&&"object"==typeof s&&s&&"string"==typeof s.code?r=s.code:"object"==typeof s&&s&&"string"==typeof s.error_code&&(r=s.error_code),r){if("weak_password"===r)throw new tM(tL(s),e.status,(null==(t=s.weak_password)?void 0:t.reasons)||[]);else if("session_not_found"===r)throw new tP}else if("object"==typeof s&&s&&"object"==typeof s.weak_password&&s.weak_password&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0))throw new tM(tL(s),e.status,s.weak_password.reasons);throw new tN(tL(s),e.status||500,r)}async function tU(e,t,s,r){var i;let n=Object.assign({},null==r?void 0:r.headers);n[tl]||(n[tl]=tc["2024-01-01"].name),(null==r?void 0:r.jwt)&&(n.Authorization=`Bearer ${r.jwt}`);let a=null!=(i=null==r?void 0:r.query)?i:{};(null==r?void 0:r.redirectTo)&&(a.redirect_to=r.redirectTo);let o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await tQ(e,t,s+o,{headers:n,noResolveJson:null==r?void 0:r.noResolveJson},{},null==r?void 0:r.body);return(null==r?void 0:r.xform)?null==r?void 0:r.xform(l):{data:Object.assign({},l),error:null}}async function tQ(e,t,s,r,i,n){let a,o,l=(o={method:t,headers:(null==r?void 0:r.headers)||{}},"GET"===t?o:(o.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},null==r?void 0:r.headers),o.body=JSON.stringify(n),Object.assign(Object.assign({},o),i)));try{a=await e(s,Object.assign({},l))}catch(e){throw console.error(e),new tA(tL(e),0)}if(a.ok||await tz(a),null==r?void 0:r.noResolveJson)return a;try{return await a.json()}catch(e){await tz(e)}}function tW(e){var t,s,r;let i=null;(r=e).access_token&&r.refresh_token&&r.expires_in&&(i=Object.assign({},e),e.expires_at||(i.expires_at=(s=e.expires_in,Math.round(Date.now()/1e3)+s)));return{data:{session:i,user:null!=(t=e.user)?t:e},error:null}}function tH(e){let t=tW(e);return!t.error&&e.weak_password&&"object"==typeof e.weak_password&&Array.isArray(e.weak_password.reasons)&&e.weak_password.reasons.length&&e.weak_password.message&&"string"==typeof e.weak_password.message&&e.weak_password.reasons.reduce((e,t)=>e&&"string"==typeof t,!0)&&(t.data.weak_password=e.weak_password),t}function tq(e){var t;return{data:{user:null!=(t=e.user)?t:e},error:null}}function tK(e){return{data:e,error:null}}function tG(e){let{action_link:t,email_otp:s,hashed_token:r,redirect_to:i,verification_type:n}=e;return{data:{properties:{action_link:t,email_otp:s,hashed_token:r,redirect_to:i,verification_type:n},user:Object.assign({},tD(e,["action_link","email_otp","hashed_token","redirect_to","verification_type"]))},error:null}}function tJ(e){return e}var tV=function(e,t){var s={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(s[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(s[r[i]]=e[r[i]]);return s};class tZ{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=tp(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t="global"){try{return await tU(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(e){if(tE(e))return{data:null,error:e};throw e}}async inviteUserByEmail(e,t={}){try{return await tU(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:tq})}catch(e){if(tE(e))return{data:{user:null},error:e};throw e}}async generateLink(e){try{let{options:t}=e,s=tV(e,["options"]),r=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(r.new_email=null==s?void 0:s.newEmail,delete r.newEmail),await tU(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:r,headers:this.headers,xform:tG,redirectTo:null==t?void 0:t.redirectTo})}catch(e){if(tE(e))return{data:{properties:null,user:null},error:e};throw e}}async createUser(e){try{return await tU(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:tq})}catch(e){if(tE(e))return{data:{user:null},error:e};throw e}}async listUsers(e){var t,s,r,i,n,a,o;try{let l={nextPage:null,lastPage:0,total:0},c=await tU(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:null!=(s=null==(t=null==e?void 0:e.page)?void 0:t.toString())?s:"",per_page:null!=(i=null==(r=null==e?void 0:e.perPage)?void 0:r.toString())?i:""},xform:tJ});if(c.error)throw c.error;let h=await c.json(),u=null!=(n=c.headers.get("x-total-count"))?n:0,d=null!=(o=null==(a=c.headers.get("link"))?void 0:a.split(","))?o:[];return d.length>0&&(d.forEach(e=>{let t=parseInt(e.split(";")[0].split("=")[1].substring(0,1)),s=JSON.parse(e.split(";")[1].split("=")[1]);l[`${s}Page`]=t}),l.total=parseInt(u)),{data:Object.assign(Object.assign({},h),l),error:null}}catch(e){if(tE(e))return{data:{users:[]},error:e};throw e}}async getUserById(e){try{return await tU(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:tq})}catch(e){if(tE(e))return{data:{user:null},error:e};throw e}}async updateUserById(e,t){try{return await tU(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:tq})}catch(e){if(tE(e))return{data:{user:null},error:e};throw e}}async deleteUser(e,t=!1){try{return await tU(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:tq})}catch(e){if(tE(e))return{data:{user:null},error:e};throw e}}async _listFactors(e){try{let{data:t,error:s}=await tU(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:e=>({data:{factors:e},error:null})});return{data:t,error:s}}catch(e){if(tE(e))return{data:null,error:e};throw e}}async _deleteFactor(e){try{return{data:await tU(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(e){if(tE(e))return{data:null,error:e};throw e}}}let tX={getItem:e=>td()?globalThis.localStorage.getItem(e):null,setItem:(e,t)=>{td()&&globalThis.localStorage.setItem(e,t)},removeItem:e=>{td()&&globalThis.localStorage.removeItem(e)}};function tY(e={}){return{getItem:t=>e[t]||null,setItem:(t,s)=>{e[t]=s},removeItem:t=>{delete e[t]}}}let t0={debug:!!(globalThis&&td()&&globalThis.localStorage&&"true"===globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug"))};class t1 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class t2 extends t1{}async function t3(e,t,s){t0.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",e,t);let r=new globalThis.AbortController;return t>0&&setTimeout(()=>{r.abort(),t0.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",e)},t),await Promise.resolve().then(()=>globalThis.navigator.locks.request(e,0===t?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:r.signal},async r=>{if(r){t0.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",e,r.name);try{return await s()}finally{t0.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",e,r.name)}}if(0===t)throw t0.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",e),new t2(`Acquiring an exclusive Navigator LockManager lock "${e}" immediately failed`);if(t0.debug)try{let e=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(e,null,"  "))}catch(e){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",e)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await s()}))}if("object"!=typeof globalThis)try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch(e){"u">typeof self&&(self.globalThis=self)}let t5={url:"http://localhost:9999",storageKey:"supabase.auth.token",autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:to,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function t4(e,t,s){return await s()}class t6{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=t6.nextInstanceID,t6.nextInstanceID+=1,this.instanceID>0&&th()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const r=Object.assign(Object.assign({},t5),e);if(this.logDebugMessages=!!r.debug,"function"==typeof r.debug&&(this.logger=r.debug),this.persistSession=r.persistSession,this.storageKey=r.storageKey,this.autoRefreshToken=r.autoRefreshToken,this.admin=new tZ({url:r.url,headers:r.headers,fetch:r.fetch}),this.url=r.url,this.headers=r.headers,this.fetch=tp(r.fetch),this.lock=r.lock||t4,this.detectSessionInUrl=r.detectSessionInUrl,this.flowType=r.flowType,this.hasCustomAuthorizationHeader=r.hasCustomAuthorizationHeader,r.lock?this.lock=r.lock:th()&&(null==(t=null==globalThis?void 0:globalThis.navigator)?void 0:t.locks)?this.lock=t3:this.lock=t4,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?r.storage?this.storage=r.storage:td()?this.storage=tX:(this.memoryStorage={},this.storage=tY(this.memoryStorage)):(this.memoryStorage={},this.storage=tY(this.memoryStorage)),th()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(e){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",e)}null==(s=this.broadcastChannel)||s.addEventListener("message",async e=>{this._debug("received broadcast notification from other tab or client",e),await this._notifyAllSubscribers(e.data.event,e.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${ta}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise||(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))()),await this.initializePromise}async _initialize(){var e;try{let t=function(e){let t={},s=new URL(e);if(s.hash&&"#"===s.hash[0])try{new URLSearchParams(s.hash.substring(1)).forEach((e,s)=>{t[s]=e})}catch(e){}return s.searchParams.forEach((e,s)=>{t[s]=e}),t}(window.location.href),s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),th()&&this.detectSessionInUrl&&"none"!==s){let{data:r,error:i}=await this._getSessionFromURL(t,s);if(i){if(this._debug("#_initialize()","error detecting session from URL",i),tE(i)&&"AuthImplicitGrantRedirectError"===i.name){let t=null==(e=i.details)?void 0:e.code;if("identity_already_exists"===t||"identity_not_found"===t||"single_identity_not_deletable"===t)return{error:i}}return await this._removeSession(),{error:i}}let{session:n,redirectType:a}=r;return this._debug("#_initialize()","detected session in URL",n,"redirect type",a),await this._saveSession(n),setTimeout(async()=>{"recovery"===a?await this._notifyAllSubscribers("PASSWORD_RECOVERY",n):await this._notifyAllSubscribers("SIGNED_IN",n)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(e){if(tE(e))return{error:e};return{error:new tC("Unexpected error during initialization",e)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,r;try{let{data:i,error:n}=await tU(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:null!=(s=null==(t=null==e?void 0:e.options)?void 0:t.data)?s:{},gotrue_meta_security:{captcha_token:null==(r=null==e?void 0:e.options)?void 0:r.captchaToken}},xform:tW});if(n||!i)return{data:{user:null,session:null},error:n};let a=i.session,o=i.user;return i.session&&(await this._saveSession(i.session),await this._notifyAllSubscribers("SIGNED_IN",a)),{data:{user:o,session:a},error:null}}catch(e){if(tE(e))return{data:{user:null,session:null},error:e};throw e}}async signUp(e){var t,s,r;try{let i;if("email"in e){let{email:s,password:r,options:n}=e,a=null,o=null;"pkce"===this.flowType&&([a,o]=await tk(this.storage,this.storageKey)),i=await tU(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:null==n?void 0:n.emailRedirectTo,body:{email:s,password:r,data:null!=(t=null==n?void 0:n.data)?t:{},gotrue_meta_security:{captcha_token:null==n?void 0:n.captchaToken},code_challenge:a,code_challenge_method:o},xform:tW})}else if("phone"in e){let{phone:t,password:n,options:a}=e;i=await tU(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:t,password:n,data:null!=(s=null==a?void 0:a.data)?s:{},channel:null!=(r=null==a?void 0:a.channel)?r:"sms",gotrue_meta_security:{captcha_token:null==a?void 0:a.captchaToken}},xform:tW})}else throw new tO("You must provide either an email or phone number and a password");let{data:n,error:a}=i;if(a||!n)return{data:{user:null,session:null},error:a};let o=n.session,l=n.user;return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(e){if(tE(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithPassword(e){try{let t;if("email"in e){let{email:s,password:r,options:i}=e;t=await tU(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:tH})}else if("phone"in e){let{phone:s,password:r,options:i}=e;t=await tU(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},xform:tH})}else throw new tO("You must provide either an email or phone number and a password");let{data:s,error:r}=t;if(r)return{data:{user:null,session:null},error:r};if(!s||!s.session||!s.user)return{data:{user:null,session:null},error:new tT};return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:r}}catch(e){if(tE(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOAuth(e){var t,s,r,i;return await this._handleProviderSignIn(e.provider,{redirectTo:null==(t=e.options)?void 0:t.redirectTo,scopes:null==(s=e.options)?void 0:s.scopes,queryParams:null==(r=e.options)?void 0:r.queryParams,skipBrowserRedirect:null==(i=e.options)?void 0:i.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async _exchangeCodeForSession(e){let t=await tm(this.storage,`${this.storageKey}-code-verifier`),[s,r]=(null!=t?t:"").split("/");try{let{data:t,error:i}=await tU(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:tW});if(await tg(this.storage,`${this.storageKey}-code-verifier`),i)throw i;if(!t||!t.session||!t.user)return{data:{user:null,session:null,redirectType:null},error:new tT};return t.session&&(await this._saveSession(t.session),await this._notifyAllSubscribers("SIGNED_IN",t.session)),{data:Object.assign(Object.assign({},t),{redirectType:null!=r?r:null}),error:i}}catch(e){if(tE(e))return{data:{user:null,session:null,redirectType:null},error:e};throw e}}async signInWithIdToken(e){try{let{options:t,provider:s,token:r,access_token:i,nonce:n}=e,{data:a,error:o}=await tU(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:r,access_token:i,nonce:n,gotrue_meta_security:{captcha_token:null==t?void 0:t.captchaToken}},xform:tW});if(o)return{data:{user:null,session:null},error:o};if(!a||!a.session||!a.user)return{data:{user:null,session:null},error:new tT};return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",a.session)),{data:a,error:o}}catch(e){if(tE(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithOtp(e){var t,s,r,i,n;try{if("email"in e){let{email:r,options:i}=e,n=null,a=null;"pkce"===this.flowType&&([n,a]=await tk(this.storage,this.storageKey));let{error:o}=await tU(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:r,data:null!=(t=null==i?void 0:i.data)?t:{},create_user:null==(s=null==i?void 0:i.shouldCreateUser)||s,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken},code_challenge:n,code_challenge_method:a},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:o}}if("phone"in e){let{phone:t,options:s}=e,{data:a,error:o}=await tU(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:t,data:null!=(r=null==s?void 0:s.data)?r:{},create_user:null==(i=null==s?void 0:s.shouldCreateUser)||i,gotrue_meta_security:{captcha_token:null==s?void 0:s.captchaToken},channel:null!=(n=null==s?void 0:s.channel)?n:"sms"}});return{data:{user:null,session:null,messageId:null==a?void 0:a.message_id},error:o}}throw new tO("You must provide either an email or phone number.")}catch(e){if(tE(e))return{data:{user:null,session:null},error:e};throw e}}async verifyOtp(e){var t,s;try{let r,i;"options"in e&&(r=null==(t=e.options)?void 0:t.redirectTo,i=null==(s=e.options)?void 0:s.captchaToken);let{data:n,error:a}=await tU(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:i}}),redirectTo:r,xform:tW});if(a)throw a;if(!n)throw Error("An error occurred on token verification.");let o=n.session,l=n.user;return(null==o?void 0:o.access_token)&&(await this._saveSession(o),await this._notifyAllSubscribers("recovery"==e.type?"PASSWORD_RECOVERY":"SIGNED_IN",o)),{data:{user:l,session:o},error:null}}catch(e){if(tE(e))return{data:{user:null,session:null},error:e};throw e}}async signInWithSSO(e){var t,s,r;try{let i=null,n=null;return"pkce"===this.flowType&&([i,n]=await tk(this.storage,this.storageKey)),await tU(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:null!=(s=null==(t=e.options)?void 0:t.redirectTo)?s:void 0}),(null==(r=null==e?void 0:e.options)?void 0:r.captchaToken)?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:i,code_challenge_method:n}),headers:this.headers,xform:tK})}catch(e){if(tE(e))return{data:null,error:e};throw e}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{let{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new tP;let{error:r}=await tU(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:r}})}catch(e){if(tE(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{let t=`${this.url}/resend`;if("email"in e){let{email:s,type:r,options:i}=e,{error:n}=await tU(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}},redirectTo:null==i?void 0:i.emailRedirectTo});return{data:{user:null,session:null},error:n}}if("phone"in e){let{phone:s,type:r,options:i}=e,{data:n,error:a}=await tU(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:r,gotrue_meta_security:{captcha_token:null==i?void 0:i.captchaToken}}});return{data:{user:null,session:null,messageId:null==n?void 0:n.message_id},error:a}}throw new tO("You must provide either an email or phone number and a type")}catch(e){if(tE(e))return{data:{user:null,session:null},error:e};throw e}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async e=>e))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){let e=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await e,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch(e){}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;let e=t();for(this.pendingInLock.push((async()=>{try{await e}catch(e){}})()),await e;this.pendingInLock.length;){let e=[...this.pendingInLock];await Promise.all(e),this.pendingInLock.splice(0,e.length)}return await e}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{let t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",Error().stack);try{let e=null,t=await tm(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),null!==t&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};let s=!!e.expires_at&&e.expires_at<=Date.now()/1e3;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let t=this.suppressGetSessionWarning;e=new Proxy(e,{get:(e,s,r)=>(t||"user"!==s||(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),t=!0,this.suppressGetSessionWarning=!0),Reflect.get(e,s,r))})}return{data:{session:e},error:null}}let{session:r,error:i}=await this._callRefreshToken(e.refresh_token);if(i)return{data:{session:null},error:i};return{data:{session:r},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{if(e)return await tU(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:tq});return await this._useSession(async e=>{var t,s,r;let{data:i,error:n}=e;if(n)throw n;return(null==(t=i.session)?void 0:t.access_token)||this.hasCustomAuthorizationHeader?await tU(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:null!=(r=null==(s=i.session)?void 0:s.access_token)?r:void 0,xform:tq}):{data:{user:null},error:new tP}})}catch(e){if(tE(e))return tE(e)&&"AuthSessionMissingError"===e.name&&(await this._removeSession(),await tg(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:e};throw e}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{let{data:r,error:i}=s;if(i)throw i;if(!r.session)throw new tP;let n=r.session,a=null,o=null;"pkce"===this.flowType&&null!=e.email&&([a,o]=await tk(this.storage,this.storageKey));let{data:l,error:c}=await tU(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:null==t?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:o}),jwt:n.access_token,xform:tq});if(c)throw c;return n.user=l.user,await this._saveSession(n),await this._notifyAllSubscribers("USER_UPDATED",n),{data:{user:n.user},error:null}})}catch(e){if(tE(e))return{data:{user:null},error:e};throw e}}_decodeJWT(e){return tb(e)}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new tP;let t=Date.now()/1e3,s=t,r=!0,i=null,n=tb(e.access_token);if(n.exp&&(r=(s=n.exp)<=t),r){let{session:t,error:s}=await this._callRefreshToken(e.refresh_token);if(s)return{data:{user:null,session:null},error:s};if(!t)return{data:{user:null,session:null},error:null};i=t}else{let{data:r,error:n}=await this._getUser(e.access_token);if(n)throw n;i={access_token:e.access_token,refresh_token:e.refresh_token,user:r.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)}return{data:{user:i.user,session:i},error:null}}catch(e){if(tE(e))return{data:{session:null,user:null},error:e};throw e}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){let{data:r,error:i}=t;if(i)throw i;e=null!=(s=r.session)?s:void 0}if(!(null==e?void 0:e.refresh_token))throw new tP;let{session:r,error:i}=await this._callRefreshToken(e.refresh_token);return i?{data:{user:null,session:null},error:i}:r?{data:{user:r.user,session:r},error:null}:{data:{user:null,session:null},error:null}})}catch(e){if(tE(e))return{data:{user:null,session:null},error:e};throw e}}async _getSessionFromURL(e,t){try{if(!th())throw new t$("No browser detected.");if(e.error||e.error_description||e.error_code)throw new t$(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if("pkce"===this.flowType)throw new tF("Not a valid PKCE flow url.");break;case"pkce":if("implicit"===this.flowType)throw new t$("Not a valid implicit grant flow url.")}if("pkce"===t){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new tF("No code detected.");let{data:t,error:s}=await this._exchangeCodeForSession(e.code);if(s)throw s;let r=new URL(window.location.href);return r.searchParams.delete("code"),window.history.replaceState(window.history.state,"",r.toString()),{data:{session:t.session,redirectType:null},error:null}}let{provider_token:s,provider_refresh_token:r,access_token:i,refresh_token:n,expires_in:a,expires_at:o,token_type:l}=e;if(!i||!a||!n||!l)throw new t$("No session defined in URL");let c=Math.round(Date.now()/1e3),h=parseInt(a),u=c+h;o&&(u=parseInt(o));let d=u-c;1e3*d<=3e4&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${d}s, should have been closer to ${h}s`);let p=u-h;c-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,u,c):c-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,u,c);let{data:f,error:m}=await this._getUser(i);if(m)throw m;let g={provider_token:s,provider_refresh_token:r,access_token:i,expires_in:h,expires_at:u,refresh_token:n,token_type:l,user:f.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:g,redirectType:e.type},error:null}}catch(e){if(tE(e))return{data:{session:null,redirectType:null},error:e};throw e}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){let t=await tm(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;let{data:r,error:i}=t;if(i)return{error:i};let n=null==(s=r.session)?void 0:s.access_token;if(n){let{error:t}=await this.admin.signOut(n,e);if(t&&!(tE(t)&&"AuthApiError"===t.name&&(404===t.status||401===t.status||403===t.status)))return{error:t}}return"others"!==e&&(await this._removeSession(),await tg(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){let t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){let t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>{await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})})(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,r;try{let{data:{session:r},error:i}=t;if(i)throw i;await (null==(s=this.stateChangeEmitters.get(e))?void 0:s.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(t){await (null==(r=this.stateChangeEmitters.get(e))?void 0:r.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",t),console.error(t)}})}async resetPasswordForEmail(e,t={}){let s=null,r=null;"pkce"===this.flowType&&([s,r]=await tk(this.storage,this.storageKey,!0));try{return await tU(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:r,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(e){if(tE(e))return{data:null,error:e};throw e}}async getUserIdentities(){var e;try{let{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:null!=(e=t.user.identities)?e:[]},error:null}}catch(e){if(tE(e))return{data:null,error:e};throw e}}async linkIdentity(e){var t;try{let{data:s,error:r}=await this._useSession(async t=>{var s,r,i,n,a;let{data:o,error:l}=t;if(l)throw l;let c=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:null==(s=e.options)?void 0:s.redirectTo,scopes:null==(r=e.options)?void 0:r.scopes,queryParams:null==(i=e.options)?void 0:i.queryParams,skipBrowserRedirect:!0});return await tU(this.fetch,"GET",c,{headers:this.headers,jwt:null!=(a=null==(n=o.session)?void 0:n.access_token)?a:void 0})});if(r)throw r;return!th()||(null==(t=e.options)?void 0:t.skipBrowserRedirect)||window.location.assign(null==s?void 0:s.url),{data:{provider:e.provider,url:null==s?void 0:s.url},error:null}}catch(t){if(tE(t))return{data:{provider:e.provider,url:null},error:t};throw t}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,r;let{data:i,error:n}=t;if(n)throw n;return await tU(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:null!=(r=null==(s=i.session)?void 0:s.access_token)?r:void 0})})}catch(e){if(tE(e))return{data:null,error:e};throw e}}async _refreshAccessToken(e){let t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{var s,r;let i=Date.now();return await (s=async s=>(s>0&&await tx(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await tU(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:tW})),r=(e,t)=>{let s=200*Math.pow(2,e);return t&&tI(t)&&Date.now()+s-i<3e4},new Promise((e,t)=>{(async()=>{for(let i=0;i<1/0;i++)try{let t=await s(i);if(!r(i,null,t))return void e(t)}catch(e){if(!r(i,e))return void t(e)}})()}))}catch(e){if(this._debug(t,"error",e),tE(e))return{data:{session:null,user:null},error:e};throw e}finally{this._debug(t,"end")}}_isValidSession(e){return"object"==typeof e&&null!==e&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){let s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),th()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;let t="#_recoverAndRefresh()";this._debug(t,"begin");try{let s=await tm(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),null!==s&&await this._removeSession();return}let r=Math.round(Date.now()/1e3),i=(null!=(e=s.expires_at)?e:1/0)<r+10;if(this._debug(t,`session has${i?"":" not"} expired with margin of 10s`),i){if(this.autoRefreshToken&&s.refresh_token){let{error:e}=await this._callRefreshToken(s.refresh_token);e&&(console.error(e),tI(e)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",e),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(e){this._debug(t,"error",e),console.error(e);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new tP;if(this.refreshingDeferred)return this.refreshingDeferred.promise;let r=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(r,"begin");try{this.refreshingDeferred=new ty;let{data:t,error:s}=await this._refreshAccessToken(e);if(s)throw s;if(!t.session)throw new tP;await this._saveSession(t.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",t.session);let r={session:t.session,error:null};return this.refreshingDeferred.resolve(r),r}catch(e){if(this._debug(r,"error",e),tE(e)){let s={session:null,error:e};return tI(e)||await this._removeSession(),null==(t=this.refreshingDeferred)||t.resolve(s),s}throw null==(s=this.refreshingDeferred)||s.reject(e),e}finally{this.refreshingDeferred=null,this._debug(r,"end")}}async _notifyAllSubscribers(e,t,s=!0){let r=`#_notifyAllSubscribers(${e})`;this._debug(r,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});let r=[],i=Array.from(this.stateChangeEmitters.values()).map(async s=>{try{await s.callback(e,t)}catch(e){r.push(e)}});if(await Promise.all(i),r.length>0){for(let e=0;e<r.length;e+=1)console.error(r[e]);throw r[0]}}finally{this._debug(r,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await tf(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await tg(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");let e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&th()&&(null==window?void 0:window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(e){console.error("removing visibilitychange callback failed",e)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");let e=setInterval(()=>this._autoRefreshTokenTick(),3e4);this.autoRefreshTicker=e,e&&"object"==typeof e&&"function"==typeof e.unref?e.unref():"u">typeof Deno&&"function"==typeof Deno.unrefTimer&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");let e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{let e=Date.now();try{return await this._useSession(async t=>{let{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at)return void this._debug("#_autoRefreshTokenTick()","no session");let r=Math.floor((1e3*s.expires_at-e)/3e4);this._debug("#_autoRefreshTokenTick()",`access token expires in ${r} ticks, a tick lasts 30000ms, refresh threshold is 3 ticks`),r<=3&&await this._callRefreshToken(s.refresh_token)})}catch(e){console.error("Auto refresh tick failed with error. This is likely a transient error.",e)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof t1)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!th()||!(null==window?void 0:window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),null==window||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){let t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),"visible"===document.visibilityState?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{"visible"!==document.visibilityState?this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting"):await this._recoverAndRefresh()}))):"hidden"===document.visibilityState&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){let r=[`provider=${encodeURIComponent(t)}`];if((null==s?void 0:s.redirectTo)&&r.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),(null==s?void 0:s.scopes)&&r.push(`scopes=${encodeURIComponent(s.scopes)}`),"pkce"===this.flowType){let[e,t]=await tk(this.storage,this.storageKey),s=new URLSearchParams({code_challenge:`${encodeURIComponent(e)}`,code_challenge_method:`${encodeURIComponent(t)}`});r.push(s.toString())}if(null==s?void 0:s.queryParams){let e=new URLSearchParams(s.queryParams);r.push(e.toString())}return(null==s?void 0:s.skipBrowserRedirect)&&r.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${r.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;let{data:r,error:i}=t;return i?{data:null,error:i}:await tU(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:null==(s=null==r?void 0:r.session)?void 0:s.access_token})})}catch(e){if(tE(e))return{data:null,error:e};throw e}}async _enroll(e){try{return await this._useSession(async t=>{var s,r;let{data:i,error:n}=t;if(n)return{data:null,error:n};let a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},"phone"===e.factorType?{phone:e.phone}:{issuer:e.issuer}),{data:o,error:l}=await tU(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:null==(s=null==i?void 0:i.session)?void 0:s.access_token});return l?{data:null,error:l}:("totp"===e.factorType&&(null==(r=null==o?void 0:o.totp)?void 0:r.qr_code)&&(o.totp.qr_code=`data:image/svg+xml;utf-8,${o.totp.qr_code}`),{data:o,error:null})})}catch(e){if(tE(e))return{data:null,error:e};throw e}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;let{data:r,error:i}=t;if(i)return{data:null,error:i};let{data:n,error:a}=await tU(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:null==(s=null==r?void 0:r.session)?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+n.expires_in},n)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",n),{data:n,error:a})})}catch(e){if(tE(e))return{data:null,error:e};throw e}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;let{data:r,error:i}=t;return i?{data:null,error:i}:await tU(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:null==(s=null==r?void 0:r.session)?void 0:s.access_token})})}catch(e){if(tE(e))return{data:null,error:e};throw e}})}async _challengeAndVerify(e){let{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){let{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};let s=(null==e?void 0:e.factors)||[],r=s.filter(e=>"totp"===e.factor_type&&"verified"===e.status),i=s.filter(e=>"phone"===e.factor_type&&"verified"===e.status);return{data:{all:s,totp:r,phone:i},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;let{data:{session:r},error:i}=e;if(i)return{data:null,error:i};if(!r)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};let n=this._decodeJWT(r.access_token),a=null;n.aal&&(a=n.aal);let o=a;return(null!=(s=null==(t=r.user.factors)?void 0:t.filter(e=>"verified"===e.status))?s:[]).length>0&&(o="aal2"),{data:{currentLevel:a,nextLevel:o,currentAuthenticationMethods:n.amr||[]},error:null}}))}}t6.nextInstanceID=0;let t8=t6;class t7 extends t8{constructor(e){super(e)}}let t9=new class e{constructor(e,t,s){var r,i,n;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw Error("supabaseUrl is required.");if(!t)throw Error("supabaseKey is required.");const a=e.replace(/\/$/,"");this.realtimeUrl=`${a}/realtime/v1`.replace(/^http/i,"ws"),this.authUrl=`${a}/auth/v1`,this.storageUrl=`${a}/storage/v1`,this.functionsUrl=`${a}/functions/v1`;const o=`sb-${new URL(this.authUrl).hostname.split(".")[0]}-auth-token`,l=function(e,t){let{db:s,auth:r,realtime:i,global:n}=e,{db:a,auth:o,realtime:l,global:c}=t,h={db:Object.assign(Object.assign({},a),s),auth:Object.assign(Object.assign({},o),r),realtime:Object.assign(Object.assign({},l),i),global:Object.assign(Object.assign({},c),n),accessToken:()=>{var e,t,s,r;return e=this,t=void 0,r=function*(){return""},new(s=void 0,s=Promise)(function(i,n){function a(e){try{l(r.next(e))}catch(e){n(e)}}function o(e){try{l(r.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?i(e.value):((t=e.value)instanceof s?t:new s(function(e){e(t)})).then(a,o)}l((r=r.apply(e,t||[])).next())})}};return e.accessToken?h.accessToken=e.accessToken:delete h.accessToken,h}(null!=s?s:{},{db:ts,realtime:ti,auth:Object.assign(Object.assign({},tr),{storageKey:o}),global:tt});this.storageKey=null!=(r=l.auth.storageKey)?r:"",this.headers=null!=(i=l.global.headers)?i:{},l.accessToken?(this.accessToken=l.accessToken,this.auth=new Proxy({},{get:(e,t)=>{throw Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(t)} is not possible`)}})):this.auth=this._initSupabaseAuthClient(null!=(n=l.auth)?n:{},this.headers,l.global.fetch),this.fetch=((e,t,s)=>{let r,i=(r=s||("u"<typeof fetch?tn.default:fetch),(...e)=>r(...e)),n="u"<typeof Headers?tn.Headers:Headers;return(s,r)=>{var a,o,l,c;return a=void 0,o=void 0,l=void 0,c=function*(){var a;let o=null!=(a=yield t())?a:e,l=new n(null==r?void 0:r.headers);return l.has("apikey")||l.set("apikey",e),l.has("Authorization")||l.set("Authorization",`Bearer ${o}`),i(s,Object.assign(Object.assign({},r),{headers:l}))},new(l||(l=Promise))(function(e,t){function s(e){try{i(c.next(e))}catch(e){t(e)}}function r(e){try{i(c.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):((i=t.value)instanceof l?i:new l(function(e){e(i)})).then(s,r)}i((c=c.apply(a,o||[])).next())})}})(t,this._getAccessToken.bind(this),l.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},l.realtime)),this.rest=new eg(`${a}/rest/v1`,{headers:this.headers,schema:l.db.schema,fetch:this.fetch}),l.accessToken||this._listenForAuthEvents()}get functions(){return new em(this.functionsUrl,{headers:this.headers,customFetch:this.fetch})}get storage(){return new e9(this.storageUrl,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t,s,r,i,n;return s=this,r=void 0,i=void 0,n=function*(){if(this.accessToken)return yield this.accessToken();let{data:s}=yield this.auth.getSession();return null!=(t=null==(e=s.session)?void 0:e.access_token)?t:null},new(i||(i=Promise))(function(e,t){function a(e){try{l(n.next(e))}catch(e){t(e)}}function o(e){try{l(n.throw(e))}catch(e){t(e)}}function l(t){var s;t.done?e(t.value):((s=t.value)instanceof i?s:new i(function(e){e(s)})).then(a,o)}l((n=n.apply(s,r||[])).next())})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,storageKey:i,flowType:n,lock:a,debug:o},l,c){let h={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new t7({url:this.authUrl,headers:Object.assign(Object.assign({},h),l),storageKey:i,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:r,flowType:n,lock:a,debug:o,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new ez(this.realtimeUrl,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},null==e?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((e,t)=>{this._handleTokenChanged(e,"CLIENT",null==t?void 0:t.access_token)})}_handleTokenChanged(e,t,s){("TOKEN_REFRESHED"===e||"SIGNED_IN"===e)&&this.changedAccessToken!==s?this.changedAccessToken=s:"SIGNED_OUT"===e&&(this.realtime.setAuth(),"STORAGE"==t&&this.auth.signOut(),this.changedAccessToken=void 0)}}("https://jextayidnmtsoofugnig.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpleHRheWlkbm10c29vZnVnbmlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwODM1MDAsImV4cCI6MjA4NDY1OTUwMH0.vxRq32MPWyO_znst5nFCiQ7AWJtlJeOFWMY-RlZmjrs",void 0);async function se(e,t,s,r,i,n){console.log("[Supabase] Uploading metadata:",{cid:e,deviceId:s,mimeType:i,fileSize:t,hasUserKeyHash:!!n});try{let a=await fetch("/api/supabase/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"uploadMetadata",cid:e,fileSize:t,deviceId:s,nonce:r,mimeType:i,userKeyHash:n})}),o=await a.json();if(o.success)return console.log("[Supabase] Metadata uploaded via proxy:",o.data?.[0]?.id),o.data;console.warn("[Supabase] Proxy failed, trying direct client:",o.error)}catch(e){console.warn("[Supabase] Proxy error, trying direct client:",e)}let{data:a,error:o}=await t9.from("photos_metadata").insert([{cid:e,file_size_bytes:t,device_id:s,nonce:r,mime_type:i,user_key_hash:n}]).select();if(o)throw console.error("[Supabase] Metadata Upload Error:",{code:o.code,message:o.message,details:o.details,hint:o.hint}),o;return console.log("[Supabase] Metadata uploaded successfully:",a?.[0]?.id),a}async function st(e,t){if(!t)return console.error("loadCIDsFromSupabase: userKeyHash is required"),[];try{let e=await fetch("/api/supabase/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"loadCIDs",userKeyHash:t})}),s=await e.json();if(s.success)return console.log("[Supabase] CIDs loaded via proxy:",s.data?.length),s.data||[];console.warn("[Supabase] Proxy failed, trying direct client:",s.error)}catch(e){console.warn("[Supabase] Proxy error, trying direct client:",e)}let{data:s,error:r}=await t9.from("photos_metadata").select("cid, device_id, uploaded_at, file_size_bytes, nonce, mime_type").eq("user_key_hash",t).order("uploaded_at",{ascending:!1});if(r)throw console.error("Supabase Load Error:",r),r;return s||[]}async function ss(e,t){if(!t)return!1;let{data:s,error:r}=await t9.from("photos_metadata").select("id").eq("cid",e).eq("user_key_hash",t).single();return r&&"PGRST116"!==r.code&&console.error("Supabase Check Error:",r),!!s}async function sr(e){try{let t=await fetch("/api/supabase/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"deleteMetadata",cid:e})}),s=await t.json();if(s.success)return void console.log("[Supabase] Metadata deleted via proxy");console.warn("[Supabase] Proxy failed, trying direct client:",s.error)}catch(e){console.warn("[Supabase] Proxy error, trying direct client:",e)}let{error:t}=await t9.from("photos_metadata").delete().eq("cid",e);if(t)throw console.error("Supabase Delete Error:",t),t}async function si(e,t,s,r,i){if(!r||0===r.length)throw console.error("registerDevice: userKeyHash is required"),Error("userKeyHash is required for device registration");try{let n=await fetch("/api/supabase/proxy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"registerDevice",id:e,deviceName:t,deviceType:s,userKeyHash:r,userId:i})}),a=await n.json();if(a.success)return console.log("[Supabase] Device registered via proxy:",a.updated?"updated":"inserted"),!0;console.warn("[Supabase] Proxy failed, trying direct client:",a.error)}catch(e){console.warn("[Supabase] Proxy error, trying direct client:",e)}let{data:n}=await t9.from("devices").select("id").eq("user_id",i).eq("device_name",t).eq("device_type",s||"").single();if(n){let{error:e}=await t9.from("devices").update({device_name:t,device_type:s,user_key_hash:r}).eq("id",n.id);if(e)throw console.error("[Supabase] Device Update Error:",e),e;return console.log("[Supabase] Device updated:",n.id),!0}let{error:a}=await t9.from("devices").insert({id:e,device_name:t,device_type:s,user_key_hash:r,user_id:i});if(a){if(a.message?.includes("Device limit exceeded"))throw Error("DEVICE_LIMIT_EXCEEDED");throw console.error("[Supabase] Device Insert Error:",a),a}return console.log("[Supabase] Device inserted:",e),!0}async function sn(e){let{data:t,error:s}=await t9.from("devices").select("*").eq("user_key_hash",e).order("created_at",{ascending:!1});if(s)throw console.error("Supabase Get Devices Error:",s),s;return t||[]}var sa=e.i(52789);let so="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySW5mb3JtYXRpb24iOnsiaWQiOiJlYTcxMDdjNi0yMGE0LTQ5Y2ItODAyYy1kMmRhOWM2Nzk4NjUiLCJlbWFpbCI6ImVpbmFyQGJsYWNrLWtuaWdodC5kZXYiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwicGluX3BvbGljeSI6eyJyZWdpb25zIjpbeyJkZXNpcmVkUmVwbGljYXRpb25Db3VudCI6MSwiaWQiOiJGUkExIn0seyJkZXNpcmVkUmVwbGljYXRpb25Db3VudCI6MSwiaWQiOiJOWUMxIn1dLCJ2ZXJzaW9uIjoxfSwibWZhX2VuYWJsZWQiOmZhbHNlLCJzdGF0dXMiOiJBQ1RJVkUifSwiYXV0aGVudGljYXRpb25UeXBlIjoic2NvcGVkS2V5Iiwic2NvcGVkS2V5S2V5IjoiNjkyYjcyYTBlOTk2NDhmNjQ4NjgiLCJzY29wZWRLZXlTZWNyZXQiOiJmMmM3ZDUwMWE3NjhiMWI3NTI3ODExODAyZTg1YzJlNmUyZDc5ZjA0YTM1ZTA4ZjNmYWJiYmRiMmFlMGMzMmUwIiwiZXhwIjoxODAwNjgxOTMzfQ.g47clgfFIHt9Bw-pjvytmuMPO8FSXgAsSfhcXaP-YII",sl="red-able-bug-554.mypinata.cloud";async function sc(e,t,s){return console.log("[IPFS] Starting upload to Pinata...",{blobSize:e.size,fileName:t}),new Promise((r,i)=>{let n=new XMLHttpRequest;n.open("POST","https://api.pinata.cloud/pinning/pinFileToIPFS"),n.setRequestHeader("Authorization",`Bearer ${so}`),n.timeout=12e4,n.upload.onprogress=e=>{if(e.lengthComputable&&s){let t=Math.round(e.loaded/e.total*100);console.log(`[IPFS] Upload progress: ${t}%`),s(t)}},n.onload=()=>{if(console.log("[IPFS] XHR onload, status:",n.status),n.status>=200&&n.status<300)try{let e=JSON.parse(n.responseText);console.log("[IPFS] Upload success, CID:",e.IpfsHash),r(e.IpfsHash)}catch(e){console.error("[IPFS] Failed to parse response:",n.responseText),i(Error("Failed to parse Pinata response"))}else console.error("[IPFS] Upload failed:",{status:n.status,response:n.responseText}),i(Error(`IPFS upload failed: ${n.status} - ${n.responseText}`))},n.onerror=e=>{console.error("[IPFS] XHR network error:",e),i(Error("Network error during IPFS upload - check connection"))},n.ontimeout=()=>{console.error("[IPFS] Upload timeout (2 min)"),i(Error("IPFS upload timeout - file too large or slow connection"))};let a=new FormData;a.append("file",e,t||"encrypted-photo.bin");let o=JSON.stringify({name:t||"photovault-encrypted",keyvalues:{app:"photovault",type:"encrypted-photo"}});a.append("pinataMetadata",o);let l=JSON.stringify({cidVersion:1});a.append("pinataOptions",l),console.log("[IPFS] Sending XHR..."),n.send(a)})}async function sh(e){console.log(`[IPFS] Downloading CID: ${e}`);try{console.log("[IPFS] Trying API proxy...");let t=await fetch(`/api/ipfs/download?cid=${encodeURIComponent(e)}`);if(t.ok){let e=await t.blob();return console.log(`[IPFS] API proxy succeeded, size: ${e.size} bytes`),e}console.warn(`[IPFS] API proxy failed: ${t.status}`)}catch(e){console.warn("[IPFS] API proxy error:",e)}let t=sl.startsWith("http")?sl:sl.includes(".")?`https://${sl}`:`https://${sl}.mypinata.cloud`,s=[()=>{let s=new URL(`${t}/ipfs/${e}`);return s.searchParams.set("pinataGatewayToken","q1z_4lRpNW9NNmISiMudoy79QVUJ_7-V6s5CDJvEM-CadXIF_WIWW5Xizui72HvA"),s.toString()},()=>`https://cloudflare-ipfs.com/ipfs/${e}`],r=new AbortController;try{let e=s.map(async(e,t)=>{let s=e();console.log(`[IPFS] Trying gateway ${t+1}: ${s.substring(0,60)}...`);let i=await fetch(s,{signal:r.signal,mode:"cors",credentials:"omit"});if(!i.ok)throw Error(`Gateway failed: ${i.status}`);return console.log(`[IPFS] Gateway ${t+1} succeeded`),i.blob()}),t=await Promise.any(e);return r.abort(),console.log(`[IPFS] Download complete, size: ${t.size} bytes`),t}catch(t){throw r.abort(),console.error("[IPFS] All methods failed:",t),Error(`IPFS download failed for CID: ${e}. Check network/CORS.`)}}async function su(e){let t=await fetch(`https://api.pinata.cloud/pinning/unpin/${e}`,{method:"DELETE",headers:{Authorization:`Bearer ${so}`}});t.ok||console.error("Pinata unpin failed:",await t.text())}let sd=async(e,t,s)=>{try{console.log("Uploading to IPFS...",{size:e.size,fileName:t});let r=await sc(e,t,s);return console.log("IPFS upload successful:",r),r}catch(e){throw console.error("Remote Storage Upload failed:",e),e}},sp=async e=>{try{console.log("Downloading from IPFS:",e);let t=await sh(e);return console.log("IPFS download successful:",{cid:e,size:t.size}),t}catch(e){throw console.error("Remote Storage Download failed:",e),e}};function sf(e){return e.startsWith("Qm")||e.startsWith("bafy")||e.startsWith("bafk")}var sm=e.i(75523);let sg=e=>{let t,s=new Set,r=(e,r)=>{let i="function"==typeof e?e(t):e;if(!Object.is(i,t)){let e=t;t=(null!=r?r:"object"!=typeof i||null===i)?i:Object.assign({},t,i),s.forEach(s=>s(t,e))}},i=()=>t,n={setState:r,getState:i,getInitialState:()=>a,subscribe:e=>(s.add(e),()=>s.delete(e))},a=t=e(r,i,n);return n};function sy(e,t){let s;try{s=e()}catch(e){return}return{getItem:e=>{var r;let i=e=>null===e?null:JSON.parse(e,null==t?void 0:t.reviver),n=null!=(r=s.getItem(e))?r:null;return n instanceof Promise?n.then(i):i(n)},setItem:(e,r)=>s.setItem(e,JSON.stringify(r,null==t?void 0:t.replacer)),removeItem:e=>s.removeItem(e)}}let sb=e=>t=>{try{let s=e(t);if(s instanceof Promise)return s;return{then:e=>sb(e)(s),catch(e){return this}}}catch(e){return{then(e){return this},catch:t=>sb(t)(e)}}},sx=(a=(l=(t=e=>({backupActive:!1,autoBackupEnabled:!0,backgroundBackupEnabled:!1,selectedPlan:"free",lastBackup:"Noch nie",permanence:0,setBackupActive:t=>e({backupActive:t}),setAutoBackupEnabled:t=>e({autoBackupEnabled:t}),setBackgroundBackupEnabled:t=>e({backgroundBackupEnabled:t}),setSelectedPlan:t=>e({selectedPlan:t}),setLastBackup:t=>e({lastBackup:t}),setPermanence:t=>e({permanence:t})}),s={name:"photovault-settings",storage:sy(()=>localStorage)},(e,r,i)=>{let n,a={storage:sy(()=>localStorage),partialize:e=>e,version:0,merge:(e,t)=>({...t,...e}),...s},o=!1,l=0,c=new Set,h=new Set,u=a.storage;if(!u)return t((...t)=>{console.warn(`[zustand persist middleware] Unable to update item '${a.name}', the given storage is currently unavailable.`),e(...t)},r,i);let d=()=>{let e=a.partialize({...r()});return u.setItem(a.name,{state:e,version:a.version})},p=i.setState;i.setState=(e,t)=>(p(e,t),d());let f=t((...t)=>(e(...t),d()),r,i);i.getInitialState=()=>f;let m=()=>{var t,s;if(!u)return;let i=++l;o=!1,c.forEach(e=>{var t;return e(null!=(t=r())?t:f)});let p=(null==(s=a.onRehydrateStorage)?void 0:s.call(a,null!=(t=r())?t:f))||void 0;return sb(u.getItem.bind(u))(a.name).then(e=>{if(e)if("number"!=typeof e.version||e.version===a.version)return[!1,e.state];else{if(a.migrate){let t=a.migrate(e.state,e.version);return t instanceof Promise?t.then(e=>[!0,e]):[!0,t]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}return[!1,void 0]}).then(t=>{var s;if(i!==l)return;let[o,c]=t;if(e(n=a.merge(c,null!=(s=r())?s:f),!0),o)return d()}).then(()=>{i===l&&(null==p||p(n,void 0),n=r(),o=!0,h.forEach(e=>e(n)))}).catch(e=>{i===l&&(null==p||p(void 0,e))})};return i.persist={setOptions:e=>{a={...a,...e},e.storage&&(u=e.storage)},clearStorage:()=>{null==u||u.removeItem(a.name)},getOptions:()=>a,rehydrate:()=>m(),hasHydrated:()=>o,onHydrate:e=>(c.add(e),()=>{c.delete(e)}),onFinishHydration:e=>(h.add(e),()=>{h.delete(e)})},a.skipHydration||m(),n||f}))?sg(l):sg,Object.assign(o=e=>(function(e,t=e=>e){let s=I.default.useSyncExternalStore(e.subscribe,I.default.useCallback(()=>t(e.getState()),[e,t]),I.default.useCallback(()=>t(e.getInitialState()),[e,t]));return I.default.useDebugValue(s),s})(a,e),a),o);var sv=Object.defineProperty,sw=Object.getOwnPropertySymbols,s_=Object.prototype.hasOwnProperty,sk=Object.prototype.propertyIsEnumerable,sj=(e,t,s)=>t in e?sv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,sS=(e,t)=>{for(var s in t||(t={}))s_.call(t,s)&&sj(e,s,t[s]);if(sw)for(var s of sw(t))sk.call(t,s)&&sj(e,s,t[s]);return e},sE=(e,t)=>{var s={};for(var r in e)s_.call(e,r)&&0>t.indexOf(r)&&(s[r]=e[r]);if(null!=e&&sw)for(var r of sw(e))0>t.indexOf(r)&&sk.call(e,r)&&(s[r]=e[r]);return s};(e=>{let t=class t{constructor(e,s,r,n){if(this.version=e,this.errorCorrectionLevel=s,this.modules=[],this.isFunction=[],e<t.MIN_VERSION||e>t.MAX_VERSION)throw RangeError("Version value out of range");if(n<-1||n>7)throw RangeError("Mask value out of range");this.size=4*e+17;let a=[];for(let e=0;e<this.size;e++)a.push(!1);for(let e=0;e<this.size;e++)this.modules.push(a.slice()),this.isFunction.push(a.slice());this.drawFunctionPatterns();const o=this.addEccAndInterleave(r);if(this.drawCodewords(o),-1==n){let e=1e9;for(let t=0;t<8;t++){this.applyMask(t),this.drawFormatBits(t);const s=this.getPenaltyScore();s<e&&(n=t,e=s),this.applyMask(t)}}i(0<=n&&n<=7),this.mask=n,this.applyMask(n),this.drawFormatBits(n),this.isFunction=[]}static encodeText(s,r){let i=e.QrSegment.makeSegments(s);return t.encodeSegments(i,r)}static encodeBinary(s,r){let i=e.QrSegment.makeBytes(s);return t.encodeSegments([i],r)}static encodeSegments(e,r,n=1,o=40,l=-1,c=!0){let h,u;if(!(t.MIN_VERSION<=n&&n<=o&&o<=t.MAX_VERSION)||l<-1||l>7)throw RangeError("Invalid value");for(h=n;;h++){let s=8*t.getNumDataCodewords(h,r),i=a.getTotalBits(e,h);if(i<=s){u=i;break}if(h>=o)throw RangeError("Data too long")}for(let e of[t.Ecc.MEDIUM,t.Ecc.QUARTILE,t.Ecc.HIGH])c&&u<=8*t.getNumDataCodewords(h,e)&&(r=e);let d=[];for(let t of e)for(let e of(s(t.mode.modeBits,4,d),s(t.numChars,t.mode.numCharCountBits(h),d),t.getData()))d.push(e);i(d.length==u);let p=8*t.getNumDataCodewords(h,r);i(d.length<=p),s(0,Math.min(4,p-d.length),d),s(0,(8-d.length%8)%8,d),i(d.length%8==0);for(let e=236;d.length<p;e^=253)s(e,8,d);let f=[];for(;8*f.length<d.length;)f.push(0);return d.forEach((e,t)=>f[t>>>3]|=e<<7-(7&t)),new t(h,r,f,l)}getModule(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]}getModules(){return this.modules}drawFunctionPatterns(){for(let e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);let e=this.getAlignmentPatternPositions(),t=e.length;for(let s=0;s<t;s++)for(let r=0;r<t;r++)(0!=s||0!=r)&&(0!=s||r!=t-1)&&(s!=t-1||0!=r)&&this.drawAlignmentPattern(e[s],e[r]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(e){let t=this.errorCorrectionLevel.formatBits<<3|e,s=t;for(let e=0;e<10;e++)s=s<<1^(s>>>9)*1335;let n=(t<<10|s)^21522;i(n>>>15==0);for(let e=0;e<=5;e++)this.setFunctionModule(8,e,r(n,e));this.setFunctionModule(8,7,r(n,6)),this.setFunctionModule(8,8,r(n,7)),this.setFunctionModule(7,8,r(n,8));for(let e=9;e<15;e++)this.setFunctionModule(14-e,8,r(n,e));for(let e=0;e<8;e++)this.setFunctionModule(this.size-1-e,8,r(n,e));for(let e=8;e<15;e++)this.setFunctionModule(8,this.size-15+e,r(n,e));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let e=this.version;for(let t=0;t<12;t++)e=e<<1^(e>>>11)*7973;let t=this.version<<12|e;i(t>>>18==0);for(let e=0;e<18;e++){let s=r(t,e),i=this.size-11+e%3,n=Math.floor(e/3);this.setFunctionModule(i,n,s),this.setFunctionModule(n,i,s)}}drawFinderPattern(e,t){for(let s=-4;s<=4;s++)for(let r=-4;r<=4;r++){let i=Math.max(Math.abs(r),Math.abs(s)),n=e+r,a=t+s;0<=n&&n<this.size&&0<=a&&a<this.size&&this.setFunctionModule(n,a,2!=i&&4!=i)}}drawAlignmentPattern(e,t){for(let s=-2;s<=2;s++)for(let r=-2;r<=2;r++)this.setFunctionModule(e+r,t+s,1!=Math.max(Math.abs(r),Math.abs(s)))}setFunctionModule(e,t,s){this.modules[t][e]=s,this.isFunction[t][e]=!0}addEccAndInterleave(e){let s=this.version,r=this.errorCorrectionLevel;if(e.length!=t.getNumDataCodewords(s,r))throw RangeError("Invalid argument");let n=t.NUM_ERROR_CORRECTION_BLOCKS[r.ordinal][s],a=t.ECC_CODEWORDS_PER_BLOCK[r.ordinal][s],o=Math.floor(t.getNumRawDataModules(s)/8),l=n-o%n,c=Math.floor(o/n),h=[],u=t.reedSolomonComputeDivisor(a);for(let s=0,r=0;s<n;s++){let i=e.slice(r,r+c-a+(s<l?0:1));r+=i.length;let n=t.reedSolomonComputeRemainder(i,u);s<l&&i.push(0),h.push(i.concat(n))}let d=[];for(let e=0;e<h[0].length;e++)h.forEach((t,s)=>{(e!=c-a||s>=l)&&d.push(t[e])});return i(d.length==o),d}drawCodewords(e){if(e.length!=Math.floor(t.getNumRawDataModules(this.version)/8))throw RangeError("Invalid argument");let s=0;for(let t=this.size-1;t>=1;t-=2){6==t&&(t=5);for(let i=0;i<this.size;i++)for(let n=0;n<2;n++){let a=t-n,o=(t+1&2)==0?this.size-1-i:i;!this.isFunction[o][a]&&s<8*e.length&&(this.modules[o][a]=r(e[s>>>3],7-(7&s)),s++)}}i(s==8*e.length)}applyMask(e){if(e<0||e>7)throw RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++){let r;switch(e){case 0:r=(s+t)%2==0;break;case 1:r=t%2==0;break;case 2:r=s%3==0;break;case 3:r=(s+t)%3==0;break;case 4:r=(Math.floor(s/3)+Math.floor(t/2))%2==0;break;case 5:r=s*t%2+s*t%3==0;break;case 6:r=(s*t%2+s*t%3)%2==0;break;case 7:r=((s+t)%2+s*t%3)%2==0;break;default:throw Error("Unreachable")}!this.isFunction[t][s]&&r&&(this.modules[t][s]=!this.modules[t][s])}}getPenaltyScore(){let e=0;for(let s=0;s<this.size;s++){let r=!1,i=0,n=[0,0,0,0,0,0,0];for(let a=0;a<this.size;a++)this.modules[s][a]==r?5==++i?e+=t.PENALTY_N1:i>5&&e++:(this.finderPenaltyAddHistory(i,n),r||(e+=this.finderPenaltyCountPatterns(n)*t.PENALTY_N3),r=this.modules[s][a],i=1);e+=this.finderPenaltyTerminateAndCount(r,i,n)*t.PENALTY_N3}for(let s=0;s<this.size;s++){let r=!1,i=0,n=[0,0,0,0,0,0,0];for(let a=0;a<this.size;a++)this.modules[a][s]==r?5==++i?e+=t.PENALTY_N1:i>5&&e++:(this.finderPenaltyAddHistory(i,n),r||(e+=this.finderPenaltyCountPatterns(n)*t.PENALTY_N3),r=this.modules[a][s],i=1);e+=this.finderPenaltyTerminateAndCount(r,i,n)*t.PENALTY_N3}for(let s=0;s<this.size-1;s++)for(let r=0;r<this.size-1;r++){let i=this.modules[s][r];i==this.modules[s][r+1]&&i==this.modules[s+1][r]&&i==this.modules[s+1][r+1]&&(e+=t.PENALTY_N2)}let s=0;for(let e of this.modules)s=e.reduce((e,t)=>e+ +!!t,s);let r=this.size*this.size,n=Math.ceil(Math.abs(20*s-10*r)/r)-1;return i(0<=n&&n<=9),i(0<=(e+=n*t.PENALTY_N4)&&e<=2568888),e}getAlignmentPatternPositions(){if(1==this.version)return[];{let e=Math.floor(this.version/7)+2,t=32==this.version?26:2*Math.ceil((4*this.version+4)/(2*e-2)),s=[6];for(let r=this.size-7;s.length<e;r-=t)s.splice(1,0,r);return s}}static getNumRawDataModules(e){if(e<t.MIN_VERSION||e>t.MAX_VERSION)throw RangeError("Version number out of range");let s=(16*e+128)*e+64;if(e>=2){let t=Math.floor(e/7)+2;s-=(25*t-10)*t-55,e>=7&&(s-=36)}return i(208<=s&&s<=29648),s}static getNumDataCodewords(e,s){return Math.floor(t.getNumRawDataModules(e)/8)-t.ECC_CODEWORDS_PER_BLOCK[s.ordinal][e]*t.NUM_ERROR_CORRECTION_BLOCKS[s.ordinal][e]}static reedSolomonComputeDivisor(e){if(e<1||e>255)throw RangeError("Degree out of range");let s=[];for(let t=0;t<e-1;t++)s.push(0);s.push(1);let r=1;for(let i=0;i<e;i++){for(let e=0;e<s.length;e++)s[e]=t.reedSolomonMultiply(s[e],r),e+1<s.length&&(s[e]^=s[e+1]);r=t.reedSolomonMultiply(r,2)}return s}static reedSolomonComputeRemainder(e,s){let r=s.map(e=>0);for(let i of e){let e=i^r.shift();r.push(0),s.forEach((s,i)=>r[i]^=t.reedSolomonMultiply(s,e))}return r}static reedSolomonMultiply(e,t){if(e>>>8!=0||t>>>8!=0)throw RangeError("Byte out of range");let s=0;for(let r=7;r>=0;r--)s=s<<1^(s>>>7)*285^(t>>>r&1)*e;return i(s>>>8==0),s}finderPenaltyCountPatterns(e){let t=e[1];i(t<=3*this.size);let s=t>0&&e[2]==t&&e[3]==3*t&&e[4]==t&&e[5]==t;return(s&&e[0]>=4*t&&e[6]>=t?1:0)+(s&&e[6]>=4*t&&e[0]>=t?1:0)}finderPenaltyTerminateAndCount(e,t,s){return e&&(this.finderPenaltyAddHistory(t,s),t=0),t+=this.size,this.finderPenaltyAddHistory(t,s),this.finderPenaltyCountPatterns(s)}finderPenaltyAddHistory(e,t){0==t[0]&&(e+=this.size),t.pop(),t.unshift(e)}};function s(e,t,s){if(t<0||t>31||e>>>t!=0)throw RangeError("Value out of range");for(let r=t-1;r>=0;r--)s.push(e>>>r&1)}function r(e,t){return(e>>>t&1)!=0}function i(e){if(!e)throw Error("Assertion error")}t.MIN_VERSION=1,t.MAX_VERSION=40,t.PENALTY_N1=3,t.PENALTY_N2=3,t.PENALTY_N3=40,t.PENALTY_N4=10,t.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],t.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],e.QrCode=t;let n=class e{constructor(e,t,s){if(this.mode=e,this.numChars=t,this.bitData=s,t<0)throw RangeError("Invalid argument");this.bitData=s.slice()}static makeBytes(t){let r=[];for(let e of t)s(e,8,r);return new e(e.Mode.BYTE,t.length,r)}static makeNumeric(t){if(!e.isNumeric(t))throw RangeError("String contains non-numeric characters");let r=[];for(let e=0;e<t.length;){let i=Math.min(t.length-e,3);s(parseInt(t.substring(e,e+i),10),3*i+1,r),e+=i}return new e(e.Mode.NUMERIC,t.length,r)}static makeAlphanumeric(t){let r;if(!e.isAlphanumeric(t))throw RangeError("String contains unencodable characters in alphanumeric mode");let i=[];for(r=0;r+2<=t.length;r+=2){let n=45*e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r));s(n+=e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r+1)),11,i)}return r<t.length&&s(e.ALPHANUMERIC_CHARSET.indexOf(t.charAt(r)),6,i),new e(e.Mode.ALPHANUMERIC,t.length,i)}static makeSegments(t){return""==t?[]:e.isNumeric(t)?[e.makeNumeric(t)]:e.isAlphanumeric(t)?[e.makeAlphanumeric(t)]:[e.makeBytes(e.toUtf8ByteArray(t))]}static makeEci(t){let r=[];if(t<0)throw RangeError("ECI assignment value out of range");if(t<128)s(t,8,r);else if(t<16384)s(2,2,r),s(t,14,r);else if(t<1e6)s(6,3,r),s(t,21,r);else throw RangeError("ECI assignment value out of range");return new e(e.Mode.ECI,0,r)}static isNumeric(t){return e.NUMERIC_REGEX.test(t)}static isAlphanumeric(t){return e.ALPHANUMERIC_REGEX.test(t)}getData(){return this.bitData.slice()}static getTotalBits(e,t){let s=0;for(let r of e){let e=r.mode.numCharCountBits(t);if(r.numChars>=1<<e)return 1/0;s+=4+e+r.bitData.length}return s}static toUtf8ByteArray(e){e=encodeURI(e);let t=[];for(let s=0;s<e.length;s++)"%"!=e.charAt(s)?t.push(e.charCodeAt(s)):(t.push(parseInt(e.substring(s+1,s+3),16)),s+=2);return t}};n.NUMERIC_REGEX=/^[0-9]*$/,n.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,n.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let a=n;e.QrSegment=n})(F||(F={})),v=(x=F||(F={})).QrCode||(x.QrCode={}),(r=class{constructor(e,t){this.ordinal=e,this.formatBits=t}}).LOW=new r(0,1),r.MEDIUM=new r(1,0),r.QUARTILE=new r(2,3),r.HIGH=new r(3,2),v.Ecc=r,_=(w=F||(F={})).QrSegment||(w.QrSegment={}),(i=class{constructor(e,t){this.modeBits=e,this.numBitsCharCount=t}numCharCountBits(e){return this.numBitsCharCount[Math.floor((e+7)/17)]}}).NUMERIC=new i(1,[10,12,14]),i.ALPHANUMERIC=new i(2,[9,11,13]),i.BYTE=new i(4,[8,16,16]),i.KANJI=new i(8,[8,10,12]),i.ECI=new i(7,[0,0,0]),_.Mode=i;var sN=F,sC={L:sN.QrCode.Ecc.LOW,M:sN.QrCode.Ecc.MEDIUM,Q:sN.QrCode.Ecc.QUARTILE,H:sN.QrCode.Ecc.HIGH},sR="#FFFFFF",sP="#000000";function sT(e,t=0){let s=[];return e.forEach(function(e,r){let i=null;e.forEach(function(n,a){if(!n&&null!==i){s.push(`M${i+t} ${r+t}h${a-i}v1H${i+t}z`),i=null;return}if(a===e.length-1){if(!n)return;null===i?s.push(`M${a+t},${r+t} h1v1H${a+t}z`):s.push(`M${i+t},${r+t} h${a+1-i}v1H${i+t}z`);return}n&&null===i&&(i=a)})}),s.join("")}function sO(e,t){return e.slice().map((e,s)=>s<t.y||s>=t.y+t.h?e:e.map((e,s)=>(s<t.x||s>=t.x+t.w)&&e))}function s$({value:e,level:t,minVersion:s,includeMargin:r,marginSize:i,imageSettings:n,size:a,boostLevel:o}){let l=I.default.useMemo(()=>{let r=(Array.isArray(e)?e:[e]).reduce((e,t)=>(e.push(...sN.QrSegment.makeSegments(t)),e),[]);return sN.QrCode.encodeSegments(r,sC[t],s,void 0,void 0,o)},[e,t,s,o]),{cells:c,margin:h,numCells:u,calculatedImageSettings:d}=I.default.useMemo(()=>{let e=l.getModules(),t=null!=i?Math.max(Math.floor(i),0):4*!!r,s=e.length+2*t,o=function(e,t,s,r){if(null==r)return null;let i=e.length+2*s,n=Math.floor(.1*t),a=i/t,o=(r.width||n)*a,l=(r.height||n)*a,c=null==r.x?e.length/2-o/2:r.x*a,h=null==r.y?e.length/2-l/2:r.y*a,u=null==r.opacity?1:r.opacity,d=null;if(r.excavate){let e=Math.floor(c),t=Math.floor(h),s=Math.ceil(o+c-e),r=Math.ceil(l+h-t);d={x:e,y:t,w:s,h:r}}return{x:c,y:h,h:l,w:o,excavation:d,opacity:u,crossOrigin:r.crossOrigin}}(e,a,t,n);return{cells:e,margin:t,numCells:s,calculatedImageSettings:o}},[l,a,n,r,i]);return{qrcode:l,margin:h,cells:c,numCells:u,calculatedImageSettings:d}}var sF=function(){try{new Path2D().addPath(new Path2D)}catch(e){return!1}return!0}();I.default.forwardRef(function(e,t){let{value:s,size:r=128,level:i="L",bgColor:n=sR,fgColor:a=sP,includeMargin:o=!1,minVersion:l=1,boostLevel:c,marginSize:h,imageSettings:u}=e,d=sE(e,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:p}=d,f=sE(d,["style"]),m=null==u?void 0:u.src,g=I.default.useRef(null),y=I.default.useRef(null),b=I.default.useCallback(e=>{g.current=e,"function"==typeof t?t(e):t&&(t.current=e)},[t]),[x,v]=I.default.useState(!1),{margin:w,cells:_,numCells:k,calculatedImageSettings:j}=s$({value:s,level:i,minVersion:l,boostLevel:c,includeMargin:o,marginSize:h,imageSettings:u,size:r});I.default.useEffect(()=>{if(null!=g.current){let e=g.current,t=e.getContext("2d");if(!t)return;let s=_,i=y.current,o=null!=j&&null!==i&&i.complete&&0!==i.naturalHeight&&0!==i.naturalWidth;o&&null!=j.excavation&&(s=sO(_,j.excavation));let l=window.devicePixelRatio||1;e.height=e.width=r*l;let c=r/k*l;t.scale(c,c),t.fillStyle=n,t.fillRect(0,0,k,k),t.fillStyle=a,sF?t.fill(new Path2D(sT(s,w))):_.forEach(function(e,s){e.forEach(function(e,r){e&&t.fillRect(r+w,s+w,1,1)})}),j&&(t.globalAlpha=j.opacity),o&&t.drawImage(i,j.x+w,j.y+w,j.w,j.h)}}),I.default.useEffect(()=>{v(!1)},[m]);let S=sS({height:r,width:r},p),E=null;return null!=m&&(E=I.default.createElement("img",{src:m,key:m,style:{display:"none"},onLoad:()=>{v(!0)},ref:y,crossOrigin:null==j?void 0:j.crossOrigin})),I.default.createElement(I.default.Fragment,null,I.default.createElement("canvas",sS({style:S,height:r,width:r,ref:b,role:"img"},f)),E)}).displayName="QRCodeCanvas";var sA=I.default.forwardRef(function(e,t){let{value:s,size:r=128,level:i="L",bgColor:n=sR,fgColor:a=sP,includeMargin:o=!1,minVersion:l=1,boostLevel:c,title:h,marginSize:u,imageSettings:d}=e,p=sE(e,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:f,cells:m,numCells:g,calculatedImageSettings:y}=s$({value:s,level:i,minVersion:l,boostLevel:c,includeMargin:o,marginSize:u,imageSettings:d,size:r}),b=m,x=null;null!=d&&null!=y&&(null!=y.excavation&&(b=sO(m,y.excavation)),x=I.default.createElement("image",{href:d.src,height:y.h,width:y.w,x:y.x+f,y:y.y+f,preserveAspectRatio:"none",opacity:y.opacity,crossOrigin:y.crossOrigin}));let v=sT(b,f);return I.default.createElement("svg",sS({height:r,width:r,viewBox:`0 0 ${g} ${g}`,ref:t,role:"img"},p),!!h&&I.default.createElement("title",null,h),I.default.createElement("path",{fill:n,d:`M0,0 h${g}v${g}H0z`,shapeRendering:"crispEdges"}),I.default.createElement("path",{fill:a,d:v,shapeRendering:"crispEdges"}),x)});sA.displayName="QRCodeSVG";var sI=e.i(37727);let sM=(0,M.default)("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function sD({isOpen:e,onClose:t}){let[s,r]=(0,I.useState)("show"),[i,n]=(0,I.useState)(""),[a,o]=(0,I.useState)(!1),[l,c]=(0,I.useState)(null),[h,u]=(0,I.useState)(!1),{recoveryPhrase:d,restoreFromPhrase:p}=el(),f=async()=>{if(d)try{await navigator.clipboard.writeText(d),o(!0),setTimeout(()=>o(!1),2e3)}catch{console.error("Failed to copy to clipboard")}};return e?(0,A.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 px-6 backdrop-blur-sm",children:(0,A.jsxs)(X,{className:"bg-white w-full max-w-[380px] p-0 shadow-2xl overflow-hidden",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between p-4 border-b-2 border-[#2563EB]/10",children:[(0,A.jsx)("h2",{className:"sketch-heading text-[20px] text-[#1D1D1F]",children:"GerÃ¤t verbinden"}),(0,A.jsx)("button",{onClick:t,className:"w-10 h-10 flex items-center justify-center rounded-full hover:bg-black/5",children:(0,A.jsx)(sI.X,{className:"w-5 h-5 text-[#6E6E73]"})})]}),(0,A.jsxs)("div",{className:"flex border-b-2 border-[#2563EB]/10",children:[(0,A.jsxs)("button",{onClick:()=>r("show"),className:`flex-1 py-4 sketch-subheading text-[15px] flex items-center justify-center gap-2 transition-colors ${"show"===s?"text-[#2563EB] bg-[#2563EB]/5":"text-[#6E6E73]"}`,children:[(0,A.jsx)(sM,{className:"w-4 h-4"}),"Zeigen"]}),(0,A.jsx)("button",{onClick:()=>r("input"),className:`flex-1 py-4 sketch-subheading text-[15px] flex items-center justify-center gap-2 transition-colors ${"input"===s?"text-[#2563EB] bg-[#2563EB]/5":"text-[#6E6E73]"}`,children:"Eingeben"})]}),(0,A.jsx)("div",{className:"p-5",children:"show"===s?(0,A.jsxs)("div",{className:"flex flex-col items-center",children:[(0,A.jsx)("p",{className:"sketch-body text-[14px] text-[#6E6E73] text-center mb-6",children:"Scanne den QR-Code oder kopiere den SchlÃ¼ssel."}),d&&(0,A.jsx)("div",{className:"mb-6",children:(0,A.jsx)(X,{className:"p-4 bg-white",children:(0,A.jsx)(sA,{value:d,size:180,level:"M",includeMargin:!1})})}),(0,A.jsx)("div",{className:"w-full mb-6",children:(0,A.jsxs)(X,{className:"bg-[#2563EB]/5 p-3",children:[(0,A.jsx)("p",{className:"sketch-body text-[11px] text-[#6E6E73] mb-1",children:"Backup-Phrase:"}),(0,A.jsx)("p",{className:"sketch-subheading text-[13px] break-all leading-relaxed",children:d||"Kein SchlÃ¼ssel"})]})}),(0,A.jsx)(Z.SketchButton,{onClick:f,disabled:!d,className:"w-full",size:"md",children:a?"âœ“ Kopiert!":"Phrase kopieren"})]}):(0,A.jsxs)("div",{className:"flex flex-col",children:[(0,A.jsx)("p",{className:"sketch-body text-[14px] text-[#6E6E73] text-center mb-6",children:"Gib den SchlÃ¼ssel deines anderen GerÃ¤ts ein."}),(0,A.jsx)(es,{value:i,onChange:e=>{n(e),c(null)},placeholder:"SchlÃ¼ssel hier einfÃ¼gen...",rows:3,className:"mb-4"}),l&&(0,A.jsx)("p",{className:"sketch-body text-[14px] text-[#FF3B30] text-center mb-4 italic",children:l}),h&&(0,A.jsx)("p",{className:"sketch-body text-[14px] text-[#30D158] text-center mb-4 font-bold",children:"âœ“ Erfolg!"}),(0,A.jsx)(Z.SketchButton,{onClick:()=>{(c(null),i.trim())?p(i.trim())?(u(!0),n(""),setTimeout(()=>{u(!1),t()},1500)):c("UngÃ¼ltiger SchlÃ¼ssel. Bitte Ã¼berprÃ¼fe die Eingabe."):c("Bitte gib einen SchlÃ¼ssel ein")},disabled:!i.trim()||h,className:"w-full",size:"md",children:h?"Verbunden":"Verbinden"}),(0,A.jsx)("p",{className:"sketch-body text-[11px] text-[#FF9500] text-center mt-6",children:"Achtung: Dies ersetzt deinen aktuellen SchlÃ¼ssel!"})]})})]})}):null}function sL({state:t,setState:s,onRestartOnboarding:r,authUser:i}){let[n,a]=(0,I.useState)(!1),[o,l]=(0,I.useState)(!1),[c,h]=(0,I.useState)(!1),[u,d]=(0,I.useState)(!1),[p,f]=(0,I.useState)(!1),[m,g]=(0,I.useState)(!1),[y,b]=(0,I.useState)([]),[x,v]=(0,I.useState)(!1),[w,_]=(0,I.useState)({current:0,total:0}),k=sx(e=>e.autoBackupEnabled),j=sx(e=>e.setAutoBackupEnabled),S=sx(e=>e.backgroundBackupEnabled),E=sx(e=>e.setBackgroundBackupEnabled),N=sx(e=>e.selectedPlan),C=sx(e=>e.setSelectedPlan),R=sx(e=>e.setLastBackup),{secretKey:P,recoveryPhrase:T,generateNewKey:O,clearKey:$}=el(),F=(0,sa.getDeviceId)(),[M,D]=(0,I.useState)(null);(0,I.useEffect)(()=>{P&&e.A(88936).then(e=>e.getUserKeyHash(P)).then(D)},[P]),(0,I.useEffect)(()=>{M&&(async()=>{try{let e=await sn(M);b(e)}catch(e){console.error("Failed to fetch devices:",e)}})()},[M]);let L=T?.split("-").slice(0,12)||[],B=async()=>{if(!x&&P){v(!0),console.log("[Backup] Starting manual backup to IPFS...");try{let e=(await (0,sm.getAllPhotos)()).filter(e=>e.encryptedBlob);_({current:0,total:e.length});let t=0,s=(0,sa.getDeviceId)(),r=M||await (0,ea.getUserKeyHash)(P);for(let i of e)if(i.encryptedBlob)try{if(!await ss(i.cid,r)){let e=await sd(i.encryptedBlob,i.fileName);console.log(`[Backup] Uploaded to IPFS: ${e}`),await se(e,i.fileSize,s,i.nonce,i.mimeType,r)}t++,_({current:t,total:e.length})}catch(e){console.error(`[Backup] Failed to upload ${i.cid}:`,e)}R("Gerade eben"),console.log(`[Backup] Complete: ${t} photos processed`)}catch(e){console.error("[Backup] Failed:",e)}finally{v(!1),_({current:0,total:0})}}},z=async()=>{$(),await O()&&s(e=>({...e,photosCount:0})),h(!1)},[U,Q]=(0,I.useState)(!1),[W,q]=(0,I.useState)(!1),K=async()=>{try{let{db:t}=await e.A(334);await t.delete(),localStorage.clear(),window.location.reload()}catch(e){console.error("Failed to clear cache:",e)}};if(n){let e=y.map(e=>({id:e.id,name:e.device_name||"Unbekanntes GerÃ¤t",lastActive:e.id===F?"Aktiv":function(e){if(!e)return"Unbekannt";let t=new Date(e),s=new Date().getTime()-t.getTime(),r=Math.floor(s/6e4),i=Math.floor(s/36e5),n=Math.floor(s/864e5);return r<1?"Gerade eben":r<60?`vor ${r} Min.`:i<24?`vor ${i} Std.`:n<7?`vor ${n} Tagen`:t.toLocaleDateString("de-DE")}(e.created_at),syncing:!1}));return 0===e.length&&e.push({id:F,name:"Dieses GerÃ¤t",lastActive:"Aktiv",syncing:!1}),(0,A.jsx)(sB,{devices:e,onBack:()=>a(!1),onAddDevice:()=>{a(!1),Q(!0)}})}return(0,A.jsxs)("div",{className:"h-full flex flex-col pb-4 overflow-y-auto",children:[(0,A.jsx)("header",{className:"px-5 pt-6 pb-4 bg-[#FAFBFC]",children:(0,A.jsx)("h1",{className:"sketch-heading text-[32px]",children:"Einstellungen"})}),(0,A.jsxs)("div",{className:"flex-1 px-5",children:[(0,A.jsxs)("div",{className:"mb-8",children:[(0,A.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"Backup"}),(0,A.jsxs)(X,{className:"overflow-hidden p-0",children:[(0,A.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"sketch-subheading text-[17px]",children:"Automatisches Backup"}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Neue Fotos automatisch sichern"})]}),(0,A.jsx)(Y,{checked:k,onChange:()=>{j(!k)}})]}),(0,A.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,A.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"sketch-subheading text-[17px]",children:"Hintergrund-Backup"}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:"Weiter sichern wenn App geschlossen"})]}),(0,A.jsx)(Y,{checked:S,onChange:()=>{E(!S)}})]}),(0,A.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,A.jsxs)("button",{onClick:()=>f(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#2563EB]/5 transition-colors",children:[(0,A.jsxs)("div",{className:"flex items-center gap-4",children:[(0,A.jsx)(ee,{icon:"folder",size:28}),(0,A.jsxs)("div",{className:"text-left",children:[(0,A.jsx)("span",{className:"sketch-subheading text-[17px] block",children:"Backup-Quelle"}),(0,A.jsx)("span",{className:"sketch-body text-[14px] text-[#6E6E73]",children:"photos-app"===t.photoSource?"Fotos-App":"Dateien-App"})]})]}),(0,A.jsx)(J,{name:"chevronRight",size:16,className:"opacity-40"})]})]}),(0,A.jsx)("div",{className:"px-4 mt-4",children:(0,A.jsx)(Z.SketchButton,{onClick:B,disabled:x||!P,className:"w-full",size:"lg",children:x?(0,A.jsxs)(A.Fragment,{children:[(0,A.jsx)(H.Loader2,{className:"w-5 h-5 animate-spin mr-2"}),w.total>0?`${w.current}/${w.total}`:"Wait..."]}):"Jetzt sichern"})}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73] px-4 mt-3 text-center",children:"Alle lokalen Fotos in die Cloud hochladen"})]}),(0,A.jsxs)("div",{className:"mb-8",children:[(0,A.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"Speicher"}),(0,A.jsxs)(X,{className:"overflow-hidden p-0",children:[(0,A.jsxs)("div",{className:"p-4",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,A.jsx)("span",{className:"sketch-subheading text-[17px]",children:"Aktueller Plan"}),(0,A.jsx)("span",{className:"sketch-subheading text-[16px] text-[#2563EB]",children:"free"===N?"Free":"Backup+"})]}),(0,A.jsx)("p",{className:"sketch-body text-[14px] text-[#6E6E73]",children:"free"===N?"Fotos nur auf deinen GerÃ¤ten":"200 GB Cloud-Backup aktiv"})]}),(0,A.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,A.jsx)("div",{className:"p-4",children:(0,A.jsxs)("div",{className:"flex items-center justify-between",children:[(0,A.jsx)("span",{className:"sketch-body text-[15px] text-[#6E6E73]",children:"Verwendet"}),(0,A.jsxs)("span",{className:"sketch-subheading text-[15px]",children:[t.photosCount.toLocaleString()," Fotos (lokal)"]})]})}),(0,A.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,A.jsxs)("button",{onClick:()=>g(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#2563EB]/5 transition-colors",children:[(0,A.jsx)("span",{className:"sketch-subheading text-[17px] text-[#2563EB]",children:"free"===N?"Upgrade zu Backup+":"Plan verwalten"}),(0,A.jsx)(J,{name:"chevronRight",size:16,className:"opacity-40"})]})]})]}),(0,A.jsxs)("div",{className:"mb-8",children:[(0,A.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"GerÃ¤te"}),(0,A.jsx)(X,{className:"overflow-hidden p-0",children:(0,A.jsxs)("button",{onClick:()=>a(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#2563EB]/5 transition-colors",children:[(0,A.jsxs)("div",{className:"flex items-center gap-4",children:[(0,A.jsx)(ee,{icon:"photo",size:28}),(0,A.jsx)("span",{className:"sketch-subheading text-[17px]",children:"Verbundene GerÃ¤te"})]}),(0,A.jsxs)("div",{className:"flex items-center gap-3",children:[(0,A.jsx)("span",{className:"sketch-body text-[15px] text-[#6E6E73]",children:y.length||1}),(0,A.jsx)(J,{name:"chevronRight",size:16,className:"opacity-40"})]})]})})]}),(0,A.jsxs)("div",{className:"mb-8",children:[(0,A.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"Sicherheit"}),(0,A.jsxs)(X,{className:"overflow-hidden p-0",children:[(0,A.jsxs)("button",{onClick:()=>l(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#2563EB]/5 transition-colors",children:[(0,A.jsx)("span",{className:"sketch-subheading text-[17px]",children:"Backup-Phrase anzeigen"}),(0,A.jsx)(J,{name:"chevronRight",size:16,className:"opacity-40"})]}),(0,A.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,A.jsxs)("button",{onClick:()=>h(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#FF3B30]/5 transition-colors",children:[(0,A.jsx)("span",{className:"sketch-subheading text-[17px] text-[#FF3B30]",children:"Neuen SchlÃ¼ssel erstellen"}),(0,A.jsx)(J,{name:"chevronRight",size:16,className:"opacity-40"})]})]}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73] px-4 mt-3",children:"Teile diese WÃ¶rter niemals mit anderen."})]}),(0,A.jsxs)("div",{className:"mb-8",children:[(0,A.jsx)("h2",{className:"sketch-subheading text-[15px] uppercase tracking-wide px-4 mb-3",children:"Wartung"}),(0,A.jsx)(X,{className:"overflow-hidden p-0",children:(0,A.jsxs)("button",{onClick:()=>q(!0),className:"w-full flex items-center justify-between p-4 hover:bg-[#FF9500]/5 transition-colors",children:[(0,A.jsxs)("div",{className:"flex items-center gap-4",children:[(0,A.jsx)(ee,{icon:"warning",size:28,color:"#FF9500"}),(0,A.jsx)("span",{className:"sketch-subheading text-[17px] text-[#FF9500]",children:"Lokalen Cache leeren"})]}),(0,A.jsx)(J,{name:"chevronRight",size:16,className:"opacity-40"})]})}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73] px-4 mt-3",children:"LÃ¶scht lokale Vorschaubilder. Deine Cloud-Fotos bleiben sicher."})]})]}),o&&(0,A.jsx)(sQ,{title:"Sicherheitshinweis",message:"Deine Backup-Phrase gibt vollen Zugriff auf deine verschlÃ¼sselten Fotos. Nur an einem privaten Ort anzeigen.",confirmLabel:"Phrase anzeigen",confirmDestructive:!1,onConfirm:()=>{l(!1),d(!0)},onCancel:()=>l(!1)}),u&&(0,A.jsx)("div",{className:"fixed inset-0 bg-black/60 flex items-center justify-center z-50 p-6 backdrop-blur-sm",children:(0,A.jsxs)(X,{className:"bg-white w-full max-w-[400px] p-6 shadow-2xl",children:[(0,A.jsx)("h3",{className:"sketch-heading text-[24px] text-center mb-2",children:"Back-up Phrase"}),(0,A.jsx)("p",{className:"sketch-body text-[14px] text-[#6E6E73] text-center mb-6",children:"Notiere diese WÃ¶rter sicher."}),L.length>0?(0,A.jsx)("div",{className:"grid grid-cols-2 gap-3 mb-6",children:L.map((e,t)=>(0,A.jsxs)(X,{className:"p-2 text-center bg-[#2563EB]/5",children:[(0,A.jsx)("span",{className:"sketch-body text-[10px] text-[#6E6E73] block",children:t+1}),(0,A.jsx)("span",{className:"sketch-subheading text-[14px]",children:e})]},t))}):(0,A.jsx)("div",{className:"mb-6",children:(0,A.jsx)(X,{className:"bg-[#FF9500]/5 border-[#FF9500] p-4",children:(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#FF9500] text-center",children:"Kein SchlÃ¼ssel gefunden."})})}),(0,A.jsx)(Z.SketchButton,{onClick:()=>d(!1),className:"w-full",children:"Fertig"})]})}),c&&(0,A.jsx)(sQ,{title:"Datenverlust-Warnung",message:"Das Erstellen eines neuen SchlÃ¼ssels lÃ¶scht alle vorhandenen Backup-Daten permanent. Diese Aktion kann nicht rÃ¼ckgÃ¤ngig gemacht werden.",confirmLabel:"Neuen SchlÃ¼ssel erstellen",confirmDestructive:!0,onConfirm:z,onCancel:()=>h(!1)}),p&&(0,A.jsx)(sz,{currentSource:t.photoSource,onSelect:e=>{console.log("Update backup source preference:",e),s(t=>({...t,photoSource:e})),f(!1)},onClose:()=>f(!1)}),m&&(0,A.jsx)(sU,{currentPlan:N,onSelect:e=>{console.log("Update plan:",e),C(e),g(!1)},onClose:()=>g(!1)}),W&&(0,A.jsx)(sQ,{title:"Cache leeren?",message:"Dies wird lokale Vorschaubilder und GerÃ¤tedaten lÃ¶schen. Deine verschlÃ¼sselten Fotos in der Cloud bleiben sicher. Die App wird neu geladen.",confirmLabel:"Cache leeren",confirmDestructive:!0,onConfirm:K,onCancel:()=>q(!1)}),(0,A.jsx)(sD,{isOpen:U,onClose:()=>Q(!1)})]})}function sB({devices:e,onBack:t,onAddDevice:s}){return(0,A.jsxs)("div",{className:"h-full flex flex-col pb-4 overflow-y-auto bg-[#FAFBFC]",children:[(0,A.jsxs)("header",{className:"px-5 pt-6 pb-4 bg-[#FAFBFC]",children:[(0,A.jsx)("button",{onClick:t,className:"sketch-body text-[#2563EB] mb-2 flex items-center gap-2 hover:underline",children:"â† ZurÃ¼ck"}),(0,A.jsx)("h1",{className:"sketch-heading text-[32px]",children:"GerÃ¤te"})]}),(0,A.jsxs)("div",{className:"flex-1 px-5",children:[(0,A.jsx)(X,{className:"overflow-hidden p-0",children:e.map((e,t)=>(0,A.jsxs)("div",{children:[t>0&&(0,A.jsx)("div",{className:"h-[2px] bg-[#2563EB]/10 mx-4"}),(0,A.jsxs)("div",{className:"flex items-center gap-4 p-4",children:[(0,A.jsx)(ee,{icon:"photo",size:32}),(0,A.jsxs)("div",{className:"flex-1",children:[(0,A.jsx)("p",{className:"sketch-subheading text-[17px] text-[#1D1D1F]",children:e.name}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73]",children:e.lastActive})]}),e.syncing?(0,A.jsx)(H.Loader2,{className:"w-5 h-5 text-[#2563EB] animate-spin"}):"Aktiv"===e.lastActive?(0,A.jsxs)("div",{className:"flex items-center gap-1",children:[(0,A.jsx)(eh.Check,{className:"w-4 h-4 text-[#30D158]"}),(0,A.jsx)("span",{className:"sketch-subheading text-[13px] text-[#30D158]",children:"Aktiv"})]}):null]})]},e.id))}),(0,A.jsx)(Z.SketchButton,{onClick:s,className:"w-full mt-8",size:"lg",children:"Neu verbinden"}),(0,A.jsx)("p",{className:"sketch-body text-[13px] text-[#6E6E73] text-center mt-4 px-4",children:"SchlÃ¼ssel scannen oder Recovery-Phrase eingeben"})]})]})}function sz({currentSource:e,onSelect:t,onClose:s}){return(0,A.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-end justify-center z-50",children:(0,A.jsxs)("div",{className:"bg-white w-full max-w-[428px] rounded-t-2xl p-6 pb-10",children:[(0,A.jsx)("h3",{className:"sketch-heading text-[24px] text-[#1D1D1F] text-center mb-2",children:"Backup-Quelle"}),(0,A.jsx)("p",{className:"text-[15px] text-[#6E6E73] text-center mb-6",children:"Wo sind deine Fotos gespeichert?"}),(0,A.jsx)("div",{className:"space-y-3 mb-6",children:[{id:"photos-app",label:"Fotos-App",description:"Alle Fotos aus der iOS Foto-Bibliothek"},{id:"files-app",label:"Dateien-App",description:"Fotos aus einem bestimmten Ordner"}].map(s=>(0,A.jsx)("button",{onClick:()=>t(s.id),className:`w-full p-4 rounded-xl bg-[#F2F2F7] text-left ios-tap-target ${e===s.id?"ring-2 ring-[#007AFF]":""}`,children:(0,A.jsxs)("div",{className:"flex items-center justify-between",children:[(0,A.jsxs)("div",{children:[(0,A.jsx)("p",{className:"text-[17px] font-medium text-[#1D1D1F]",children:s.label}),(0,A.jsx)("p",{className:"text-[13px] text-[#6E6E73] mt-0.5",children:s.description})]}),(0,A.jsx)("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${e===s.id?"border-[#007AFF] bg-[#007AFF]":"border-[#C7C7CC]"}`,children:e===s.id&&(0,A.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-white"})})]})},s.id))}),(0,A.jsx)("button",{onClick:s,className:"w-full h-[44px] text-[#007AFF] text-[17px] ios-tap-target",children:"Abbrechen"})]})})}function sU({currentPlan:e,onSelect:t,onClose:s}){return(0,A.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-end justify-center z-50",children:(0,A.jsxs)("div",{className:"bg-white w-full max-w-[428px] rounded-t-2xl p-6 pb-10 max-h-[80vh] overflow-y-auto",children:[(0,A.jsx)("h3",{className:"sketch-heading text-[24px] text-[#1D1D1F] text-center mb-2",children:"Speicherplan"}),(0,A.jsx)("p",{className:"text-[15px] text-[#6E6E73] text-center mb-6",children:"Du kannst jederzeit wechseln"}),(0,A.jsx)("div",{className:"space-y-3 mb-6",children:[{id:"free",label:"FREE",subtitle:"Auf deinen GerÃ¤ten",price:"0â‚¬/Monat",features:["Unbegrenzte Fotos","Zero-Knowledge VerschlÃ¼sselung","Multi-Device Sync"]},{id:"backup-plus",label:"BACKUP+ (Coming Soon)",subtitle:"Dauerhaft im Netz",price:"2,99â‚¬/Monat",features:["Alles von Free","200 GB Cloud-Backup","Schnellere Synchronisierung"],disabled:!0}].map(s=>(0,A.jsx)("button",{onClick:()=>!s.disabled&&t(s.id),disabled:s.disabled,className:`w-full p-4 rounded-xl text-left ios-tap-target ${s.disabled?"bg-[#F2F2F7]/50 cursor-not-allowed opacity-60":e===s.id?"bg-[#F2F2F7] ring-2 ring-[#007AFF]":"bg-[#F2F2F7]"}`,children:(0,A.jsxs)("div",{className:"flex items-start justify-between",children:[(0,A.jsxs)("div",{className:"flex-1",children:[(0,A.jsx)("p",{className:"text-[13px] font-bold text-[#007AFF] tracking-wide",children:s.label}),(0,A.jsx)("p",{className:"text-[17px] font-semibold text-[#1D1D1F] mt-0.5",children:s.subtitle}),(0,A.jsx)("ul",{className:"mt-2 space-y-1",children:s.features.map(e=>(0,A.jsxs)("li",{className:"text-[13px] text-[#6E6E73] flex items-center gap-2",children:[(0,A.jsx)("span",{className:"text-[#30D158]",children:"âœ“"})," ",e]},e))}),(0,A.jsx)("p",{className:"text-[15px] font-semibold text-[#1D1D1F] mt-3",children:s.price})]}),(0,A.jsx)("div",{className:`w-6 h-6 rounded-full border-2 flex items-center justify-center ${e===s.id?"border-[#007AFF] bg-[#007AFF]":"border-[#C7C7CC]"}`,children:e===s.id&&(0,A.jsx)("div",{className:"w-2.5 h-2.5 rounded-full bg-white"})})]})},s.id))}),(0,A.jsx)("button",{onClick:s,className:"w-full h-[44px] text-[#007AFF] text-[17px] ios-tap-target",children:"Abbrechen"})]})})}function sQ({title:e,message:t,confirmLabel:s,confirmDestructive:r,onConfirm:i,onCancel:n}){return(0,A.jsx)("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 px-8",children:(0,A.jsxs)("div",{className:"bg-white w-full max-w-[270px] rounded-2xl overflow-hidden",children:[(0,A.jsxs)("div",{className:"p-4 text-center",children:[(0,A.jsx)("h3",{className:"sketch-subheading text-[17px] text-[#1D1D1F] mb-1",children:e}),(0,A.jsx)("p",{className:"text-[13px] text-[#6E6E73] leading-relaxed",children:t})]}),(0,A.jsxs)("div",{className:"border-t border-[#E5E5EA]",children:[(0,A.jsx)("button",{onClick:n,className:"w-full py-3 text-[17px] text-[#007AFF] border-b border-[#E5E5EA] ios-tap-target",children:"Abbrechen"}),(0,A.jsx)("button",{onClick:i,className:`w-full py-3 text-[17px] font-semibold ios-tap-target ${r?"text-[#FF3B30]":"text-[#007AFF]"}`,children:s})]})]})})}var sW=e.i(12598),sH=e.i(75555),sq=e.i(40143),sK=e.i(86491),sG=e.i(15823),sJ=e.i(93803),sV=e.i(19273),sZ=e.i(80166),sX=class extends sG.Subscribable{constructor(e,t){super(),this.options=t,this.#e=e,this.#t=null,this.#s=(0,sJ.pendingThenable)(),this.bindMethods(),this.setOptions(t)}#e;#r=void 0;#i=void 0;#n=void 0;#a;#o;#s;#t;#l;#c;#h;#u;#d;#p;#f=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#r.addObserver(this),sY(this.#r,this.options)?this.#m():this.updateResult(),this.#g())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return s0(this.#r,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return s0(this.#r,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#y(),this.#b(),this.#r.removeObserver(this)}setOptions(e){let t=this.options,s=this.#r;if(this.options=this.#e.defaultQueryOptions(e),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof(0,sV.resolveEnabled)(this.options.enabled,this.#r))throw Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#x(),this.#r.setOptions(this.options),t._defaulted&&!(0,sV.shallowEqualObjects)(this.options,t)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#r,observer:this});let r=this.hasListeners();r&&s1(this.#r,s,this.options,t)&&this.#m(),this.updateResult(),r&&(this.#r!==s||(0,sV.resolveEnabled)(this.options.enabled,this.#r)!==(0,sV.resolveEnabled)(t.enabled,this.#r)||(0,sV.resolveStaleTime)(this.options.staleTime,this.#r)!==(0,sV.resolveStaleTime)(t.staleTime,this.#r))&&this.#v();let i=this.#w();r&&(this.#r!==s||(0,sV.resolveEnabled)(this.options.enabled,this.#r)!==(0,sV.resolveEnabled)(t.enabled,this.#r)||i!==this.#p)&&this.#_(i)}getOptimisticResult(e){var t,s;let r=this.#e.getQueryCache().build(this.#e,e),i=this.createResult(r,e);return t=this,s=i,(0,sV.shallowEqualObjects)(t.getCurrentResult(),s)||(this.#n=i,this.#o=this.options,this.#a=this.#r.state),i}getCurrentResult(){return this.#n}trackResult(e,t){return new Proxy(e,{get:(e,s)=>(this.trackProp(s),t?.(s),"promise"===s&&(this.trackProp("data"),this.options.experimental_prefetchInRender||"pending"!==this.#s.status||this.#s.reject(Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(e,s))})}trackProp(e){this.#f.add(e)}getCurrentQuery(){return this.#r}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){let t=this.#e.defaultQueryOptions(e),s=this.#e.getQueryCache().build(this.#e,t);return s.fetch().then(()=>this.createResult(s,t))}fetch(e){return this.#m({...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#n))}#m(e){this.#x();let t=this.#r.fetch(this.options,e);return e?.throwOnError||(t=t.catch(sV.noop)),t}#v(){this.#y();let e=(0,sV.resolveStaleTime)(this.options.staleTime,this.#r);if(sV.isServer||this.#n.isStale||!(0,sV.isValidTimeout)(e))return;let t=(0,sV.timeUntilStale)(this.#n.dataUpdatedAt,e);this.#u=sZ.timeoutManager.setTimeout(()=>{this.#n.isStale||this.updateResult()},t+1)}#w(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#r):this.options.refetchInterval)??!1}#_(e){this.#b(),this.#p=e,!sV.isServer&&!1!==(0,sV.resolveEnabled)(this.options.enabled,this.#r)&&(0,sV.isValidTimeout)(this.#p)&&0!==this.#p&&(this.#d=sZ.timeoutManager.setInterval(()=>{(this.options.refetchIntervalInBackground||sH.focusManager.isFocused())&&this.#m()},this.#p))}#g(){this.#v(),this.#_(this.#w())}#y(){this.#u&&(sZ.timeoutManager.clearTimeout(this.#u),this.#u=void 0)}#b(){this.#d&&(sZ.timeoutManager.clearInterval(this.#d),this.#d=void 0)}createResult(e,t){let s,r=this.#r,i=this.options,n=this.#n,a=this.#a,o=this.#o,l=e!==r?e.state:this.#i,{state:c}=e,h={...c},u=!1;if(t._optimisticResults){let s=this.hasListeners(),n=!s&&sY(e,t),a=s&&s1(e,r,t,i);(n||a)&&(h={...h,...(0,sK.fetchState)(c.data,e.options)}),"isRestoring"===t._optimisticResults&&(h.fetchStatus="idle")}let{error:d,errorUpdatedAt:p,status:f}=h;s=h.data;let m=!1;if(void 0!==t.placeholderData&&void 0===s&&"pending"===f){let e;n?.isPlaceholderData&&t.placeholderData===o?.placeholderData?(e=n.data,m=!0):e="function"==typeof t.placeholderData?t.placeholderData(this.#h?.state.data,this.#h):t.placeholderData,void 0!==e&&(f="success",s=(0,sV.replaceData)(n?.data,e,t),u=!0)}if(t.select&&void 0!==s&&!m)if(n&&s===a?.data&&t.select===this.#l)s=this.#c;else try{this.#l=t.select,s=t.select(s),s=(0,sV.replaceData)(n?.data,s,t),this.#c=s,this.#t=null}catch(e){this.#t=e}this.#t&&(d=this.#t,s=this.#c,p=Date.now(),f="error");let g="fetching"===h.fetchStatus,y="pending"===f,b="error"===f,x=y&&g,v=void 0!==s,w={status:f,fetchStatus:h.fetchStatus,isPending:y,isSuccess:"success"===f,isError:b,isInitialLoading:x,isLoading:x,data:s,dataUpdatedAt:h.dataUpdatedAt,error:d,errorUpdatedAt:p,failureCount:h.fetchFailureCount,failureReason:h.fetchFailureReason,errorUpdateCount:h.errorUpdateCount,isFetched:h.dataUpdateCount>0||h.errorUpdateCount>0,isFetchedAfterMount:h.dataUpdateCount>l.dataUpdateCount||h.errorUpdateCount>l.errorUpdateCount,isFetching:g,isRefetching:g&&!y,isLoadingError:b&&!v,isPaused:"paused"===h.fetchStatus,isPlaceholderData:u,isRefetchError:b&&v,isStale:s2(e,t),refetch:this.refetch,promise:this.#s,isEnabled:!1!==(0,sV.resolveEnabled)(t.enabled,e)};if(this.options.experimental_prefetchInRender){let t=void 0!==w.data,s="error"===w.status&&!t,i=e=>{s?e.reject(w.error):t&&e.resolve(w.data)},n=()=>{i(this.#s=w.promise=(0,sJ.pendingThenable)())},a=this.#s;switch(a.status){case"pending":e.queryHash===r.queryHash&&i(a);break;case"fulfilled":(s||w.data!==a.value)&&n();break;case"rejected":s&&w.error===a.reason||n()}}return w}updateResult(){let e=this.#n,t=this.createResult(this.#r,this.options);if(this.#a=this.#r.state,this.#o=this.options,void 0!==this.#a.data&&(this.#h=this.#r),(0,sV.shallowEqualObjects)(t,e))return;this.#n=t;let s=()=>{if(!e)return!0;let{notifyOnChangeProps:t}=this.options,s="function"==typeof t?t():t;if("all"===s||!s&&!this.#f.size)return!0;let r=new Set(s??this.#f);return this.options.throwOnError&&r.add("error"),Object.keys(this.#n).some(t=>this.#n[t]!==e[t]&&r.has(t))};this.#k({listeners:s()})}#x(){let e=this.#e.getQueryCache().build(this.#e,this.options);if(e===this.#r)return;let t=this.#r;this.#r=e,this.#i=e.state,this.hasListeners()&&(t?.removeObserver(this),e.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#g()}#k(e){sq.notifyManager.batch(()=>{e.listeners&&this.listeners.forEach(e=>{e(this.#n)}),this.#e.getQueryCache().notify({query:this.#r,type:"observerResultsUpdated"})})}};function sY(e,t){return!1!==(0,sV.resolveEnabled)(t.enabled,e)&&void 0===e.state.data&&("error"!==e.state.status||!1!==t.retryOnMount)||void 0!==e.state.data&&s0(e,t,t.refetchOnMount)}function s0(e,t,s){if(!1!==(0,sV.resolveEnabled)(t.enabled,e)&&"static"!==(0,sV.resolveStaleTime)(t.staleTime,e)){let r="function"==typeof s?s(e):s;return"always"===r||!1!==r&&s2(e,t)}return!1}function s1(e,t,s,r){return(e!==t||!1===(0,sV.resolveEnabled)(r.enabled,e))&&(!s.suspense||"error"!==e.state.status)&&s2(e,s)}function s2(e,t){return!1!==(0,sV.resolveEnabled)(t.enabled,e)&&e.isStaleByTime((0,sV.resolveStaleTime)(t.staleTime,e))}var s3=I.createContext((n=!1,{clearReset:()=>{n=!1},reset:()=>{n=!0},isReset:()=>n})),s5=I.createContext(!1);s5.Provider;var s4=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function s6(e,t){return function(e,t,s){let r,i=I.useContext(s5),n=I.useContext(s3),a=(0,sW.useQueryClient)(s),o=a.defaultQueryOptions(e);a.getDefaultOptions().queries?._experimental_beforeQuery?.(o);let l=a.getQueryCache().get(o.queryHash);if(o._optimisticResults=i?"isRestoring":"optimistic",o.suspense){let e=e=>"static"===e?e:Math.max(e??1e3,1e3),t=o.staleTime;o.staleTime="function"==typeof t?(...s)=>e(t(...s)):e(t),"number"==typeof o.gcTime&&(o.gcTime=Math.max(o.gcTime,1e3))}r=l?.state.error&&"function"==typeof o.throwOnError?(0,sV.shouldThrowError)(o.throwOnError,[l.state.error,l]):o.throwOnError,(o.suspense||o.experimental_prefetchInRender||r)&&!n.isReset()&&(o.retryOnMount=!1),I.useEffect(()=>{n.clearReset()},[n]);let c=!a.getQueryCache().get(o.queryHash),[h]=I.useState(()=>new t(a,o)),u=h.getOptimisticResult(o),d=!i&&!1!==e.subscribed;if(I.useSyncExternalStore(I.useCallback(e=>{let t=d?h.subscribe(sq.notifyManager.batchCalls(e)):sV.noop;return h.updateResult(),t},[h,d]),()=>h.getCurrentResult(),()=>h.getCurrentResult()),I.useEffect(()=>{h.setOptions(o)},[o,h]),o?.suspense&&u.isPending)throw s4(o,h,n);if((({result:e,errorResetBoundary:t,throwOnError:s,query:r,suspense:i})=>e.isError&&!t.isReset()&&!e.isFetching&&r&&(i&&void 0===e.data||(0,sV.shouldThrowError)(s,[e.error,r])))({result:u,errorResetBoundary:n,throwOnError:o.throwOnError,query:l,suspense:o.suspense}))throw u.error;if(a.getDefaultOptions().queries?._experimental_afterQuery?.(o,u),o.experimental_prefetchInRender&&!sV.isServer&&u.isLoading&&u.isFetching&&!i){let e=c?s4(o,h,n):l?.promise;e?.catch(sV.noop).finally(()=>{h.updateResult()})}return o.notifyOnChangeProps?u:h.trackResult(u)}(e,sX,t)}var s8=e.i(14272),s7=sG,s9=class extends s7.Subscribable{#e;#n=void 0;#j;#S;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#E()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,sV.shallowEqualObjects)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#j,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,sV.hashKey)(t.mutationKey)!==(0,sV.hashKey)(this.options.mutationKey)?this.reset():this.#j?.state.status==="pending"&&this.#j.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#j?.removeObserver(this)}onMutationUpdate(e){this.#E(),this.#k(e)}getCurrentResult(){return this.#n}reset(){this.#j?.removeObserver(this),this.#j=void 0,this.#E(),this.#k()}mutate(e,t){return this.#S=t,this.#j?.removeObserver(this),this.#j=this.#e.getMutationCache().build(this.#e,this.options),this.#j.addObserver(this),this.#j.execute(e)}#E(){let e=this.#j?.state??(0,s8.getDefaultState)();this.#n={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#k(e){sq.notifyManager.batch(()=>{if(this.#S&&this.hasListeners()){let t=this.#n.variables,s=this.#n.context,r={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#S.onSuccess?.(e.data,t,s,r)}catch(e){Promise.reject(e)}try{this.#S.onSettled?.(e.data,null,t,s,r)}catch(e){Promise.reject(e)}}else if(e?.type==="error"){try{this.#S.onError?.(e.error,t,s,r)}catch(e){Promise.reject(e)}try{this.#S.onSettled?.(void 0,e.error,t,s,r)}catch(e){Promise.reject(e)}}}this.listeners.forEach(e=>{e(this.#n)})})}};function re(e,t){let s=(0,sW.useQueryClient)(t),[r]=I.useState(()=>new s9(s,e));I.useEffect(()=>{r.setOptions(e)},[r,e]);let i=I.useSyncExternalStore(I.useCallback(e=>r.subscribe(sq.notifyManager.batchCalls(e)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),n=I.useCallback((e,t)=>{r.mutate(e,t).catch(sV.noop)},[r]);if(i.error&&(0,sV.shouldThrowError)(r.options.throwOnError,[i.error]))throw i.error;return{...i,mutate:n,mutateAsync:i.mutate}}async function rt(e,t){let s={local:!1,supabase:!1,ipfs:!1,errors:[]};if(console.log("[PhotoManager] Starting global delete for CID:",e),void 0!==t&&t>0)try{await (0,sm.deletePhoto)(t),s.local=!0,console.log("[PhotoManager] Deleted from IndexedDB:",t)}catch(t){let e=`IndexedDB delete failed: ${t}`;s.errors.push(e),console.error("[PhotoManager]",e)}else console.log("[PhotoManager] No local ID provided, skipping IndexedDB delete"),s.local=!0;try{await sr(e),s.supabase=!0,console.log("[PhotoManager] Deleted from Supabase:",e)}catch(t){let e=`Supabase delete failed: ${t}`;s.errors.push(e),console.error("[PhotoManager]",e)}if(e.startsWith("Qm")&&46===e.length||e.startsWith("bafy")||e.startsWith("bafk"))try{await su(e),s.ipfs=!0,console.log("[PhotoManager] Unpinned from IPFS:",e)}catch(e){console.warn("[PhotoManager] IPFS unpin failed (non-critical):",e),s.ipfs=!1}else console.log("[PhotoManager] Skipping IPFS unpin for mock/temp CID:",e),s.ipfs=!0;return console.log("[PhotoManager] Global delete complete:",s),s}let rs=null,rr=0,ri=new Map;function rn(e){let{id:t,success:s,file:r,blob:i,fileName:n,mimeType:a,converted:o,error:l,originalSize:c,convertedSize:h}=e.data,u=ri.get(t);if(u){if(ri.delete(t),!s)return void u.reject(Error(l||"Conversion failed"));if(i&&o){let e=new File([i],n,{type:a,lastModified:Date.now()});u.resolve({file:e,converted:!0,originalSize:c,convertedSize:h})}else u.resolve({file:r,converted:!1})}}function ra(e){console.error("[HEIC] Worker error:",e),ri.forEach(({reject:t})=>{t(Error("Worker error: "+e.message))}),ri.clear(),rs=null}async function ro(e,t=.92){if(!(["image/heic","image/heif","image/heic-sequence","image/heif-sequence"].includes(e.type?.toLowerCase())||e.name?.toLowerCase().endsWith(".heic")||e.name?.toLowerCase().endsWith(".heif")))return{file:e,converted:!1};let s=function(){if(!rs)try{(rs=new Worker("/workers/heic-worker.js")).onmessage=rn,rs.onerror=ra,console.log("[HEIC] Worker initialized")}catch(e){return console.warn("[HEIC] Worker creation failed, will use main thread:",e),null}return rs}();return s?new Promise((r,i)=>{let n=++rr;ri.set(n,{resolve:r,reject:i}),setTimeout(()=>{ri.has(n)&&(ri.delete(n),console.warn("[HEIC] Worker timeout, falling back to main thread"),rl(e,t).then(r).catch(i))},12e4),s.postMessage({id:n,file:e,quality:t})}):(console.log("[HEIC] Using main thread conversion"),rl(e,t))}async function rl(t,s){try{let r=(await e.A(208)).default,i=await r({blob:t,toType:"image/jpeg",quality:s}),n=Array.isArray(i)?i[0]:i,a=t.name.replace(/\.(heic|heif)$/i,".jpg"),o=new File([n],a,{type:"image/jpeg",lastModified:t.lastModified});return{file:o,converted:!0,originalSize:t.size,convertedSize:o.size}}catch(e){return console.error("[HEIC] Main thread conversion failed:",e),{file:t,converted:!1}}}var rc=e.i(27927);function rh({photo:e,secretKey:t,showCloudBadge:s=!0}){let[r,i]=(0,I.useState)(null),[n,a]=(0,I.useState)(!1),[o,l]=(0,I.useState)(!1),[c,h]=(0,I.useState)(!1),[u,d]=(0,I.useState)(!1),p=(0,I.useRef)(null);return((0,I.useEffect)(()=>{if(t&&!r)return(async()=>{l(!0);try{let s=e.encryptedBlob;if(!s&&e.cid&&sf(e.cid)){h(!0),d(!0),console.log("Fetching from IPFS for thumbnail:",e.cid);try{s=await sp(e.cid),console.log("Fetched from IPFS:",{cid:e.cid,size:s.size})}catch(t){console.error(`Failed to fetch from IPFS (CID: ${e.cid}):`,t),a(!0);return}finally{h(!1)}}if(!s){console.log("No blob available for:",e.cid),d(!0);return}let r=await (0,ea.decryptFile)(s,e.nonce,t,e.mimeType);if(r){let e=URL.createObjectURL(r);p.current=e,i(e)}else a(!0)}catch(t){console.error("Failed to decrypt photo:",e.cid,t),a(!0)}finally{l(!1)}})(),()=>{if(p.current){let e=p.current;setTimeout(()=>{try{URL.revokeObjectURL(e)}catch(e){}},1e3),p.current=null}}},[e,t,r]),n)?(0,A.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-red-50 text-red-500 p-2 text-center",children:[(0,A.jsx)(J,{name:"lock",size:24,className:"mb-1 opacity-50"}),(0,A.jsx)("span",{className:"text-[10px]",children:"Fehler"})]}):c?(0,A.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-blue-50",children:[(0,A.jsx)(rc.Cloud,{className:"w-5 h-5 text-blue-400 mb-1 animate-pulse"}),(0,A.jsx)(H.Loader2,{className:"w-4 h-4 animate-spin text-blue-400"}),(0,A.jsx)("span",{className:"text-[9px] text-blue-500 mt-1",children:"Laden..."})]}):o||!r?!u||r||o?(0,A.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,A.jsx)(H.Loader2,{className:"w-6 h-6 animate-spin text-gray-400"})}):(0,A.jsxs)("div",{className:"w-full h-full flex flex-col items-center justify-center bg-gray-100 relative",children:[(0,A.jsx)(rc.Cloud,{className:"w-6 h-6 text-gray-400"}),(0,A.jsx)("span",{className:"text-[9px] text-gray-500 mt-1",children:"In der Cloud"})]}):(0,A.jsxs)("div",{className:"relative w-full h-full",children:[(0,A.jsx)("img",{src:r,alt:"",className:"w-full h-full object-cover animate-in fade-in duration-500",loading:"lazy"}),s&&u&&(0,A.jsx)("div",{className:"absolute bottom-1 right-1 bg-black/50 rounded-full p-1",children:(0,A.jsx)(rc.Cloud,{className:"w-3 h-3 text-white"})})]})}let ru=(0,M.default)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),rd=(0,M.default)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]),rp=(0,M.default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),rf=(0,M.default)("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]),rm=(0,M.default)("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);var rg=e.i(40160);function ry({photosCount:e=0,authUser:t}){let s,r,i=(0,sW.useQueryClient)(),[n,a]=(0,I.useState)(""),[o,l]=(0,I.useState)(!1),[c,h]=(0,I.useState)(!1),[u,d]=(0,I.useState)(null),[p,f]=(0,I.useState)(!1),[m,g]=(0,I.useState)(new Set),[y,b]=(0,I.useState)(null),[x,v]=(0,I.useState)(null),[w,_]=(0,I.useState)(null),[k,j]=(0,I.useState)(!1),[S,E]=(0,I.useState)(!1),N=(0,I.useRef)(null),C=(0,I.useRef)(null),{secretKey:R}=el(),{photos:P,uploadPhoto:T,isUploading:O,uploadProgress:$}=function(e){let t=(0,sW.useQueryClient)(),[s,r]=(0,I.useState)(null);(0,I.useEffect)(()=>{e?(0,ea.getUserKeyHash)(e).then(r):r(null)},[e]);let{data:i=[],isLoading:n,error:a}=s6({queryKey:["photos"],queryFn:sm.getAllPhotos,enabled:!0}),{data:o=0}=s6({queryKey:["photoCount"],queryFn:sm.getPhotoCount}),[l,c]=(0,I.useState)(0),[h,u]=(0,I.useState)(new Map),d=re({mutationFn:async t=>{if(!e)throw Error("No encryption key");if(!s)throw Error("userKeyHash not ready - bitte kurz warten");let r=`temp_${Date.now()}_${Math.random().toString(36).slice(2)}`;console.log("[Upload] Starting upload:",t.name,"tempId:",r),c(0);let i=URL.createObjectURL(t);u(e=>new Map(e).set(r,{file:t,objectUrl:i,progress:0}));try{let i,n=await ro(t),a=n.file;n.converted&&console.log("[Upload] HEIC converted:",{originalSize:n.originalSize,convertedSize:n.convertedSize});let{encrypted:o,nonce:l}=await (0,ea.encryptFile)(a,e);console.log("[Upload] Encrypted:",{size:o.size}),u(e=>{let t=new Map(e),s=t.get(r);return s&&t.set(r,{...s,progress:20}),t});try{i=await sd(o,a.name,e=>{let t=20+.6*e;c(t),u(e=>{let s=new Map(e),i=s.get(r);return i&&s.set(r,{...i,progress:t}),s})}),console.log("[Upload] IPFS CID:",i)}catch(e){console.error("[Upload] IPFS failed:",e),i=`cid_${Date.now()}_${Math.random().toString(36).slice(2)}`,console.log("[Upload] Using fallback CID:",i)}u(e=>{let t=new Map(e),s=t.get(r);return s&&t.set(r,{...s,progress:85}),t});let h={cid:i,nonce:l,fileName:a.name,mimeType:a.type,fileSize:a.size,uploadedAt:new Date,encryptedBlob:o};try{await (0,sm.savePhoto)(h),console.log("[Upload] Saved to IndexedDB:",i)}catch(e){throw console.error("[Upload] IndexedDB save FAILED:",e),e}let d=(0,sa.getDeviceId)();try{await se(i,a.size,d,l,a.type,s),console.log("[Upload] Supabase synced:",i)}catch(e){console.error("[Upload] Supabase sync failed (local + IPFS OK):",e)}return u(e=>{let t=new Map(e),s=t.get(r);return s&&URL.revokeObjectURL(s.objectUrl),t.delete(r),t}),h}catch(e){throw u(e=>{let t=new Map(e),s=t.get(r);return s&&URL.revokeObjectURL(s.objectUrl),t.delete(r),t}),e}},onSuccess:()=>{t.invalidateQueries({queryKey:["photos"]}),t.invalidateQueries({queryKey:["photoCount"]}),console.log("[Upload] Complete - queries invalidated")},onError:e=>{console.error("[Upload] Mutation failed:",e)}}),p=re({mutationFn:async e=>{console.log("[Delete] Starting global delete:",e.cid);let t=await rt(e.cid,e.id);return t.errors.length>0&&console.warn("[Delete] Some operations failed:",t.errors),t},onSuccess:e=>{t.invalidateQueries({queryKey:["photos"]}),t.invalidateQueries({queryKey:["photoCount"]}),console.log("[Delete] Complete:",{local:e.local,supabase:e.supabase,ipfs:e.ipfs})},onError:e=>{console.error("[Delete] Mutation failed:",e)}}),f=(0,I.useCallback)(async t=>{if(!e||!t.encryptedBlob)return null;let s=await (0,ea.decryptFile)(t.encryptedBlob,t.nonce,e,t.mimeType);return s?URL.createObjectURL(s):null},[e]),m=Array.from(h.entries()).map(([e,t])=>({id:-1,cid:e,nonce:"",fileName:t.file.name,mimeType:t.file.type,fileSize:t.file.size,uploadedAt:new Date,encryptedBlob:void 0,isUploading:!0,uploadProgress:t.progress,previewUrl:t.objectUrl}));return{photos:i,photoCount:o,isLoading:n,error:a,uploadPhoto:d.mutate,deletePhoto:p.mutate,isDeleting:p.isPending,decryptPhoto:f,isUploading:d.isPending,uploadProgress:l,userKeyHash:s,uploadingPhotos:m}}(R),{remoteCIDs:F,remoteCIDsFromOtherDevices:M,isConnected:D}=function(e={}){let{onNewPhoto:t,onPhotoDeleted:s,enabled:r=!0,secretKey:i}=e,[n,a]=(0,I.useState)([]),[o,l]=(0,I.useState)(!1),[c,h]=(0,I.useState)(null),[u,d]=(0,I.useState)(null),p=(0,I.useRef)(null),f=(0,I.useRef)("server"),m=(0,I.useRef)(t),g=(0,I.useRef)(s),y=(0,I.useRef)(null),b=(0,I.useRef)(!1);(0,I.useEffect)(()=>{m.current=t,g.current=s},[t,s]),(0,I.useEffect)(()=>{f.current=(0,sa.getDeviceId)()},[]),(0,I.useEffect)(()=>{let e=!0;return i?(0,ea.getUserKeyHash)(i).then(t=>{e&&(d(t),p.current=t)}):(d(null),p.current=null),()=>{e=!1}},[i]);let x=(0,I.useCallback)(async()=>{let e=p.current,t=f.current;if(!e)return[];try{let s=(await st(t,e)).map(e=>({cid:e.cid,device_id:e.device_id,uploaded_at:e.uploaded_at,file_size_bytes:e.file_size_bytes,nonce:e.nonce||null,mime_type:e.mime_type||null,isFromOtherDevice:e.device_id!==t}));return a(s),h(null),s}catch(e){return console.error("Failed to load remote CIDs:",e),h(e),[]}},[]);(0,I.useEffect)(()=>{u&&r&&x()},[u,r,x]),(0,I.useEffect)(()=>{if(!r||b.current||!u)return;console.log("[Realtime] Setting up subscription..."),b.current=!0;let e=[],t=null,s=()=>{0!==e.length&&(a(t=>{let s=e.filter(e=>!t.some(t=>t.cid===e.cid));return 0===s.length?t:[...s,...t]}),e.filter(e=>e.isFromOtherDevice).forEach(e=>{console.log("[Realtime] New photo from another device:",e.cid),m.current?.(e)}),e=[])},i=t9.channel(`photos_metadata_${u.slice(0,8)}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"photos_metadata"},r=>{let i=r.new,n=p.current;if(n&&i.user_key_hash!==n)return;let a={cid:i.cid,device_id:i.device_id,uploaded_at:i.uploaded_at,file_size_bytes:i.file_size_bytes,nonce:i.nonce,mime_type:i.mime_type,isFromOtherDevice:i.device_id!==f.current};e.push(a),t&&clearTimeout(t),t=setTimeout(s,100)}).on("postgres_changes",{event:"DELETE",schema:"public",table:"photos_metadata"},e=>{let t=e.old;g.current?.(t.cid),a(e=>e.filter(e=>e.cid!==t.cid))}).subscribe(e=>{console.log("[Realtime] Status:",e),l("SUBSCRIBED"===e),"CHANNEL_ERROR"===e&&(console.log("[Realtime] Channel error, retrying in 5s..."),setTimeout(()=>{y.current&&b.current&&y.current.subscribe()},5e3))});return y.current=i,()=>{console.log("[Realtime] Cleaning up subscription..."),b.current=!1,t&&clearTimeout(t),y.current&&(t9.removeChannel(y.current),y.current=null)}},[r,u]);let v=(0,I.useCallback)(async()=>x(),[x]),w=n.filter(e=>e.isFromOtherDevice);return{remoteCIDs:n,remoteCIDsFromOtherDevices:w,isConnected:o,lastSyncError:c,refresh:v,deviceId:f.current,userKeyHash:u}}({onNewPhoto:(0,I.useCallback)(e=>{console.log("[Realtime] New photo from device:",e.device_id,e.cid),v(`Neues Foto von anderem Ger\xe4t empfangen`),setTimeout(()=>v(null),3e3),i.invalidateQueries({queryKey:["photos"]}),i.invalidateQueries({queryKey:["photoCount"]})},[i]),onPhotoDeleted:(0,I.useCallback)(e=>{console.log("[Realtime] Photo deleted from another device:",e),v(`Foto von anderem Ger\xe4t gel\xf6scht`),setTimeout(()=>v(null),3e3),i.invalidateQueries({queryKey:["photos"]}),i.invalidateQueries({queryKey:["photoCount"]})},[i]),enabled:!0,secretKey:R}),L=(s=P.map(e=>({id:e.id?.toString()||e.cid,cid:e.cid,placeholderUrl:"",category:"photo",date:e.uploadedAt.toISOString().split("T")[0],metadata:e,isLocal:!0,isCloud:sf(e.cid)})),r=new Set(P.map(e=>e.cid)),[...s,...F.filter(e=>!r.has(e.cid)).map(e=>({id:e.cid,cid:e.cid,placeholderUrl:"",category:"cloud",date:e.uploaded_at?new Date(e.uploaded_at).toISOString().split("T")[0]:new Date().toISOString().split("T")[0],metadata:{cid:e.cid,nonce:e.nonce||"",fileName:`cloud_${e.cid}`,mimeType:e.mime_type||"image/jpeg",fileSize:e.file_size_bytes||0,uploadedAt:e.uploaded_at?new Date(e.uploaded_at):new Date},isLocal:!1,isCloud:!0}))]),B=(0,I.useMemo)(()=>{var t;let s,r;return L.length>0?L:(t=Math.min(e,50),s=["nature","architecture","travel","food","animals","city","landscape","portrait","ocean","forest"],r=new Date,Array.from({length:t},(e,t)=>{let i=new Date(r);return i.setDate(i.getDate()-Math.floor(t/3)),{id:`photo-${t}`,cid:`Qm${Math.random().toString(36).substring(2,15)}${Math.random().toString(36).substring(2,15)}`,placeholderUrl:`https://picsum.photos/seed/${t+100}/400/400`,category:s[t%s.length],date:i.toISOString().split("T")[0],metadata:void 0}}))},[L,e]),z=(0,I.useMemo)(()=>B.filter(e=>(!u||e.category===u)&&(!n||!!e.category.includes(n.toLowerCase()))),[B,u,n]),U=(0,I.useMemo)(()=>{let e;return e={},z.forEach(t=>{e[t.date]||(e[t.date]=[]),e[t.date].push(t)}),Object.entries(e).map(([e,t])=>{var s;let r,i,n;return{date:e,photos:t,label:(r=new Date(s=e),((n=new Date(i=new Date)).setDate(n.getDate()-1),s===i.toISOString().split("T")[0])?"Heute":s===n.toISOString().split("T")[0]?"Gestern":r.toLocaleDateString("de-DE",{weekday:"long",day:"numeric",month:"long"}))}})},[z]),Q=async e=>{if(R&&e.metadata){j(!0),_(null);try{let t=e.metadata.encryptedBlob;if(!t&&e.cid&&sf(e.cid)&&(console.log("Loading full-res from IPFS:",e.cid),t=await sp(e.cid)),!t)return void console.error("No blob available for fullscreen");let s=await (0,ea.decryptFile)(t,e.metadata.nonce,R,e.metadata.mimeType);if(s){let e=URL.createObjectURL(s);_(e)}}catch(e){console.error("Failed to load fullscreen photo:",e)}finally{j(!1)}}},W=async e=>{if(R&&e.metadata){E(!0);try{let t=e.metadata.encryptedBlob;if(!t&&e.cid&&sf(e.cid)&&(t=await sp(e.cid)),!t)return;let s=await (0,ea.decryptFile)(t,e.metadata.nonce,R,e.metadata.mimeType);if(s){let t=URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=e.metadata.fileName||`photo_${e.cid.slice(0,8)}.jpg`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t),v("Foto heruntergeladen!"),setTimeout(()=>v(null),2e3)}}catch(e){console.error("Failed to download photo:",e)}finally{E(!1)}}},q=()=>{N.current&&(clearTimeout(N.current),N.current=null)},K=B.length;return(0,A.jsxs)("div",{className:"flex flex-col h-full bg-[#FAFBFC]",children:[(0,A.jsxs)("header",{className:"px-5 pt-10 pb-4 bg-[#FAFBFC] sticky top-0 z-30 border-b-2 border-[#2563EB]/10",children:[(0,A.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,A.jsx)("h1",{className:"sketch-heading text-[32px]",children:"Galerie"}),(0,A.jsxs)("div",{className:"flex items-center gap-3",children:[(0,A.jsx)("button",{onClick:()=>l(!o),className:`p-2 rounded-full transition-colors ${o?"bg-[#2563EB]/10 text-[#2563EB]":"text-[#6E6E73]"}`,children:(0,A.jsx)(ru,{className:"w-6 h-6"})}),(0,A.jsx)(Z.SketchButton,{onClick:()=>{C.current?.click()},size:"sm",className:"scale-90",children:"HinzufÃ¼gen"})]})]}),(0,A.jsxs)("div",{className:"flex items-center justify-between px-1 mb-4",children:[(0,A.jsxs)("p",{className:"sketch-body text-[15px] text-[#3B82F6]",children:[K," Fotos gesichert"]}),(0,A.jsx)("div",{className:"flex items-center gap-2",children:D?(0,A.jsx)(ee,{icon:"cloud",size:20,color:"#30D158"}):(0,A.jsx)(ee,{icon:"warning",size:20,color:"#8E8E93"})})]}),o&&(0,A.jsx)("div",{className:"mb-4",children:(0,A.jsx)(et,{value:n,onChange:e=>a(e),placeholder:"Suchen...",icon:(0,A.jsx)(ru,{className:"w-5 h-5"}),className:"w-full"})}),(0,A.jsxs)("div",{className:"flex gap-2 overflow-x-auto pb-2 -mx-1 px-1",children:[(0,A.jsx)("button",{onClick:()=>d(null),className:`sketch-subheading text-[15px] px-4 py-1.5 rounded-full transition-colors ${null===u?"bg-[#2563EB] text-white":"bg-[#2563EB]/5 text-[#2563EB]"}`,children:"Alle"}),[{id:"nature",label:"Natur (Coming Soon)"},{id:"architecture",label:"Architektur (Coming Soon)"},{id:"travel",label:"Reisen (Coming Soon)"},{id:"food",label:"Essen (Coming Soon)"},{id:"animals",label:"Tiere (Coming Soon)"},{id:"city",label:"Stadt (Coming Soon)"},{id:"landscape",label:"Landschaft (Coming Soon)"}].map(e=>(0,A.jsx)("button",{onClick:()=>d(e.id),className:`sketch-subheading text-[15px] px-4 py-1.5 rounded-full transition-colors whitespace-nowrap ${u===e.id?"bg-[#2563EB] text-white":"bg-[#2563EB]/5 text-[#2563EB]"}`,children:e.label},e.id))]})]}),(0,A.jsx)("main",{className:"flex-1 overflow-y-auto px-1 pb-[100px]",children:0===U.length?(0,A.jsxs)("div",{className:"pt-20 text-center px-10",children:[(0,A.jsx)(ee,{icon:"photo",size:64,className:"mx-auto mb-4 opacity-20"}),(0,A.jsx)("p",{className:"sketch-subheading text-lg text-[#6E6E73]",children:"Keine Fotos gefunden"}),(0,A.jsx)("p",{className:"sketch-body text-sm text-[#8E8E93] mt-2",children:"Versuche es mit einem anderen Suchbegriff oder Filter"})]}):U.map(e=>(0,A.jsxs)("div",{className:"mb-8",children:[(0,A.jsx)("h2",{className:"sketch-subheading text-[19px] px-4 mb-3 sticky top-[160px] bg-[#FAFBFC]/80 backdrop-blur-sm z-10 py-1",children:e.label}),(0,A.jsx)("div",{className:"grid grid-cols-3 gap-1",children:e.photos.map(e=>(0,A.jsxs)("div",{className:`relative aspect-square overflow-hidden cursor-pointer active:opacity-70 transition-opacity ${m.has(e.id)?"ring-4 ring-[#2563EB] ring-inset":""}`,onClick:()=>{var t;return t=e.id,void(p?g(e=>{let s=new Set(e);return s.has(t)?s.delete(t):s.add(t),s}):(b(t),e.metadata&&Q(e)))},onTouchStart:()=>{var t;return t=e.id,void(N.current=setTimeout(()=>{f(!0),g(new Set([t]))},500))},onTouchEnd:q,onContextMenu:t=>{t.preventDefault(),f(!0),g(new Set([e.id]))},children:[(0,A.jsx)(rh,{photo:e.metadata,secretKey:R,showCloudBadge:!0}),p&&(0,A.jsx)("div",{className:"absolute top-2 right-2 z-10 w-6 h-6",children:(0,A.jsx)(X,{className:`w-6 h-6 rounded-full p-0 flex items-center justify-center ${m.has(e.id)?"bg-[#2563EB] border-[#2563EB]":"bg-white/80 border-[#2563EB]"}`,children:m.has(e.id)&&(0,A.jsx)(eh.Check,{className:"w-4 h-4 text-white"})})})]},e.id))})]},e.date))}),x&&(0,A.jsx)("div",{className:"fixed bottom-[100px] left-1/2 -translate-x-1/2 z-50 w-[90%] max-w-[400px]",children:(0,A.jsx)(X,{className:"bg-[#2563EB] border-[#1E40AF] py-3 px-5 shadow-xl",children:(0,A.jsxs)("p",{className:"sketch-body text-white text-center flex items-center justify-center gap-3",children:[(0,A.jsx)(H.Loader2,{className:"w-4 h-4 animate-spin text-white/80"}),x]})})}),y&&(0,A.jsxs)("div",{className:"fixed inset-0 bg-black z-[100] flex flex-col",children:[(0,A.jsxs)("div",{className:"p-4 flex items-center justify-between",children:[(0,A.jsx)("button",{onClick:()=>{b(null),w&&(URL.revokeObjectURL(w),_(null))},className:"p-2 text-white/80 hover:text-white",children:(0,A.jsx)(sI.X,{className:"w-6 h-6"})}),(0,A.jsxs)("div",{className:"flex items-center gap-4",children:[(0,A.jsx)("button",{className:"p-2 text-white/80 hover:text-white",children:(0,A.jsx)(rd,{className:"w-6 h-6"})}),(0,A.jsx)("button",{className:"p-2 text-white/80 hover:text-white",children:(0,A.jsx)(rf,{className:"w-6 h-6"})})]})]}),(0,A.jsx)("div",{className:"flex-1 relative flex items-center justify-center overflow-hidden",children:k?(0,A.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,A.jsx)(H.Loader2,{className:"w-12 h-12 text-[#2563EB] animate-spin"}),(0,A.jsx)("p",{className:"sketch-body text-white/60",children:"EntschlÃ¼sseln..."})]}):w?(0,A.jsx)("img",{src:w,alt:"Vollbild",className:"max-w-full max-h-full object-contain"}):(0,A.jsxs)("div",{className:"text-center p-10",children:[(0,A.jsx)(ee,{icon:"warning",size:48,color:"#FF3B30",className:"mx-auto mb-4"}),(0,A.jsx)("p",{className:"sketch-body text-white",children:"Laden fehlgeschlagen"})]})}),(0,A.jsxs)("div",{className:"p-6 flex items-center justify-around bg-black/40 backdrop-blur-md",children:[(0,A.jsxs)("button",{className:"flex flex-col items-center gap-1 text-white/70",onClick:()=>{let e=B.find(e=>e.id===y);e&&W(e)},disabled:S,children:[S?(0,A.jsx)(H.Loader2,{className:"w-6 h-6 animate-spin"}):(0,A.jsx)(rg.Download,{className:"w-6 h-6"}),(0,A.jsx)("span",{className:"sketch-body text-[10px]",children:"Speichern"})]}),(0,A.jsxs)("button",{className:"flex flex-col items-center gap-1 text-white/70",children:[(0,A.jsx)(rm,{className:"w-6 h-6"}),(0,A.jsx)("span",{className:"sketch-body text-[10px]",children:"Exportieren"})]}),(0,A.jsxs)("button",{className:"flex flex-col items-center gap-1 text-[#FF3B30]",children:[(0,A.jsx)(rp,{className:"w-6 h-6"}),(0,A.jsx)("span",{className:"sketch-body text-[10px]",children:"LÃ¶schen"})]})]})]}),(0,A.jsx)("input",{ref:C,type:"file",multiple:!0,accept:"image/*",onChange:e=>{Array.from(e.target.files||[]).forEach(e=>T(e))},className:"hidden"}),O&&(0,A.jsx)("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm z-[60] flex items-center justify-center p-6",children:(0,A.jsxs)(X,{className:"bg-white w-full max-w-[280px] p-6 flex flex-col items-center",children:[(0,A.jsx)("div",{className:"w-16 h-16 rounded-full bg-[#2563EB]/10 flex items-center justify-center mb-4",children:(0,A.jsx)(H.Loader2,{className:"w-8 h-8 text-[#2563EB] animate-spin"})}),(0,A.jsx)("h3",{className:"sketch-subheading text-lg text-center mb-2",children:"Sicherung lÃ¤uft..."}),(0,A.jsx)("p",{className:"sketch-body text-sm text-[#6E6E73] text-center mb-4",children:$>0?`${$}% hochgeladen`:"Vorbereiten..."}),(0,A.jsx)("div",{className:"w-full bg-[#E5E7EB] h-2 rounded-full overflow-hidden",children:(0,A.jsx)("div",{className:"bg-[#2563EB] h-full transition-all duration-300",style:{width:`${$}%`}})})]})})]})}let rb={isOnboarded:!1,backupActive:!1,selectedPlan:"free",autoBackupEnabled:!0,backgroundBackupEnabled:!1,photosCount:0,lastBackup:"Noch nie",permanence:0,encryptionKey:"",backupPhrase:[],devices:[],photoSource:"photos-app"};function rx(){let[e,t]=(0,I.useState)(rb),[s,r]=(0,I.useState)("gallery"),[i,n]=(0,I.useState)("loading"),[a,o]=(0,I.useState)(null),{data:l,isPending:c}=(0,V.useSession)(),h=(0,I.useRef)(!1),u=(0,I.useCallback)(async(e,t)=>{if(h.current)return void console.log("[Device] Already registered this session, skipping");try{let s=(0,sa.getDeviceId)(),r=(0,sa.getDeviceName)(),i=(0,sa.getDeviceType)();await si(s,r,i,e,t),h.current=!0,console.log("[Device] Registered successfully:",s)}catch(e){console.error("[Device] Registration failed:",e)}},[]);(0,I.useEffect)(()=>{(async()=>{if(c)return;if(!l?.user)return n("auth");let e=l.user,s=null;try{let e=await fetch("/api/auth/get-vault-key-hash");e.ok&&(s=(await e.json()).vaultKeyHash)}catch(e){console.error("Failed to fetch vault_key_hash:",e)}o({id:e.id,email:e.email,vaultKeyHash:s});let r=(0,ea.loadKeyFromStorage)();if(r){let i=await (0,ea.getUserKeyHash)(r);if(s&&i!==s){console.warn("Local key doesn't match account's vault_key_hash"),(0,ea.clearKeyFromStorage)(),n("unlock");return}await u(i,e.id),t(e=>({...e,isOnboarded:!0})),n("main")}else s?n("unlock"):n("setup")})()},[l,c,u]);let d=(0,I.useCallback)(async e=>{let s=e.vaultKeyHash;try{let e=await fetch("/api/auth/get-vault-key-hash");e.ok&&(s=(await e.json()).vaultKeyHash)}catch(e){console.error("Failed to fetch vault_key_hash:",e)}o({...e,vaultKeyHash:s});let r=(0,ea.loadKeyFromStorage)();if(r){let i=await (0,ea.getUserKeyHash)(r);s&&i!==s?((0,ea.clearKeyFromStorage)(),n("unlock")):(await u(i,e.id),t(e=>({...e,isOnboarded:!0})),n("main"))}else s?n("unlock"):n("setup")},[u]),p=(0,I.useCallback)(async(e,s)=>{a&&(a.vaultKeyHash||(await rv(a.id,s),o({...a,vaultKeyHash:s})),await u(s,a.id),t(e=>({...e,isOnboarded:!0})),n("main"))},[a,u]),f=(0,I.useCallback)(async e=>{a&&(await rv(a.id,e),o({...a,vaultKeyHash:e}),await u(e,a.id),t(e=>({...e,isOnboarded:!0})),n("main"))},[a,u]),m=(0,I.useCallback)(async()=>{await (0,V.signOut)(),(0,ea.clearKeyFromStorage)(),o(null),t(rb),n("auth")},[]);return"loading"===i||c?(0,A.jsx)(L,{}):"auth"===i?(0,A.jsx)("div",{className:"min-h-screen ios-bg-gray",children:(0,A.jsx)("div",{className:"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7]",children:(0,A.jsx)(er,{onSuccess:d})})}):"unlock"===i&&a?(0,A.jsx)("div",{className:"min-h-screen ios-bg-gray",children:(0,A.jsx)("div",{className:"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7]",children:(0,A.jsx)(eo,{userEmail:a.email,expectedKeyHash:a.vaultKeyHash,onUnlock:p,onCreateNewVault:()=>n("setup"),onLogout:m})})}):"setup"===i&&a?(0,A.jsx)("div",{className:"min-h-screen ios-bg-gray",children:(0,A.jsx)("div",{className:"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7]",children:(0,A.jsx)(ec,{userId:a.id,onComplete:f,onBack:()=>n("unlock")})})}):(0,A.jsx)("div",{className:"min-h-screen ios-bg-gray",children:(0,A.jsxs)("div",{className:"max-w-[1200px] mx-auto min-h-screen bg-[#F2F2F7] flex flex-col relative",children:[(0,A.jsxs)("div",{className:"flex-1 overflow-hidden pb-[80px]",children:["gallery"===s&&(0,A.jsx)(ry,{photosCount:e.photosCount,authUser:a}),"settings"===s&&(0,A.jsx)(sL,{state:e,setState:t,onRestartOnboarding:m,authUser:a})]}),(0,A.jsx)(rw,{currentScreen:s,onNavigate:e=>{r(e)}})]})})}async function rv(e,t){try{if(!(await fetch("/api/auth/update-vault-key",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,keyHash:t})})).ok)throw Error("Failed to update vault key hash")}catch(e){throw console.error("Failed to update vault_key_hash:",e),e}}function rw({currentScreen:e,onNavigate:t}){return(0,A.jsxs)("nav",{className:"fixed bottom-0 left-0 right-0 h-[85px] bg-[#FAFBFC]/90 backdrop-blur-xl border-t-2 border-[#2563EB]/10 flex items-start justify-around pt-3 pb-7 max-w-[1200px] mx-auto z-40",children:[(0,A.jsxs)("button",{onClick:()=>t("gallery"),className:"flex flex-col items-center gap-1 px-8 transition-transform active:scale-95",children:[(0,A.jsx)(ee,{icon:"photo",size:28,color:"gallery"===e?"#2563EB":"#9CA3AF"}),(0,A.jsx)("span",{className:`sketch-subheading text-[12px] ${"gallery"===e?"text-[#2563EB]":"text-[#9CA3AF]"}`,children:"Galerie"})]}),(0,A.jsxs)("button",{onClick:()=>t("settings"),className:"flex flex-col items-center gap-1 px-8 transition-transform active:scale-95",children:[(0,A.jsx)(ee,{icon:"folder",size:28,color:"settings"===e?"#2563EB":"#9CA3AF"}),(0,A.jsx)("span",{className:`sketch-subheading text-[12px] ${"settings"===e?"text-[#2563EB]":"text-[#9CA3AF]"}`,children:"Optionen"})]})]})}e.s(["PhotoVaultApp",()=>rx],71058)}]);